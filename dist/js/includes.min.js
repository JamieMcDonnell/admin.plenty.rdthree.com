function Rainbow(){"use strict";function a(a){if(a.length<2)throw new Error("Rainbow must have two or more colours.");var f=(d-c)/(a.length-1),g=new ColourGradient;g.setGradient(a[0],a[1]),g.setNumberRange(c,c+f),b=[g];for(var h=1;h<a.length-1;h++){var i=new ColourGradient;i.setGradient(a[h],a[h+1]),i.setNumberRange(c+f*h,c+f*(h+1)),b[h]=i}e=a}var b=null,c=0,d=100,e=["ff0000","ffff00","00ff00","0000ff"];a(e),this.setSpectrum=function(){return a(arguments),this},this.setSpectrumByArray=function(b){return a(b),this},this.colourAt=function(a){if(isNaN(a))throw new TypeError(a+" is not a number");if(1===b.length)return b[0].colourAt(a);var e=(d-c)/b.length,f=Math.min(Math.floor((Math.max(a,c)-c)/e),b.length-1);return b[f].colourAt(a)},this.colorAt=this.colourAt,this.setNumberRange=function(b,f){if(!(f>b))throw new RangeError("maxNumber ("+f+") is not greater than minNumber ("+b+")");return c=b,d=f,a(e),this}}function ColourGradient(){"use strict";function a(a,c,d){var e=a;g>e&&(e=g),e>h&&(e=h);var f=h-g,i=parseInt(c,16),j=parseInt(d,16),k=(j-i)/f,l=Math.round(k*(e-g)+i);return b(l.toString(16))}function b(a){return 1===a.length?"0"+a:a}function c(a){var b=/^#?[0-9a-fA-F]{6}$/i;return b.test(a)}function d(a){if(c(a))return a.substring(a.length-6,a.length);var b=a.toLowerCase();if(i.hasOwnProperty(b))return i[b];throw new Error(a+" is not a valid colour.")}var e="ff0000",f="0000ff",g=0,h=100;this.setGradient=function(a,b){e=d(a),f=d(b)},this.setNumberRange=function(a,b){if(!(b>a))throw new RangeError("maxNumber ("+b+") is not greater than minNumber ("+a+")");g=a,h=b},this.colourAt=function(b){return a(b,e.substring(0,2),f.substring(0,2))+a(b,e.substring(2,4),f.substring(2,4))+a(b,e.substring(4,6),f.substring(4,6))};var i={aliceblue:"F0F8FF",antiquewhite:"FAEBD7",aqua:"00FFFF",aquamarine:"7FFFD4",azure:"F0FFFF",beige:"F5F5DC",bisque:"FFE4C4",black:"000000",blanchedalmond:"FFEBCD",blue:"0000FF",blueviolet:"8A2BE2",brown:"A52A2A",burlywood:"DEB887",cadetblue:"5F9EA0",chartreuse:"7FFF00",chocolate:"D2691E",coral:"FF7F50",cornflowerblue:"6495ED",cornsilk:"FFF8DC",crimson:"DC143C",cyan:"00FFFF",darkblue:"00008B",darkcyan:"008B8B",darkgoldenrod:"B8860B",darkgray:"A9A9A9",darkgreen:"006400",darkgrey:"A9A9A9",darkkhaki:"BDB76B",darkmagenta:"8B008B",darkolivegreen:"556B2F",darkorange:"FF8C00",darkorchid:"9932CC",darkred:"8B0000",darksalmon:"E9967A",darkseagreen:"8FBC8F",darkslateblue:"483D8B",darkslategray:"2F4F4F",darkslategrey:"2F4F4F",darkturquoise:"00CED1",darkviolet:"9400D3",deeppink:"FF1493",deepskyblue:"00BFFF",dimgray:"696969",dimgrey:"696969",dodgerblue:"1E90FF",firebrick:"B22222",floralwhite:"FFFAF0",forestgreen:"228B22",fuchsia:"FF00FF",gainsboro:"DCDCDC",ghostwhite:"F8F8FF",gold:"FFD700",goldenrod:"DAA520",gray:"808080",green:"008000",greenyellow:"ADFF2F",grey:"808080",honeydew:"F0FFF0",hotpink:"FF69B4",indianred:"CD5C5C",indigo:"4B0082",ivory:"FFFFF0",khaki:"F0E68C",lavender:"E6E6FA",lavenderblush:"FFF0F5",lawngreen:"7CFC00",lemonchiffon:"FFFACD",lightblue:"ADD8E6",lightcoral:"F08080",lightcyan:"E0FFFF",lightgoldenrodyellow:"FAFAD2",lightgray:"D3D3D3",lightgreen:"90EE90",lightgrey:"D3D3D3",lightpink:"FFB6C1",lightsalmon:"FFA07A",lightseagreen:"20B2AA",lightskyblue:"87CEFA",lightslategray:"778899",lightslategrey:"778899",lightsteelblue:"B0C4DE",lightyellow:"FFFFE0",lime:"00FF00",limegreen:"32CD32",linen:"FAF0E6",magenta:"FF00FF",maroon:"800000",mediumaquamarine:"66CDAA",mediumblue:"0000CD",mediumorchid:"BA55D3",mediumpurple:"9370DB",mediumseagreen:"3CB371",mediumslateblue:"7B68EE",mediumspringgreen:"00FA9A",mediumturquoise:"48D1CC",mediumvioletred:"C71585",midnightblue:"191970",mintcream:"F5FFFA",mistyrose:"FFE4E1",moccasin:"FFE4B5",navajowhite:"FFDEAD",navy:"000080",oldlace:"FDF5E6",olive:"808000",olivedrab:"6B8E23",orange:"FFA500",orangered:"FF4500",orchid:"DA70D6",palegoldenrod:"EEE8AA",palegreen:"98FB98",paleturquoise:"AFEEEE",palevioletred:"DB7093",papayawhip:"FFEFD5",peachpuff:"FFDAB9",peru:"CD853F",pink:"FFC0CB",plum:"DDA0DD",powderblue:"B0E0E6",purple:"800080",red:"FF0000",rosybrown:"BC8F8F",royalblue:"4169E1",saddlebrown:"8B4513",salmon:"FA8072",sandybrown:"F4A460",seagreen:"2E8B57",seashell:"FFF5EE",sienna:"A0522D",silver:"C0C0C0",skyblue:"87CEEB",slateblue:"6A5ACD",slategray:"708090",slategrey:"708090",snow:"FFFAFA",springgreen:"00FF7F",steelblue:"4682B4",tan:"D2B48C",teal:"008080",thistle:"D8BFD8",tomato:"FF6347",turquoise:"40E0D0",violet:"EE82EE",wheat:"F5DEB3",white:"FFFFFF",whitesmoke:"F5F5F5",yellow:"FFFF00",yellowgreen:"9ACD32"}}function RichMarker(a){var b=a||{};this.ready_=!1,this.dragging_=!1,void 0==a.visible&&(a.visible=!0),void 0==a.shadow&&(a.shadow="7px -3px 5px rgba(88,88,88,0.7)"),void 0==a.anchor&&(a.anchor=RichMarkerPosition.BOTTOM),this.setValues(b)}!function(a,b){"object"==typeof exports&&"object"==typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):"object"==typeof exports?exports.restful=b():a.restful=b()}(this,function(){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={exports:{},id:d,loaded:!1};return a[d].call(e.exports,e,e.exports,b),e.loaded=!0,e.exports}var c={};return b.m=a,b.c=c,b.p="",b(0)}([function(a,b,c){"use strict";function d(a,b){var c={baseUrl:a,port:b||80,prefixUrl:"",protocol:"http"},d=function(){var a={_http:l(k),headers:{},requestInterceptors:[],responseInterceptors:[]},b={url:function(a){var b=function(){return a.apply(this,arguments)};return b.toString=function(){return a.toString()},b}(function(){var a=c.protocol+"://"+c.baseUrl;return 80!==c.port&&(a+=":"+c.port),""!==c.prefixUrl&&(a+="/"+c.prefixUrl),a})};return g(b,a),f(function(){return a._http},b)}(),e={url:function(){return d.url()},one:function(a,b){return i(a,b,e)},all:function(a){return h(a,e)}};return e=f(j(d),e),g(e,c),e}var e=function(a){return a&&a.__esModule?a["default"]:a};a.exports=d;var f=e(c(1)),g=e(c(2)),h=e(c(3)),i=e(c(4)),j=e(c(5)),k=e(c(7)),l=e(c(6))},function(a){"use strict";function b(a){if(null==a)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(a)}a.exports=Object.assign||function(a){for(var c,d,e=b(a),f=1;f<arguments.length;f++){c=arguments[f],d=Object.keys(Object(c));for(var g=0;g<d.length;g++)e[d[g]]=c[d[g]]}return e}},function(a){"use strict";function b(a,b){for(var c in b)b.hasOwnProperty(c)&&!function(c){a[c]=function(d){return arguments.length?(b[c]=d,a):b[c]}}(c)}a.exports=b},function(a,b,c){"use strict";function d(a,b){function c(c){var e=i(a,c,b);return e().headers(d.headers()).responseInterceptors(d.responseInterceptors()).requestInterceptors(d.requestInterceptors()),e}var d=g([b.url(),a].join("/"),b()),e={get:function(a,b,e){return d.get(a,b,e).then(function(a){return h(a,c)})},getAll:function(a,b){return d.getAll(a,b).then(function(a){return h(a,c)})},post:function(a,b){return d.post(a,b).then(function(a){return h(a)})},put:function(a,b,c){return d.put(a,b,c).then(function(a){return h(a)})},patch:function(a,b,c){return d.patch(a,b,c).then(function(a){return h(a)})},head:function(a,b,c){return d.head(a,b,c).then(function(a){return h(a)})},"delete":function(a,b){return d["delete"](a,b).then(function(a){return h(a)})},url:function(){return[b.url(),a].join("/")}};return f(j(d),e)}var e=function(a){return a&&a.__esModule?a["default"]:a};a.exports=d;var f=e(c(1)),g=e(c(8)),h=e(c(9)),i=e(c(4)),j=e(c(5))},function(a,b,c){"use strict";function d(a,b,c){var e=h([c.url(),a].join("/"),c()),k={get:function(a,c){return e.get(b,a,c).then(function(a){return i(a,function(){return k})})},put:function(a,c){return e.put(b,a,c).then(function(a){return i(a)})},patch:function(a,c){return e.patch(b,a,c).then(function(a){return i(a)})},head:function(a,c){return e.head(b,a,c).then(function(a){return i(a)})},"delete":function(a){return e["delete"](b,a).then(function(a){return i(a)})},one:function(a,b){return d(a,b,k)},all:function(a){return g(a,k)},url:function(){return[c.url(),a,b].join("/")}};return k=f(j(e),k)}var e=function(a){return a&&a.__esModule?a["default"]:a};a.exports=d;var f=e(c(1)),g=e(c(3)),h=e(c(8)),i=e(c(9)),j=e(c(5))},function(a,b,c){"use strict";function d(a){function b(){return a}return b=f(b,{addRequestInterceptor:function(c){return a.requestInterceptors().push(c),b},requestInterceptors:function(){return a.requestInterceptors()},addResponseInterceptor:function(c){return a.responseInterceptors().push(c),b},responseInterceptors:function(){return a.responseInterceptors},header:function(c,d){return a.headers()[c]=d,b},headers:function(){return a.headers()}})}var e=function(a){return a&&a.__esModule?a["default"]:a};a.exports=d;var f=e(c(1))},function(a,b,c){"use strict";function d(a,b,c,d){return d=void 0!==d?!!d:!1,function(e,f){if(d)try{e=JSON.parse(e)}catch(g){}for(var h in a)e=a[h](e,f,b,c);if(!d)try{e=JSON.stringify(e)}catch(g){}return e}}function e(a){var b={request:function(b,c){return c.method=b,-1!==["post","put","patch"].indexOf(b)&&(c.transformRequest=[d(c.requestInterceptors||[],c.method,c.url)],delete c.requestInterceptors),c.transformResponse=[d(c.responseInterceptors||[],c.method,c.url,!0)],delete c.responseInterceptors,a(c)}};return g(function(){return a},b)}var f=function(a){return a&&a.__esModule?a["default"]:a};a.exports=e;var g=f(c(1))},function(a,b,c){a.exports=c(10)},function(a,b,c){"use strict";function d(a,b){function c(){for(var a=j,b=[];a;)b=b.concat(a.requestInterceptors()),a=a._parent?a._parent():null;return b}function d(){for(var a=j,b=[];a;)b=b.concat(a.responseInterceptors()),a=a._parent?a._parent():null;return b}function e(){for(var a=j,b={};a;)f(b,a.headers()),a=a._parent?a._parent():null;return b}function h(a){var b=void 0===arguments[1]?{}:arguments[1],g=void 0===arguments[2]?{}:arguments[2],h=void 0===arguments[3]?null:arguments[3],i={url:a,params:b||{},headers:f({},e(),g||{}),responseInterceptors:d()};return h&&(i.data=h,i.requestInterceptors=c()),i}var i={_parent:b,headers:{},requestInterceptors:[],responseInterceptors:[]},j={get:function(b,c,d){return i._parent().request("get",h(a+"/"+b,c,d))},getAll:function(b,c){return i._parent().request("get",h(a,b,c))},post:function(b,c){return c=c||{},c["Content-Type"]||(c["Content-Type"]="application/json;charset=UTF-8"),i._parent().request("post",h(a,{},c,b))},put:function(b,c,d){return d=d||{},d["Content-Type"]||(d["Content-Type"]="application/json;charset=UTF-8"),i._parent().request("put",h(a+"/"+b,{},d,c))},patch:function(b,c,d){return d=d||{},d["Content-Type"]||(d["Content-Type"]="application/json;charset=UTF-8"),i._parent().request("patch",h(a+"/"+b,{},d,c))},"delete":function(b,c){return i._parent().request("delete",h(a+"/"+b,{},c))},head:function(b,c){return i._parent().request("head",h(a+"/"+b,{},c))}};return j=f(function(){return i._parent()},j),g(j,i),j}var e=function(a){return a&&a.__esModule?a["default"]:a};a.exports=d;var f=e(c(1)),g=e(c(2));e(c(11))},function(a,b,c){"use strict";var d=function(a){return a&&a.__esModule?a["default"]:a},e=d(c(12));a.exports=function(a,b){return new Promise(function(c,d){var f=a.status;return f>=200&&400>f?c(e(a,b)):void d(e(a))})}},function(a,b,c){function d(){g.forEach(arguments,function(a){k[a]=function(b,c){return k(g.merge(c||{},{method:a,url:b}))}})}function e(){g.forEach(arguments,function(a){k[a]=function(b,c,d){return k(g.merge(d||{},{method:a,url:b,data:c}))}})}var f=c(13),g=c(14),h=c(15),i=c(16),j=c(17);!function(){var a=c(20);a&&"function"==typeof a.polyfill&&a.polyfill()}();var k=a.exports=function l(a){a=g.merge({method:"get",headers:{},transformRequest:f.transformRequest,transformResponse:f.transformResponse},a),a.withCredentials=a.withCredentials||f.withCredentials;var b=[i,void 0],c=Promise.resolve(a);for(l.interceptors.request.forEach(function(a){b.unshift(a.fulfilled,a.rejected)}),l.interceptors.response.forEach(function(a){b.push(a.fulfilled,a.rejected)});b.length;)c=c.then(b.shift(),b.shift());return c.success=function(a){return h("success","then","https://github.com/mzabriskie/axios/blob/master/README.md#response-api"),c.then(function(b){a(b.data,b.status,b.headers,b.config)}),c},c.error=function(a){return h("error","catch","https://github.com/mzabriskie/axios/blob/master/README.md#response-api"),c.then(null,function(b){a(b.data,b.status,b.headers,b.config)}),c},c};k.defaults=f,k.all=function(a){return Promise.all(a)},k.spread=c(18),k.interceptors={request:new j,response:new j},d("delete","get","head"),e("post","put","patch")},function(a,b,c){"use strict";function d(a,b,c){var d={one:function(a,b){return c.one(a,b)},all:function(a){return c.all(a)},save:function(a){return c.put(b,a)},remove:function(a){return c["delete"](a)},url:function(){return c.url()},id:function(a){var b=function(){return a.apply(this,arguments)};return b.toString=function(){return a.toString()},b}(function(){return a}),data:function(a){var b=function(){return a.apply(this,arguments)};return b.toString=function(){return a.toString()},b}(function(){return b})};return f(function(){return b},d)}var e=function(a){return a&&a.__esModule?a["default"]:a};a.exports=d;var f=e(c(1))},function(a,b,c){"use strict";function d(a,b){var c={status:function(){return a.status},body:function(){var c=void 0===arguments[0]?!0:arguments[0];return c&&b?"[object Array]"===Object.prototype.toString.call(a.data)?a.data.map(function(a){return g(a.id,a,b(a.id))}):g(a.data.id,a.data,b(a.data.id)):a.data},headers:function(){return a.headers},config:function(){return a.config}};return f(function(){return a},c)}var e=function(a){return a&&a.__esModule?a["default"]:a};a.exports=d;var f=e(c(1)),g=e(c(11))},function(a,b,c){"use strict";var d=c(14),e=/^\s*(\[|\{[^\{])/,f=/[\}\]]\s*$/,g=/^\)\]\}',?\n/,h={"Content-Type":"application/x-www-form-urlencoded"};a.exports={transformRequest:[function(a,b){return d.isArrayBuffer(a)?a:d.isArrayBufferView(a)?a.buffer:!d.isObject(a)||d.isFile(a)||d.isBlob(a)?a:(!d.isUndefined(b)&&d.isUndefined(b["Content-Type"])&&(b["Content-Type"]="application/json;charset=utf-8"),JSON.stringify(a))}],transformResponse:[function(a){return"string"==typeof a&&(a=a.replace(g,""),e.test(a)&&f.test(a)&&(a=JSON.parse(a))),a}],headers:{common:{Accept:"application/json, text/plain, */*"},patch:d.merge(h),post:d.merge(h),put:d.merge(h)},xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN"}},function(a){function b(a){return"[object Array]"===p.call(a)}function c(a){return"[object ArrayBuffer]"===p.call(a)}function d(a){return"[object FormData]"===p.call(a)}function e(a){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(a):a&&a.buffer&&a.buffer instanceof ArrayBuffer}function f(a){return"string"==typeof a}function g(a){return"number"==typeof a}function h(a){return"undefined"==typeof a}function i(a){return null!==a&&"object"==typeof a}function j(a){return"[object Date]"===p.call(a)}function k(a){return"[object File]"===p.call(a)}function l(a){return"[object Blob]"===p.call(a)}function m(a){return a.replace(/^\s*/,"").replace(/\s*$/,"")}function n(a,c){if(null!==a&&"undefined"!=typeof a){var d=b(a)||"object"==typeof a&&!isNaN(a.length);if("object"==typeof a||d||(a=[a]),d)for(var e=0,f=a.length;f>e;e++)c.call(null,a[e],e,a);else for(var g in a)a.hasOwnProperty(g)&&c.call(null,a[g],g,a)}}function o(){var a={};return n(arguments,function(b){n(b,function(b,c){a[c]=b})}),a}var p=Object.prototype.toString;a.exports={isArray:b,isArrayBuffer:c,isFormData:d,isArrayBufferView:e,isString:f,isNumber:g,isObject:i,isUndefined:h,isDate:j,isFile:k,isBlob:l,forEach:n,merge:o,trim:m}},function(a){"use strict";a.exports=function(a,b,c){try{console.warn("DEPRECATED method `"+a+"`."+(b?" Use `"+b+"` instead.":"")+" This method will be removed in a future release."),c&&console.warn("For more information about usage see "+c)}catch(d){}}},function(a,b,c){(function(b){"use strict";a.exports=function(a){return new Promise(function(d,e){try{"undefined"!=typeof window?c(19)(d,e,a):"undefined"!=typeof b&&c(19)(d,e,a)}catch(f){e(f)}})}}).call(b,c(21))},function(a,b,c){"use strict";function d(){this.handlers=[]}var e=c(14);d.prototype.use=function(a,b){return this.handlers.push({fulfilled:a,rejected:b}),this.handlers.length-1},d.prototype.eject=function(a){this.handlers[a]&&(this.handlers[a]=null)},d.prototype.forEach=function(a){e.forEach(this.handlers,function(b){null!==b&&a(b)})},a.exports=d},function(a){a.exports=function(a){return function(b){a.apply(null,b)}}},function(a,b,c){var d=c(13),e=c(14),f=c(22),g=c(23),h=c(24),i=c(25),j=c(26);a.exports=function(a,b,c){var k=i(c.data,c.headers,c.transformRequest),l=e.merge(d.headers.common,d.headers[c.method]||{},c.headers||{});e.isFormData(k)&&delete l["Content-Type"];var m=new(XMLHttpRequest||ActiveXObject)("Microsoft.XMLHTTP");m.open(c.method.toUpperCase(),f(c.url,c.params),!0),m.onreadystatechange=function(){if(m&&4===m.readyState){var d=h(m.getAllResponseHeaders()),e=-1!==["text",""].indexOf(c.responseType||"")?m.responseText:m.response,f={data:i(e,d,c.transformResponse),status:m.status,statusText:m.statusText,headers:d,config:c};(m.status>=200&&m.status<300?a:b)(f),m=null}};var n=j(c.url)?g.read(c.xsrfCookieName||d.xsrfCookieName):void 0;if(n&&(l[c.xsrfHeaderName||d.xsrfHeaderName]=n),e.forEach(l,function(a,b){k||"content-type"!==b.toLowerCase()?m.setRequestHeader(b,a):delete l[b]}),c.withCredentials&&(m.withCredentials=!0),c.responseType)try{m.responseType=c.responseType}catch(o){if("json"!==m.responseType)throw o}e.isArrayBuffer(k)&&(k=new DataView(k)),m.send(k)}},function(a,b,c){var d;(function(a,e,f){(function(){"use strict";function g(a){return"function"==typeof a||"object"==typeof a&&null!==a}function h(a){return"function"==typeof a}function i(a){return"object"==typeof a&&null!==a}function j(){}function k(){return function(){a.nextTick(o)}}function l(){var a=0,b=new R(o),c=document.createTextNode("");return b.observe(c,{characterData:!0}),function(){c.data=a=++a%2}}function m(){var a=new MessageChannel;return a.port1.onmessage=o,function(){a.port2.postMessage(0)}}function n(){return function(){setTimeout(o,1)}}function o(){for(var a=0;O>a;a+=2){var b=T[a],c=T[a+1];b(c),T[a]=void 0,T[a+1]=void 0}O=0}function p(){}function q(){return new TypeError("You cannot resolve a promise with itself")}function r(){return new TypeError("A promises callback cannot return that same promise.")}function s(a){try{return a.then}catch(b){return X.error=b,X}}function t(a,b,c,d){try{a.call(b,c,d)}catch(e){return e}}function u(a,b,c){P(function(a){var d=!1,e=t(c,b,function(c){d||(d=!0,b!==c?x(a,c):z(a,c))},function(b){d||(d=!0,A(a,b))},"Settle: "+(a._label||" unknown promise"));!d&&e&&(d=!0,A(a,e))},a)}function v(a,b){b._state===V?z(a,b._result):a._state===W?A(a,b._result):B(b,void 0,function(b){x(a,b)},function(b){A(a,b)})}function w(a,b){if(b.constructor===a.constructor)v(a,b);else{var c=s(b);c===X?A(a,X.error):void 0===c?z(a,b):h(c)?u(a,b,c):z(a,b)}}function x(a,b){a===b?A(a,q()):g(b)?w(a,b):z(a,b)}function y(a){a._onerror&&a._onerror(a._result),C(a)}function z(a,b){a._state===U&&(a._result=b,a._state=V,0===a._subscribers.length||P(C,a))}function A(a,b){a._state===U&&(a._state=W,a._result=b,P(y,a))}function B(a,b,c,d){var e=a._subscribers,f=e.length;a._onerror=null,e[f]=b,e[f+V]=c,e[f+W]=d,0===f&&a._state&&P(C,a)}function C(a){var b=a._subscribers,c=a._state;if(0!==b.length){for(var d,e,f=a._result,g=0;g<b.length;g+=3)d=b[g],e=b[g+c],d?F(c,d,e,f):e(f);a._subscribers.length=0}}function D(){this.error=null}function E(a,b){try{return a(b)}catch(c){return Y.error=c,Y}}function F(a,b,c,d){var e,f,g,i,j=h(c);if(j){if(e=E(c,d),e===Y?(i=!0,f=e.error,e=null):g=!0,b===e)return void A(b,r())}else e=d,g=!0;b._state!==U||(j&&g?x(b,e):i?A(b,f):a===V?z(b,e):a===W&&A(b,e))}function G(a,b){try{b(function(b){x(a,b)},function(b){A(a,b)})}catch(c){A(a,c)}}function H(a,b,c,d){this._instanceConstructor=a,this.promise=new a(p,d),this._abortOnReject=c,this._validateInput(b)?(this._input=b,this.length=b.length,this._remaining=b.length,this._init(),0===this.length?z(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&z(this.promise,this._result))):A(this.promise,this._validationError())}function I(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function J(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function K(a){this._id=ca++,this._state=void 0,this._result=void 0,this._subscribers=[],p!==a&&(h(a)||I(),this instanceof K||J(),G(this,a))}var L;L=Array.isArray?Array.isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)};var M,N=L,O=(Date.now||function(){return(new Date).getTime()},Object.create||function(a){if(arguments.length>1)throw new Error("Second argument not supported");if("object"!=typeof a)throw new TypeError("Argument must be an object");return j.prototype=a,new j},0),P=function(a,b){T[O]=a,T[O+1]=b,O+=2,2===O&&M()},Q="undefined"!=typeof window?window:{},R=Q.MutationObserver||Q.WebKitMutationObserver,S="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,T=new Array(1e3);M="undefined"!=typeof a&&"[object process]"==={}.toString.call(a)?k():R?l():S?m():n();var U=void 0,V=1,W=2,X=new D,Y=new D;H.prototype._validateInput=function(a){return N(a)},H.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},H.prototype._init=function(){this._result=new Array(this.length)};var Z=H;H.prototype._enumerate=function(){for(var a=this.length,b=this.promise,c=this._input,d=0;b._state===U&&a>d;d++)this._eachEntry(c[d],d)},H.prototype._eachEntry=function(a,b){var c=this._instanceConstructor;i(a)?a.constructor===c&&a._state!==U?(a._onerror=null,this._settledAt(a._state,b,a._result)):this._willSettleAt(c.resolve(a),b):(this._remaining--,this._result[b]=this._makeResult(V,b,a))},H.prototype._settledAt=function(a,b,c){var d=this.promise;d._state===U&&(this._remaining--,this._abortOnReject&&a===W?A(d,c):this._result[b]=this._makeResult(a,b,c)),0===this._remaining&&z(d,this._result)},H.prototype._makeResult=function(a,b,c){return c},H.prototype._willSettleAt=function(a,b){var c=this;B(a,void 0,function(a){c._settledAt(V,b,a)},function(a){c._settledAt(W,b,a)})};var $=function(a,b){return new Z(this,a,!0,b).promise},_=function(a,b){function c(a){x(f,a)}function d(a){A(f,a)}var e=this,f=new e(p,b);if(!N(a))return A(f,new TypeError("You must pass an array to race.")),f;for(var g=a.length,h=0;f._state===U&&g>h;h++)B(e.resolve(a[h]),void 0,c,d);return f},aa=function(a,b){var c=this;if(a&&"object"==typeof a&&a.constructor===c)return a;var d=new c(p,b);return x(d,a),d},ba=function(a,b){var c=this,d=new c(p,b);return A(d,a),d},ca=0,da=K;K.all=$,K.race=_,K.resolve=aa,K.reject=ba,K.prototype={constructor:K,then:function(a,b){var c=this,d=c._state;if(d===V&&!a||d===W&&!b)return this;var e=new this.constructor(p),f=c._result;if(d){var g=arguments[d-1];P(function(){F(d,e,g,f)})}else B(c,e,a,b);return e},"catch":function(a){return this.then(null,a)}};var ea=function(){var a;a="undefined"!=typeof e?e:"undefined"!=typeof window&&window.document?window:self;var b="Promise"in a&&"resolve"in a.Promise&&"reject"in a.Promise&&"all"in a.Promise&&"race"in a.Promise&&function(){var b;return new a.Promise(function(a){b=a}),h(b)}();b||(a.Promise=da)},fa={Promise:da,polyfill:ea};c(27).amd?(d=function(){return fa}.call(b,c,b,f),!(void 0!==d&&(f.exports=d))):"undefined"!=typeof f&&f.exports?f.exports=fa:"undefined"!=typeof this&&(this.ES6Promise=fa)}).call(this)}).call(b,c(21),function(){return this}(),c(28)(a))},function(a){function b(){}var c=a.exports={};c.nextTick=function(){var a="undefined"!=typeof window&&window.setImmediate,b="undefined"!=typeof window&&window.MutationObserver,c="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(a)return function(a){return window.setImmediate(a)};var d=[];if(b){var e=document.createElement("div"),f=new MutationObserver(function(){var a=d.slice();d.length=0,a.forEach(function(a){a()})});return f.observe(e,{attributes:!0}),function(a){d.length||e.setAttribute("yes","no"),d.push(a)}}return c?(window.addEventListener("message",function(a){var b=a.source;if((b===window||null===b)&&"process-tick"===a.data&&(a.stopPropagation(),d.length>0)){var c=d.shift();c()}},!0),function(a){d.push(a),window.postMessage("process-tick","*")}):function(a){setTimeout(a,0)}}(),c.title="browser",c.browser=!0,c.env={},c.argv=[],c.on=b,c.addListener=b,c.once=b,c.off=b,c.removeListener=b,c.removeAllListeners=b,c.emit=b,c.binding=function(){throw new Error("process.binding is not supported")},c.cwd=function(){return"/"},c.chdir=function(){throw new Error("process.chdir is not supported")}},function(a,b,c){"use strict";function d(a){return encodeURIComponent(a).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}var e=c(14);a.exports=function(a,b){if(!b)return a;var c=[];return e.forEach(b,function(a,b){null!==a&&"undefined"!=typeof a&&(e.isArray(a)||(a=[a]),e.forEach(a,function(a){e.isDate(a)?a=a.toISOString():e.isObject(a)&&(a=JSON.stringify(a)),c.push(d(b)+"="+d(a))}))}),c.length>0&&(a+=(-1===a.indexOf("?")?"?":"&")+c.join("&")),a}},function(a,b,c){"use strict";var d=c(14);a.exports={write:function(a,b,c,e,f,g){var h=[];h.push(a+"="+encodeURIComponent(b)),d.isNumber(c)&&h.push("expires="+new Date(c).toGMTString()),d.isString(e)&&h.push("path="+e),d.isString(f)&&h.push("domain="+f),g===!0&&h.push("secure"),document.cookie=h.join("; ")},read:function(a){var b=document.cookie.match(new RegExp("(^|;\\s*)("+a+")=([^;]*)"));return b?decodeURIComponent(b[3]):null},remove:function(a){this.write(a,"",Date.now()-864e5)}}},function(a,b,c){"use strict";var d=c(14);a.exports=function(a){var b,c,e,f={};return a?(d.forEach(a.split("\n"),function(a){e=a.indexOf(":"),b=d.trim(a.substr(0,e)).toLowerCase(),c=d.trim(a.substr(e+1)),b&&(f[b]=f[b]?f[b]+", "+c:c)}),f):f}},function(a,b,c){"use strict";var d=c(14);a.exports=function(a,b,c){return d.forEach(c,function(c){a=c(a,b)}),a}},function(a,b,c){"use strict";function d(a){var b=a;return e&&(g.setAttribute("href",b),b=g.href),g.setAttribute("href",b),{href:g.href,protocol:g.protocol?g.protocol.replace(/:$/,""):"",host:g.host,search:g.search?g.search.replace(/^\?/,""):"",hash:g.hash?g.hash.replace(/^#/,""):"",hostname:g.hostname,port:g.port,pathname:"/"===g.pathname.charAt(0)?g.pathname:"/"+g.pathname}}var e=/(msie|trident)/i.test(navigator.userAgent),f=c(14),g=document.createElement("a"),h=d(window.location.href);a.exports=function(a){var b=f.isString(a)?d(a):a;return b.protocol===h.protocol&&b.host===h.host}},function(a){a.exports=function(){throw new Error("define cannot be used indirect")}},function(a){a.exports=function(a){return a.webpackPolyfill||(a.deprecate=function(){},a.paths=[],a.children=[],a.webpackPolyfill=1),a}}])}),function(a){function b(){try{return g in a&&a[g]}catch(b){return!1}}function c(a){return a.replace(/^d/,"___$&").replace(m,"___")}var d,e={},f=a.document,g="localStorage",h="script";if(e.disabled=!1,e.version="1.3.17",e.set=function(){},e.get=function(){},e.has=function(a){return void 0!==e.get(a)},e.remove=function(){},e.clear=function(){},e.transact=function(a,b,c){null==c&&(c=b,b=null),null==b&&(b={});var d=e.get(a,b);c(d),e.set(a,d)},e.getAll=function(){},e.forEach=function(){},e.serialize=function(a){return JSON.stringify(a)},e.deserialize=function(a){if("string"!=typeof a)return void 0;try{return JSON.parse(a)}catch(b){return a||void 0}},b())d=a[g],e.set=function(a,b){return void 0===b?e.remove(a):(d.setItem(a,e.serialize(b)),b)},e.get=function(a,b){var c=e.deserialize(d.getItem(a));return void 0===c?b:c},e.remove=function(a){d.removeItem(a)},e.clear=function(){d.clear()},e.getAll=function(){var a={};return e.forEach(function(b,c){a[b]=c}),a},e.forEach=function(a){for(var b=0;b<d.length;b++){var c=d.key(b);a(c,e.get(c))}};else if(f.documentElement.addBehavior){var i,j;try{j=new ActiveXObject("htmlfile"),j.open(),j.write("<"+h+">document.w=window</"+h+'><iframe src="/favicon.ico"></iframe>'),j.close(),i=j.w.frames[0].document,d=i.createElement("div")}catch(k){d=f.createElement("div"),i=f.body}var l=function(a){return function(){var b=Array.prototype.slice.call(arguments,0);b.unshift(d),i.appendChild(d),d.addBehavior("#default#userData"),d.load(g);var c=a.apply(e,b);return i.removeChild(d),c}},m=new RegExp("[!\"#$%&'()*+,/\\\\:;<=>?@[\\]^`{|}~]","g");e.set=l(function(a,b,d){return b=c(b),void 0===d?e.remove(b):(a.setAttribute(b,e.serialize(d)),a.save(g),d)}),e.get=l(function(a,b,d){b=c(b);var f=e.deserialize(a.getAttribute(b));return void 0===f?d:f}),e.remove=l(function(a,b){b=c(b),a.removeAttribute(b),a.save(g)}),e.clear=l(function(a){var b=a.XMLDocument.documentElement.attributes;a.load(g);for(var c,d=0;c=b[d];d++)a.removeAttribute(c.name);a.save(g)}),e.getAll=function(){var a={};return e.forEach(function(b,c){a[b]=c}),a},e.forEach=l(function(a,b){for(var c,d=a.XMLDocument.documentElement.attributes,f=0;c=d[f];++f)b(c.name,e.deserialize(a.getAttribute(c.name)))})}try{var n="__storejs__";e.set(n,n),e.get(n)!=n&&(e.disabled=!0),e.remove(n)}catch(k){e.disabled=!0}e.enabled=!e.disabled,"undefined"!=typeof module&&module.exports&&this.module!==module?module.exports=e:"function"==typeof define&&define.amd?define(e):a.store=e}(Function("return this")()),"undefined"!=typeof module&&(module.exports=Rainbow),!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.eventcollector=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){function c(a){return"number"==typeof a&&a%1===0&&a>0}var d=a("events"),e=a("util"),f="done",g="alldone",h="timeout",i=function(a,b){if(d.EventEmitter.call(this),!c(a))throw new Error("`total` must be a positive integer");if(b&&!c(b))throw new Error("`timeout` must be a positive integer");this.destroyed=!1,this.total=a,this.fired=0,b&&(this.timer=setTimeout(function(){this.onTimeout()}.bind(this),b))};e.inherits(i,d.EventEmitter),i.prototype.done=function(a){if(!this.destroyed){this.fired++;try{this.emit(f,this.fired,this.total,a),this.fired===this.total&&(this.destroy(),this.emit(g,this.total))}catch(b){throw b}return this}},i.prototype.destroy=function(){this.destroyed=!0,clearTimeout(this.timer)},i.prototype.onTimeout=function(){this.destroyed||this.emit(h,this.fired,this.total)},b.exports=function(a,b){return new i(a,b)}},{events:2,util:6}],2:[function(a,b){function c(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function d(a){return"function"==typeof a}function e(a){return"number"==typeof a}function f(a){return"object"==typeof a&&null!==a}function g(a){return void 0===a}b.exports=c,c.EventEmitter=c,c.prototype._events=void 0,c.prototype._maxListeners=void 0,c.defaultMaxListeners=10,c.prototype.setMaxListeners=function(a){if(!e(a)||0>a||isNaN(a))throw TypeError("n must be a positive number");return this._maxListeners=a,this},c.prototype.emit=function(a){var b,c,e,h,i,j;if(this._events||(this._events={}),"error"===a&&(!this._events.error||f(this._events.error)&&!this._events.error.length)){if(b=arguments[1],b instanceof Error)throw b;throw TypeError('Uncaught, unspecified "error" event.')}if(c=this._events[a],g(c))return!1;if(d(c))switch(arguments.length){case 1:
c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:for(e=arguments.length,h=new Array(e-1),i=1;e>i;i++)h[i-1]=arguments[i];c.apply(this,h)}else if(f(c)){for(e=arguments.length,h=new Array(e-1),i=1;e>i;i++)h[i-1]=arguments[i];for(j=c.slice(),e=j.length,i=0;e>i;i++)j[i].apply(this,h)}return!0},c.prototype.addListener=function(a,b){var e;if(!d(b))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",a,d(b.listener)?b.listener:b),this._events[a]?f(this._events[a])?this._events[a].push(b):this._events[a]=[this._events[a],b]:this._events[a]=b,f(this._events[a])&&!this._events[a].warned){var e;e=g(this._maxListeners)?c.defaultMaxListeners:this._maxListeners,e&&e>0&&this._events[a].length>e&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),"function"==typeof console.trace&&console.trace())}return this},c.prototype.on=c.prototype.addListener,c.prototype.once=function(a,b){function c(){this.removeListener(a,c),e||(e=!0,b.apply(this,arguments))}if(!d(b))throw TypeError("listener must be a function");var e=!1;return c.listener=b,this.on(a,c),this},c.prototype.removeListener=function(a,b){var c,e,g,h;if(!d(b))throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;if(c=this._events[a],g=c.length,e=-1,c===b||d(c.listener)&&c.listener===b)delete this._events[a],this._events.removeListener&&this.emit("removeListener",a,b);else if(f(c)){for(h=g;h-->0;)if(c[h]===b||c[h].listener&&c[h].listener===b){e=h;break}if(0>e)return this;1===c.length?(c.length=0,delete this._events[a]):c.splice(e,1),this._events.removeListener&&this.emit("removeListener",a,b)}return this},c.prototype.removeAllListeners=function(a){var b,c;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[a]&&delete this._events[a],this;if(0===arguments.length){for(b in this._events)"removeListener"!==b&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events={},this}if(c=this._events[a],d(c))this.removeListener(a,c);else for(;c.length;)this.removeListener(a,c[c.length-1]);return delete this._events[a],this},c.prototype.listeners=function(a){var b;return b=this._events&&this._events[a]?d(this._events[a])?[this._events[a]]:this._events[a].slice():[]},c.listenerCount=function(a,b){var c;return c=a._events&&a._events[b]?d(a._events[b])?1:a._events[b].length:0}},{}],3:[function(a,b){b.exports="function"==typeof Object.create?function(a,b){a.super_=b,a.prototype=Object.create(b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}})}:function(a,b){a.super_=b;var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a}},{}],4:[function(a,b){function c(){}var d=b.exports={};d.nextTick=function(){var a="undefined"!=typeof window&&window.setImmediate,b="undefined"!=typeof window&&window.MutationObserver,c="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(a)return function(a){return window.setImmediate(a)};var d=[];if(b){var e=document.createElement("div"),f=new MutationObserver(function(){var a=d.slice();d.length=0,a.forEach(function(a){a()})});return f.observe(e,{attributes:!0}),function(a){d.length||e.setAttribute("yes","no"),d.push(a)}}return c?(window.addEventListener("message",function(a){var b=a.source;if((b===window||null===b)&&"process-tick"===a.data&&(a.stopPropagation(),d.length>0)){var c=d.shift();c()}},!0),function(a){d.push(a),window.postMessage("process-tick","*")}):function(a){setTimeout(a,0)}}(),d.title="browser",d.browser=!0,d.env={},d.argv=[],d.on=c,d.addListener=c,d.once=c,d.off=c,d.removeListener=c,d.removeAllListeners=c,d.emit=c,d.binding=function(){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(){throw new Error("process.chdir is not supported")}},{}],5:[function(a,b){b.exports=function(a){return a&&"object"==typeof a&&"function"==typeof a.copy&&"function"==typeof a.fill&&"function"==typeof a.readUInt8}},{}],6:[function(a,b,c){(function(b,d){function e(a,b){var d={seen:[],stylize:g};return arguments.length>=3&&(d.depth=arguments[2]),arguments.length>=4&&(d.colors=arguments[3]),p(b)?d.showHidden=b:b&&c._extend(d,b),v(d.showHidden)&&(d.showHidden=!1),v(d.depth)&&(d.depth=2),v(d.colors)&&(d.colors=!1),v(d.customInspect)&&(d.customInspect=!0),d.colors&&(d.stylize=f),i(d,a,d.depth)}function f(a,b){var c=e.styles[b];return c?"["+e.colors[c][0]+"m"+a+"["+e.colors[c][1]+"m":a}function g(a){return a}function h(a){var b={};return a.forEach(function(a){b[a]=!0}),b}function i(a,b,d){if(a.customInspect&&b&&A(b.inspect)&&b.inspect!==c.inspect&&(!b.constructor||b.constructor.prototype!==b)){var e=b.inspect(d,a);return t(e)||(e=i(a,e,d)),e}var f=j(a,b);if(f)return f;var g=Object.keys(b),p=h(g);if(a.showHidden&&(g=Object.getOwnPropertyNames(b)),z(b)&&(g.indexOf("message")>=0||g.indexOf("description")>=0))return k(b);if(0===g.length){if(A(b)){var q=b.name?": "+b.name:"";return a.stylize("[Function"+q+"]","special")}if(w(b))return a.stylize(RegExp.prototype.toString.call(b),"regexp");if(y(b))return a.stylize(Date.prototype.toString.call(b),"date");if(z(b))return k(b)}var r="",s=!1,u=["{","}"];if(o(b)&&(s=!0,u=["[","]"]),A(b)){var v=b.name?": "+b.name:"";r=" [Function"+v+"]"}if(w(b)&&(r=" "+RegExp.prototype.toString.call(b)),y(b)&&(r=" "+Date.prototype.toUTCString.call(b)),z(b)&&(r=" "+k(b)),0===g.length&&(!s||0==b.length))return u[0]+r+u[1];if(0>d)return w(b)?a.stylize(RegExp.prototype.toString.call(b),"regexp"):a.stylize("[Object]","special");a.seen.push(b);var x;return x=s?l(a,b,d,p,g):g.map(function(c){return m(a,b,d,p,c,s)}),a.seen.pop(),n(x,r,u)}function j(a,b){if(v(b))return a.stylize("undefined","undefined");if(t(b)){var c="'"+JSON.stringify(b).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return a.stylize(c,"string")}return s(b)?a.stylize(""+b,"number"):p(b)?a.stylize(""+b,"boolean"):q(b)?a.stylize("null","null"):void 0}function k(a){return"["+Error.prototype.toString.call(a)+"]"}function l(a,b,c,d,e){for(var f=[],g=0,h=b.length;h>g;++g)f.push(F(b,String(g))?m(a,b,c,d,String(g),!0):"");return e.forEach(function(e){e.match(/^\d+$/)||f.push(m(a,b,c,d,e,!0))}),f}function m(a,b,c,d,e,f){var g,h,j;if(j=Object.getOwnPropertyDescriptor(b,e)||{value:b[e]},j.get?h=j.set?a.stylize("[Getter/Setter]","special"):a.stylize("[Getter]","special"):j.set&&(h=a.stylize("[Setter]","special")),F(d,e)||(g="["+e+"]"),h||(a.seen.indexOf(j.value)<0?(h=q(c)?i(a,j.value,null):i(a,j.value,c-1),h.indexOf("\n")>-1&&(h=f?h.split("\n").map(function(a){return"  "+a}).join("\n").substr(2):"\n"+h.split("\n").map(function(a){return"   "+a}).join("\n"))):h=a.stylize("[Circular]","special")),v(g)){if(f&&e.match(/^\d+$/))return h;g=JSON.stringify(""+e),g.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(g=g.substr(1,g.length-2),g=a.stylize(g,"name")):(g=g.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),g=a.stylize(g,"string"))}return g+": "+h}function n(a,b,c){var d=0,e=a.reduce(function(a,b){return d++,b.indexOf("\n")>=0&&d++,a+b.replace(/\u001b\[\d\d?m/g,"").length+1},0);return e>60?c[0]+(""===b?"":b+"\n ")+" "+a.join(",\n  ")+" "+c[1]:c[0]+b+" "+a.join(", ")+" "+c[1]}function o(a){return Array.isArray(a)}function p(a){return"boolean"==typeof a}function q(a){return null===a}function r(a){return null==a}function s(a){return"number"==typeof a}function t(a){return"string"==typeof a}function u(a){return"symbol"==typeof a}function v(a){return void 0===a}function w(a){return x(a)&&"[object RegExp]"===C(a)}function x(a){return"object"==typeof a&&null!==a}function y(a){return x(a)&&"[object Date]"===C(a)}function z(a){return x(a)&&("[object Error]"===C(a)||a instanceof Error)}function A(a){return"function"==typeof a}function B(a){return null===a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||"symbol"==typeof a||"undefined"==typeof a}function C(a){return Object.prototype.toString.call(a)}function D(a){return 10>a?"0"+a.toString(10):a.toString(10)}function E(){var a=new Date,b=[D(a.getHours()),D(a.getMinutes()),D(a.getSeconds())].join(":");return[a.getDate(),J[a.getMonth()],b].join(" ")}function F(a,b){return Object.prototype.hasOwnProperty.call(a,b)}var G=/%[sdj%]/g;c.format=function(a){if(!t(a)){for(var b=[],c=0;c<arguments.length;c++)b.push(e(arguments[c]));return b.join(" ")}for(var c=1,d=arguments,f=d.length,g=String(a).replace(G,function(a){if("%%"===a)return"%";if(c>=f)return a;switch(a){case"%s":return String(d[c++]);case"%d":return Number(d[c++]);case"%j":try{return JSON.stringify(d[c++])}catch(b){return"[Circular]"}default:return a}}),h=d[c];f>c;h=d[++c])g+=q(h)||!x(h)?" "+h:" "+e(h);return g},c.deprecate=function(a,e){function f(){if(!g){if(b.throwDeprecation)throw new Error(e);b.traceDeprecation?console.trace(e):console.error(e),g=!0}return a.apply(this,arguments)}if(v(d.process))return function(){return c.deprecate(a,e).apply(this,arguments)};if(b.noDeprecation===!0)return a;var g=!1;return f};var H,I={};c.debuglog=function(a){if(v(H)&&(H=b.env.NODE_DEBUG||""),a=a.toUpperCase(),!I[a])if(new RegExp("\\b"+a+"\\b","i").test(H)){var d=b.pid;I[a]=function(){var b=c.format.apply(c,arguments);console.error("%s %d: %s",a,d,b)}}else I[a]=function(){};return I[a]},c.inspect=e,e.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},e.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"},c.isArray=o,c.isBoolean=p,c.isNull=q,c.isNullOrUndefined=r,c.isNumber=s,c.isString=t,c.isSymbol=u,c.isUndefined=v,c.isRegExp=w,c.isObject=x,c.isDate=y,c.isError=z,c.isFunction=A,c.isPrimitive=B,c.isBuffer=a("./support/isBuffer");var J=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];c.log=function(){console.log("%s - %s",E(),c.format.apply(c,arguments))},c.inherits=a("inherits"),c._extend=function(a,b){if(!b||!x(b))return a;for(var c=Object.keys(b),d=c.length;d--;)a[c[d]]=b[c[d]];return a}}).call(this,a("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":5,_process:4,inherits:3}]},{},[1])(1)}),!function(a,b){if("function"==typeof define&&define.amd)define(["jquery"],b);else if("object"==typeof module&&module.exports){var c;try{c=require("jquery")}catch(d){c=null}module.exports=b(c)}else a.Slider=b(a.jQuery)}(this,function(a){var b;return function(a){"use strict";function b(){}function c(a){function c(b){b.prototype.option||(b.prototype.option=function(b){a.isPlainObject(b)&&(this.options=a.extend(!0,this.options,b))})}function e(b,c){a.fn[b]=function(e){if("string"==typeof e){for(var g=d.call(arguments,1),h=0,i=this.length;i>h;h++){var j=this[h],k=a.data(j,b);if(k)if(a.isFunction(k[e])&&"_"!==e.charAt(0)){var l=k[e].apply(k,g);if(void 0!==l&&l!==k)return l}else f("no such method '"+e+"' for "+b+" instance");else f("cannot call methods on "+b+" prior to initialization; attempted to call '"+e+"'")}return this}var m=this.map(function(){var d=a.data(this,b);return d?(d.option(e),d._init()):(d=new c(this,e),a.data(this,b,d)),a(this)});return!m||m.length>1?m:m[0]}}if(a){var f="undefined"==typeof console?b:function(a){console.error(a)};return a.bridget=function(a,b){c(b),e(a,b)},a.bridget}}var d=Array.prototype.slice;c(a)}(a),function(a){function c(b,c){function d(a,b){var c="data-slider-"+b.replace(/_/g,"-"),d=a.getAttribute(c);try{return JSON.parse(d)}catch(e){return d}}this._state={value:null,enabled:null,offset:null,size:null,percentage:null,inDrag:null,over:null},"string"==typeof b?this.element=document.querySelector(b):b instanceof HTMLElement&&(this.element=b),c=c?c:{};for(var f=Object.keys(this.defaultOptions),g=0;g<f.length;g++){var h=f[g],i=c[h];i="undefined"!=typeof i?i:d(this.element,h),i=null!==i?i:this.defaultOptions[h],this.options||(this.options={}),this.options[h]=i}"vertical"!==this.options.orientation||"top"!==this.options.tooltip_position&&"bottom"!==this.options.tooltip_position?"horizontal"!==this.options.orientation||"left"!==this.options.tooltip_position&&"right"!==this.options.tooltip_position||(this.options.tooltip_position="top"):this.options.tooltip_position="right";var j,k,l,m,n,o=this.element.style.width,p=!1,q=this.element.parentNode;if(this.sliderElem)p=!0;else{this.sliderElem=document.createElement("div"),this.sliderElem.className="slider";var r=document.createElement("div");if(r.className="slider-track",k=document.createElement("div"),k.className="slider-track-low",j=document.createElement("div"),j.className="slider-selection",l=document.createElement("div"),l.className="slider-track-high",m=document.createElement("div"),m.className="slider-handle min-slider-handle",n=document.createElement("div"),n.className="slider-handle max-slider-handle",r.appendChild(k),r.appendChild(j),r.appendChild(l),this.ticks=[],Array.isArray(this.options.ticks)&&this.options.ticks.length>0){for(g=0;g<this.options.ticks.length;g++){var s=document.createElement("div");s.className="slider-tick",this.ticks.push(s),r.appendChild(s)}j.className+=" tick-slider-selection"}if(r.appendChild(m),r.appendChild(n),this.tickLabels=[],Array.isArray(this.options.ticks_labels)&&this.options.ticks_labels.length>0)for(this.tickLabelContainer=document.createElement("div"),this.tickLabelContainer.className="slider-tick-label-container",g=0;g<this.options.ticks_labels.length;g++){var t=document.createElement("div");t.className="slider-tick-label",t.innerHTML=this.options.ticks_labels[g],this.tickLabels.push(t),this.tickLabelContainer.appendChild(t)}var u=function(a){var b=document.createElement("div");b.className="tooltip-arrow";var c=document.createElement("div");c.className="tooltip-inner",a.appendChild(b),a.appendChild(c)},v=document.createElement("div");v.className="tooltip tooltip-main",u(v);var w=document.createElement("div");w.className="tooltip tooltip-min",u(w);var x=document.createElement("div");x.className="tooltip tooltip-max",u(x),this.sliderElem.appendChild(r),this.sliderElem.appendChild(v),this.sliderElem.appendChild(w),this.sliderElem.appendChild(x),this.tickLabelContainer&&this.sliderElem.appendChild(this.tickLabelContainer),q.insertBefore(this.sliderElem,this.element),this.element.style.display="none"}if(a&&(this.$element=a(this.element),this.$sliderElem=a(this.sliderElem)),this.eventToCallbackMap={},this.sliderElem.id=this.options.id,this.touchCapable="ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch,this.tooltip=this.sliderElem.querySelector(".tooltip-main"),this.tooltipInner=this.tooltip.querySelector(".tooltip-inner"),this.tooltip_min=this.sliderElem.querySelector(".tooltip-min"),this.tooltipInner_min=this.tooltip_min.querySelector(".tooltip-inner"),this.tooltip_max=this.sliderElem.querySelector(".tooltip-max"),this.tooltipInner_max=this.tooltip_max.querySelector(".tooltip-inner"),e[this.options.scale]&&(this.options.scale=e[this.options.scale]),p===!0&&(this._removeClass(this.sliderElem,"slider-horizontal"),this._removeClass(this.sliderElem,"slider-vertical"),this._removeClass(this.tooltip,"hide"),this._removeClass(this.tooltip_min,"hide"),this._removeClass(this.tooltip_max,"hide"),["left","top","width","height"].forEach(function(a){this._removeProperty(this.trackLow,a),this._removeProperty(this.trackSelection,a),this._removeProperty(this.trackHigh,a)},this),[this.handle1,this.handle2].forEach(function(a){this._removeProperty(a,"left"),this._removeProperty(a,"top")},this),[this.tooltip,this.tooltip_min,this.tooltip_max].forEach(function(a){this._removeProperty(a,"left"),this._removeProperty(a,"top"),this._removeProperty(a,"margin-left"),this._removeProperty(a,"margin-top"),this._removeClass(a,"right"),this._removeClass(a,"top")},this)),"vertical"===this.options.orientation?(this._addClass(this.sliderElem,"slider-vertical"),this.stylePos="top",this.mousePos="pageY",this.sizePos="offsetHeight"):(this._addClass(this.sliderElem,"slider-horizontal"),this.sliderElem.style.width=o,this.options.orientation="horizontal",this.stylePos="left",this.mousePos="pageX",this.sizePos="offsetWidth"),this._setTooltipPosition(),Array.isArray(this.options.ticks)&&this.options.ticks.length>0&&(this.options.max=Math.max.apply(Math,this.options.ticks),this.options.min=Math.min.apply(Math,this.options.ticks)),Array.isArray(this.options.value)?(this.options.range=!0,this._state.value=this.options.value):this._state.value=this.options.range?[this.options.value,this.options.max]:this.options.value,this.trackLow=k||this.trackLow,this.trackSelection=j||this.trackSelection,this.trackHigh=l||this.trackHigh,"none"===this.options.selection&&(this._addClass(this.trackLow,"hide"),this._addClass(this.trackSelection,"hide"),this._addClass(this.trackHigh,"hide")),this.handle1=m||this.handle1,this.handle2=n||this.handle2,p===!0)for(this._removeClass(this.handle1,"round triangle"),this._removeClass(this.handle2,"round triangle hide"),g=0;g<this.ticks.length;g++)this._removeClass(this.ticks[g],"round triangle hide");var y=["round","triangle","custom"],z=-1!==y.indexOf(this.options.handle);if(z)for(this._addClass(this.handle1,this.options.handle),this._addClass(this.handle2,this.options.handle),g=0;g<this.ticks.length;g++)this._addClass(this.ticks[g],this.options.handle);this._state.offset=this._offset(this.sliderElem),this._state.size=this.sliderElem[this.sizePos],this.setValue(this._state.value),this.handle1Keydown=this._keydown.bind(this,0),this.handle1.addEventListener("keydown",this.handle1Keydown,!1),this.handle2Keydown=this._keydown.bind(this,1),this.handle2.addEventListener("keydown",this.handle2Keydown,!1),this.mousedown=this._mousedown.bind(this),this.touchCapable&&this.sliderElem.addEventListener("touchstart",this.mousedown,!1),this.sliderElem.addEventListener("mousedown",this.mousedown,!1),"hide"===this.options.tooltip?(this._addClass(this.tooltip,"hide"),this._addClass(this.tooltip_min,"hide"),this._addClass(this.tooltip_max,"hide")):"always"===this.options.tooltip?(this._showTooltip(),this._alwaysShowTooltip=!0):(this.showTooltip=this._showTooltip.bind(this),this.hideTooltip=this._hideTooltip.bind(this),this.sliderElem.addEventListener("mouseenter",this.showTooltip,!1),this.sliderElem.addEventListener("mouseleave",this.hideTooltip,!1),this.handle1.addEventListener("focus",this.showTooltip,!1),this.handle1.addEventListener("blur",this.hideTooltip,!1),this.handle2.addEventListener("focus",this.showTooltip,!1),this.handle2.addEventListener("blur",this.hideTooltip,!1)),this.options.enabled?this.enable():this.disable()}var d={formatInvalidInputErrorMsg:function(a){return"Invalid input value '"+a+"' passed in"},callingContextNotSliderInstance:"Calling context element does not have instance of Slider bound to it. Check your code to make sure the JQuery object returned from the call to the slider() initializer is calling the method"},e={linear:{toValue:function(a){var b=a/100*(this.options.max-this.options.min);if(this.options.ticks_positions.length>0){for(var c,d,e,f=0,g=0;g<this.options.ticks_positions.length;g++)if(a<=this.options.ticks_positions[g]){c=g>0?this.options.ticks[g-1]:0,e=g>0?this.options.ticks_positions[g-1]:0,d=this.options.ticks[g],f=this.options.ticks_positions[g];break}if(g>0){var h=(a-e)/(f-e);b=c+h*(d-c)}}var i=this.options.min+Math.round(b/this.options.step)*this.options.step;return i<this.options.min?this.options.min:i>this.options.max?this.options.max:i},toPercentage:function(a){if(this.options.max===this.options.min)return 0;if(this.options.ticks_positions.length>0){for(var b,c,d,e=0,f=0;f<this.options.ticks.length;f++)if(a<=this.options.ticks[f]){b=f>0?this.options.ticks[f-1]:0,d=f>0?this.options.ticks_positions[f-1]:0,c=this.options.ticks[f],e=this.options.ticks_positions[f];break}if(f>0){var g=(a-b)/(c-b);return d+g*(e-d)}}return 100*(a-this.options.min)/(this.options.max-this.options.min)}},logarithmic:{toValue:function(a){var b=0===this.options.min?0:Math.log(this.options.min),c=Math.log(this.options.max),d=Math.exp(b+(c-b)*a/100);return d=this.options.min+Math.round((d-this.options.min)/this.options.step)*this.options.step,d<this.options.min?this.options.min:d>this.options.max?this.options.max:d},toPercentage:function(a){if(this.options.max===this.options.min)return 0;var b=Math.log(this.options.max),c=0===this.options.min?0:Math.log(this.options.min),d=0===a?0:Math.log(a);return 100*(d-c)/(b-c)}}};if(b=function(a,b){return c.call(this,a,b),this},b.prototype={_init:function(){},constructor:b,defaultOptions:{id:"",min:0,max:10,step:1,precision:0,orientation:"horizontal",value:5,range:!1,selection:"before",tooltip:"show",tooltip_split:!1,handle:"round",reversed:!1,enabled:!0,formatter:function(a){return Array.isArray(a)?a[0]+" : "+a[1]:a},natural_arrow_keys:!1,ticks:[],ticks_positions:[],ticks_labels:[],ticks_snap_bounds:0,scale:"linear",focus:!1,tooltip_position:null},getElement:function(){return this.sliderElem},getValue:function(){return this.options.range?this._state.value:this._state.value[0]},setValue:function(a,b,c){a||(a=0);var d=this.getValue();this._state.value=this._validateInputValue(a);var e=this._applyPrecision.bind(this);this.options.range?(this._state.value[0]=e(this._state.value[0]),this._state.value[1]=e(this._state.value[1]),this._state.value[0]=Math.max(this.options.min,Math.min(this.options.max,this._state.value[0])),this._state.value[1]=Math.max(this.options.min,Math.min(this.options.max,this._state.value[1]))):(this._state.value=e(this._state.value),this._state.value=[Math.max(this.options.min,Math.min(this.options.max,this._state.value))],this._addClass(this.handle2,"hide"),this._state.value[1]="after"===this.options.selection?this.options.max:this.options.min),this._state.percentage=this.options.max>this.options.min?[this._toPercentage(this._state.value[0]),this._toPercentage(this._state.value[1]),100*this.options.step/(this.options.max-this.options.min)]:[0,0,100],this._layout();var f=this.options.range?this._state.value:this._state.value[0];return b===!0&&this._trigger("slide",f),d!==f&&c===!0&&this._trigger("change",{oldValue:d,newValue:f}),this._setDataVal(f),this},destroy:function(){this._removeSliderEventHandlers(),this.sliderElem.parentNode.removeChild(this.sliderElem),this.element.style.display="",this._cleanUpEventCallbacksMap(),this.element.removeAttribute("data"),a&&(this._unbindJQueryEventHandlers(),this.$element.removeData("slider"))},disable:function(){return this._state.enabled=!1,this.handle1.removeAttribute("tabindex"),this.handle2.removeAttribute("tabindex"),this._addClass(this.sliderElem,"slider-disabled"),this._trigger("slideDisabled"),this},enable:function(){return this._state.enabled=!0,this.handle1.setAttribute("tabindex",0),this.handle2.setAttribute("tabindex",0),this._removeClass(this.sliderElem,"slider-disabled"),this._trigger("slideEnabled"),this},toggle:function(){return this._state.enabled?this.disable():this.enable(),this},isEnabled:function(){return this._state.enabled},on:function(a,b){return this._bindNonQueryEventHandler(a,b),this},off:function(b,c){a?(this.$element.off(b,c),this.$sliderElem.off(b,c)):this._unbindNonQueryEventHandler(b,c)},getAttribute:function(a){return a?this.options[a]:this.options},setAttribute:function(a,b){return this.options[a]=b,this},refresh:function(){return this._removeSliderEventHandlers(),c.call(this,this.element,this.options),a&&a.data(this.element,"slider",this),this},relayout:function(){return this._layout(),this},_removeSliderEventHandlers:function(){this.handle1.removeEventListener("keydown",this.handle1Keydown,!1),this.handle1.removeEventListener("focus",this.showTooltip,!1),this.handle1.removeEventListener("blur",this.hideTooltip,!1),this.handle2.removeEventListener("keydown",this.handle2Keydown,!1),this.handle2.removeEventListener("focus",this.handle2Keydown,!1),this.handle2.removeEventListener("blur",this.handle2Keydown,!1),this.sliderElem.removeEventListener("mouseenter",this.showTooltip,!1),this.sliderElem.removeEventListener("mouseleave",this.hideTooltip,!1),this.sliderElem.removeEventListener("touchstart",this.mousedown,!1),this.sliderElem.removeEventListener("mousedown",this.mousedown,!1)},_bindNonQueryEventHandler:function(a,b){void 0===this.eventToCallbackMap[a]&&(this.eventToCallbackMap[a]=[]),this.eventToCallbackMap[a].push(b)},_unbindNonQueryEventHandler:function(a,b){var c=this.eventToCallbackMap[a];if(void 0!==c)for(var d=0;d<c.length;d++)if(c[d]===b){c.splice(d,1);break}},_cleanUpEventCallbacksMap:function(){for(var a=Object.keys(this.eventToCallbackMap),b=0;b<a.length;b++){var c=a[b];this.eventToCallbackMap[c]=null}},_showTooltip:function(){this.options.tooltip_split===!1?(this._addClass(this.tooltip,"in"),this.tooltip_min.style.display="none",this.tooltip_max.style.display="none"):(this._addClass(this.tooltip_min,"in"),this._addClass(this.tooltip_max,"in"),this.tooltip.style.display="none"),this._state.over=!0},_hideTooltip:function(){this._state.inDrag===!1&&this.alwaysShowTooltip!==!0&&(this._removeClass(this.tooltip,"in"),this._removeClass(this.tooltip_min,"in"),this._removeClass(this.tooltip_max,"in")),this._state.over=!1},_layout:function(){var a;if(a=this.options.reversed?[100-this._state.percentage[0],this.options.range?100-this._state.percentage[1]:this._state.percentage[1]]:[this._state.percentage[0],this._state.percentage[1]],this.handle1.style[this.stylePos]=a[0]+"%",this.handle2.style[this.stylePos]=a[1]+"%",Array.isArray(this.options.ticks)&&this.options.ticks.length>0){var b=Math.max.apply(Math,this.options.ticks),c=Math.min.apply(Math,this.options.ticks),d="vertical"===this.options.orientation?"height":"width",e="vertical"===this.options.orientation?"marginTop":"marginLeft",f=this._state.size/(this.options.ticks.length-1);if(this.tickLabelContainer){var g=0;if(0===this.options.ticks_positions.length)this.tickLabelContainer.style[e]=-f/2+"px",g=this.tickLabelContainer.offsetHeight;else for(h=0;h<this.tickLabelContainer.childNodes.length;h++)this.tickLabelContainer.childNodes[h].offsetHeight>g&&(g=this.tickLabelContainer.childNodes[h].offsetHeight);"horizontal"===this.options.orientation&&(this.sliderElem.style.marginBottom=g+"px")}for(var h=0;h<this.options.ticks.length;h++){var i=this.options.ticks_positions[h]||100*(this.options.ticks[h]-c)/(b-c);this.ticks[h].style[this.stylePos]=i+"%",this._removeClass(this.ticks[h],"in-selection"),this.options.range?i>=a[0]&&i<=a[1]&&this._addClass(this.ticks[h],"in-selection"):"after"===this.options.selection&&i>=a[0]?this._addClass(this.ticks[h],"in-selection"):"before"===this.options.selection&&i<=a[0]&&this._addClass(this.ticks[h],"in-selection"),this.tickLabels[h]&&(this.tickLabels[h].style[d]=f+"px",void 0!==this.options.ticks_positions[h]&&(this.tickLabels[h].style.position="absolute",this.tickLabels[h].style[this.stylePos]=this.options.ticks_positions[h]+"%",this.tickLabels[h].style[e]=-f/2+"px"))}}if("vertical"===this.options.orientation)this.trackLow.style.top="0",this.trackLow.style.height=Math.min(a[0],a[1])+"%",this.trackSelection.style.top=Math.min(a[0],a[1])+"%",this.trackSelection.style.height=Math.abs(a[0]-a[1])+"%",this.trackHigh.style.bottom="0",this.trackHigh.style.height=100-Math.min(a[0],a[1])-Math.abs(a[0]-a[1])+"%";else{this.trackLow.style.left="0",this.trackLow.style.width=Math.min(a[0],a[1])+"%",this.trackSelection.style.left=Math.min(a[0],a[1])+"%",this.trackSelection.style.width=Math.abs(a[0]-a[1])+"%",this.trackHigh.style.right="0",this.trackHigh.style.width=100-Math.min(a[0],a[1])-Math.abs(a[0]-a[1])+"%";var j=this.tooltip_min.getBoundingClientRect(),k=this.tooltip_max.getBoundingClientRect();j.right>k.left?(this._removeClass(this.tooltip_max,"top"),this._addClass(this.tooltip_max,"bottom"),this.tooltip_max.style.top="18px"):(this._removeClass(this.tooltip_max,"bottom"),this._addClass(this.tooltip_max,"top"),this.tooltip_max.style.top=this.tooltip_min.style.top)}var l;if(this.options.range){l=this.options.formatter(this._state.value),this._setText(this.tooltipInner,l),this.tooltip.style[this.stylePos]=(a[1]+a[0])/2+"%","vertical"===this.options.orientation?this._css(this.tooltip,"margin-top",-this.tooltip.offsetHeight/2+"px"):this._css(this.tooltip,"margin-left",-this.tooltip.offsetWidth/2+"px"),"vertical"===this.options.orientation?this._css(this.tooltip,"margin-top",-this.tooltip.offsetHeight/2+"px"):this._css(this.tooltip,"margin-left",-this.tooltip.offsetWidth/2+"px");var m=this.options.formatter(this._state.value[0]);this._setText(this.tooltipInner_min,m);var n=this.options.formatter(this._state.value[1]);this._setText(this.tooltipInner_max,n),this.tooltip_min.style[this.stylePos]=a[0]+"%","vertical"===this.options.orientation?this._css(this.tooltip_min,"margin-top",-this.tooltip_min.offsetHeight/2+"px"):this._css(this.tooltip_min,"margin-left",-this.tooltip_min.offsetWidth/2+"px"),this.tooltip_max.style[this.stylePos]=a[1]+"%","vertical"===this.options.orientation?this._css(this.tooltip_max,"margin-top",-this.tooltip_max.offsetHeight/2+"px"):this._css(this.tooltip_max,"margin-left",-this.tooltip_max.offsetWidth/2+"px")}else l=this.options.formatter(this._state.value[0]),this._setText(this.tooltipInner,l),this.tooltip.style[this.stylePos]=a[0]+"%","vertical"===this.options.orientation?this._css(this.tooltip,"margin-top",-this.tooltip.offsetHeight/2+"px"):this._css(this.tooltip,"margin-left",-this.tooltip.offsetWidth/2+"px")},_removeProperty:function(a,b){a.style.removeProperty?a.style.removeProperty(b):a.style.removeAttribute(b)},_mousedown:function(a){if(!this._state.enabled)return!1;this._state.offset=this._offset(this.sliderElem),this._state.size=this.sliderElem[this.sizePos];var b=this._getPercentage(a);if(this.options.range){var c=Math.abs(this._state.percentage[0]-b),d=Math.abs(this._state.percentage[1]-b);this._state.dragged=d>c?0:1}else this._state.dragged=0;this._state.percentage[this._state.dragged]=b,this._layout(),this.touchCapable&&(document.removeEventListener("touchmove",this.mousemove,!1),document.removeEventListener("touchend",this.mouseup,!1)),this.mousemove&&document.removeEventListener("mousemove",this.mousemove,!1),this.mouseup&&document.removeEventListener("mouseup",this.mouseup,!1),this.mousemove=this._mousemove.bind(this),this.mouseup=this._mouseup.bind(this),this.touchCapable&&(document.addEventListener("touchmove",this.mousemove,!1),document.addEventListener("touchend",this.mouseup,!1)),document.addEventListener("mousemove",this.mousemove,!1),document.addEventListener("mouseup",this.mouseup,!1),this._state.inDrag=!0;var e=this._calculateValue();return this._trigger("slideStart",e),this._setDataVal(e),this.setValue(e,!1,!0),this._pauseEvent(a),this.options.focus&&this._triggerFocusOnHandle(this._state.dragged),!0},_triggerFocusOnHandle:function(a){0===a&&this.handle1.focus(),1===a&&this.handle2.focus()},_keydown:function(a,b){if(!this._state.enabled)return!1;var c;switch(b.keyCode){case 37:case 40:c=-1;break;case 39:case 38:c=1}if(c){if(this.options.natural_arrow_keys){var d="vertical"===this.options.orientation&&!this.options.reversed,e="horizontal"===this.options.orientation&&this.options.reversed;(d||e)&&(c=-c)}var f=this._state.value[a]+c*this.options.step;return this.options.range&&(f=[a?this._state.value[0]:f,a?f:this._state.value[1]]),this._trigger("slideStart",f),this._setDataVal(f),this.setValue(f,!0,!0),this._setDataVal(f),this._trigger("slideStop",f),this._layout(),this._pauseEvent(b),!1}},_pauseEvent:function(a){a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault(),a.cancelBubble=!0,a.returnValue=!1},_mousemove:function(a){
if(!this._state.enabled)return!1;var b=this._getPercentage(a);this._adjustPercentageForRangeSliders(b),this._state.percentage[this._state.dragged]=b,this._layout();var c=this._calculateValue(!0);return this.setValue(c,!0,!0),!1},_adjustPercentageForRangeSliders:function(a){if(this.options.range){var b=this._getNumDigitsAfterDecimalPlace(a);b=b?b-1:0;var c=this._applyToFixedAndParseFloat(a,b);0===this._state.dragged&&this._applyToFixedAndParseFloat(this._state.percentage[1],b)<c?(this._state.percentage[0]=this._state.percentage[1],this._state.dragged=1):1===this._state.dragged&&this._applyToFixedAndParseFloat(this._state.percentage[0],b)>c&&(this._state.percentage[1]=this._state.percentage[0],this._state.dragged=0)}},_mouseup:function(){if(!this._state.enabled)return!1;this.touchCapable&&(document.removeEventListener("touchmove",this.mousemove,!1),document.removeEventListener("touchend",this.mouseup,!1)),document.removeEventListener("mousemove",this.mousemove,!1),document.removeEventListener("mouseup",this.mouseup,!1),this._state.inDrag=!1,this._state.over===!1&&this._hideTooltip();var a=this._calculateValue(!0);return this._layout(),this._setDataVal(a),this._trigger("slideStop",a),!1},_calculateValue:function(a){var b;if(this.options.range?(b=[this.options.min,this.options.max],0!==this._state.percentage[0]&&(b[0]=this._toValue(this._state.percentage[0]),b[0]=this._applyPrecision(b[0])),100!==this._state.percentage[1]&&(b[1]=this._toValue(this._state.percentage[1]),b[1]=this._applyPrecision(b[1]))):(b=this._toValue(this._state.percentage[0]),b=parseFloat(b),b=this._applyPrecision(b)),a){for(var c=[b,1/0],d=0;d<this.options.ticks.length;d++){var e=Math.abs(this.options.ticks[d]-b);e<=c[1]&&(c=[this.options.ticks[d],e])}if(c[1]<=this.options.ticks_snap_bounds)return c[0]}return b},_applyPrecision:function(a){var b=this.options.precision||this._getNumDigitsAfterDecimalPlace(this.options.step);return this._applyToFixedAndParseFloat(a,b)},_getNumDigitsAfterDecimalPlace:function(a){var b=(""+a).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);return b?Math.max(0,(b[1]?b[1].length:0)-(b[2]?+b[2]:0)):0},_applyToFixedAndParseFloat:function(a,b){var c=a.toFixed(b);return parseFloat(c)},_getPercentage:function(a){!this.touchCapable||"touchstart"!==a.type&&"touchmove"!==a.type||(a=a.touches[0]);var b=a[this.mousePos],c=this._state.offset[this.stylePos],d=b-c,e=d/this._state.size*100;return e=Math.round(e/this._state.percentage[2])*this._state.percentage[2],this.options.reversed&&(e=100-e),Math.max(0,Math.min(100,e))},_validateInputValue:function(a){if("number"==typeof a)return a;if(Array.isArray(a))return this._validateArray(a),a;throw new Error(d.formatInvalidInputErrorMsg(a))},_validateArray:function(a){for(var b=0;b<a.length;b++){var c=a[b];if("number"!=typeof c)throw new Error(d.formatInvalidInputErrorMsg(c))}},_setDataVal:function(a){var b="value: '"+a+"'";this.element.setAttribute("data",b),this.element.setAttribute("value",a),this.element.value=a},_trigger:function(b,c){c=c||0===c?c:void 0;var d=this.eventToCallbackMap[b];if(d&&d.length)for(var e=0;e<d.length;e++){var f=d[e];f(c)}a&&this._triggerJQueryEvent(b,c)},_triggerJQueryEvent:function(a,b){var c={type:a,value:b};this.$element.trigger(c),this.$sliderElem.trigger(c)},_unbindJQueryEventHandlers:function(){this.$element.off(),this.$sliderElem.off()},_setText:function(a,b){"undefined"!=typeof a.innerText?a.innerText=b:"undefined"!=typeof a.textContent&&(a.textContent=b)},_removeClass:function(a,b){for(var c=b.split(" "),d=a.className,e=0;e<c.length;e++){var f=c[e],g=new RegExp("(?:\\s|^)"+f+"(?:\\s|$)");d=d.replace(g," ")}a.className=d.trim()},_addClass:function(a,b){for(var c=b.split(" "),d=a.className,e=0;e<c.length;e++){var f=c[e],g=new RegExp("(?:\\s|^)"+f+"(?:\\s|$)"),h=g.test(d);h||(d+=" "+f)}a.className=d.trim()},_offsetLeft:function(a){return a.getBoundingClientRect().left},_offsetTop:function(a){for(var b=a.offsetTop;(a=a.offsetParent)&&!isNaN(a.offsetTop);)b+=a.offsetTop;return b},_offset:function(a){return{left:this._offsetLeft(a),top:this._offsetTop(a)}},_css:function(b,c,d){if(a)a.style(b,c,d);else{var e=c.replace(/^-ms-/,"ms-").replace(/-([\da-z])/gi,function(a,b){return b.toUpperCase()});b.style[e]=d}},_toValue:function(a){return this.options.scale.toValue.apply(this,[a])},_toPercentage:function(a){return this.options.scale.toPercentage.apply(this,[a])},_setTooltipPosition:function(){var a=[this.tooltip,this.tooltip_min,this.tooltip_max];if("vertical"===this.options.orientation){var b=this.options.tooltip_position||"right",c="left"===b?"right":"left";a.forEach(function(a){this._addClass(a,b),a.style[c]="100%"}.bind(this))}else a.forEach("bottom"===this.options.tooltip_position?function(a){this._addClass(a,"bottom"),a.style.top="22px"}.bind(this):function(a){this._addClass(a,"top"),a.style.top=-this.tooltip.outerHeight-14+"px"}.bind(this))}},a){var f=a.fn.slider?"bootstrapSlider":"slider";a.bridget(f,b)}}(a),b}),function(){var a=[].slice;!function(b,c){"use strict";var d;return d=function(){function a(a,c){null==c&&(c={}),this.$element=b(a),this.options=b.extend({},b.fn.bootstrapSwitch.defaults,{state:this.$element.is(":checked"),size:this.$element.data("size"),animate:this.$element.data("animate"),disabled:this.$element.is(":disabled"),readonly:this.$element.is("[readonly]"),indeterminate:this.$element.data("indeterminate"),inverse:this.$element.data("inverse"),radioAllOff:this.$element.data("radio-all-off"),onColor:this.$element.data("on-color"),offColor:this.$element.data("off-color"),onText:this.$element.data("on-text"),offText:this.$element.data("off-text"),labelText:this.$element.data("label-text"),handleWidth:this.$element.data("handle-width"),labelWidth:this.$element.data("label-width"),baseClass:this.$element.data("base-class"),wrapperClass:this.$element.data("wrapper-class")},c),this.$wrapper=b("<div>",{"class":function(a){return function(){var b;return b=[""+a.options.baseClass].concat(a._getClasses(a.options.wrapperClass)),b.push(a.options.state?""+a.options.baseClass+"-on":""+a.options.baseClass+"-off"),null!=a.options.size&&b.push(""+a.options.baseClass+"-"+a.options.size),a.options.disabled&&b.push(""+a.options.baseClass+"-disabled"),a.options.readonly&&b.push(""+a.options.baseClass+"-readonly"),a.options.indeterminate&&b.push(""+a.options.baseClass+"-indeterminate"),a.options.inverse&&b.push(""+a.options.baseClass+"-inverse"),a.$element.attr("id")&&b.push(""+a.options.baseClass+"-id-"+a.$element.attr("id")),b.join(" ")}}(this)()}),this.$container=b("<div>",{"class":""+this.options.baseClass+"-container"}),this.$on=b("<span>",{html:this.options.onText,"class":""+this.options.baseClass+"-handle-on "+this.options.baseClass+"-"+this.options.onColor}),this.$off=b("<span>",{html:this.options.offText,"class":""+this.options.baseClass+"-handle-off "+this.options.baseClass+"-"+this.options.offColor}),this.$label=b("<span>",{html:this.options.labelText,"class":""+this.options.baseClass+"-label"}),this.$element.on("init.bootstrapSwitch",function(b){return function(){return b.options.onInit.apply(a,arguments)}}(this)),this.$element.on("switchChange.bootstrapSwitch",function(b){return function(){return b.options.onSwitchChange.apply(a,arguments)}}(this)),this.$container=this.$element.wrap(this.$container).parent(),this.$wrapper=this.$container.wrap(this.$wrapper).parent(),this.$element.before(this.options.inverse?this.$off:this.$on).before(this.$label).before(this.options.inverse?this.$on:this.$off),this.options.indeterminate&&this.$element.prop("indeterminate",!0),this._init(),this._elementHandlers(),this._handleHandlers(),this._labelHandlers(),this._formHandler(),this._externalLabelHandler(),this.$element.trigger("init.bootstrapSwitch")}return a.prototype._constructor=a,a.prototype.state=function(a,b){return"undefined"==typeof a?this.options.state:this.options.disabled||this.options.readonly?this.$element:this.options.state&&!this.options.radioAllOff&&this.$element.is(":radio")?this.$element:(this.options.indeterminate&&this.indeterminate(!1),a=!!a,this.$element.prop("checked",a).trigger("change.bootstrapSwitch",b),this.$element)},a.prototype.toggleState=function(a){return this.options.disabled||this.options.readonly?this.$element:this.options.indeterminate?(this.indeterminate(!1),this.state(!0)):this.$element.prop("checked",!this.options.state).trigger("change.bootstrapSwitch",a)},a.prototype.size=function(a){return"undefined"==typeof a?this.options.size:(null!=this.options.size&&this.$wrapper.removeClass(""+this.options.baseClass+"-"+this.options.size),a&&this.$wrapper.addClass(""+this.options.baseClass+"-"+a),this._width(),this._containerPosition(),this.options.size=a,this.$element)},a.prototype.animate=function(a){return"undefined"==typeof a?this.options.animate:(a=!!a,a===this.options.animate?this.$element:this.toggleAnimate())},a.prototype.toggleAnimate=function(){return this.options.animate=!this.options.animate,this.$wrapper.toggleClass(""+this.options.baseClass+"-animate"),this.$element},a.prototype.disabled=function(a){return"undefined"==typeof a?this.options.disabled:(a=!!a,a===this.options.disabled?this.$element:this.toggleDisabled())},a.prototype.toggleDisabled=function(){return this.options.disabled=!this.options.disabled,this.$element.prop("disabled",this.options.disabled),this.$wrapper.toggleClass(""+this.options.baseClass+"-disabled"),this.$element},a.prototype.readonly=function(a){return"undefined"==typeof a?this.options.readonly:(a=!!a,a===this.options.readonly?this.$element:this.toggleReadonly())},a.prototype.toggleReadonly=function(){return this.options.readonly=!this.options.readonly,this.$element.prop("readonly",this.options.readonly),this.$wrapper.toggleClass(""+this.options.baseClass+"-readonly"),this.$element},a.prototype.indeterminate=function(a){return"undefined"==typeof a?this.options.indeterminate:(a=!!a,a===this.options.indeterminate?this.$element:this.toggleIndeterminate())},a.prototype.toggleIndeterminate=function(){return this.options.indeterminate=!this.options.indeterminate,this.$element.prop("indeterminate",this.options.indeterminate),this.$wrapper.toggleClass(""+this.options.baseClass+"-indeterminate"),this._containerPosition(),this.$element},a.prototype.inverse=function(a){return"undefined"==typeof a?this.options.inverse:(a=!!a,a===this.options.inverse?this.$element:this.toggleInverse())},a.prototype.toggleInverse=function(){var a,b;return this.$wrapper.toggleClass(""+this.options.baseClass+"-inverse"),b=this.$on.clone(!0),a=this.$off.clone(!0),this.$on.replaceWith(a),this.$off.replaceWith(b),this.$on=a,this.$off=b,this.options.inverse=!this.options.inverse,this.$element},a.prototype.onColor=function(a){var b;return b=this.options.onColor,"undefined"==typeof a?b:(null!=b&&this.$on.removeClass(""+this.options.baseClass+"-"+b),this.$on.addClass(""+this.options.baseClass+"-"+a),this.options.onColor=a,this.$element)},a.prototype.offColor=function(a){var b;return b=this.options.offColor,"undefined"==typeof a?b:(null!=b&&this.$off.removeClass(""+this.options.baseClass+"-"+b),this.$off.addClass(""+this.options.baseClass+"-"+a),this.options.offColor=a,this.$element)},a.prototype.onText=function(a){return"undefined"==typeof a?this.options.onText:(this.$on.html(a),this._width(),this._containerPosition(),this.options.onText=a,this.$element)},a.prototype.offText=function(a){return"undefined"==typeof a?this.options.offText:(this.$off.html(a),this._width(),this._containerPosition(),this.options.offText=a,this.$element)},a.prototype.labelText=function(a){return"undefined"==typeof a?this.options.labelText:(this.$label.html(a),this._width(),this.options.labelText=a,this.$element)},a.prototype.handleWidth=function(a){return"undefined"==typeof a?this.options.handleWidth:(this.options.handleWidth=a,this._width(),this._containerPosition(),this.$element)},a.prototype.labelWidth=function(a){return"undefined"==typeof a?this.options.labelWidth:(this.options.labelWidth=a,this._width(),this._containerPosition(),this.$element)},a.prototype.baseClass=function(){return this.options.baseClass},a.prototype.wrapperClass=function(a){return"undefined"==typeof a?this.options.wrapperClass:(a||(a=b.fn.bootstrapSwitch.defaults.wrapperClass),this.$wrapper.removeClass(this._getClasses(this.options.wrapperClass).join(" ")),this.$wrapper.addClass(this._getClasses(a).join(" ")),this.options.wrapperClass=a,this.$element)},a.prototype.radioAllOff=function(a){return"undefined"==typeof a?this.options.radioAllOff:(a=!!a,a===this.options.radioAllOff?this.$element:(this.options.radioAllOff=a,this.$element))},a.prototype.onInit=function(a){return"undefined"==typeof a?this.options.onInit:(a||(a=b.fn.bootstrapSwitch.defaults.onInit),this.options.onInit=a,this.$element)},a.prototype.onSwitchChange=function(a){return"undefined"==typeof a?this.options.onSwitchChange:(a||(a=b.fn.bootstrapSwitch.defaults.onSwitchChange),this.options.onSwitchChange=a,this.$element)},a.prototype.destroy=function(){var a;return a=this.$element.closest("form"),a.length&&a.off("reset.bootstrapSwitch").removeData("bootstrap-switch"),this.$container.children().not(this.$element).remove(),this.$element.unwrap().unwrap().off(".bootstrapSwitch").removeData("bootstrap-switch"),this.$element},a.prototype._width=function(){var a,b;return a=this.$on.add(this.$off),a.add(this.$label).css("width",""),b="auto"===this.options.handleWidth?Math.max(this.$on.width(),this.$off.width()):this.options.handleWidth,a.width(b),this.$label.width(function(a){return function(c,d){return"auto"!==a.options.labelWidth?a.options.labelWidth:b>d?b:d}}(this)),this._handleWidth=this.$on.outerWidth(),this._labelWidth=this.$label.outerWidth(),this.$container.width(2*this._handleWidth+this._labelWidth),this.$wrapper.width(this._handleWidth+this._labelWidth)},a.prototype._containerPosition=function(a,b){return null==a&&(a=this.options.state),this.$container.css("margin-left",function(b){return function(){var c;return c=[0,"-"+b._handleWidth+"px"],b.options.indeterminate?"-"+b._handleWidth/2+"px":a?b.options.inverse?c[1]:c[0]:b.options.inverse?c[0]:c[1]}}(this)),b?setTimeout(function(){return b()},50):void 0},a.prototype._init=function(){var a,b;return a=function(a){return function(){return a._width(),a._containerPosition(null,function(){return a.options.animate?a.$wrapper.addClass(""+a.options.baseClass+"-animate"):void 0})}}(this),this.$wrapper.is(":visible")?a():b=c.setInterval(function(d){return function(){return d.$wrapper.is(":visible")?(a(),c.clearInterval(b)):void 0}}(this),50)},a.prototype._elementHandlers=function(){return this.$element.on({"change.bootstrapSwitch":function(a){return function(c,d){var e;return c.preventDefault(),c.stopImmediatePropagation(),e=a.$element.is(":checked"),a._containerPosition(e),e!==a.options.state?(a.options.state=e,a.$wrapper.toggleClass(""+a.options.baseClass+"-off").toggleClass(""+a.options.baseClass+"-on"),d?void 0:(a.$element.is(":radio")&&b("[name='"+a.$element.attr("name")+"']").not(a.$element).prop("checked",!1).trigger("change.bootstrapSwitch",!0),a.$element.trigger("switchChange.bootstrapSwitch",[e]))):void 0}}(this),"focus.bootstrapSwitch":function(a){return function(b){return b.preventDefault(),a.$wrapper.addClass(""+a.options.baseClass+"-focused")}}(this),"blur.bootstrapSwitch":function(a){return function(b){return b.preventDefault(),a.$wrapper.removeClass(""+a.options.baseClass+"-focused")}}(this),"keydown.bootstrapSwitch":function(a){return function(b){if(b.which&&!a.options.disabled&&!a.options.readonly)switch(b.which){case 37:return b.preventDefault(),b.stopImmediatePropagation(),a.state(!1);case 39:return b.preventDefault(),b.stopImmediatePropagation(),a.state(!0)}}}(this)})},a.prototype._handleHandlers=function(){return this.$on.on("click.bootstrapSwitch",function(a){return function(b){return b.preventDefault(),b.stopPropagation(),a.state(!1),a.$element.trigger("focus.bootstrapSwitch")}}(this)),this.$off.on("click.bootstrapSwitch",function(a){return function(b){return b.preventDefault(),b.stopPropagation(),a.state(!0),a.$element.trigger("focus.bootstrapSwitch")}}(this))},a.prototype._labelHandlers=function(){return this.$label.on({"mousedown.bootstrapSwitch touchstart.bootstrapSwitch":function(a){return function(b){return a._dragStart||a.options.disabled||a.options.readonly?void 0:(b.preventDefault(),b.stopPropagation(),a._dragStart=(b.pageX||b.originalEvent.touches[0].pageX)-parseInt(a.$container.css("margin-left"),10),a.options.animate&&a.$wrapper.removeClass(""+a.options.baseClass+"-animate"),a.$element.trigger("focus.bootstrapSwitch"))}}(this),"mousemove.bootstrapSwitch touchmove.bootstrapSwitch":function(a){return function(b){var c;return null==a._dragStart||(b.preventDefault(),c=(b.pageX||b.originalEvent.touches[0].pageX)-a._dragStart,c<-a._handleWidth||c>0)?void 0:(a._dragEnd=c,a.$container.css("margin-left",""+a._dragEnd+"px"))}}(this),"mouseup.bootstrapSwitch touchend.bootstrapSwitch":function(a){return function(b){var c;return a._dragStart?(b.preventDefault(),a.options.animate&&a.$wrapper.addClass(""+a.options.baseClass+"-animate"),a._dragEnd?(c=a._dragEnd>-(a._handleWidth/2),a._dragEnd=!1,a.state(a.options.inverse?!c:c)):a.state(!a.options.state),a._dragStart=!1):void 0}}(this),"mouseleave.bootstrapSwitch":function(a){return function(){return a.$label.trigger("mouseup.bootstrapSwitch")}}(this)})},a.prototype._externalLabelHandler=function(){var a;return a=this.$element.closest("label"),a.on("click",function(b){return function(c){return c.preventDefault(),c.stopImmediatePropagation(),c.target===a[0]?b.toggleState():void 0}}(this))},a.prototype._formHandler=function(){var a;return a=this.$element.closest("form"),a.data("bootstrap-switch")?void 0:a.on("reset.bootstrapSwitch",function(){return c.setTimeout(function(){return a.find("input").filter(function(){return b(this).data("bootstrap-switch")}).each(function(){return b(this).bootstrapSwitch("state",this.checked)})},1)}).data("bootstrap-switch",!0)},a.prototype._getClasses=function(a){var c,d,e,f;if(!b.isArray(a))return[""+this.options.baseClass+"-"+a];for(d=[],e=0,f=a.length;f>e;e++)c=a[e],d.push(""+this.options.baseClass+"-"+c);return d},a}(),b.fn.bootstrapSwitch=function(){var c,e,f;return e=arguments[0],c=2<=arguments.length?a.call(arguments,1):[],f=this,this.each(function(){var a,g;return a=b(this),g=a.data("bootstrap-switch"),g||a.data("bootstrap-switch",g=new d(this,e)),"string"==typeof e?f=g[e].apply(g,c):void 0}),f},b.fn.bootstrapSwitch.Constructor=d,b.fn.bootstrapSwitch.defaults={state:!0,size:null,animate:!0,disabled:!1,readonly:!1,indeterminate:!1,inverse:!1,radioAllOff:!1,onColor:"primary",offColor:"default",onText:"ON",offText:"OFF",labelText:"&nbsp;",handleWidth:"auto",labelWidth:"auto",baseClass:"bootstrap-switch",wrapperClass:"wrapper",onInit:function(){},onSwitchChange:function(){}}}(window.jQuery,window)}.call(this),function(){function a(a){this._value=a}function b(a,b,c,d){var e,f,g=Math.pow(10,b);return f=(c(a*g)/g).toFixed(b),d&&(e=new RegExp("0{1,"+d+"}$"),f=f.replace(e,"")),f}function c(a,b,c){var d;return d=b.indexOf("$")>-1?e(a,b,c):b.indexOf("%")>-1?f(a,b,c):b.indexOf(":")>-1?g(a,b):i(a._value,b,c)}function d(a,b){var c,d,e,f,g,i=b,j=["KB","MB","GB","TB","PB","EB","ZB","YB"],k=!1;if(b.indexOf(":")>-1)a._value=h(b);else if(b===q)a._value=0;else{for("."!==o[p].delimiters.decimal&&(b=b.replace(/\./g,"").replace(o[p].delimiters.decimal,".")),c=new RegExp("[^a-zA-Z]"+o[p].abbreviations.thousand+"(?:\\)|(\\"+o[p].currency.symbol+")?(?:\\))?)?$"),d=new RegExp("[^a-zA-Z]"+o[p].abbreviations.million+"(?:\\)|(\\"+o[p].currency.symbol+")?(?:\\))?)?$"),e=new RegExp("[^a-zA-Z]"+o[p].abbreviations.billion+"(?:\\)|(\\"+o[p].currency.symbol+")?(?:\\))?)?$"),f=new RegExp("[^a-zA-Z]"+o[p].abbreviations.trillion+"(?:\\)|(\\"+o[p].currency.symbol+")?(?:\\))?)?$"),g=0;g<=j.length&&!(k=b.indexOf(j[g])>-1?Math.pow(1024,g+1):!1);g++);a._value=(k?k:1)*(i.match(c)?Math.pow(10,3):1)*(i.match(d)?Math.pow(10,6):1)*(i.match(e)?Math.pow(10,9):1)*(i.match(f)?Math.pow(10,12):1)*(b.indexOf("%")>-1?.01:1)*((b.split("-").length+Math.min(b.split("(").length-1,b.split(")").length-1))%2?1:-1)*Number(b.replace(/[^0-9\.]+/g,"")),a._value=k?Math.ceil(a._value):a._value}return a._value}function e(a,b,c){var d,e,f=b.indexOf("$"),g=b.indexOf("("),h=b.indexOf("-"),j="";return b.indexOf(" $")>-1?(j=" ",b=b.replace(" $","")):b.indexOf("$ ")>-1?(j=" ",b=b.replace("$ ","")):b=b.replace("$",""),e=i(a._value,b,c),1>=f?e.indexOf("(")>-1||e.indexOf("-")>-1?(e=e.split(""),d=1,(g>f||h>f)&&(d=0),e.splice(d,0,o[p].currency.symbol+j),e=e.join("")):e=o[p].currency.symbol+j+e:e.indexOf(")")>-1?(e=e.split(""),e.splice(-1,0,j+o[p].currency.symbol),e=e.join("")):e=e+j+o[p].currency.symbol,e}function f(a,b,c){var d,e="",f=100*a._value;return b.indexOf(" %")>-1?(e=" ",b=b.replace(" %","")):b=b.replace("%",""),d=i(f,b,c),d.indexOf(")")>-1?(d=d.split(""),d.splice(-1,0,e+"%"),d=d.join("")):d=d+e+"%",d}function g(a){var b=Math.floor(a._value/60/60),c=Math.floor((a._value-60*b*60)/60),d=Math.round(a._value-60*b*60-60*c);return b+":"+(10>c?"0"+c:c)+":"+(10>d?"0"+d:d)}function h(a){var b=a.split(":"),c=0;return 3===b.length?(c+=60*Number(b[0])*60,c+=60*Number(b[1]),c+=Number(b[2])):2===b.length&&(c+=60*Number(b[0]),c+=Number(b[1])),Number(c)}function i(a,c,d){var e,f,g,h,i,j,k=!1,l=!1,m=!1,n="",r=!1,s=!1,t=!1,u=!1,v=!1,w="",x="",y=Math.abs(a),z=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],A="",B=!1;if(0===a&&null!==q)return q;if(c.indexOf("(")>-1?(k=!0,c=c.slice(1,-1)):c.indexOf("+")>-1&&(l=!0,c=c.replace(/\+/g,"")),c.indexOf("a")>-1&&(r=c.indexOf("aK")>=0,s=c.indexOf("aM")>=0,t=c.indexOf("aB")>=0,u=c.indexOf("aT")>=0,v=r||s||t||u,c.indexOf(" a")>-1?(n=" ",c=c.replace(" a","")):c=c.replace("a",""),y>=Math.pow(10,12)&&!v||u?(n+=o[p].abbreviations.trillion,a/=Math.pow(10,12)):y<Math.pow(10,12)&&y>=Math.pow(10,9)&&!v||t?(n+=o[p].abbreviations.billion,a/=Math.pow(10,9)):y<Math.pow(10,9)&&y>=Math.pow(10,6)&&!v||s?(n+=o[p].abbreviations.million,a/=Math.pow(10,6)):(y<Math.pow(10,6)&&y>=Math.pow(10,3)&&!v||r)&&(n+=o[p].abbreviations.thousand,a/=Math.pow(10,3))),c.indexOf("b")>-1)for(c.indexOf(" b")>-1?(w=" ",c=c.replace(" b","")):c=c.replace("b",""),g=0;g<=z.length;g++)if(e=Math.pow(1024,g),f=Math.pow(1024,g+1),a>=e&&f>a){w+=z[g],e>0&&(a/=e);break}return c.indexOf("o")>-1&&(c.indexOf(" o")>-1?(x=" ",c=c.replace(" o","")):c=c.replace("o",""),x+=o[p].ordinal(a)),c.indexOf("[.]")>-1&&(m=!0,c=c.replace("[.]",".")),h=a.toString().split(".")[0],i=c.split(".")[1],j=c.indexOf(","),i?(i.indexOf("[")>-1?(i=i.replace("]",""),i=i.split("["),A=b(a,i[0].length+i[1].length,d,i[1].length)):A=b(a,i.length,d),h=A.split(".")[0],A=A.split(".")[1].length?o[p].delimiters.decimal+A.split(".")[1]:"",m&&0===Number(A.slice(1))&&(A="")):h=b(a,null,d),h.indexOf("-")>-1&&(h=h.slice(1),B=!0),j>-1&&(h=h.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1"+o[p].delimiters.thousands)),0===c.indexOf(".")&&(h=""),(k&&B?"(":"")+(!k&&B?"-":"")+(!B&&l?"+":"")+h+A+(x?x:"")+(n?n:"")+(w?w:"")+(k&&B?")":"")}function j(a,b){o[a]=b}function k(a){var b=a.toString().split(".");return b.length<2?1:Math.pow(10,b[1].length)}function l(){var a=Array.prototype.slice.call(arguments);return a.reduce(function(a,b){var c=k(a),d=k(b);return c>d?c:d},-1/0)}var m,n="1.5.3",o={},p="en",q=null,r="0,0",s="undefined"!=typeof module&&module.exports;m=function(b){return m.isNumeral(b)?b=b.value():0===b||"undefined"==typeof b?b=0:Number(b)||(b=m.fn.unformat(b)),new a(Number(b))},m.version=n,m.isNumeral=function(b){return b instanceof a},m.language=function(a,b){if(!a)return p;if(a&&!b){if(!o[a])throw new Error("Unknown language : "+a);p=a}return(b||!o[a])&&j(a,b),m},m.languageData=function(a){if(!a)return o[p];if(!o[a])throw new Error("Unknown language : "+a);return o[a]},m.language("en",{delimiters:{thousands:",",decimal:"."},abbreviations:{thousand:"k",million:"m",billion:"b",trillion:"t"},ordinal:function(a){var b=a%10;return 1===~~(a%100/10)?"th":1===b?"st":2===b?"nd":3===b?"rd":"th"},currency:{symbol:"$"}}),m.zeroFormat=function(a){q="string"==typeof a?a:null},m.defaultFormat=function(a){r="string"==typeof a?a:"0.0"},"function"!=typeof Array.prototype.reduce&&(Array.prototype.reduce=function(a,b){"use strict";if(null===this||"undefined"==typeof this)throw new TypeError("Array.prototype.reduce called on null or undefined");if("function"!=typeof a)throw new TypeError(a+" is not a function");var c,d,e=this.length>>>0,f=!1;for(1<arguments.length&&(d=b,f=!0),c=0;e>c;++c)this.hasOwnProperty(c)&&(f?d=a(d,this[c],c,this):(d=this[c],f=!0));if(!f)throw new TypeError("Reduce of empty array with no initial value");return d}),m.fn=a.prototype={clone:function(){return m(this)},format:function(a,b){return c(this,a?a:r,void 0!==b?b:Math.round)},unformat:function(a){return"[object Number]"===Object.prototype.toString.call(a)?a:d(this,a?a:r)},value:function(){return this._value},valueOf:function(){return this._value},set:function(a){return this._value=Number(a),this},add:function(a){function b(a,b){return a+c*b}var c=l.call(null,this._value,a);return this._value=[this._value,a].reduce(b,0)/c,this},subtract:function(a){function b(a,b){return a-c*b}var c=l.call(null,this._value,a);return this._value=[a].reduce(b,this._value*c)/c,this},multiply:function(a){function b(a,b){var c=l(a,b);return a*c*b*c/(c*c)}return this._value=[this._value,a].reduce(b,1),this},divide:function(a){function b(a,b){var c=l(a,b);return a*c/(b*c)}return this._value=[this._value,a].reduce(b),this},difference:function(a){return Math.abs(m(this._value).subtract(a).value())}},s&&(module.exports=m),"undefined"==typeof ender&&(this.numeral=m),"function"==typeof define&&define.amd&&define([],function(){return m})}.call(this),function(){"use strict";var a=this,b=a.Chart,c=function(a){this.canvas=a.canvas,this.ctx=a;var b=function(a,b){return a["offset"+b]?a["offset"+b]:document.defaultView.getComputedStyle(a).getPropertyValue(b)},c=this.width=b(a.canvas,"Width"),e=this.height=b(a.canvas,"Height");a.canvas.width=c,a.canvas.height=e;var c=this.width=a.canvas.width,e=this.height=a.canvas.height;return this.aspectRatio=this.width/this.height,d.retinaScale(this),this};c.defaults={global:{animation:!0,animationSteps:60,animationEasing:"easeOutQuart",showScale:!0,scaleOverride:!1,scaleSteps:null,scaleStepWidth:null,scaleStartValue:null,scaleLineColor:"rgba(0,0,0,.1)",scaleLineWidth:1,scaleShowLabels:!0,scaleLabel:"<%=value%>",scaleIntegersOnly:!0,scaleBeginAtZero:!1,scaleFontFamily:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",scaleFontSize:12,scaleFontStyle:"normal",scaleFontColor:"#666",responsive:!1,maintainAspectRatio:!0,showTooltips:!0,customTooltips:!1,tooltipEvents:["mousemove","touchstart","touchmove","mouseout"],tooltipFillColor:"rgba(0,0,0,0.8)",tooltipFontFamily:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",tooltipFontSize:14,tooltipFontStyle:"normal",tooltipFontColor:"#fff",tooltipTitleFontFamily:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",tooltipTitleFontSize:14,tooltipTitleFontStyle:"bold",tooltipTitleFontColor:"#fff",tooltipYPadding:6,tooltipXPadding:6,tooltipCaretSize:8,tooltipCornerRadius:6,tooltipXOffset:10,tooltipTemplate:"<%if (label){%><%=label%>: <%}%><%= value %>",multiTooltipTemplate:"<%= value %>",multiTooltipKeyBackground:"#fff",onAnimationProgress:function(){},onAnimationComplete:function(){}}},c.types={};var d=c.helpers={},e=d.each=function(a,b,c){var d=Array.prototype.slice.call(arguments,3);if(a)if(a.length===+a.length){var e;for(e=0;e<a.length;e++)b.apply(c,[a[e],e].concat(d))}else for(var f in a)b.apply(c,[a[f],f].concat(d))},f=d.clone=function(a){var b={};return e(a,function(c,d){a.hasOwnProperty(d)&&(b[d]=c)}),b},g=d.extend=function(a){return e(Array.prototype.slice.call(arguments,1),function(b){e(b,function(c,d){b.hasOwnProperty(d)&&(a[d]=c)})}),a},h=d.merge=function(){var a=Array.prototype.slice.call(arguments,0);return a.unshift({}),g.apply(null,a)},i=d.indexOf=function(a,b){if(Array.prototype.indexOf)return a.indexOf(b);for(var c=0;c<a.length;c++)if(a[c]===b)return c;return-1},j=(d.where=function(a,b){var c=[];return d.each(a,function(a){b(a)&&c.push(a)}),c},d.findNextWhere=function(a,b,c){c||(c=-1);for(var d=c+1;d<a.length;d++){var e=a[d];if(b(e))return e}},d.findPreviousWhere=function(a,b,c){c||(c=a.length);for(var d=c-1;d>=0;d--){var e=a[d];if(b(e))return e}},d.inherits=function(a){var b=this,c=a&&a.hasOwnProperty("constructor")?a.constructor:function(){return b.apply(this,arguments)},d=function(){this.constructor=c};return d.prototype=b.prototype,c.prototype=new d,c.extend=j,a&&g(c.prototype,a),c.__super__=b.prototype,c}),k=d.noop=function(){},l=d.uid=function(){var a=0;return function(){return"chart-"+a++}}(),m=d.warn=function(a){window.console&&"function"==typeof window.console.warn&&console.warn(a)},n=d.amd="function"==typeof define&&define.amd,o=d.isNumber=function(a){return!isNaN(parseFloat(a))&&isFinite(a)},p=d.max=function(a){return Math.max.apply(Math,a)},q=d.min=function(a){return Math.min.apply(Math,a)},r=(d.cap=function(a,b,c){if(o(b)){if(a>b)return b}else if(o(c)&&c>a)return c;return a},d.getDecimalPlaces=function(a){return a%1!==0&&o(a)?a.toString().split(".")[1].length:0}),s=d.radians=function(a){return a*(Math.PI/180)},t=(d.getAngleFromPoint=function(a,b){var c=b.x-a.x,d=b.y-a.y,e=Math.sqrt(c*c+d*d),f=2*Math.PI+Math.atan2(d,c);return 0>c&&0>d&&(f+=2*Math.PI),{angle:f,distance:e}},d.aliasPixel=function(a){return a%2===0?0:.5}),u=(d.splineCurve=function(a,b,c,d){var e=Math.sqrt(Math.pow(b.x-a.x,2)+Math.pow(b.y-a.y,2)),f=Math.sqrt(Math.pow(c.x-b.x,2)+Math.pow(c.y-b.y,2)),g=d*e/(e+f),h=d*f/(e+f);return{inner:{x:b.x-g*(c.x-a.x),y:b.y-g*(c.y-a.y)},outer:{x:b.x+h*(c.x-a.x),y:b.y+h*(c.y-a.y)}}},d.calculateOrderOfMagnitude=function(a){return Math.floor(Math.log(a)/Math.LN10)}),v=(d.calculateScaleRange=function(a,b,c,d,e){var f=2,g=Math.floor(b/(1.5*c)),h=f>=g,i=p(a),j=q(a);i===j&&(i+=.5,j>=.5&&!d?j-=.5:i+=.5);for(var k=Math.abs(i-j),l=u(k),m=Math.ceil(i/(1*Math.pow(10,l)))*Math.pow(10,l),n=d?0:Math.floor(j/(1*Math.pow(10,l)))*Math.pow(10,l),o=m-n,r=Math.pow(10,l),s=Math.round(o/r);(s>g||g>2*s)&&!h;)if(s>g)r*=2,s=Math.round(o/r),s%1!==0&&(h=!0);else if(e&&l>=0){if(r/2%1!==0)break;r/=2,s=Math.round(o/r)}else r/=2,s=Math.round(o/r);return h&&(s=f,r=o/s),{steps:s,stepValue:r,min:n,max:n+s*r}},d.template=function(a,b){function c(a,b){var c=/\W/.test(a)?new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+a.replace(/[\r\t\n]/g," ").split("<%").join("	").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("	").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');"):d[a]=d[a];return b?c(b):c}if(a instanceof Function)return a(b);var d={};return c(a,b)}),w=(d.generateLabels=function(a,b,c,d){var f=new Array(b);return labelTemplateString&&e(f,function(b,e){f[e]=v(a,{value:c+d*(e+1)})}),f},d.easingEffects={linear:function(a){return a},easeInQuad:function(a){return a*a},easeOutQuad:function(a){return-1*a*(a-2)},easeInOutQuad:function(a){return(a/=.5)<1?.5*a*a:-.5*(--a*(a-2)-1)},easeInCubic:function(a){return a*a*a},easeOutCubic:function(a){return 1*((a=a/1-1)*a*a+1)},easeInOutCubic:function(a){return(a/=.5)<1?.5*a*a*a:.5*((a-=2)*a*a+2)},easeInQuart:function(a){return a*a*a*a},easeOutQuart:function(a){return-1*((a=a/1-1)*a*a*a-1)},easeInOutQuart:function(a){return(a/=.5)<1?.5*a*a*a*a:-.5*((a-=2)*a*a*a-2)},easeInQuint:function(a){return 1*(a/=1)*a*a*a*a},easeOutQuint:function(a){return 1*((a=a/1-1)*a*a*a*a+1)},easeInOutQuint:function(a){return(a/=.5)<1?.5*a*a*a*a*a:.5*((a-=2)*a*a*a*a+2)},easeInSine:function(a){return-1*Math.cos(a/1*(Math.PI/2))+1},easeOutSine:function(a){return 1*Math.sin(a/1*(Math.PI/2))},easeInOutSine:function(a){return-.5*(Math.cos(Math.PI*a/1)-1)},easeInExpo:function(a){return 0===a?1:1*Math.pow(2,10*(a/1-1))},easeOutExpo:function(a){return 1===a?1:1*(-Math.pow(2,-10*a/1)+1)},easeInOutExpo:function(a){
return 0===a?0:1===a?1:(a/=.5)<1?.5*Math.pow(2,10*(a-1)):.5*(-Math.pow(2,-10*--a)+2)},easeInCirc:function(a){return a>=1?a:-1*(Math.sqrt(1-(a/=1)*a)-1)},easeOutCirc:function(a){return 1*Math.sqrt(1-(a=a/1-1)*a)},easeInOutCirc:function(a){return(a/=.5)<1?-.5*(Math.sqrt(1-a*a)-1):.5*(Math.sqrt(1-(a-=2)*a)+1)},easeInElastic:function(a){var b=1.70158,c=0,d=1;return 0===a?0:1==(a/=1)?1:(c||(c=.3),d<Math.abs(1)?(d=1,b=c/4):b=c/(2*Math.PI)*Math.asin(1/d),-(d*Math.pow(2,10*(a-=1))*Math.sin(2*(1*a-b)*Math.PI/c)))},easeOutElastic:function(a){var b=1.70158,c=0,d=1;return 0===a?0:1==(a/=1)?1:(c||(c=.3),d<Math.abs(1)?(d=1,b=c/4):b=c/(2*Math.PI)*Math.asin(1/d),d*Math.pow(2,-10*a)*Math.sin(2*(1*a-b)*Math.PI/c)+1)},easeInOutElastic:function(a){var b=1.70158,c=0,d=1;return 0===a?0:2==(a/=.5)?1:(c||(c=.3*1.5),d<Math.abs(1)?(d=1,b=c/4):b=c/(2*Math.PI)*Math.asin(1/d),1>a?-.5*d*Math.pow(2,10*(a-=1))*Math.sin(2*(1*a-b)*Math.PI/c):d*Math.pow(2,-10*(a-=1))*Math.sin(2*(1*a-b)*Math.PI/c)*.5+1)},easeInBack:function(a){var b=1.70158;return 1*(a/=1)*a*((b+1)*a-b)},easeOutBack:function(a){var b=1.70158;return 1*((a=a/1-1)*a*((b+1)*a+b)+1)},easeInOutBack:function(a){var b=1.70158;return(a/=.5)<1?.5*a*a*(((b*=1.525)+1)*a-b):.5*((a-=2)*a*(((b*=1.525)+1)*a+b)+2)},easeInBounce:function(a){return 1-w.easeOutBounce(1-a)},easeOutBounce:function(a){return(a/=1)<1/2.75?7.5625*a*a:2/2.75>a?1*(7.5625*(a-=1.5/2.75)*a+.75):2.5/2.75>a?1*(7.5625*(a-=2.25/2.75)*a+.9375):1*(7.5625*(a-=2.625/2.75)*a+.984375)},easeInOutBounce:function(a){return.5>a?.5*w.easeInBounce(2*a):.5*w.easeOutBounce(2*a-1)+.5}}),x=d.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return window.setTimeout(a,1e3/60)}}(),y=d.cancelAnimFrame=function(){return window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame||function(a){return window.clearTimeout(a,1e3/60)}}(),z=(d.animationLoop=function(a,b,c,d,e,f){var g=0,h=w[c]||w.linear,i=function(){g++;var c=g/b,j=h(c);a.call(f,j,c,g),d.call(f,j,c),b>g?f.animationFrame=x(i):e.apply(f)};x(i)},d.getRelativePosition=function(a){var b,c,d=a.originalEvent||a,e=a.currentTarget||a.srcElement,f=e.getBoundingClientRect();return d.touches?(b=d.touches[0].clientX-f.left,c=d.touches[0].clientY-f.top):(b=d.clientX-f.left,c=d.clientY-f.top),{x:b,y:c}},d.addEvent=function(a,b,c){a.addEventListener?a.addEventListener(b,c):a.attachEvent?a.attachEvent("on"+b,c):a["on"+b]=c}),A=d.removeEvent=function(a,b,c){a.removeEventListener?a.removeEventListener(b,c,!1):a.detachEvent?a.detachEvent("on"+b,c):a["on"+b]=k},B=(d.bindEvents=function(a,b,c){a.events||(a.events={}),e(b,function(b){a.events[b]=function(){c.apply(a,arguments)},z(a.chart.canvas,b,a.events[b])})},d.unbindEvents=function(a,b){e(b,function(b,c){A(a.chart.canvas,c,b)})}),C=d.getMaximumWidth=function(a){var b=a.parentNode;return b.clientWidth},D=d.getMaximumHeight=function(a){var b=a.parentNode;return b.clientHeight},E=(d.getMaximumSize=d.getMaximumWidth,d.retinaScale=function(a){var b=a.ctx,c=a.canvas.width,d=a.canvas.height;window.devicePixelRatio&&(b.canvas.style.width=c+"px",b.canvas.style.height=d+"px",b.canvas.height=d*window.devicePixelRatio,b.canvas.width=c*window.devicePixelRatio,b.scale(window.devicePixelRatio,window.devicePixelRatio))}),F=d.clear=function(a){a.ctx.clearRect(0,0,a.width,a.height)},G=d.fontString=function(a,b,c){return b+" "+a+"px "+c},H=d.longestText=function(a,b,c){a.font=b;var d=0;return e(c,function(b){var c=a.measureText(b).width;d=c>d?c:d}),d},I=d.drawRoundedRectangle=function(a,b,c,d,e,f){a.beginPath(),a.moveTo(b+f,c),a.lineTo(b+d-f,c),a.quadraticCurveTo(b+d,c,b+d,c+f),a.lineTo(b+d,c+e-f),a.quadraticCurveTo(b+d,c+e,b+d-f,c+e),a.lineTo(b+f,c+e),a.quadraticCurveTo(b,c+e,b,c+e-f),a.lineTo(b,c+f),a.quadraticCurveTo(b,c,b+f,c),a.closePath()};c.instances={},c.Type=function(a,b,d){this.options=b,this.chart=d,this.id=l(),c.instances[this.id]=this,b.responsive&&this.resize(),this.initialize.call(this,a)},g(c.Type.prototype,{initialize:function(){return this},clear:function(){return F(this.chart),this},stop:function(){return y(this.animationFrame),this},resize:function(a){this.stop();var b=this.chart.canvas,c=C(this.chart.canvas),d=this.options.maintainAspectRatio?c/this.chart.aspectRatio:D(this.chart.canvas);return b.width=this.chart.width=c,b.height=this.chart.height=d,E(this.chart),"function"==typeof a&&a.apply(this,Array.prototype.slice.call(arguments,1)),this},reflow:k,render:function(a){return a&&this.reflow(),this.options.animation&&!a?d.animationLoop(this.draw,this.options.animationSteps,this.options.animationEasing,this.options.onAnimationProgress,this.options.onAnimationComplete,this):(this.draw(),this.options.onAnimationComplete.call(this)),this},generateLegend:function(){return v(this.options.legendTemplate,this)},destroy:function(){this.clear(),B(this,this.events);var a=this.chart.canvas;a.width=this.chart.width,a.height=this.chart.height,a.style.removeProperty?(a.style.removeProperty("width"),a.style.removeProperty("height")):(a.style.removeAttribute("width"),a.style.removeAttribute("height")),delete c.instances[this.id]},showTooltip:function(a,b){"undefined"==typeof this.activeElements&&(this.activeElements=[]);var f=function(a){var b=!1;return a.length!==this.activeElements.length?b=!0:(e(a,function(a,c){a!==this.activeElements[c]&&(b=!0)},this),b)}.call(this,a);if(f||b){if(this.activeElements=a,this.draw(),this.options.customTooltips&&this.options.customTooltips(!1),a.length>0)if(this.datasets&&this.datasets.length>1){for(var g,h,j=this.datasets.length-1;j>=0&&(g=this.datasets[j].points||this.datasets[j].bars||this.datasets[j].segments,h=i(g,a[0]),-1===h);j--);var k=[],l=[],m=function(){var a,b,c,e,f,g=[],i=[],j=[];return d.each(this.datasets,function(b){a=b.points||b.bars||b.segments,a[h]&&a[h].hasValue()&&g.push(a[h])}),d.each(g,function(a){i.push(a.x),j.push(a.y),k.push(d.template(this.options.multiTooltipTemplate,a)),l.push({fill:a._saved.fillColor||a.fillColor,stroke:a._saved.strokeColor||a.strokeColor})},this),f=q(j),c=p(j),e=q(i),b=p(i),{x:e>this.chart.width/2?e:b,y:(f+c)/2}}.call(this,h);new c.MultiTooltip({x:m.x,y:m.y,xPadding:this.options.tooltipXPadding,yPadding:this.options.tooltipYPadding,xOffset:this.options.tooltipXOffset,fillColor:this.options.tooltipFillColor,textColor:this.options.tooltipFontColor,fontFamily:this.options.tooltipFontFamily,fontStyle:this.options.tooltipFontStyle,fontSize:this.options.tooltipFontSize,titleTextColor:this.options.tooltipTitleFontColor,titleFontFamily:this.options.tooltipTitleFontFamily,titleFontStyle:this.options.tooltipTitleFontStyle,titleFontSize:this.options.tooltipTitleFontSize,cornerRadius:this.options.tooltipCornerRadius,labels:k,legendColors:l,legendColorBackground:this.options.multiTooltipKeyBackground,title:a[0].label,chart:this.chart,ctx:this.chart.ctx,custom:this.options.customTooltips}).draw()}else e(a,function(a){var b=a.tooltipPosition();new c.Tooltip({x:Math.round(b.x),y:Math.round(b.y),xPadding:this.options.tooltipXPadding,yPadding:this.options.tooltipYPadding,fillColor:this.options.tooltipFillColor,textColor:this.options.tooltipFontColor,fontFamily:this.options.tooltipFontFamily,fontStyle:this.options.tooltipFontStyle,fontSize:this.options.tooltipFontSize,caretHeight:this.options.tooltipCaretSize,cornerRadius:this.options.tooltipCornerRadius,text:v(this.options.tooltipTemplate,a),chart:this.chart,custom:this.options.customTooltips}).draw()},this);return this}},toBase64Image:function(){return this.chart.canvas.toDataURL.apply(this.chart.canvas,arguments)}}),c.Type.extend=function(a){var b=this,d=function(){return b.apply(this,arguments)};if(d.prototype=f(b.prototype),g(d.prototype,a),d.extend=c.Type.extend,a.name||b.prototype.name){var e=a.name||b.prototype.name,i=c.defaults[b.prototype.name]?f(c.defaults[b.prototype.name]):{};c.defaults[e]=g(i,a.defaults),c.types[e]=d,c.prototype[e]=function(a,b){var f=h(c.defaults.global,c.defaults[e],b||{});return new d(a,f,this)}}else m("Name not provided for this chart, so it hasn't been registered");return b},c.Element=function(a){g(this,a),this.initialize.apply(this,arguments),this.save()},g(c.Element.prototype,{initialize:function(){},restore:function(a){return a?e(a,function(a){this[a]=this._saved[a]},this):g(this,this._saved),this},save:function(){return this._saved=f(this),delete this._saved._saved,this},update:function(a){return e(a,function(a,b){this._saved[b]=this[b],this[b]=a},this),this},transition:function(a,b){return e(a,function(a,c){this[c]=(a-this._saved[c])*b+this._saved[c]},this),this},tooltipPosition:function(){return{x:this.x,y:this.y}},hasValue:function(){return o(this.value)}}),c.Element.extend=j,c.Point=c.Element.extend({display:!0,inRange:function(a,b){var c=this.hitDetectionRadius+this.radius;return Math.pow(a-this.x,2)+Math.pow(b-this.y,2)<Math.pow(c,2)},draw:function(){if(this.display){var a=this.ctx;a.beginPath(),a.arc(this.x,this.y,this.radius,0,2*Math.PI),a.closePath(),a.strokeStyle=this.strokeColor,a.lineWidth=this.strokeWidth,a.fillStyle=this.fillColor,a.fill(),a.stroke()}}}),c.Arc=c.Element.extend({inRange:function(a,b){var c=d.getAngleFromPoint(this,{x:a,y:b}),e=c.angle>=this.startAngle&&c.angle<=this.endAngle,f=c.distance>=this.innerRadius&&c.distance<=this.outerRadius;return e&&f},tooltipPosition:function(){var a=this.startAngle+(this.endAngle-this.startAngle)/2,b=(this.outerRadius-this.innerRadius)/2+this.innerRadius;return{x:this.x+Math.cos(a)*b,y:this.y+Math.sin(a)*b}},draw:function(){var a=this.ctx;a.beginPath(),a.arc(this.x,this.y,this.outerRadius,this.startAngle,this.endAngle),a.arc(this.x,this.y,this.innerRadius,this.endAngle,this.startAngle,!0),a.closePath(),a.strokeStyle=this.strokeColor,a.lineWidth=this.strokeWidth,a.fillStyle=this.fillColor,a.fill(),a.lineJoin="bevel",this.showStroke&&a.stroke()}}),c.Rectangle=c.Element.extend({draw:function(){var a=this.ctx,b=this.width/2,c=this.x-b,d=this.x+b,e=this.base-(this.base-this.y),f=this.strokeWidth/2;this.showStroke&&(c+=f,d-=f,e+=f),a.beginPath(),a.fillStyle=this.fillColor,a.strokeStyle=this.strokeColor,a.lineWidth=this.strokeWidth,a.moveTo(c,this.base),a.lineTo(c,e),a.lineTo(d,e),a.lineTo(d,this.base),a.fill(),this.showStroke&&a.stroke()},height:function(){return this.base-this.y},inRange:function(a,b){return a>=this.x-this.width/2&&a<=this.x+this.width/2&&b>=this.y&&b<=this.base}}),c.Tooltip=c.Element.extend({draw:function(){var a=this.chart.ctx;a.font=G(this.fontSize,this.fontStyle,this.fontFamily),this.xAlign="center",this.yAlign="above";var b=this.caretPadding=2,c=a.measureText(this.text).width+2*this.xPadding,d=this.fontSize+2*this.yPadding,e=d+this.caretHeight+b;this.x+c/2>this.chart.width?this.xAlign="left":this.x-c/2<0&&(this.xAlign="right"),this.y-e<0&&(this.yAlign="below");var f=this.x-c/2,g=this.y-e;if(a.fillStyle=this.fillColor,this.custom)this.custom(this);else{switch(this.yAlign){case"above":a.beginPath(),a.moveTo(this.x,this.y-b),a.lineTo(this.x+this.caretHeight,this.y-(b+this.caretHeight)),a.lineTo(this.x-this.caretHeight,this.y-(b+this.caretHeight)),a.closePath(),a.fill();break;case"below":g=this.y+b+this.caretHeight,a.beginPath(),a.moveTo(this.x,this.y+b),a.lineTo(this.x+this.caretHeight,this.y+b+this.caretHeight),a.lineTo(this.x-this.caretHeight,this.y+b+this.caretHeight),a.closePath(),a.fill()}switch(this.xAlign){case"left":f=this.x-c+(this.cornerRadius+this.caretHeight);break;case"right":f=this.x-(this.cornerRadius+this.caretHeight)}I(a,f,g,c,d,this.cornerRadius),a.fill(),a.fillStyle=this.textColor,a.textAlign="center",a.textBaseline="middle",a.fillText(this.text,f+c/2,g+d/2)}}}),c.MultiTooltip=c.Element.extend({initialize:function(){this.font=G(this.fontSize,this.fontStyle,this.fontFamily),this.titleFont=G(this.titleFontSize,this.titleFontStyle,this.titleFontFamily),this.height=this.labels.length*this.fontSize+(this.labels.length-1)*(this.fontSize/2)+2*this.yPadding+1.5*this.titleFontSize,this.ctx.font=this.titleFont;var a=this.ctx.measureText(this.title).width,b=H(this.ctx,this.font,this.labels)+this.fontSize+3,c=p([b,a]);this.width=c+2*this.xPadding;var d=this.height/2;this.y-d<0?this.y=d:this.y+d>this.chart.height&&(this.y=this.chart.height-d),this.x>this.chart.width/2?this.x-=this.xOffset+this.width:this.x+=this.xOffset},getLineHeight:function(a){var b=this.y-this.height/2+this.yPadding,c=a-1;return 0===a?b+this.titleFontSize/2:b+(1.5*this.fontSize*c+this.fontSize/2)+1.5*this.titleFontSize},draw:function(){if(this.custom)this.custom(this);else{I(this.ctx,this.x,this.y-this.height/2,this.width,this.height,this.cornerRadius);var a=this.ctx;a.fillStyle=this.fillColor,a.fill(),a.closePath(),a.textAlign="left",a.textBaseline="middle",a.fillStyle=this.titleTextColor,a.font=this.titleFont,a.fillText(this.title,this.x+this.xPadding,this.getLineHeight(0)),a.font=this.font,d.each(this.labels,function(b,c){a.fillStyle=this.textColor,a.fillText(b,this.x+this.xPadding+this.fontSize+3,this.getLineHeight(c+1)),a.fillStyle=this.legendColorBackground,a.fillRect(this.x+this.xPadding,this.getLineHeight(c+1)-this.fontSize/2,this.fontSize,this.fontSize),a.fillStyle=this.legendColors[c].fill,a.fillRect(this.x+this.xPadding,this.getLineHeight(c+1)-this.fontSize/2,this.fontSize,this.fontSize)},this)}}}),c.Scale=c.Element.extend({initialize:function(){this.fit()},buildYLabels:function(){this.yLabels=[];for(var a=r(this.stepValue),b=0;b<=this.steps;b++)this.yLabels.push(v(this.templateString,{value:(this.min+b*this.stepValue).toFixed(a)}));this.yLabelWidth=this.display&&this.showLabels?H(this.ctx,this.font,this.yLabels):0},addXLabel:function(a){this.xLabels.push(a),this.valuesCount++,this.fit()},removeXLabel:function(){this.xLabels.shift(),this.valuesCount--,this.fit()},fit:function(){this.startPoint=this.display?this.fontSize:0,this.endPoint=this.display?this.height-1.5*this.fontSize-5:this.height,this.startPoint+=this.padding,this.endPoint-=this.padding;var a,b=this.endPoint-this.startPoint;for(this.calculateYRange(b),this.buildYLabels(),this.calculateXLabelRotation();b>this.endPoint-this.startPoint;)b=this.endPoint-this.startPoint,a=this.yLabelWidth,this.calculateYRange(b),this.buildYLabels(),a<this.yLabelWidth&&this.calculateXLabelRotation()},calculateXLabelRotation:function(){this.ctx.font=this.font;var a,b,c=this.ctx.measureText(this.xLabels[0]).width,d=this.ctx.measureText(this.xLabels[this.xLabels.length-1]).width;if(this.xScalePaddingRight=d/2+3,this.xScalePaddingLeft=c/2>this.yLabelWidth+10?c/2:this.yLabelWidth+10,this.xLabelRotation=0,this.display){var e,f=H(this.ctx,this.font,this.xLabels);this.xLabelWidth=f;for(var g=Math.floor(this.calculateX(1)-this.calculateX(0))-6;this.xLabelWidth>g&&0===this.xLabelRotation||this.xLabelWidth>g&&this.xLabelRotation<=90&&this.xLabelRotation>0;)e=Math.cos(s(this.xLabelRotation)),a=e*c,b=e*d,a+this.fontSize/2>this.yLabelWidth+8&&(this.xScalePaddingLeft=a+this.fontSize/2),this.xScalePaddingRight=this.fontSize/2,this.xLabelRotation++,this.xLabelWidth=e*f;this.xLabelRotation>0&&(this.endPoint-=Math.sin(s(this.xLabelRotation))*f+3)}else this.xLabelWidth=0,this.xScalePaddingRight=this.padding,this.xScalePaddingLeft=this.padding},calculateYRange:k,drawingArea:function(){return this.startPoint-this.endPoint},calculateY:function(a){var b=this.drawingArea()/(this.min-this.max);return this.endPoint-b*(a-this.min)},calculateX:function(a){var b=(this.xLabelRotation>0,this.width-(this.xScalePaddingLeft+this.xScalePaddingRight)),c=b/Math.max(this.valuesCount-(this.offsetGridLines?0:1),1),d=c*a+this.xScalePaddingLeft;return this.offsetGridLines&&(d+=c/2),Math.round(d)},update:function(a){d.extend(this,a),this.fit()},draw:function(){var a=this.ctx,b=(this.endPoint-this.startPoint)/this.steps,c=Math.round(this.xScalePaddingLeft);this.display&&(a.fillStyle=this.textColor,a.font=this.font,e(this.yLabels,function(e,f){var g=this.endPoint-b*f,h=Math.round(g),i=this.showHorizontalLines;a.textAlign="right",a.textBaseline="middle",this.showLabels&&a.fillText(e,c-10,g),0!==f||i||(i=!0),i&&a.beginPath(),f>0?(a.lineWidth=this.gridLineWidth,a.strokeStyle=this.gridLineColor):(a.lineWidth=this.lineWidth,a.strokeStyle=this.lineColor),h+=d.aliasPixel(a.lineWidth),i&&(a.moveTo(c,h),a.lineTo(this.width,h),a.stroke(),a.closePath()),a.lineWidth=this.lineWidth,a.strokeStyle=this.lineColor,a.beginPath(),a.moveTo(c-5,h),a.lineTo(c,h),a.stroke(),a.closePath()},this),e(this.xLabels,function(b,c){var d=this.calculateX(c)+t(this.lineWidth),e=this.calculateX(c-(this.offsetGridLines?.5:0))+t(this.lineWidth),f=this.xLabelRotation>0,g=this.showVerticalLines;0!==c||g||(g=!0),g&&a.beginPath(),c>0?(a.lineWidth=this.gridLineWidth,a.strokeStyle=this.gridLineColor):(a.lineWidth=this.lineWidth,a.strokeStyle=this.lineColor),g&&(a.moveTo(e,this.endPoint),a.lineTo(e,this.startPoint-3),a.stroke(),a.closePath()),a.lineWidth=this.lineWidth,a.strokeStyle=this.lineColor,a.beginPath(),a.moveTo(e,this.endPoint),a.lineTo(e,this.endPoint+5),a.stroke(),a.closePath(),a.save(),a.translate(d,f?this.endPoint+12:this.endPoint+8),a.rotate(-1*s(this.xLabelRotation)),a.font=this.font,a.textAlign=f?"right":"center",a.textBaseline=f?"middle":"top",a.fillText(b,0,0),a.restore()},this))}}),c.RadialScale=c.Element.extend({initialize:function(){this.size=q([this.height,this.width]),this.drawingArea=this.display?this.size/2-(this.fontSize/2+this.backdropPaddingY):this.size/2},calculateCenterOffset:function(a){var b=this.drawingArea/(this.max-this.min);return(a-this.min)*b},update:function(){this.lineArc?this.drawingArea=this.display?this.size/2-(this.fontSize/2+this.backdropPaddingY):this.size/2:this.setScaleSize(),this.buildYLabels()},buildYLabels:function(){this.yLabels=[];for(var a=r(this.stepValue),b=0;b<=this.steps;b++)this.yLabels.push(v(this.templateString,{value:(this.min+b*this.stepValue).toFixed(a)}))},getCircumference:function(){return 2*Math.PI/this.valuesCount},setScaleSize:function(){var a,b,c,d,e,f,g,h,i,j,k,l,m=q([this.height/2-this.pointLabelFontSize-5,this.width/2]),n=this.width,p=0;for(this.ctx.font=G(this.pointLabelFontSize,this.pointLabelFontStyle,this.pointLabelFontFamily),b=0;b<this.valuesCount;b++)a=this.getPointPosition(b,m),c=this.ctx.measureText(v(this.templateString,{value:this.labels[b]})).width+5,0===b||b===this.valuesCount/2?(d=c/2,a.x+d>n&&(n=a.x+d,e=b),a.x-d<p&&(p=a.x-d,g=b)):b<this.valuesCount/2?a.x+c>n&&(n=a.x+c,e=b):b>this.valuesCount/2&&a.x-c<p&&(p=a.x-c,g=b);i=p,j=Math.ceil(n-this.width),f=this.getIndexAngle(e),h=this.getIndexAngle(g),k=j/Math.sin(f+Math.PI/2),l=i/Math.sin(h+Math.PI/2),k=o(k)?k:0,l=o(l)?l:0,this.drawingArea=m-(l+k)/2,this.setCenterPoint(l,k)},setCenterPoint:function(a,b){var c=this.width-b-this.drawingArea,d=a+this.drawingArea;this.xCenter=(d+c)/2,this.yCenter=this.height/2},getIndexAngle:function(a){var b=2*Math.PI/this.valuesCount;return a*b-Math.PI/2},getPointPosition:function(a,b){var c=this.getIndexAngle(a);return{x:Math.cos(c)*b+this.xCenter,y:Math.sin(c)*b+this.yCenter}},draw:function(){if(this.display){var a=this.ctx;if(e(this.yLabels,function(b,c){if(c>0){var d,e=c*(this.drawingArea/this.steps),f=this.yCenter-e;if(this.lineWidth>0)if(a.strokeStyle=this.lineColor,a.lineWidth=this.lineWidth,this.lineArc)a.beginPath(),a.arc(this.xCenter,this.yCenter,e,0,2*Math.PI),a.closePath(),a.stroke();else{a.beginPath();for(var g=0;g<this.valuesCount;g++)d=this.getPointPosition(g,this.calculateCenterOffset(this.min+c*this.stepValue)),0===g?a.moveTo(d.x,d.y):a.lineTo(d.x,d.y);a.closePath(),a.stroke()}if(this.showLabels){if(a.font=G(this.fontSize,this.fontStyle,this.fontFamily),this.showLabelBackdrop){var h=a.measureText(b).width;a.fillStyle=this.backdropColor,a.fillRect(this.xCenter-h/2-this.backdropPaddingX,f-this.fontSize/2-this.backdropPaddingY,h+2*this.backdropPaddingX,this.fontSize+2*this.backdropPaddingY)}a.textAlign="center",a.textBaseline="middle",a.fillStyle=this.fontColor,a.fillText(b,this.xCenter,f)}}},this),!this.lineArc){a.lineWidth=this.angleLineWidth,a.strokeStyle=this.angleLineColor;for(var b=this.valuesCount-1;b>=0;b--){if(this.angleLineWidth>0){var c=this.getPointPosition(b,this.calculateCenterOffset(this.max));a.beginPath(),a.moveTo(this.xCenter,this.yCenter),a.lineTo(c.x,c.y),a.stroke(),a.closePath()}var d=this.getPointPosition(b,this.calculateCenterOffset(this.max)+5);a.font=G(this.pointLabelFontSize,this.pointLabelFontStyle,this.pointLabelFontFamily),a.fillStyle=this.pointLabelFontColor;var f=this.labels.length,g=this.labels.length/2,h=g/2,i=h>b||b>f-h,j=b===h||b===f-h;a.textAlign=0===b?"center":b===g?"center":g>b?"left":"right",a.textBaseline=j?"middle":i?"bottom":"top",a.fillText(this.labels[b],d.x,d.y)}}}}}),d.addEvent(window,"resize",function(){var a;return function(){clearTimeout(a),a=setTimeout(function(){e(c.instances,function(a){a.options.responsive&&a.resize(a.render,!0)})},50)}}()),n?define(function(){return c}):"object"==typeof module&&module.exports&&(module.exports=c),a.Chart=c,c.noConflict=function(){return a.Chart=b,c}}.call(this),function(){"use strict";var a=this,b=a.Chart,c=b.helpers,d={scaleBeginAtZero:!0,scaleShowGridLines:!0,scaleGridLineColor:"rgba(0,0,0,.05)",scaleGridLineWidth:1,scaleShowHorizontalLines:!0,scaleShowVerticalLines:!0,barShowStroke:!0,barStrokeWidth:2,barValueSpacing:5,barDatasetSpacing:1,legendTemplate:'<ul class="<%=name.toLowerCase()%>-legend"><% for (var i=0; i<datasets.length; i++){%><li><span style="background-color:<%=datasets[i].fillColor%>"></span><%if(datasets[i].label){%><%=datasets[i].label%><%}%></li><%}%></ul>'};b.Type.extend({name:"Bar",defaults:d,initialize:function(a){var d=this.options;this.ScaleClass=b.Scale.extend({offsetGridLines:!0,calculateBarX:function(a,b,c){var e=this.calculateBaseWidth(),f=this.calculateX(c)-e/2,g=this.calculateBarWidth(a);return f+g*b+b*d.barDatasetSpacing+g/2},calculateBaseWidth:function(){return this.calculateX(1)-this.calculateX(0)-2*d.barValueSpacing},calculateBarWidth:function(a){var b=this.calculateBaseWidth()-(a-1)*d.barDatasetSpacing;return b/a}}),this.datasets=[],this.options.showTooltips&&c.bindEvents(this,this.options.tooltipEvents,function(a){var b="mouseout"!==a.type?this.getBarsAtEvent(a):[];this.eachBars(function(a){a.restore(["fillColor","strokeColor"])}),c.each(b,function(a){a.fillColor=a.highlightFill,a.strokeColor=a.highlightStroke}),this.showTooltip(b)}),this.BarClass=b.Rectangle.extend({strokeWidth:this.options.barStrokeWidth,showStroke:this.options.barShowStroke,ctx:this.chart.ctx}),c.each(a.datasets,function(b){var d={label:b.label||null,fillColor:b.fillColor,strokeColor:b.strokeColor,bars:[]};this.datasets.push(d),c.each(b.data,function(c,e){d.bars.push(new this.BarClass({value:c,label:a.labels[e],datasetLabel:b.label,strokeColor:b.strokeColor,fillColor:b.fillColor,highlightFill:b.highlightFill||b.fillColor,highlightStroke:b.highlightStroke||b.strokeColor}))},this)},this),this.buildScale(a.labels),this.BarClass.prototype.base=this.scale.endPoint,this.eachBars(function(a,b,d){c.extend(a,{width:this.scale.calculateBarWidth(this.datasets.length),x:this.scale.calculateBarX(this.datasets.length,d,b),y:this.scale.endPoint}),a.save()},this),this.render()},update:function(){this.scale.update(),c.each(this.activeElements,function(a){a.restore(["fillColor","strokeColor"])}),this.eachBars(function(a){a.save()}),this.render()},eachBars:function(a){c.each(this.datasets,function(b,d){c.each(b.bars,a,this,d)},this)},getBarsAtEvent:function(a){for(var b,d=[],e=c.getRelativePosition(a),f=function(a){d.push(a.bars[b])},g=0;g<this.datasets.length;g++)for(b=0;b<this.datasets[g].bars.length;b++)if(this.datasets[g].bars[b].inRange(e.x,e.y))return c.each(this.datasets,f),d;return d},buildScale:function(a){var b=this,d=function(){var a=[];return b.eachBars(function(b){a.push(b.value)}),a},e={templateString:this.options.scaleLabel,height:this.chart.height,width:this.chart.width,ctx:this.chart.ctx,textColor:this.options.scaleFontColor,fontSize:this.options.scaleFontSize,fontStyle:this.options.scaleFontStyle,fontFamily:this.options.scaleFontFamily,valuesCount:a.length,beginAtZero:this.options.scaleBeginAtZero,integersOnly:this.options.scaleIntegersOnly,calculateYRange:function(a){var b=c.calculateScaleRange(d(),a,this.fontSize,this.beginAtZero,this.integersOnly);c.extend(this,b)},xLabels:a,font:c.fontString(this.options.scaleFontSize,this.options.scaleFontStyle,this.options.scaleFontFamily),lineWidth:this.options.scaleLineWidth,lineColor:this.options.scaleLineColor,showHorizontalLines:this.options.scaleShowHorizontalLines,showVerticalLines:this.options.scaleShowVerticalLines,gridLineWidth:this.options.scaleShowGridLines?this.options.scaleGridLineWidth:0,gridLineColor:this.options.scaleShowGridLines?this.options.scaleGridLineColor:"rgba(0,0,0,0)",padding:this.options.showScale?0:this.options.barShowStroke?this.options.barStrokeWidth:0,showLabels:this.options.scaleShowLabels,display:this.options.showScale};this.options.scaleOverride&&c.extend(e,{calculateYRange:c.noop,steps:this.options.scaleSteps,stepValue:this.options.scaleStepWidth,min:this.options.scaleStartValue,max:this.options.scaleStartValue+this.options.scaleSteps*this.options.scaleStepWidth}),this.scale=new this.ScaleClass(e)},addData:function(a,b){c.each(a,function(a,c){this.datasets[c].bars.push(new this.BarClass({value:a,label:b,x:this.scale.calculateBarX(this.datasets.length,c,this.scale.valuesCount+1),y:this.scale.endPoint,width:this.scale.calculateBarWidth(this.datasets.length),base:this.scale.endPoint,strokeColor:this.datasets[c].strokeColor,fillColor:this.datasets[c].fillColor}))},this),this.scale.addXLabel(b),this.update()},removeData:function(){this.scale.removeXLabel(),c.each(this.datasets,function(a){a.bars.shift()},this),this.update()},reflow:function(){c.extend(this.BarClass.prototype,{y:this.scale.endPoint,base:this.scale.endPoint});var a=c.extend({height:this.chart.height,width:this.chart.width});this.scale.update(a)},draw:function(a){var b=a||1;this.clear(),this.chart.ctx,this.scale.draw(b),c.each(this.datasets,function(a,d){c.each(a.bars,function(a,c){a.hasValue()&&(a.base=this.scale.endPoint,a.transition({x:this.scale.calculateBarX(this.datasets.length,d,c),y:this.scale.calculateY(a.value),width:this.scale.calculateBarWidth(this.datasets.length)},b).draw())},this)},this)}})}.call(this),function(){"use strict";var a=this,b=a.Chart,c=b.helpers,d={segmentShowStroke:!0,segmentStrokeColor:"#fff",segmentStrokeWidth:2,percentageInnerCutout:50,animationSteps:100,animationEasing:"easeOutBounce",animateRotate:!0,animateScale:!1,legendTemplate:'<ul class="<%=name.toLowerCase()%>-legend"><% for (var i=0; i<segments.length; i++){%><li><span style="background-color:<%=segments[i].fillColor%>"></span><%if(segments[i].label){%><%=segments[i].label%><%}%></li><%}%></ul>'};b.Type.extend({name:"Doughnut",defaults:d,initialize:function(a){this.segments=[],this.outerRadius=(c.min([this.chart.width,this.chart.height])-this.options.segmentStrokeWidth/2)/2,this.SegmentArc=b.Arc.extend({ctx:this.chart.ctx,x:this.chart.width/2,y:this.chart.height/2}),this.options.showTooltips&&c.bindEvents(this,this.options.tooltipEvents,function(a){var b="mouseout"!==a.type?this.getSegmentsAtEvent(a):[];c.each(this.segments,function(a){a.restore(["fillColor"])}),c.each(b,function(a){a.fillColor=a.highlightColor}),this.showTooltip(b)}),this.calculateTotal(a),c.each(a,function(a,b){this.addData(a,b,!0)},this),this.render()},getSegmentsAtEvent:function(a){var b=[],d=c.getRelativePosition(a);return c.each(this.segments,function(a){a.inRange(d.x,d.y)&&b.push(a)},this),b},addData:function(a,b,c){var d=b||this.segments.length;this.segments.splice(d,0,new this.SegmentArc({value:a.value,outerRadius:this.options.animateScale?0:this.outerRadius,innerRadius:this.options.animateScale?0:this.outerRadius/100*this.options.percentageInnerCutout,fillColor:a.color,highlightColor:a.highlight||a.color,showStroke:this.options.segmentShowStroke,strokeWidth:this.options.segmentStrokeWidth,strokeColor:this.options.segmentStrokeColor,startAngle:1.5*Math.PI,circumference:this.options.animateRotate?0:this.calculateCircumference(a.value),label:a.label})),c||(this.reflow(),this.update())},calculateCircumference:function(a){return 2*Math.PI*(Math.abs(a)/this.total)},calculateTotal:function(a){this.total=0,c.each(a,function(a){this.total+=Math.abs(a.value)},this)},update:function(){this.calculateTotal(this.segments),c.each(this.activeElements,function(a){a.restore(["fillColor"])}),c.each(this.segments,function(a){a.save()}),this.render()},removeData:function(a){var b=c.isNumber(a)?a:this.segments.length-1;this.segments.splice(b,1),this.reflow(),this.update()},reflow:function(){c.extend(this.SegmentArc.prototype,{x:this.chart.width/2,y:this.chart.height/2}),this.outerRadius=(c.min([this.chart.width,this.chart.height])-this.options.segmentStrokeWidth/2)/2,c.each(this.segments,function(a){a.update({outerRadius:this.outerRadius,innerRadius:this.outerRadius/100*this.options.percentageInnerCutout})},this)},draw:function(a){var b=a?a:1;this.clear(),c.each(this.segments,function(a,c){a.transition({circumference:this.calculateCircumference(a.value),outerRadius:this.outerRadius,innerRadius:this.outerRadius/100*this.options.percentageInnerCutout},b),a.endAngle=a.startAngle+a.circumference,a.draw(),0===c&&(a.startAngle=1.5*Math.PI),c<this.segments.length-1&&(this.segments[c+1].startAngle=a.endAngle)},this)}}),b.types.Doughnut.extend({name:"Pie",defaults:c.merge(d,{percentageInnerCutout:0})})}.call(this),function(){"use strict";var a=this,b=a.Chart,c=b.helpers,d={scaleShowGridLines:!0,scaleGridLineColor:"rgba(0,0,0,.05)",scaleGridLineWidth:1,scaleShowHorizontalLines:!0,scaleShowVerticalLines:!0,bezierCurve:!0,bezierCurveTension:.4,pointDot:!0,pointDotRadius:4,pointDotStrokeWidth:1,pointHitDetectionRadius:20,datasetStroke:!0,datasetStrokeWidth:2,datasetFill:!0,legendTemplate:'<ul class="<%=name.toLowerCase()%>-legend"><% for (var i=0; i<datasets.length; i++){%><li><span style="background-color:<%=datasets[i].strokeColor%>"></span><%if(datasets[i].label){%><%=datasets[i].label%><%}%></li><%}%></ul>'};b.Type.extend({name:"Line",defaults:d,initialize:function(a){this.PointClass=b.Point.extend({strokeWidth:this.options.pointDotStrokeWidth,radius:this.options.pointDotRadius,display:this.options.pointDot,hitDetectionRadius:this.options.pointHitDetectionRadius,ctx:this.chart.ctx,inRange:function(a){return Math.pow(a-this.x,2)<Math.pow(this.radius+this.hitDetectionRadius,2)}}),this.datasets=[],this.options.showTooltips&&c.bindEvents(this,this.options.tooltipEvents,function(a){var b="mouseout"!==a.type?this.getPointsAtEvent(a):[];this.eachPoints(function(a){a.restore(["fillColor","strokeColor"])}),c.each(b,function(a){a.fillColor=a.highlightFill,a.strokeColor=a.highlightStroke}),this.showTooltip(b)}),c.each(a.datasets,function(b){var d={label:b.label||null,fillColor:b.fillColor,strokeColor:b.strokeColor,pointColor:b.pointColor,pointStrokeColor:b.pointStrokeColor,points:[]};this.datasets.push(d),c.each(b.data,function(c,e){d.points.push(new this.PointClass({value:c,label:a.labels[e],datasetLabel:b.label,strokeColor:b.pointStrokeColor,fillColor:b.pointColor,highlightFill:b.pointHighlightFill||b.pointColor,highlightStroke:b.pointHighlightStroke||b.pointStrokeColor}))},this),this.buildScale(a.labels),this.eachPoints(function(a,b){c.extend(a,{x:this.scale.calculateX(b),y:this.scale.endPoint}),a.save()},this)},this),this.render()},update:function(){this.scale.update(),c.each(this.activeElements,function(a){a.restore(["fillColor","strokeColor"])}),this.eachPoints(function(a){a.save()}),this.render()},eachPoints:function(a){c.each(this.datasets,function(b){c.each(b.points,a,this)},this)},getPointsAtEvent:function(a){var b=[],d=c.getRelativePosition(a);return c.each(this.datasets,function(a){c.each(a.points,function(a){
a.inRange(d.x,d.y)&&b.push(a)})},this),b},buildScale:function(a){var d=this,e=function(){var a=[];return d.eachPoints(function(b){a.push(b.value)}),a},f={templateString:this.options.scaleLabel,height:this.chart.height,width:this.chart.width,ctx:this.chart.ctx,textColor:this.options.scaleFontColor,fontSize:this.options.scaleFontSize,fontStyle:this.options.scaleFontStyle,fontFamily:this.options.scaleFontFamily,valuesCount:a.length,beginAtZero:this.options.scaleBeginAtZero,integersOnly:this.options.scaleIntegersOnly,calculateYRange:function(a){var b=c.calculateScaleRange(e(),a,this.fontSize,this.beginAtZero,this.integersOnly);c.extend(this,b)},xLabels:a,font:c.fontString(this.options.scaleFontSize,this.options.scaleFontStyle,this.options.scaleFontFamily),lineWidth:this.options.scaleLineWidth,lineColor:this.options.scaleLineColor,showHorizontalLines:this.options.scaleShowHorizontalLines,showVerticalLines:this.options.scaleShowVerticalLines,gridLineWidth:this.options.scaleShowGridLines?this.options.scaleGridLineWidth:0,gridLineColor:this.options.scaleShowGridLines?this.options.scaleGridLineColor:"rgba(0,0,0,0)",padding:this.options.showScale?0:this.options.pointDotRadius+this.options.pointDotStrokeWidth,showLabels:this.options.scaleShowLabels,display:this.options.showScale};this.options.scaleOverride&&c.extend(f,{calculateYRange:c.noop,steps:this.options.scaleSteps,stepValue:this.options.scaleStepWidth,min:this.options.scaleStartValue,max:this.options.scaleStartValue+this.options.scaleSteps*this.options.scaleStepWidth}),this.scale=new b.Scale(f)},addData:function(a,b){c.each(a,function(a,c){this.datasets[c].points.push(new this.PointClass({value:a,label:b,x:this.scale.calculateX(this.scale.valuesCount+1),y:this.scale.endPoint,strokeColor:this.datasets[c].pointStrokeColor,fillColor:this.datasets[c].pointColor}))},this),this.scale.addXLabel(b),this.update()},removeData:function(){this.scale.removeXLabel(),c.each(this.datasets,function(a){a.points.shift()},this),this.update()},reflow:function(){var a=c.extend({height:this.chart.height,width:this.chart.width});this.scale.update(a)},draw:function(a){var b=a||1;this.clear();var d=this.chart.ctx,e=function(a){return null!==a.value},f=function(a,b,d){return c.findNextWhere(b,e,d)||a},g=function(a,b,d){return c.findPreviousWhere(b,e,d)||a};this.scale.draw(b),c.each(this.datasets,function(a){var h=c.where(a.points,e);c.each(a.points,function(a,c){a.hasValue()&&a.transition({y:this.scale.calculateY(a.value),x:this.scale.calculateX(c)},b)},this),this.options.bezierCurve&&c.each(h,function(a,b){var d=b>0&&b<h.length-1?this.options.bezierCurveTension:0;a.controlPoints=c.splineCurve(g(a,h,b),a,f(a,h,b),d),a.controlPoints.outer.y>this.scale.endPoint?a.controlPoints.outer.y=this.scale.endPoint:a.controlPoints.outer.y<this.scale.startPoint&&(a.controlPoints.outer.y=this.scale.startPoint),a.controlPoints.inner.y>this.scale.endPoint?a.controlPoints.inner.y=this.scale.endPoint:a.controlPoints.inner.y<this.scale.startPoint&&(a.controlPoints.inner.y=this.scale.startPoint)},this),d.lineWidth=this.options.datasetStrokeWidth,d.strokeStyle=a.strokeColor,d.beginPath(),c.each(h,function(a,b){if(0===b)d.moveTo(a.x,a.y);else if(this.options.bezierCurve){var c=g(a,h,b);d.bezierCurveTo(c.controlPoints.outer.x,c.controlPoints.outer.y,a.controlPoints.inner.x,a.controlPoints.inner.y,a.x,a.y)}else d.lineTo(a.x,a.y)},this),d.stroke(),this.options.datasetFill&&h.length>0&&(d.lineTo(h[h.length-1].x,this.scale.endPoint),d.lineTo(h[0].x,this.scale.endPoint),d.fillStyle=a.fillColor,d.closePath(),d.fill()),c.each(h,function(a){a.draw()})},this)}})}.call(this),function(){"use strict";var a=this,b=a.Chart,c=b.helpers,d={scaleShowLabelBackdrop:!0,scaleBackdropColor:"rgba(255,255,255,0.75)",scaleBeginAtZero:!0,scaleBackdropPaddingY:2,scaleBackdropPaddingX:2,scaleShowLine:!0,segmentShowStroke:!0,segmentStrokeColor:"#fff",segmentStrokeWidth:2,animationSteps:100,animationEasing:"easeOutBounce",animateRotate:!0,animateScale:!1,legendTemplate:'<ul class="<%=name.toLowerCase()%>-legend"><% for (var i=0; i<segments.length; i++){%><li><span style="background-color:<%=segments[i].fillColor%>"></span><%if(segments[i].label){%><%=segments[i].label%><%}%></li><%}%></ul>'};b.Type.extend({name:"PolarArea",defaults:d,initialize:function(a){this.segments=[],this.SegmentArc=b.Arc.extend({showStroke:this.options.segmentShowStroke,strokeWidth:this.options.segmentStrokeWidth,strokeColor:this.options.segmentStrokeColor,ctx:this.chart.ctx,innerRadius:0,x:this.chart.width/2,y:this.chart.height/2}),this.scale=new b.RadialScale({display:this.options.showScale,fontStyle:this.options.scaleFontStyle,fontSize:this.options.scaleFontSize,fontFamily:this.options.scaleFontFamily,fontColor:this.options.scaleFontColor,showLabels:this.options.scaleShowLabels,showLabelBackdrop:this.options.scaleShowLabelBackdrop,backdropColor:this.options.scaleBackdropColor,backdropPaddingY:this.options.scaleBackdropPaddingY,backdropPaddingX:this.options.scaleBackdropPaddingX,lineWidth:this.options.scaleShowLine?this.options.scaleLineWidth:0,lineColor:this.options.scaleLineColor,lineArc:!0,width:this.chart.width,height:this.chart.height,xCenter:this.chart.width/2,yCenter:this.chart.height/2,ctx:this.chart.ctx,templateString:this.options.scaleLabel,valuesCount:a.length}),this.updateScaleRange(a),this.scale.update(),c.each(a,function(a,b){this.addData(a,b,!0)},this),this.options.showTooltips&&c.bindEvents(this,this.options.tooltipEvents,function(a){var b="mouseout"!==a.type?this.getSegmentsAtEvent(a):[];c.each(this.segments,function(a){a.restore(["fillColor"])}),c.each(b,function(a){a.fillColor=a.highlightColor}),this.showTooltip(b)}),this.render()},getSegmentsAtEvent:function(a){var b=[],d=c.getRelativePosition(a);return c.each(this.segments,function(a){a.inRange(d.x,d.y)&&b.push(a)},this),b},addData:function(a,b,c){var d=b||this.segments.length;this.segments.splice(d,0,new this.SegmentArc({fillColor:a.color,highlightColor:a.highlight||a.color,label:a.label,value:a.value,outerRadius:this.options.animateScale?0:this.scale.calculateCenterOffset(a.value),circumference:this.options.animateRotate?0:this.scale.getCircumference(),startAngle:1.5*Math.PI})),c||(this.reflow(),this.update())},removeData:function(a){var b=c.isNumber(a)?a:this.segments.length-1;this.segments.splice(b,1),this.reflow(),this.update()},calculateTotal:function(a){this.total=0,c.each(a,function(a){this.total+=a.value},this),this.scale.valuesCount=this.segments.length},updateScaleRange:function(a){var b=[];c.each(a,function(a){b.push(a.value)});var d=this.options.scaleOverride?{steps:this.options.scaleSteps,stepValue:this.options.scaleStepWidth,min:this.options.scaleStartValue,max:this.options.scaleStartValue+this.options.scaleSteps*this.options.scaleStepWidth}:c.calculateScaleRange(b,c.min([this.chart.width,this.chart.height])/2,this.options.scaleFontSize,this.options.scaleBeginAtZero,this.options.scaleIntegersOnly);c.extend(this.scale,d,{size:c.min([this.chart.width,this.chart.height]),xCenter:this.chart.width/2,yCenter:this.chart.height/2})},update:function(){this.calculateTotal(this.segments),c.each(this.segments,function(a){a.save()}),this.reflow(),this.render()},reflow:function(){c.extend(this.SegmentArc.prototype,{x:this.chart.width/2,y:this.chart.height/2}),this.updateScaleRange(this.segments),this.scale.update(),c.extend(this.scale,{xCenter:this.chart.width/2,yCenter:this.chart.height/2}),c.each(this.segments,function(a){a.update({outerRadius:this.scale.calculateCenterOffset(a.value)})},this)},draw:function(a){var b=a||1;this.clear(),c.each(this.segments,function(a,c){a.transition({circumference:this.scale.getCircumference(),outerRadius:this.scale.calculateCenterOffset(a.value)},b),a.endAngle=a.startAngle+a.circumference,0===c&&(a.startAngle=1.5*Math.PI),c<this.segments.length-1&&(this.segments[c+1].startAngle=a.endAngle),a.draw()},this),this.scale.draw()}})}.call(this),function(){"use strict";var a=this,b=a.Chart,c=b.helpers;b.Type.extend({name:"Radar",defaults:{scaleShowLine:!0,angleShowLineOut:!0,scaleShowLabels:!1,scaleBeginAtZero:!0,angleLineColor:"rgba(0,0,0,.1)",angleLineWidth:1,pointLabelFontFamily:"'Arial'",pointLabelFontStyle:"normal",pointLabelFontSize:10,pointLabelFontColor:"#666",pointDot:!0,pointDotRadius:3,pointDotStrokeWidth:1,pointHitDetectionRadius:20,datasetStroke:!0,datasetStrokeWidth:2,datasetFill:!0,legendTemplate:'<ul class="<%=name.toLowerCase()%>-legend"><% for (var i=0; i<datasets.length; i++){%><li><span style="background-color:<%=datasets[i].strokeColor%>"></span><%if(datasets[i].label){%><%=datasets[i].label%><%}%></li><%}%></ul>'},initialize:function(a){this.PointClass=b.Point.extend({strokeWidth:this.options.pointDotStrokeWidth,radius:this.options.pointDotRadius,display:this.options.pointDot,hitDetectionRadius:this.options.pointHitDetectionRadius,ctx:this.chart.ctx}),this.datasets=[],this.buildScale(a),this.options.showTooltips&&c.bindEvents(this,this.options.tooltipEvents,function(a){var b="mouseout"!==a.type?this.getPointsAtEvent(a):[];this.eachPoints(function(a){a.restore(["fillColor","strokeColor"])}),c.each(b,function(a){a.fillColor=a.highlightFill,a.strokeColor=a.highlightStroke}),this.showTooltip(b)}),c.each(a.datasets,function(b){var d={label:b.label||null,fillColor:b.fillColor,strokeColor:b.strokeColor,pointColor:b.pointColor,pointStrokeColor:b.pointStrokeColor,points:[]};this.datasets.push(d),c.each(b.data,function(c,e){var f;this.scale.animation||(f=this.scale.getPointPosition(e,this.scale.calculateCenterOffset(c))),d.points.push(new this.PointClass({value:c,label:a.labels[e],datasetLabel:b.label,x:this.options.animation?this.scale.xCenter:f.x,y:this.options.animation?this.scale.yCenter:f.y,strokeColor:b.pointStrokeColor,fillColor:b.pointColor,highlightFill:b.pointHighlightFill||b.pointColor,highlightStroke:b.pointHighlightStroke||b.pointStrokeColor}))},this)},this),this.render()},eachPoints:function(a){c.each(this.datasets,function(b){c.each(b.points,a,this)},this)},getPointsAtEvent:function(a){var b=c.getRelativePosition(a),d=c.getAngleFromPoint({x:this.scale.xCenter,y:this.scale.yCenter},b),e=2*Math.PI/this.scale.valuesCount,f=Math.round((d.angle-1.5*Math.PI)/e),g=[];return(f>=this.scale.valuesCount||0>f)&&(f=0),d.distance<=this.scale.drawingArea&&c.each(this.datasets,function(a){g.push(a.points[f])}),g},buildScale:function(a){this.scale=new b.RadialScale({display:this.options.showScale,fontStyle:this.options.scaleFontStyle,fontSize:this.options.scaleFontSize,fontFamily:this.options.scaleFontFamily,fontColor:this.options.scaleFontColor,showLabels:this.options.scaleShowLabels,showLabelBackdrop:this.options.scaleShowLabelBackdrop,backdropColor:this.options.scaleBackdropColor,backdropPaddingY:this.options.scaleBackdropPaddingY,backdropPaddingX:this.options.scaleBackdropPaddingX,lineWidth:this.options.scaleShowLine?this.options.scaleLineWidth:0,lineColor:this.options.scaleLineColor,angleLineColor:this.options.angleLineColor,angleLineWidth:this.options.angleShowLineOut?this.options.angleLineWidth:0,pointLabelFontColor:this.options.pointLabelFontColor,pointLabelFontSize:this.options.pointLabelFontSize,pointLabelFontFamily:this.options.pointLabelFontFamily,pointLabelFontStyle:this.options.pointLabelFontStyle,height:this.chart.height,width:this.chart.width,xCenter:this.chart.width/2,yCenter:this.chart.height/2,ctx:this.chart.ctx,templateString:this.options.scaleLabel,labels:a.labels,valuesCount:a.datasets[0].data.length}),this.scale.setScaleSize(),this.updateScaleRange(a.datasets),this.scale.buildYLabels()},updateScaleRange:function(a){var b=function(){var b=[];return c.each(a,function(a){a.data?b=b.concat(a.data):c.each(a.points,function(a){b.push(a.value)})}),b}(),d=this.options.scaleOverride?{steps:this.options.scaleSteps,stepValue:this.options.scaleStepWidth,min:this.options.scaleStartValue,max:this.options.scaleStartValue+this.options.scaleSteps*this.options.scaleStepWidth}:c.calculateScaleRange(b,c.min([this.chart.width,this.chart.height])/2,this.options.scaleFontSize,this.options.scaleBeginAtZero,this.options.scaleIntegersOnly);c.extend(this.scale,d)},addData:function(a,b){this.scale.valuesCount++,c.each(a,function(a,c){var d=this.scale.getPointPosition(this.scale.valuesCount,this.scale.calculateCenterOffset(a));this.datasets[c].points.push(new this.PointClass({value:a,label:b,x:d.x,y:d.y,strokeColor:this.datasets[c].pointStrokeColor,fillColor:this.datasets[c].pointColor}))},this),this.scale.labels.push(b),this.reflow(),this.update()},removeData:function(){this.scale.valuesCount--,this.scale.labels.shift(),c.each(this.datasets,function(a){a.points.shift()},this),this.reflow(),this.update()},update:function(){this.eachPoints(function(a){a.save()}),this.reflow(),this.render()},reflow:function(){c.extend(this.scale,{width:this.chart.width,height:this.chart.height,size:c.min([this.chart.width,this.chart.height]),xCenter:this.chart.width/2,yCenter:this.chart.height/2}),this.updateScaleRange(this.datasets),this.scale.setScaleSize(),this.scale.buildYLabels()},draw:function(a){var b=a||1,d=this.chart.ctx;this.clear(),this.scale.draw(),c.each(this.datasets,function(a){c.each(a.points,function(a,c){a.hasValue()&&a.transition(this.scale.getPointPosition(c,this.scale.calculateCenterOffset(a.value)),b)},this),d.lineWidth=this.options.datasetStrokeWidth,d.strokeStyle=a.strokeColor,d.beginPath(),c.each(a.points,function(a,b){0===b?d.moveTo(a.x,a.y):d.lineTo(a.x,a.y)},this),d.closePath(),d.stroke(),d.fillStyle=a.fillColor,d.fill(),c.each(a.points,function(a){a.hasValue()&&a.draw()})},this)}})}.call(this),function(a,b){"use strict";"function"==typeof define&&define.amd?define(["jquery"],b):"object"==typeof exports?module.exports=b(require("jquery")):a.bootbox=b(a.jQuery)}(this,function a(b,c){"use strict";function d(a){var b=q[o.locale];return b?b[a]:q.en[a]}function e(a,c,d){a.stopPropagation(),a.preventDefault();var e=b.isFunction(d)&&d.call(c,a)===!1;e||c.modal("hide")}function f(a){var b,c=0;for(b in a)c++;return c}function g(a,c){var d=0;b.each(a,function(a,b){c(a,b,d++)})}function h(a){var c,d;if("object"!=typeof a)throw new Error("Please supply an object of options");if(!a.message)throw new Error("Please specify a message");return a=b.extend({},o,a),a.buttons||(a.buttons={}),c=a.buttons,d=f(c),g(c,function(a,e,f){if(b.isFunction(e)&&(e=c[a]={callback:e}),"object"!==b.type(e))throw new Error("button with key "+a+" must be an object");e.label||(e.label=a),e.className||(e.className=2>=d&&f===d-1?"btn-primary":"btn-default")}),a}function i(a,b){var c=a.length,d={};if(1>c||c>2)throw new Error("Invalid argument length");return 2===c||"string"==typeof a[0]?(d[b[0]]=a[0],d[b[1]]=a[1]):d=a[0],d}function j(a,c,d){return b.extend(!0,{},a,i(c,d))}function k(a,b,c,d){var e={className:"bootbox-"+a,buttons:l.apply(null,b)};return m(j(e,d,c),b)}function l(){for(var a={},b=0,c=arguments.length;c>b;b++){var e=arguments[b],f=e.toLowerCase(),g=e.toUpperCase();a[f]={label:d(g)}}return a}function m(a,b){var d={};return g(b,function(a,b){d[b]=!0}),g(a.buttons,function(a){if(d[a]===c)throw new Error("button key "+a+" is not allowed (options are "+b.join("\n")+")")}),a}var n={dialog:"<div class='bootbox modal' tabindex='-1' role='dialog'><div class='modal-dialog'><div class='modal-content'><div class='modal-body'><div class='bootbox-body'></div></div></div></div></div>",header:"<div class='modal-header'><h4 class='modal-title'></h4></div>",footer:"<div class='modal-footer'></div>",closeButton:"<button type='button' class='bootbox-close-button close' data-dismiss='modal' aria-hidden='true'>&times;</button>",form:"<form class='bootbox-form'></form>",inputs:{text:"<input class='bootbox-input bootbox-input-text form-control' autocomplete=off type=text />",textarea:"<textarea class='bootbox-input bootbox-input-textarea form-control'></textarea>",email:"<input class='bootbox-input bootbox-input-email form-control' autocomplete='off' type='email' />",select:"<select class='bootbox-input bootbox-input-select form-control'></select>",checkbox:"<div class='checkbox'><label><input class='bootbox-input bootbox-input-checkbox' type='checkbox' /></label></div>",date:"<input class='bootbox-input bootbox-input-date form-control' autocomplete=off type='date' />",time:"<input class='bootbox-input bootbox-input-time form-control' autocomplete=off type='time' />",number:"<input class='bootbox-input bootbox-input-number form-control' autocomplete=off type='number' />",password:"<input class='bootbox-input bootbox-input-password form-control' autocomplete='off' type='password' />"}},o={locale:"en",backdrop:"static",animate:!0,className:null,closeButton:!0,show:!0,container:"body"},p={};p.alert=function(){var a;if(a=k("alert",["ok"],["message","callback"],arguments),a.callback&&!b.isFunction(a.callback))throw new Error("alert requires callback property to be a function when provided");return a.buttons.ok.callback=a.onEscape=function(){return b.isFunction(a.callback)?a.callback.call(this):!0},p.dialog(a)},p.confirm=function(){var a;if(a=k("confirm",["cancel","confirm"],["message","callback"],arguments),a.buttons.cancel.callback=a.onEscape=function(){return a.callback.call(this,!1)},a.buttons.confirm.callback=function(){return a.callback.call(this,!0)},!b.isFunction(a.callback))throw new Error("confirm requires a callback");return p.dialog(a)},p.prompt=function(){var a,d,e,f,h,i,k;if(f=b(n.form),d={className:"bootbox-prompt",buttons:l("cancel","confirm"),value:"",inputType:"text"},a=m(j(d,arguments,["title","callback"]),["cancel","confirm"]),i=a.show===c?!0:a.show,a.message=f,a.buttons.cancel.callback=a.onEscape=function(){return a.callback.call(this,null)},a.buttons.confirm.callback=function(){var c;switch(a.inputType){case"text":case"textarea":case"email":case"select":case"date":case"time":case"number":case"password":c=h.val();break;case"checkbox":var d=h.find("input:checked");c=[],g(d,function(a,d){c.push(b(d).val())})}return a.callback.call(this,c)},a.show=!1,!a.title)throw new Error("prompt requires a title");if(!b.isFunction(a.callback))throw new Error("prompt requires a callback");if(!n.inputs[a.inputType])throw new Error("invalid prompt type");switch(h=b(n.inputs[a.inputType]),a.inputType){case"text":case"textarea":case"email":case"date":case"time":case"number":case"password":h.val(a.value);break;case"select":var o={};if(k=a.inputOptions||[],!b.isArray(k))throw new Error("Please pass an array of input options");if(!k.length)throw new Error("prompt with select requires options");g(k,function(a,d){var e=h;if(d.value===c||d.text===c)throw new Error("given options in wrong format");d.group&&(o[d.group]||(o[d.group]=b("<optgroup/>").attr("label",d.group)),e=o[d.group]),e.append("<option value='"+d.value+"'>"+d.text+"</option>")}),g(o,function(a,b){h.append(b)}),h.val(a.value);break;case"checkbox":var q=b.isArray(a.value)?a.value:[a.value];if(k=a.inputOptions||[],!k.length)throw new Error("prompt with checkbox requires options");if(!k[0].value||!k[0].text)throw new Error("given options in wrong format");h=b("<div/>"),g(k,function(c,d){var e=b(n.inputs[a.inputType]);e.find("input").attr("value",d.value),e.find("label").append(d.text),g(q,function(a,b){b===d.value&&e.find("input").prop("checked",!0)}),h.append(e)})}return a.placeholder&&h.attr("placeholder",a.placeholder),a.pattern&&h.attr("pattern",a.pattern),a.maxlength&&h.attr("maxlength",a.maxlength),f.append(h),f.on("submit",function(a){a.preventDefault(),a.stopPropagation(),e.find(".btn-primary").click()}),e=p.dialog(a),e.off("shown.bs.modal"),e.on("shown.bs.modal",function(){h.focus()}),i===!0&&e.modal("show"),e},p.dialog=function(a){a=h(a);var d=b(n.dialog),f=d.find(".modal-dialog"),i=d.find(".modal-body"),j=a.buttons,k="",l={onEscape:a.onEscape};if(b.fn.modal===c)throw new Error("$.fn.modal is not defined; please double check you have included the Bootstrap JavaScript library. See http://getbootstrap.com/javascript/ for more details.");if(g(j,function(a,b){k+="<button data-bb-handler='"+a+"' type='button' class='btn "+b.className+"'>"+b.label+"</button>",l[a]=b.callback}),i.find(".bootbox-body").html(a.message),a.animate===!0&&d.addClass("fade"),a.className&&d.addClass(a.className),"large"===a.size?f.addClass("modal-lg"):"small"===a.size&&f.addClass("modal-sm"),a.title&&i.before(n.header),a.closeButton){var m=b(n.closeButton);a.title?d.find(".modal-header").prepend(m):m.css("margin-top","-10px").prependTo(i)}return a.title&&d.find(".modal-title").html(a.title),k.length&&(i.after(n.footer),d.find(".modal-footer").html(k)),d.on("hidden.bs.modal",function(a){a.target===this&&d.remove()}),d.on("shown.bs.modal",function(){d.find(".btn-primary:first").focus()}),"static"!==a.backdrop&&d.on("click.dismiss.bs.modal",function(a){d.children(".modal-backdrop").length&&(a.currentTarget=d.children(".modal-backdrop").get(0)),a.target===a.currentTarget&&d.trigger("escape.close.bb")}),d.on("escape.close.bb",function(a){l.onEscape&&e(a,d,l.onEscape)}),d.on("click",".modal-footer button",function(a){var c=b(this).data("bb-handler");e(a,d,l[c])}),d.on("click",".bootbox-close-button",function(a){e(a,d,l.onEscape)}),d.on("keyup",function(a){27===a.which&&d.trigger("escape.close.bb")}),b(a.container).append(d),d.modal({backdrop:a.backdrop?"static":!1,keyboard:!1,show:!1}),a.show&&d.modal("show"),d},p.setDefaults=function(){var a={};2===arguments.length?a[arguments[0]]=arguments[1]:a=arguments[0],b.extend(o,a)},p.hideAll=function(){return b(".bootbox").modal("hide"),p};var q={bg_BG:{OK:"Ок",CANCEL:"Отказ",CONFIRM:"Потвърждавам"},br:{OK:"OK",CANCEL:"Cancelar",CONFIRM:"Sim"},cs:{OK:"OK",CANCEL:"Zrušit",CONFIRM:"Potvrdit"},da:{OK:"OK",CANCEL:"Annuller",CONFIRM:"Accepter"},de:{OK:"OK",CANCEL:"Abbrechen",CONFIRM:"Akzeptieren"},el:{OK:"Εντάξει",CANCEL:"Ακύρωση",CONFIRM:"Επιβεβαίωση"},en:{OK:"OK",CANCEL:"Cancel",CONFIRM:"OK"},es:{OK:"OK",CANCEL:"Cancelar",CONFIRM:"Aceptar"},et:{OK:"OK",CANCEL:"Katkesta",CONFIRM:"OK"},fa:{OK:"قبول",CANCEL:"لغو",CONFIRM:"تایید"},fi:{OK:"OK",CANCEL:"Peruuta",CONFIRM:"OK"},fr:{OK:"OK",CANCEL:"Annuler",CONFIRM:"D'accord"},he:{OK:"אישור",CANCEL:"ביטול",CONFIRM:"אישור"},hu:{OK:"OK",CANCEL:"Mégsem",CONFIRM:"Megerősít"},hr:{OK:"OK",CANCEL:"Odustani",CONFIRM:"Potvrdi"},id:{OK:"OK",CANCEL:"Batal",CONFIRM:"OK"},it:{OK:"OK",CANCEL:"Annulla",CONFIRM:"Conferma"},ja:{OK:"OK",CANCEL:"キャンセル",CONFIRM:"確認"},lt:{OK:"Gerai",CANCEL:"Atšaukti",CONFIRM:"Patvirtinti"},lv:{OK:"Labi",CANCEL:"Atcelt",CONFIRM:"Apstiprināt"},nl:{OK:"OK",CANCEL:"Annuleren",CONFIRM:"Accepteren"},no:{OK:"OK",CANCEL:"Avbryt",CONFIRM:"OK"},pl:{OK:"OK",CANCEL:"Anuluj",CONFIRM:"Potwierdź"},pt:{OK:"OK",CANCEL:"Cancelar",CONFIRM:"Confirmar"},ru:{OK:"OK",CANCEL:"Отмена",CONFIRM:"Применить"},sq:{OK:"OK",CANCEL:"Anulo",CONFIRM:"Prano"},sv:{OK:"OK",CANCEL:"Avbryt",CONFIRM:"OK"},th:{OK:"ตกลง",CANCEL:"ยกเลิก",CONFIRM:"ยืนยัน"},tr:{OK:"Tamam",CANCEL:"İptal",CONFIRM:"Onayla"},zh_CN:{OK:"OK",CANCEL:"取消",CONFIRM:"确认"},zh_TW:{OK:"OK",CANCEL:"取消",CONFIRM:"確認"}};return p.addLocale=function(a,c){return b.each(["OK","CANCEL","CONFIRM"],function(a,b){if(!c[b])throw new Error("Please supply a translation for '"+b+"'")}),q[a]={OK:c.OK,CANCEL:c.CANCEL,CONFIRM:c.CONFIRM},p},p.removeLocale=function(a){return delete q[a],p},p.setLocale=function(a){return p.setDefaults("locale",a)},p.init=function(c){return a(c||b)},p}),!function(a,b,c,d){function e(a,b){var c=Math.max(0,a[0]-b[0],b[0]-a[1]),d=Math.max(0,a[2]-b[1],b[1]-a[3]);return c+d}function f(b,c,d,e){var f=b.length;for(e=e?"offset":"position",d=d||0;f--;){var g=b[f].el?b[f].el:a(b[f]),h=g[e]();h.left+=parseInt(g.css("margin-left"),10),h.top+=parseInt(g.css("margin-top"),10),c[f]=[h.left-d,h.left+g.outerWidth()+d,h.top-d,h.top+g.outerHeight()+d]}}function g(a,b){var c=b.offset();return{left:a.left-c.left,top:a.top-c.top}}function h(a,b,c){b=[b.left,b.top],c=c&&[c.left,c.top];for(var d,f=a.length,g=[];f--;)d=a[f],g[f]=[f,e(d,b),c&&e(d,c)];return g=g.sort(function(a,b){return b[1]-a[1]||b[2]-a[2]||b[0]-a[0]})}function i(b){this.options=a.extend({},m,b),this.containers=[],this.options.rootGroup||(this.scrollProxy=a.proxy(this.scroll,this),this.dragProxy=a.proxy(this.drag,this),this.dropProxy=a.proxy(this.drop,this),this.placeholder=a(this.options.placeholder),b.isValidTarget||(this.options.isValidTarget=d))}function j(b,c){this.el=b,this.options=a.extend({},l,c),this.group=i.get(this.options),this.rootGroup=this.options.rootGroup||this.group,this.handle=this.rootGroup.options.handle||this.rootGroup.options.itemSelector;var d=this.rootGroup.options.itemPath;this.target=d?this.el.find(d):this.el,this.target.on(k.start,this.handle,a.proxy(this.dragInit,this)),this.options.drop&&this.group.containers.push(this)}var k,l={drag:!0,drop:!0,exclude:"",nested:!0,vertical:!0},m={afterMove:function(){},containerPath:"",containerSelector:"ol, ul",distance:0,delay:0,handle:"",itemPath:"",itemSelector:"li",bodyClass:"dragging",draggedClass:"dragged",isValidTarget:function(){return!0},onCancel:function(){},onDrag:function(a,b){a.css(b)},onDragStart:function(b,c){b.css({height:b.outerHeight(),width:b.outerWidth()}),b.addClass(c.group.options.draggedClass),a("body").addClass(c.group.options.bodyClass)},onDrop:function(b,c){b.removeClass(c.group.options.draggedClass).removeAttr("style"),a("body").removeClass(c.group.options.bodyClass)},onMousedown:function(a,b,c){return c.target.nodeName.match(/^(input|select|textarea)$/i)?void 0:(c.preventDefault(),!0)},placeholderClass:"placeholder",placeholder:'<li class="placeholder"></li>',pullPlaceholder:!0,serialize:function(b,c,d){return b=a.extend({},b.data()),d?[c]:(c[0]&&(b.children=c),delete b.subContainers,delete b.sortable,b)},tolerance:0},n={},o=0,p={left:0,top:0,bottom:0,right:0};k={start:"touchstart.sortable mousedown.sortable",drop:"touchend.sortable touchcancel.sortable mouseup.sortable",drag:"touchmove.sortable mousemove.sortable",scroll:"scroll.sortable"},i.get=function(a){return n[a.group]||(a.group===d&&(a.group=o++),n[a.group]=new i(a)),n[a.group]},i.prototype={dragInit:function(b,c){this.$document=a(c.el[0].ownerDocument);var d=a(b.target).closest(this.options.itemSelector);d.length&&(this.item=d,this.itemContainer=c,!this.item.is(this.options.exclude)&&this.options.onMousedown(this.item,m.onMousedown,b)&&(this.setPointer(b),this.toggleListeners("on"),this.setupDelayTimer(),this.dragInitDone=!0))},drag:function(a){if(!this.dragging){if(!this.distanceMet(a)||!this.delayMet)return;this.options.onDragStart(this.item,this.itemContainer,m.onDragStart,a),this.item.before(this.placeholder),this.dragging=!0}this.setPointer(a),this.options.onDrag(this.item,g(this.pointer,this.item.offsetParent()),m.onDrag,a),a=this.getPointer(a);var b=this.sameResultBox,c=this.options.tolerance;(!b||b.top-c>a.top||b.bottom+c<a.top||b.left-c>a.left||b.right+c<a.left)&&!this.searchValidTarget()&&(this.placeholder.detach(),this.lastAppendedItem=d)},drop:function(a){this.toggleListeners("off"),this.dragInitDone=!1,this.dragging&&(this.placeholder.closest("html")[0]?this.placeholder.before(this.item).detach():this.options.onCancel(this.item,this.itemContainer,m.onCancel,a),this.options.onDrop(this.item,this.getContainer(this.item),m.onDrop,a),this.clearDimensions(),this.clearOffsetParent(),this.lastAppendedItem=this.sameResultBox=d,this.dragging=!1)},searchValidTarget:function(a,b){a||(a=this.relativePointer||this.pointer,b=this.lastRelativePointer||this.lastPointer);for(var c=h(this.getContainerDimensions(),a,b),e=c.length;e--;){var f=c[e][0];if((!c[e][1]||this.options.pullPlaceholder)&&(f=this.containers[f],!f.disabled)){if(!this.$getOffsetParent()){var i=f.getItemOffsetParent();a=g(a,i),b=g(b,i)}if(f.searchValidTarget(a,b))return!0}}this.sameResultBox&&(this.sameResultBox=d)},movePlaceholder:function(a,b,c,d){var e=this.lastAppendedItem;(d||!e||e[0]!==b[0])&&(b[c](this.placeholder),this.lastAppendedItem=b,this.sameResultBox=d,this.options.afterMove(this.placeholder,a,b))},getContainerDimensions:function(){return this.containerDimensions||f(this.containers,this.containerDimensions=[],this.options.tolerance,!this.$getOffsetParent()),this.containerDimensions},getContainer:function(a){return a.closest(this.options.containerSelector).data(c)},$getOffsetParent:function(){if(this.offsetParent===d){var a=this.containers.length-1,b=this.containers[a].getItemOffsetParent();if(!this.options.rootGroup)for(;a--;)if(b[0]!=this.containers[a].getItemOffsetParent()[0]){b=!1;break}this.offsetParent=b}return this.offsetParent},setPointer:function(a){if(a=this.getPointer(a),this.$getOffsetParent()){var b=g(a,this.$getOffsetParent());this.lastRelativePointer=this.relativePointer,this.relativePointer=b}this.lastPointer=this.pointer,this.pointer=a},distanceMet:function(a){return a=this.getPointer(a),Math.max(Math.abs(this.pointer.left-a.left),Math.abs(this.pointer.top-a.top))>=this.options.distance},getPointer:function(a){var b=a.originalEvent||a.originalEvent.touches&&a.originalEvent.touches[0];return{left:a.pageX||b.pageX,top:a.pageY||b.pageY}},setupDelayTimer:function(){var a=this;this.delayMet=!this.options.delay,this.delayMet||(clearTimeout(this._mouseDelayTimer),this._mouseDelayTimer=setTimeout(function(){a.delayMet=!0},this.options.delay))},scroll:function(){this.clearDimensions(),this.clearOffsetParent()},toggleListeners:function(b){var c=this;a.each(["drag","drop","scroll"],function(a,d){c.$document[b](k[d],c[d+"Proxy"])})},clearOffsetParent:function(){this.offsetParent=d},clearDimensions:function(){this.traverse(function(a){a._clearDimensions()})},traverse:function(a){a(this);for(var b=this.containers.length;b--;)this.containers[b].traverse(a)},_clearDimensions:function(){this.containerDimensions=d},_destroy:function(){n[this.options.group]=d}},j.prototype={dragInit:function(a){var b=this.rootGroup;!this.disabled&&!b.dragInitDone&&this.options.drag&&this.isValidDrag(a)&&b.dragInit(a,this)},isValidDrag:function(a){return 1==a.which||"touchstart"==a.type&&1==a.originalEvent.touches.length},searchValidTarget:function(a,b){var c=h(this.getItemDimensions(),a,b),d=c.length,e=this.rootGroup,f=!e.options.isValidTarget||e.options.isValidTarget(e.item,this);if(!d&&f)return e.movePlaceholder(this,this.target,"append"),!0;for(;d--;)if(e=c[d][0],!c[d][1]&&this.hasChildGroup(e)){if(this.getContainerGroup(e).searchValidTarget(a,b))return!0}else if(f)return this.movePlaceholder(e,a),!0},movePlaceholder:function(b,c){var d=a(this.items[b]),e=this.itemDimensions[b],f="after",g=d.outerWidth(),h=d.outerHeight(),i=d.offset(),i={left:i.left,right:i.left+g,top:i.top,bottom:i.top+h};this.options.vertical?c.top<=(e[2]+e[3])/2?(f="before",i.bottom-=h/2):i.top+=h/2:c.left<=(e[0]+e[1])/2?(f="before",i.right-=g/2):i.left+=g/2,this.hasChildGroup(b)&&(i=p),this.rootGroup.movePlaceholder(this,d,f,i)},getItemDimensions:function(){return this.itemDimensions||(this.items=this.$getChildren(this.el,"item").filter(":not(."+this.group.options.placeholderClass+", ."+this.group.options.draggedClass+")").get(),f(this.items,this.itemDimensions=[],this.options.tolerance)),this.itemDimensions},getItemOffsetParent:function(){var a=this.el;return"relative"===a.css("position")||"absolute"===a.css("position")||"fixed"===a.css("position")?a:a.offsetParent()},hasChildGroup:function(a){return this.options.nested&&this.getContainerGroup(a)},getContainerGroup:function(b){var e=a.data(this.items[b],"subContainers");if(e===d){var f=this.$getChildren(this.items[b],"container"),e=!1;f[0]&&(e=a.extend({},this.options,{rootGroup:this.rootGroup,group:o++}),e=f[c](e).data(c).group),a.data(this.items[b],"subContainers",e)}return e},$getChildren:function(b,c){var d=this.rootGroup.options,e=d[c+"Path"],d=d[c+"Selector"];return b=a(b),e&&(b=b.find(e)),b.children(d)},_serialize:function(b,c){var d=this,e=this.$getChildren(b,c?"item":"container").not(this.options.exclude).map(function(){return d._serialize(a(this),!c)}).get();return this.rootGroup.options.serialize(b,e,c)},traverse:function(b){a.each(this.items||[],function(c){
(c=a.data(this,"subContainers"))&&c.traverse(b)}),b(this)},_clearDimensions:function(){this.itemDimensions=d},_destroy:function(){var b=this;this.target.off(k.start,this.handle),this.el.removeData(c),this.options.drop&&(this.group.containers=a.grep(this.group.containers,function(a){return a!=b})),a.each(this.items||[],function(){a.removeData(this,"subContainers")})}};var q={enable:function(){this.traverse(function(a){a.disabled=!1})},disable:function(){this.traverse(function(a){a.disabled=!0})},serialize:function(){return this._serialize(this.el,!0)},refresh:function(){this.traverse(function(a){a._clearDimensions()})},destroy:function(){this.traverse(function(a){a._destroy()})}};a.extend(j.prototype,q),a.fn[c]=function(b){var e=Array.prototype.slice.call(arguments,1);return this.map(function(){var f=a(this),g=f.data(c);return g&&q[b]?q[b].apply(g,e)||this:(g||b!==d&&"object"!=typeof b||f.data(c,new j(f,b)),this)})}}(jQuery,window,"sortable"),!function(a,b){"use strict";function c(c,g){var h=this;h.$el=a(c),h.el=c,h.id=e++,h.$window=a(b),h.$document=a(document),h.$el.bind("destroyed",a.proxy(h.teardown,h)),h.$clonedHeader=null,h.$originalHeader=null,h.isSticky=!1,h.hasBeenSticky=!1,h.leftOffset=null,h.topOffset=null,h.init=function(){h.$el.each(function(){var b=a(this);b.css("padding",0),h.$originalHeader=a("thead:first",this),h.$clonedHeader=h.$originalHeader.clone(),b.trigger("clonedHeader."+d,[h.$clonedHeader]),h.$clonedHeader.addClass("tableFloatingHeader"),h.$clonedHeader.css("display","none"),h.$originalHeader.addClass("tableFloatingHeaderOriginal"),h.$originalHeader.after(h.$clonedHeader),h.$printStyle=a('<style type="text/css" media="print">.tableFloatingHeader{display:none !important;}.tableFloatingHeaderOriginal{position:static !important;}</style>'),a("head").append(h.$printStyle)}),h.setOptions(g),h.updateWidth(),h.toggleHeaders(),h.bind()},h.destroy=function(){h.$el.unbind("destroyed",h.teardown),h.teardown()},h.teardown=function(){h.isSticky&&h.$originalHeader.css("position","static"),a.removeData(h.el,"plugin_"+d),h.unbind(),h.$clonedHeader.remove(),h.$originalHeader.removeClass("tableFloatingHeaderOriginal"),h.$originalHeader.css("visibility","visible"),h.$printStyle.remove(),h.el=null,h.$el=null},h.bind=function(){h.$scrollableArea.on("scroll."+d,h.toggleHeaders),h.isWindowScrolling||(h.$window.on("scroll."+d+h.id,h.setPositionValues),h.$window.on("resize."+d+h.id,h.toggleHeaders)),h.$scrollableArea.on("resize."+d,h.toggleHeaders),h.$scrollableArea.on("resize."+d,h.updateWidth)},h.unbind=function(){h.$scrollableArea.off("."+d,h.toggleHeaders),h.isWindowScrolling||(h.$window.off("."+d+h.id,h.setPositionValues),h.$window.off("."+d+h.id,h.toggleHeaders)),h.$scrollableArea.off("."+d,h.updateWidth)},h.toggleHeaders=function(){h.$el&&h.$el.each(function(){var b,c=a(this),e=h.isWindowScrolling?isNaN(h.options.fixedOffset)?h.options.fixedOffset.outerHeight():h.options.fixedOffset:h.$scrollableArea.offset().top+(isNaN(h.options.fixedOffset)?0:h.options.fixedOffset),f=c.offset(),g=h.$scrollableArea.scrollTop()+e,i=h.$scrollableArea.scrollLeft(),j=h.isWindowScrolling?g>f.top:e>f.top,k=(h.isWindowScrolling?g:0)<f.top+c.height()-h.$clonedHeader.height()-(h.isWindowScrolling?0:e);j&&k?(b=f.left-i+h.options.leftOffset,h.$originalHeader.css({position:"fixed","margin-top":h.options.marginTop,left:b,"z-index":3}),h.leftOffset=b,h.topOffset=e,h.$clonedHeader.css("display",""),h.isSticky||(h.isSticky=!0,h.updateWidth(),c.trigger("enabledStickiness."+d)),h.setPositionValues()):h.isSticky&&(h.$originalHeader.css("position","static"),h.$clonedHeader.css("display","none"),h.isSticky=!1,h.resetWidth(a("td,th",h.$clonedHeader),a("td,th",h.$originalHeader)),c.trigger("disabledStickiness."+d))})},h.setPositionValues=function(){var a=h.$window.scrollTop(),b=h.$window.scrollLeft();!h.isSticky||0>a||a+h.$window.height()>h.$document.height()||0>b||b+h.$window.width()>h.$document.width()||h.$originalHeader.css({top:h.topOffset-(h.isWindowScrolling?0:a),left:h.leftOffset-(h.isWindowScrolling?0:b)})},h.updateWidth=function(){if(h.isSticky){h.$originalHeaderCells||(h.$originalHeaderCells=a("th,td",h.$originalHeader)),h.$clonedHeaderCells||(h.$clonedHeaderCells=a("th,td",h.$clonedHeader));var b=h.getWidth(h.$clonedHeaderCells);h.setWidth(b,h.$clonedHeaderCells,h.$originalHeaderCells),h.$originalHeader.css("width",h.$clonedHeader.width())}},h.getWidth=function(c){var d=[];return c.each(function(c){var e,f=a(this);if("border-box"===f.css("box-sizing")){var g=f[0].getBoundingClientRect();e=g.width?g.width:g.right-g.left}else{var i=a("th",h.$originalHeader);if("collapse"===i.css("border-collapse"))if(b.getComputedStyle)e=parseFloat(b.getComputedStyle(this,null).width);else{var j=parseFloat(f.css("padding-left")),k=parseFloat(f.css("padding-right")),l=parseFloat(f.css("border-width"));e=f.outerWidth()-j-k-l}else e=f.width()}d[c]=e}),d},h.setWidth=function(a,b,c){b.each(function(b){var d=a[b];c.eq(b).css({"min-width":d,"max-width":d})})},h.resetWidth=function(b,c){b.each(function(b){var d=a(this);c.eq(b).css({"min-width":d.css("min-width"),"max-width":d.css("max-width")})})},h.setOptions=function(c){h.options=a.extend({},f,c),h.$scrollableArea=a(h.options.scrollableArea),h.isWindowScrolling=h.$scrollableArea[0]===b},h.updateOptions=function(a){h.setOptions(a),h.unbind(),h.bind(),h.updateWidth(),h.toggleHeaders()},h.init()}var d="stickyTableHeaders",e=0,f={fixedOffset:0,leftOffset:0,marginTop:0,scrollableArea:b};a.fn[d]=function(b){return this.each(function(){var e=a.data(this,"plugin_"+d);e?"string"==typeof b?e[b].apply(e):e.updateOptions(b):"destroy"!==b&&a.data(this,"plugin_"+d,new c(this,b))})}}(jQuery,window);var plenty_admin={};plenty_admin.UI={},plenty_admin.UI.DOM=$("body"),plenty_admin.UI.loadingOverlay=plenty_admin.UI.DOM.find("#loadingOverlay"),plenty_admin.UI.fontIconClasses=["moisture-sensor","pest-control","harvest","soil-test","planting","fertilizer","tilling","late-nitrogen","early-nitrogen","spreader","sprayer","grain-cart","combine","offset-disk","atv","pipe","spray-plane","tractor","well","planter","grain-truck"],plenty_admin.UI.brand_palette=new Rainbow,plenty_admin.UI.brand_palette.setSpectrum("#0076b2","#93b222","#788912"),plenty_admin.REST={},plenty_admin.REST.URL="52.5.118.250:8080/plenty",plenty_admin.REST.fullURL="http://"+plenty_admin.REST.URL,plenty_admin.init=function(a){plenty_admin.context=a,plenty_admin.UI.DOM.find(".navbar li.logout a").click(function(){return store.remove("plenty_username"),store.get("basicAuth"),location.href="/",!1}),$("body").on("shown.bs.modal",".modal",function(){console.log("we have shown a modal"),$("body").find(".page-container").addClass("blur")}).on("hidden.bs.modal",".modal",function(){console.log("we have hidden a modal"),$("body").hasClass("loading")||$("body").find(".page-container").removeClass("blur")}),plenty_admin.REST.get_user_with_username(store.get("plenty_username"),function(b){switch(plenty_admin.DATA.userDetails=b,console.log("userDetails: ",plenty_admin.DATA.userDetails,a),plenty_admin.UI.DOM.find("#navbar .navbar-right .userFName").text(plenty_admin.DATA.userDetails.firstName).end().find("#navbar .navbar-right .userLName").text(plenty_admin.DATA.userDetails.lastName).parent().fadeIn("fast"),a){case"settings":plenty_admin.DATA.load_user_organizations(function(a){plenty_admin.DATA.getInitialOrganizationData(a,function(){plenty_admin.DATA.eventCollector=window.eventcollector(5,1e4),plenty_admin.REST.getEquipmentTypes(),plenty_admin.REST.getRoleTypes(),plenty_admin.REST.getOrganizationTypes(),plenty_admin.REST.getBoundaryTypes(),plenty_admin.REST.getGrowthMethods(),plenty_admin.DATA.eventCollector.on("done",function(a,b,c){console.log("event %d of %d emitted",a,b),console.log("event description:",c)}),plenty_admin.DATA.eventCollector.on("alldone",function(){$(document).trigger("organization_data_ready",[plenty_admin.DATA.organizations])})})});break;case"map":plenty_admin.DATA.load_user_organizations(function(a){plenty_admin.DATA.organizations={};for(var b=a.body(),c=0;c<b.length;c++){var d=b[c].data();plenty_admin.DATA.organizations[d.id]=d}$(document).trigger("map_data_ready")});break;case"dashboard":plenty_admin.HELPER.hideLoadingOverlay(),$(document).trigger("dashboard_data_ready",[plenty_admin.DATA.organizations]);break;case"plans":$(document).trigger("plans_data_ready")}})},plenty_admin.REST.make_base_auth=function(a,b){var c=a+":"+b,d=btoa(c),e="Basic "+d;return console.log("basicAuth:",e),e},plenty_admin.api=restful(plenty_admin.REST.URL),plenty_admin.api.header("Authorization",store.get("basicAuth")),plenty_admin.REST.getDataForEditable=function(a,b,c){console.log("get data for this element: ",a,b,c);var d=null;switch(a[1]){case"organizations":var e=plenty_admin.DATA.organizations[a[0]];d={},d.organizationTypeId=e.organizationTypeId,d.name=e.name,d.addressLine1=e.addressLine1,d.addressLine2=e.addressLine2,d.city=e.city,d.state=e.state,d.zip=e.zip,d.id=e.id,d.created=e.created,d.lastModified=e.lastModified,d[b]=c;break;case"users":d=$.grep(plenty_admin.DATA.current_organization.users,function(b){return b.id===parseInt(a[2])})[0],d[b]=c;break;case"fields":d=$.grep(plenty_admin.DATA.current_farm.fields,function(b){return b.id===parseInt(a[2])})[0],d[b]=c;break;case"fieldCrop":switch(d={},b){case"cropTypeId":d.id=parseInt(a[0]),d.cropTypeId=parseInt(c),d.tillageTypeId=parseInt(a[3]),d.irrigationTypeId=parseInt(a[4]),d.year=a[5],d.fieldId=parseInt(a[6]);break;case"tillageTypeId":d.id=parseInt(a[0]),d.cropTypeId=parseInt(a[2]),d.tillageTypeId=parseInt(c),d.irrigationTypeId=parseInt(a[4]),d.year=a[5],d.fieldId=parseInt(a[6]);break;case"irrigationTypeId":d.id=parseInt(a[0]),d.cropTypeId=parseInt(a[2]),d.tillageTypeId=parseInt(a[3]),d.irrigationTypeId=parseInt(c),d.year=a[5],d.fieldId=parseInt(a[6]);break;case"year":d.id=parseInt(a[0]),d.cropTypeId=parseInt(a[2]),d.tillageTypeId=parseInt(a[3]),d.irrigationTypeId=parseInt(a[4]),d.year=c,d.fieldId=parseInt(a[6])}}return console.log("Data object to send in post: ",d),d},plenty_admin.REST.inline_editing_options={url:function(a){console.log("generate url: ",a);var b=$(this),c=new $.Deferred,d=a.pk.split("/");console.log("updateProperties",d);var e="";switch(d[1]){case"organizations":e="organizations/updateOrganization";break;case"users":e="users/updateUser";break;case"fieldsAndCropTypes":e="fields/updateField";break;case"fieldCrop":e="fieldCrops/updateFieldCrop"}return $.ajax({url:plenty_admin.REST.fullURL+"/"+e,type:"POST",dataType:"json",processData:!1,headers:{Authorization:store.get("basicAuth")},contentType:"application/json;charset=UTF-8",data:JSON.stringify(plenty_admin.REST.getDataForEditable(d,a.name,a.value))}).success(function(){c.resolve(),b.editable("hide")}).error(function(){console.error("inline editing commit failed")}),c.promise()}},plenty_admin.DATA={},plenty_admin.DATA.getInitialOrganizationData=function(a,b){var c=a.body();plenty_admin.DATA.organizations={},plenty_admin.DATA.organizations.length=0,plenty_admin.REST.getInitialDataForOrganization=plenty_admin.api.all("settings/getInitialDataForOrganization");for(var d=0;d<c.length;d++){var e=c[d].data();plenty_admin.DATA.organizations[e.id]=e,plenty_admin.REST.getInitialDataForOrganization.get(e.id).then(function(a){var d=a.body(),e=d.data(),f=$.extend({},plenty_admin.DATA.organizations[e.organizationId],e);plenty_admin.DATA.organizations[f.id]=f,plenty_admin.DATA.organizations.length+=1,plenty_admin.DATA.organizations.length===c.length&&b&&"function"==typeof b&&b()})}},plenty_admin.DATA.timezones=[{value:"AST",text:"Alaska Standard Time"},{value:"CST",text:"Central Standard Time"},{value:"EST",text:"Eastern Standard Time"},{value:"MST",text:"Mountain Standard Time"},{value:"PST",text:"Pacific Standard Time"}],plenty_admin.DATA.load_user_organizations=function(a){plenty_admin.REST.getOrganizationsForUser=plenty_admin.api.one("settings/getOrganizationsForUser",plenty_admin.DATA.userDetails.id),plenty_admin.REST.getOrganizationsForUser.get().then(function(b){console.log("orgsForUser: ",b),a&&"function"==typeof a&&a(b)})},plenty_admin.DATA.load_user_filters=function(a){plenty_admin.REST.getFiltersByUser=plenty_admin.api.one("login/getFilterForUserAndCreateIfNotFound",plenty_admin.DATA.userDetails.id),plenty_admin.REST.getFiltersByUser.get().then(function(b){a&&"function"==typeof a&&a(b)})},plenty_admin.REST.get_object_from_data=function(a){for(var b={},c=0;c<a.length;c++)data=a[c].data(),b[data.id]=data;return b},plenty_admin.REST.get_array_from_data=function(a){for(var b=[],c=0;c<a.length;c++)data=a[c].data(),b.push(data);return b},plenty_admin.REST.equipmentTypes=plenty_admin.api.all("equipmentTypes/getAllEquipmentTypes"),plenty_admin.REST.getEquipmentTypes=function(){plenty_admin.DATA.equipmentTypes={},plenty_admin.REST.equipmentTypes.getAll().then(function(a){plenty_admin.DATA.equipmentTypes=plenty_admin.REST.get_object_from_data(a.body()),console.log("Get equip types finished");for(var b="",c=0;c<plenty_admin.DATA.equipmentTypes.length;c++){var d=plenty_admin.DATA.equipmentTypes[c];b+="<option value='"+d.id+"'>"+d.name+"</option>"}plenty_admin.UI.DOM.find(".equipment_type_list").find("option").remove().append(b),plenty_admin.DATA.eventCollector.done("equipment")})},plenty_admin.REST.getEquipmentByOrgAndType=function(a,b,c,d){plenty_admin.REST.equipmentByOrgAndType=plenty_admin.api.one("equipmentEquipmentTypes/getByOrganizationAndType/"+a,b),plenty_admin.REST.equipmentByOrgAndType.get().then(function(a){var b=plenty_admin.REST.get_object_from_data(a.body());c&&"function"==typeof c&&c(b,d)})},plenty_admin.REST.getSkillsAndRatesByUserAndSkillAndOrg=function(a,b,c){var d=plenty_admin.DATA.current_organization.id,e=plenty_admin.DATA.userDetails.id;plenty_admin.REST.skillsAndRatesByUserAndSkillAndOrg=plenty_admin.api.one("skillsAndRates/getSkillsAndRatesByUserAndSkillAndOrganization/"+e+"/"+a,d),plenty_admin.REST.skillsAndRatesByUserAndSkillAndOrg.get().then(function(a){var d=plenty_admin.REST.get_object_from_data(a.body());b&&"function"==typeof b&&b(d,c)})},plenty_admin.REST.getEquipmentEquipmentTypesForOrg=function(){plenty_admin.REST.equipmentEquipmentByOrg=plenty_admin.api.one("equipmentEquipmentTypes/getByOrganization",plenty_admin.DATA.current_organization.id),plenty_admin.REST.equipmentEquipmentByOrg.get().then(function(a){var b=plenty_admin.REST.get_object_from_data(a.body());plenty_admin.DATA.current_organization.equipmentEquipmentTypes=b,plenty_admin.DATA.eventCollector.done("equipmentEquipmentTypes")})},plenty_admin.REST.allProducts=plenty_admin.api.all("products/getAllProducts"),plenty_admin.REST.getAllProducts=function(){plenty_admin.REST.allProducts.getAll().then(function(a){var b=plenty_admin.REST.get_object_from_data(a.body());console.log("products",b),plenty_admin.DATA.allProducts=b,plenty_admin.DATA.eventCollector.done("allProducts")})},plenty_admin.REST.getProductsByType=function(a,b,c){plenty_admin.REST.productsByType=plenty_admin.api.one("products/getByProductType",a),plenty_admin.REST.productsByType.get().then(function(a){var d=plenty_admin.REST.get_object_from_data(a.body());b&&"function"==typeof b&&b(d,c)})},plenty_admin.REST.brandTypes=plenty_admin.api.all("brands/getAllBrands"),plenty_admin.REST.getBrandTypes=function(){plenty_admin.DATA.brandTypes={},plenty_admin.REST.brandTypes.getAll().then(function(a){plenty_admin.DATA.brandTypes=plenty_admin.REST.get_object_from_data(a.body()),console.log("Get brand types finished");var b="";for(index in plenty_admin.DATA.brandTypes)if(plenty_admin.DATA.brandTypes.hasOwnProperty(index)){var c=plenty_admin.DATA.brandTypes[index];b+="<option value='"+c.id+"'>"+c.name+"</option>"}plenty_admin.UI.DOM.find(".brand_type_list").find("option").remove().append(b),plenty_admin.DATA.eventCollector.done("Brands")})},plenty_admin.REST.activityTypes=plenty_admin.api.all("activityTypes/getAllActivityTypes"),plenty_admin.REST.getActivityTypes=function(){plenty_admin.REST.activityTypes.getAll().then(function(a){plenty_admin.DATA.activityTypes=plenty_admin.REST.get_object_from_data(a.body()),console.log("Get activity types finished"),plenty_admin.DATA.eventCollector.done("activities")},function(a){console.error("getting activity types failed: ",a)})},plenty_admin.REST.skillTypes=plenty_admin.api.all("skills/getAllSkills"),plenty_admin.REST.getSkillTypes=function(){plenty_admin.REST.skillTypes.getAll().then(function(a){for(var b={},c=0;c<a.body().length;c++)data=a.body()[c].data(),b[data.id]=data;plenty_admin.DATA.labourTypes=b,console.log("Get labour types finished"),plenty_admin.DATA.eventCollector.done("labour")},function(a){console.error("getting skill types failed: ",a)})},plenty_admin.REST.productTypes=plenty_admin.api.all("productTypes/getAllProductTypes"),plenty_admin.REST.getProductTypes=function(){plenty_admin.REST.productTypes.getAll().then(function(a){plenty_admin.DATA.productTypes=plenty_admin.REST.get_object_from_data(a.body()),console.log("Get product types finished"),plenty_admin.DATA.eventCollector.done("products")},function(a){console.error("getting skill types failed: ",a)})},plenty_admin.REST.roleTypes=plenty_admin.api.all("roleTypes/getAllRoleTypes"),plenty_admin.REST.getRoleTypes=function(){plenty_admin.DATA.roleTypes={},plenty_admin.REST.roleTypes.getAll().then(function(a){plenty_admin.DATA.roleTypes=plenty_admin.REST.get_object_from_data(a.body()),console.log("Get role types finished"),plenty_admin.DATA.eventCollector.done("roles")})},plenty_admin.REST.cropTypes=plenty_admin.api.all("cropTypes/getAllCropTypes"),plenty_admin.REST.getCropTypes=function(){plenty_admin.DATA.cropTypes={},plenty_admin.REST.cropTypes.getAll().then(function(a){plenty_admin.DATA.cropTypes=plenty_admin.REST.get_object_from_data(a.body()),console.log("Get crop types finished"),plenty_admin.DATA.eventCollector.done("Crop Types")})},plenty_admin.REST.tillageTypes=plenty_admin.api.all("tillageType/getAllTillageTypes"),plenty_admin.REST.getTillageTypes=function(){plenty_admin.DATA.tillageTypes={},plenty_admin.REST.tillageTypes.getAll().then(function(a){plenty_admin.DATA.tillageTypes=plenty_admin.REST.get_object_from_data(a.body()),console.log("Get tillage types finished"),plenty_admin.DATA.eventCollector.done("tillage types")})},plenty_admin.REST.irrigationTypes=plenty_admin.api.all("irrigationTypes/getAllIrrigationTypes"),plenty_admin.REST.getIrrigationTypes=function(){plenty_admin.DATA.irrigationTypes={},plenty_admin.REST.irrigationTypes.getAll().then(function(a){plenty_admin.DATA.irrigationTypes=plenty_admin.REST.get_object_from_data(a.body()),console.log("Get irrigation types finished"),plenty_admin.DATA.eventCollector.done("irrigation types")})},plenty_admin.REST.organizationTypes=plenty_admin.api.all("organizationTypes/getAllOrganizationTypes"),plenty_admin.REST.getOrganizationTypes=function(){plenty_admin.DATA.organizationTypes={},plenty_admin.REST.organizationTypes.getAll().then(function(a){plenty_admin.DATA.organizationTypes=plenty_admin.REST.get_object_from_data(a.body()),console.log("Get org types finished"),plenty_admin.DATA.eventCollector.done("organization types")})},plenty_admin.REST.boundaryTypes=plenty_admin.api.all("boundaryType/getAllBoundaryTypes"),plenty_admin.REST.getBoundaryTypes=function(){plenty_admin.DATA.boundaryTypes={},plenty_admin.REST.boundaryTypes.getAll().then(function(a){plenty_admin.DATA.boundaryTypes=plenty_admin.REST.get_object_from_data(a.body()),console.log("Get boundary types finished"),plenty_admin.DATA.eventCollector.done("boundary types")})},plenty_admin.REST.growthMethods=plenty_admin.api.all("cropStage/getAllGrowthMethods"),plenty_admin.REST.getGrowthMethods=function(){plenty_admin.DATA.growthMethodTypes={},plenty_admin.REST.growthMethods.getAll().then(function(a){plenty_admin.DATA.growthMethodTypes=plenty_admin.REST.get_object_from_data(a.body()),console.log("Get growth methods finished:",plenty_admin.DATA.growthMethodTypes),plenty_admin.DATA.eventCollector.done("growth methods")})},plenty_admin.REST.allUsers=plenty_admin.api.all("users/getAllUsers"),plenty_admin.REST.getAllUsers=function(a){plenty_admin.DATA.allUsers={},plenty_admin.REST.allUsers.getAll().then(function(b){plenty_admin.DATA.allUsers=plenty_admin.REST.get_object_from_data(b.body()),console.log("Get all users finished: ",plenty_admin.DATA.allUsers),a&&"function"==typeof a&&a(b)})},plenty_admin.REST.get_user_with_username=function(a,b){plenty_admin.REST.getUserWithUsername=plenty_admin.api.one("login/getUserWithUserName",a),plenty_admin.REST.getUserWithUsername.get().then(function(a){console.log("getUserWithUserName",a.body()()),b&&"function"==typeof b&&b(a.body()())})},plenty_admin.REST.get_user_with_id=function(a,b){plenty_admin.REST.getUserWithId=plenty_admin.api.one("users/getUser",a),plenty_admin.REST.getUserWithId.get().then(function(a){if(b&&"function"==typeof b){var c=a.body();response_data=c.data(),b(response_data)}})},plenty_admin.REST.get_roles_with_userid=function(a,b){plenty_admin.REST.getUserWithId=plenty_admin.api.one("role/getRolesWithUserId",a),plenty_admin.REST.getUserWithId.get().then(function(a){if(b&&"function"==typeof b){for(var c=a.body(),d=[],e=0;e<c.length;e++){var f=c[e].data();d.push(f)}console.log("roles: ",d),b(d)}})},plenty_admin.REST.get_interests_by_field=function(a,b){plenty_admin.REST.getAllInterestsByField=plenty_admin.api.one("interests/getAllInterestsByField",a),plenty_admin.REST.getAllInterestsByField.get().then(function(a){if(b&&"function"==typeof b){for(var c=a.body(),d=[],e=0;e<c.length;e++){var f=c[e].data();d.push(f)}console.log("interests: ",d),b(d)}})},plenty_admin.REST.fields={},plenty_admin.REST.fields.getAllFieldsForOrganization=function(a){plenty_admin.REST.fields.getAllFieldsByOrganization(plenty_admin.DATA.current_organization.id,function(b){plenty_admin.DATA.current_organization.fields=b,a&&"function"==typeof a&&a(b)})},plenty_admin.REST.fields.getAllFieldsByFarm=function(a,b){plenty_admin.REST.fields.allFieldsByFarm=plenty_admin.api.one("fields/getAllFieldsByFarm",a),plenty_admin.REST.fields.allFieldsByFarm.get().then(function(a){var c=a.body(),d=[];for(var e in c){var f=c[e]();d.push(f)}b&&"function"==typeof b&&b(d)})},plenty_admin.REST.fields.getAllBoundariesByField=function(a,b){plenty_admin.REST.fields.allBoundariesByField=plenty_admin.api.one("boundaries/getAllBoundariesByField",a),plenty_admin.REST.fields.allBoundariesByField.get().then(function(a){var c=a.body(),d=[];for(var e in c){var f=c[e]();d.push(f)}b&&"function"==typeof b&&b(d)})},plenty_admin.REST.fields.getAllBoundaryPointsByBoundary=function(a,b){plenty_admin.REST.fields.allBoundaryPointsByBoundary=plenty_admin.api.one("boundaryPoints/getAllBoundaryPointsByBoundary",a),plenty_admin.REST.fields.allBoundaryPointsByBoundary.get().then(function(a){var c=a.body(),d=[];for(var e in c){var f=c[e]();d.push(f)}b&&"function"==typeof b&&b(d)})},plenty_admin.REST.fields.getAllBoundaryPointsByFieldAndBoundaryType=function(a,b,c,d){plenty_admin.REST.fields.allBoundaryPointsByFieldAndBoundaryType=plenty_admin.api.one("boundaryPoints/getBoundaryPointsByFieldAndBoundaryType/"+a,1),plenty_admin.REST.fields.allBoundaryPointsByFieldAndBoundaryType.get().then(function(b){var e=b.body(),f=[];for(var g in e){var h=e[g]();f.push(h)}c&&"function"==typeof c&&c(f,a,d)})},plenty_admin.REST.fields.getCLUBoundaryPointsForBoundingBox=function(a,b,c){plenty_admin.REST.fields.CLUBoundaryPointsForBoundingBox=plenty_admin.api.one("cluBoundaries/getByBoundinBox",a.maxLongitude+"/"+a.minLongitude+"/"+a.maxLatitude+"/"+a.minLatitude),plenty_admin.REST.fields.CLUBoundaryPointsForBoundingBox.get().then(function(a){var d=a.body(),e=[];for(var f in d){var g=d[f]();e.push(g)}b&&"function"==typeof b&&b(e,c)})},plenty_admin.REST.fields.getEquipmentLocationForFilter=function(a,b){plenty_admin.REST.fields.EquipmentLocationForFilter=plenty_admin.api.one("equipment/getEquipmentLocationForFilter",plenty_admin.DATA.userFilters.filterDto.id+"/"+a.maxLongitude+"/"+a.minLongitude+"/"+a.maxLatitude+"/"+a.minLatitude),plenty_admin.REST.fields.EquipmentLocationForFilter.get().then(function(a){var c=a.body(),d=[];for(var e in c){var f=c[e]();d.push(f)}b&&"function"==typeof b&&b(d)})},plenty_admin.REST.fields.getPlatformServicesForFilter=function(a){plenty_admin.REST.fields.platformServicesForFilter=plenty_admin.api.one("filters/getPlatformServicesFiltered",plenty_admin.DATA.userFilters.filterDto.id),plenty_admin.REST.fields.platformServicesForFilter.get().then(function(b){var c=b.body(),d=[];for(var e in c){var f=c[e]();d.push(f)}a&&"function"==typeof a&&a(d)})},plenty_admin.REST.fields.getAllFieldsByOrganization=function(a,b){plenty_admin.REST.fields.allFieldsByOrganization=plenty_admin.api.one("fields/getFieldsByOrganization",a),plenty_admin.REST.fields.allFieldsByOrganization.get().then(function(a){var c=a.body(),d=[];for(var e in c){var f=c[e]();d.push(f)}b&&"function"==typeof b&&b(d)})},plenty_admin.REST.fields.getFieldById=function(a,b){plenty_admin.REST.fieldById=plenty_admin.api.all("fields/getField"),plenty_admin.REST.fieldById.get(a).then(function(a){console.log(" fieldById: ",a.body()()),b&&"function"==typeof b&&b(a.body()())})},plenty_admin.REST.fields.getEquipmentImage=function(a,b){plenty_admin.REST.equipmentImage=plenty_admin.api.all("equipmentFiles/getImage"),plenty_admin.REST.equipmentImage.get(a).then(function(a){b&&"function"==typeof b&&b(a().data)})},plenty_admin.REST.fields.getAllFarmServicesByFarm=function(a,b){plenty_admin.REST.fields.allFarmServicesByFarm.get().then(function(a){var c=a.body(),d=[];for(var e in c){var f=c[e]();d.push(f)}plenty_admin.DATA.organizations[plenty_admin.DATA.current_organization.id].farms[plenty_admin.DATA.current_farm.id].services=d,b&&"function"==typeof b&&b(d)})},plenty_admin.REST.fields.getGrowthStageById=function(a,b){plenty_admin.REST.growthStageById=plenty_admin.api.all("cropStage/getGrowthStage"),plenty_admin.REST.growthStageById.get(a).then(function(a){console.log("gs",a,a.body()()),b&&"function"==typeof b&&b(a.body()())})},plenty_admin.REST.fields.insertFieldWithInterestAndBoundaryPoints=function(a,b,c){var d={},e=plenty_admin.MAPS.selectedPolygon.polygon.getPath(),f=[];e.forEach(function(a,b){var c={};c.seqNumber=b,c.latitude=a.lat(),c.longitude=a.lng(),f.push(c)}),d.boundaryPointDtos=f,d.interestPCT=b,d.organizationId=parseInt(a.interestOrgId),delete a.interestOrgId,d.cropTypeId=parseInt(a.cropTypeId),delete a.cropTypeId,d.irrigationTypeId=parseInt(a.irrigationTypeId),delete a.irrigationTypeId,d.tillageTypeId=parseInt(a.tillageTypeId),delete a.tillageTypeId,d.growthMethodId=parseInt(a.growthMethodId),d.year=2015,d.fieldDto=a,console.log("fullFieldObject",d),plenty_admin.REST.insertField.post(d).then(function(a){var b=a.body();switch(plenty_admin.state){case"settings":plenty_admin.DATA.data_source.fieldsAndCropTypes.push({field:b}),plenty_admin.UI.updateBadges("fields",plenty_admin.DATA.data_source.fieldsAndCropTypes.length);var d=$(plenty_admin.UI.create_item(b,"fieldsAndCropTypes"));plenty_admin.UI.organization.DOM.find("table.fieldsList").find(".noItemsText").remove().end().append(d),plenty_admin.UI.organization.addItemFunctionality(d);break;case"map":plenty_admin.DATA.userFilters.filterDto.fieldIds.push(b.id),plenty_admin.DATA.update_filters(function(a){plenty_admin.DATA.userFilters=a.body()},null,!1)}c&&"function"==typeof c&&c(b)})},plenty_admin.REST.fields.insertFieldCrop=function(a,b){plenty_admin.REST.insertFieldCrop.post(a).then(function(a){var c=a.body();b&&"function"==typeof b&&b(c)})},plenty_admin.REST.fields.updateFieldCrop=function(a,b){plenty_admin.REST.updateFieldCrop.put(a).then(function(a){var c=a.body();b&&"function"==typeof b&&b(c)})},plenty_admin.REST.plans={},plenty_admin.REST.plans.createTemplatePlan=function(a,b){plenty_admin.REST.createTemplatePlan.post(a).then(function(a){var c=a.body();console.log("adding templatePlan success: ",c),b&&"function"==typeof b&&b(c)})},plenty_admin.REST.getStatus=function(){$.ajax({url:"http://52.5.118.250:8080/plenty-manage/health",context:document.body}).success(function(a){plenty_admin.UI.setRESTStatus(a.status)}).error(function(a){plenty_admin.UI.setRESTStatus("DOWN"),0==$(".modal.bootbox.healthcheck.in").length&&bootbox.dialog({message:"Rest Server is down right now, please try later - "+a.status+" - "+a.statusText,className:"danger healthcheck",buttons:{},callback:plenty_admin.HELPER.hideLoadingOverlay})})},plenty_admin.REST.getStatus(),plenty_admin.REST.checkStatus=setInterval(function(){plenty_admin.REST.getStatus()},1e5),plenty_admin.UI.setRESTStatus=function(a){var b=$("footer .restStatus");switch(b.removeClass("alert-success alert-warn alert-danger"),a){case"UP":b.addClass("alert-success");break;case"DOWN":b.addClass("alert-danger")}b.find(".status").text(a)},plenty_admin.UI.updateBadges=function(a,b){plenty_admin.UI.sideBar.DOM.find("#collapse_"+plenty_admin.DATA.current_organization.id+" li.list-group-item."+a+" span.badge").text(b),plenty_admin.UI.settings.DOM.find(".organization[data-orgid='"+plenty_admin.DATA.current_organization.id+"'] panel .orgAssets ."+a+" span.count").text(b)},plenty_admin.UI.populate_type_lists=function(a,b,c){for(var d=0;d<c.length;d++){if(plenty_admin.DATA[c[d]+"Types"]){var e="";for(id in plenty_admin.DATA[c[d]+"Types"])if(console.log("data type",plenty_admin.DATA[c[d]+"Types"],id,plenty_admin.DATA[c[d]+"Types"][id]),plenty_admin.DATA[c[d]+"Types"].hasOwnProperty(id)){var f=plenty_admin.DATA[c[d]+"Types"][id];e+="<option value='"+id+"'>"+f.name+"</option>"}}var g=a.find("#"+b+"_"+c[d]+"_type");console.log("$elList",g),g.append(e)}},plenty_admin.UI.get_inline_editing_options=function(a){var b="[";if(Array.isArray(a))for(var c=0;c<a.length;c++){var d=a[c];b+="object"==typeof d?'{value:"'+d.id+'", text: "'+d.name+'"},':'{value:"'+d+'", text: "'+d+'"},'}else if("object"==typeof a)for(id in a)a.hasOwnProperty(id)&&(b+='{value:"'+id+'", text: "'+a[id].name+'"},');return b+="]"},plenty_admin.UI.build_breadcrumb_trail=function(a){for(var b=$("<h3 class='breadcrumb-trail mtn'><ol class='breadcrumb mbn'></ol></h3>"),c=0;c<a.length;c++){var d=a[c],e=$("<li class='"+d["class"]+"'>"+("active"!=d["class"]&&d.clickHandler?"<a href=''><span class='glyphicon glyphicon-chevron-left'></span>"+d.name+"</a>":d.name)+"</li>");d.clickHandler&&e.click(d.clickHandler),b.find("ol").append(e)}return b},plenty_admin.HELPER={},plenty_admin.HELPER.getParameterByName=function(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b=new RegExp("[\\?&]"+a+"=([^&#]*)"),c=b.exec(location.search);return null===c?"":decodeURIComponent(c[1].replace(/\+/g," "))},plenty_admin.HELPER.capitalizeFirstLetter=function(a){return a.charAt(0).toUpperCase()+a.slice(1)},plenty_admin.HELPER.get_singular_selected_hash=function(){var a=plenty_admin.UI.organization.tabs.DOM.find(".nav.nav-tabs li[role='presentation'].active a[role='tab']").prop("href"),b=a.substring(a.indexOf("#")+1,a.lastIndexOf("s"));return b},plenty_admin.HELPER.formatJavaDate=function(a){var b=new Date(a),c=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],d=b.getUTCFullYear(),e=c[b.getUTCMonth()],f=b.getUTCMonth()+1,g=b.getUTCDate(),h=b.getUTCHours()<10?"0"+b.getUTCHours()-1:b.getUTCHours()-1,i=b.getUTCMinutes()<10?"0"+b.getUTCMinutes():b.getUTCMinutes(),j=b.getUTCSeconds()<10?"0"+b.getUTCSeconds():b.getUTCSeconds(),k=(e?e.slice(0,4):e)+" "+g,l=k+", "+d,m=f+"/"+g+"/"+d,n=h+":"+i+":"+j;return{date_time:n,date:k,time:n,month:e,obj:b,fullDate:l,year:d,USDate:m}},plenty_admin.HELPER.daysFromHours=function(a){if(24>a)return a+"hrs";var b=Math.floor(a/24),c=Math.round(a/24-b);return b+"days, "+c+"hrs"},plenty_admin.HELPER.treatAsUTC=function(a){if("object"==typeof a)var b=a;else var b=new Date(a);return b.setMinutes(b.getMinutes()-b.getTimezoneOffset()),b},plenty_admin.HELPER.capitalizeFirstLetter=function(a){return a.charAt(0).toUpperCase()+a.slice(1)},plenty_admin.HELPER.daydiff=function(a,b){var c=864e5,d=(b-a)/c;return d},
plenty_admin.HELPER.hideLoadingOverlay=function(){$("body").removeClass("loading").find(".page-container").removeClass("blur"),plenty_admin.UI.loadingOverlay.fadeOut("fast")},plenty_admin.HELPER.showLoadingOverlay=function(){$("body").addClass("loading").find(".page-container").addClass("blur"),plenty_admin.UI.loadingOverlay.fadeIn("fast")},plenty_admin.HELPER.returnInlineEditSelectOptions=function(a){"timezone"===a&&(optionsJSON=plenty_admin.DATA.timezones);var b="data-source='";return b+=JSON.stringify(optionsJSON),b+="'"},plenty_admin.HELPER.dynamicSort=function(a){var b=1;return"-"===a[0]&&(b=-1,a=a.substr(1)),function(c,d){var e=c[a]<d[a]?-1:c[a]>d[a]?1:0;return e*b}},plenty_admin.HELPER.validateForm=function(a){var b=a.find(".alert.help-block");b.hide(),a.find(".has-error").removeClass("has-error");var c=!0,d=[];if(a.find("input, select").each(function(){if(console.log("field",this),$(this).prop("required")){console.log("field is required",this,this.tagName);var a=null;switch(this.tagName.toLowerCase()){case"input":a=$(this).val();break;case"select":a=$(this).find("option:selected").val()}console.log("val = ",null===a,a.length),(a.length<=0||null===a)&&($(this).parent().addClass("has-error"),d.push($(this)),c=!1)}}),c)return!0;for(var e=0;e<d.length;e++){var f=d[e];f.parent().find(".alert.help-block").slideDown("fast")}},plenty_admin.HELPER.returnFieldType=function(a){switch(a){case"mobileNumber":return"number";case"email":return"email";case"timezone":return"select";default:return"text"}},plenty_admin.HELPER.initFloatingHeaders=function(a,b,c){var d,e,f,g,h,i=$(a),j=i.parent(),k=$('<div class="floating-header"/>'),l=i.clone(!0,!0),m=i.find(b+":eq(0)"),n=$(c),o=0,p=0,q=i.find(b),r=j.offset().top;$(window).on("resize",function(){r=j.offset().top,k.css({width:m.outerWidth(),height:m.outerHeight()}),s.css({top:-$(q.get(o)).position().top}),k.css(h.bottom<=k[0].offsetHeight?{position:"absolute",top:i[0].offsetHeight+i[0].offsetTop-k[0].offsetHeight+"px"}:{position:"fixed",top:r,"z-index":1})}),k.append(l),j.prepend(k);var s=k.find("table");k.css({width:m.outerWidth(),height:m.outerHeight(),display:"none",overflow:"hidden"}),n.on("scroll",function(){var a=document.querySelectorAll("div.floating-header"),b=(document.body.offsetHeight,a.length,$(this).scrollTop());b>p?(d=$(q.get(o+1)),e=d.offset().top-r,0>=e&&(s.css({top:-d.position().top}),o+=1,o>q.length-1?o=q.length-1:null)):(f=$(q.get(o)),g=f.offset().top-r,o>0&&g>=0&&(s.css({top:-$(q.get(o-1)).position().top}),o-=1,0>o?o=0:null)),p=b,h=i[0].getBoundingClientRect(),h.top-r<=0&&h.bottom>0?(k.show(),k.css(h.bottom<=k[0].offsetHeight?{position:"absolute",top:i[0].offsetHeight+i[0].offsetTop-k[0].offsetHeight+"px"}:{position:"fixed",top:r,"z-index":1})):k.hide()})},plenty_admin.HELPER.colorLuminance=function(a,b){a=String(a).replace(/[^0-9a-f]/gi,""),a.length<6&&(a=a[0]+a[0]+a[1]+a[1]+a[2]+a[2]),b=b||0;var c,d,e="#";for(d=0;3>d;d++)c=parseInt(a.substr(2*d,2),16),c=Math.round(Math.min(Math.max(0,c+c*b),255)).toString(16),e+=("00"+c).substr(c.length);return e},plenty_admin.HELPER.hexToRgb=function(a){var b=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);return b?{r:parseInt(b[1],16),g:parseInt(b[2],16),b:parseInt(b[3],16)}:null},plenty_admin.HELPER.testAPICall=function(a,b){plenty_admin.REST.getField=plenty_admin.api.all(a),plenty_admin.REST.getField.get(b).then(function(b){console.log(a+" GOT",b)})},Chart.types.Line.extend({name:"LineAlt",initialize:function(){Chart.types.Line.prototype.initialize.apply(this,arguments),console.log("Init LineAlt: ",this,arguments);var a=this.scale.xLabels,b=1;a.length>31&&a.length<125?b=3:a.length>125&&a.length<500?b=7:a.length>500&&a.length<1e3?b=14:a.length>1e3&&(b=20),a.forEach(function(c,d){d%b>0&&(a[d]="")})}}),Date.prototype.today=function(){return(this.getDate()<10?"0":"")+this.getDate()+"/"+(this.getMonth()+1<10?"0":"")+(this.getMonth()+1)+"/"+this.getFullYear()},Date.prototype.timeNow=function(){return(this.getHours()<10?"0":"")+this.getHours()+":"+(this.getMinutes()<10?"0":"")+this.getMinutes()+":"+(this.getSeconds()<10?"0":"")+this.getSeconds()},function(){function a(a){return function(b){this[a]=b}}function b(a){return function(){return this[a]}}function c(a,b,e){this.extend(c,google.maps.OverlayView),this.c=a,this.a=[],this.f=[],this.ca=[53,56,66,78,90],this.j=[],this.A=!1,e=e||{},this.g=e.gridSize||60,this.l=e.minimumClusterSize||2,this.J=e.maxZoom||o,this.j=e.styles||[],this.X=e.imagePath||this.Q,this.W=e.imageExtension||this.P,this.O=!0,void 0!=e.zoomOnClick&&(this.O=e.zoomOnClick),this.r=!1,void 0!=e.averageCenter&&(this.r=e.averageCenter),d(this),this.setMap(a),this.K=this.c.getZoom();var f=this;google.maps.event.addListener(this.c,"zoom_changed",function(){var a=f.c.getZoom();f.K!=a&&(f.K=a,f.m())}),google.maps.event.addListener(this.c,"idle",function(){f.i()}),b&&b.length&&this.C(b,!1)}function d(a){if(!a.j.length)for(var b,c=0;b=a.ca[c];c++)a.j.push({url:a.X+(c+1)+"."+a.W,height:b,width:b})}function e(a,b){b.s=!1,b.draggable&&google.maps.event.addListener(b,"dragend",function(){b.s=!1,a.L()}),a.a.push(b)}function f(a,b){var c=-1;if(a.a.indexOf)c=a.a.indexOf(b);else for(var d,e=0;d=a.a[e];e++)if(d==b){c=e;break}return-1==c?!1:(b.setMap(o),a.a.splice(c,1),!0)}function g(a){if(a.A)for(var b,c=a.v(new google.maps.LatLngBounds(a.c.getBounds().getSouthWest(),a.c.getBounds().getNorthEast())),d=0;b=a.a[d];d++)if(!b.s&&c.contains(b.getPosition())){for(var e=a,f=4e4,g=o,i=0,j=void 0;j=e.f[i];i++){var k=j.getCenter();if(k){var l=b.getPosition();if(k&&l)var m=(l.lat()-k.lat())*Math.PI/180,n=(l.lng()-k.lng())*Math.PI/180,k=Math.sin(m/2)*Math.sin(m/2)+Math.cos(k.lat()*Math.PI/180)*Math.cos(l.lat()*Math.PI/180)*Math.sin(n/2)*Math.sin(n/2),k=12742*Math.atan2(Math.sqrt(k),Math.sqrt(1-k));else k=0;f>k&&(f=k,g=j)}}g&&g.F.contains(b.getPosition())?g.q(b):(j=new h(e),j.q(b),e.f.push(j))}}function h(a){this.k=a,this.c=a.getMap(),this.g=a.w(),this.l=a.l,this.r=a.r,this.d=o,this.a=[],this.F=o,this.n=new j(this,a.z(),a.w())}function i(a){a.F=a.k.v(new google.maps.LatLngBounds(a.d,a.d))}function j(a,b,c){a.k.extend(j,google.maps.OverlayView),this.j=b,this.fa=c||0,this.u=a,this.d=o,this.c=a.getMap(),this.B=this.b=o,this.t=!1,this.setMap(this.c)}function k(a,b){var c=a.getProjection().fromLatLngToDivPixel(b);return c.x-=parseInt(a.p/2,10),c.y-=parseInt(a.h/2,10),c}function l(a){a.b&&(a.b.style.display="none"),a.t=!1}function m(a,b){var c=[];return c.push("background-image:url("+a.da+");"),c.push("background-position:"+(a.D?a.D:"0 0")+";"),"object"==typeof a.e?(c.push("number"==typeof a.e[0]&&a.e[0]>0&&a.e[0]<a.h?"height:"+(a.h-a.e[0])+"px; padding-top:"+a.e[0]+"px;":"height:"+a.h+"px; line-height:"+a.h+"px;"),c.push("number"==typeof a.e[1]&&a.e[1]>0&&a.e[1]<a.p?"width:"+(a.p-a.e[1])+"px; padding-left:"+a.e[1]+"px;":"width:"+a.p+"px; text-align:center;")):c.push("height:"+a.h+"px; line-height:"+a.h+"px; width:"+a.p+"px; text-align:center;"),c.push("cursor:pointer; top:"+b.y+"px; left:"+b.x+"px; color:"+(a.M?a.M:"black")+"; position:absolute; font-size:"+(a.N?a.N:11)+"px; font-family:Arial,sans-serif; font-weight:bold"),c.join("")}var n,o=null;n=c.prototype,n.Q="http://google-maps-utility-library-v3.googlecode.com/svn/trunk/markerclusterer/images/m",n.P="png",n.extend=function(a,b){return function(a){for(var b in a.prototype)this.prototype[b]=a.prototype[b];return this}.apply(a,[b])},n.onAdd=function(){this.A||(this.A=!0,g(this))},n.draw=function(){},n.S=function(){for(var a,b=this.o(),c=new google.maps.LatLngBounds,d=0;a=b[d];d++)c.extend(a.getPosition());this.c.fitBounds(c)},n.z=b("j"),n.o=b("a"),n.V=function(){return this.a.length},n.ba=a("J"),n.I=b("J"),n.G=function(a,b){for(var c=0,d=a.length,e=d;0!==e;)e=parseInt(e/10,10),c++;return c=Math.min(c,b),{text:d,index:c}},n.$=a("G"),n.H=b("G"),n.C=function(a,b){for(var c,d=0;c=a[d];d++)e(this,c);b||this.i()},n.q=function(a,b){e(this,a),b||this.i()},n.Y=function(a,b){var c=f(this,a);return!b&&c?(this.m(),this.i(),!0):!1},n.Z=function(a,b){for(var c,d=!1,e=0;c=a[e];e++)c=f(this,c),d=d||c;return!b&&d?(this.m(),this.i(),!0):void 0},n.U=function(){return this.f.length},n.getMap=b("c"),n.setMap=a("c"),n.w=b("g"),n.aa=a("g"),n.v=function(a){var b=this.getProjection(),c=new google.maps.LatLng(a.getNorthEast().lat(),a.getNorthEast().lng()),d=new google.maps.LatLng(a.getSouthWest().lat(),a.getSouthWest().lng()),c=b.fromLatLngToDivPixel(c);return c.x+=this.g,c.y-=this.g,d=b.fromLatLngToDivPixel(d),d.x-=this.g,d.y+=this.g,c=b.fromDivPixelToLatLng(c),b=b.fromDivPixelToLatLng(d),a.extend(c),a.extend(b),a},n.R=function(){this.m(!0),this.a=[]},n.m=function(a){for(var b,c=0;b=this.f[c];c++)b.remove();for(c=0;b=this.a[c];c++)b.s=!1,a&&b.setMap(o);this.f=[]},n.L=function(){var a=this.f.slice();this.f.length=0,this.m(),this.i(),window.setTimeout(function(){for(var b,c=0;b=a[c];c++)b.remove()},0)},n.i=function(){g(this)},n=h.prototype,n.q=function(a){var b;a:if(this.a.indexOf)b=-1!=this.a.indexOf(a);else{b=0;for(var c;c=this.a[b];b++)if(c==a){b=!0;break a}b=!1}if(b)return!1;if(this.d?this.r&&(c=this.a.length+1,b=(this.d.lat()*(c-1)+a.getPosition().lat())/c,c=(this.d.lng()*(c-1)+a.getPosition().lng())/c,this.d=new google.maps.LatLng(b,c),i(this)):(this.d=a.getPosition(),i(this)),a.s=!0,this.a.push(a),b=this.a.length,b<this.l&&a.getMap()!=this.c&&a.setMap(this.c),b==this.l)for(c=0;b>c;c++)this.a[c].setMap(o);if(b>=this.l&&a.setMap(o),a=this.c.getZoom(),(b=this.k.I())&&a>b)for(a=0;b=this.a[a];a++)b.setMap(this.c);else this.a.length<this.l?l(this.n):(b=this.k.H()(this.a,this.k.z().length),this.n.setCenter(this.d),a=this.n,a.B=b,a.ga=b.text,a.ea=b.index,a.b&&(a.b.innerHTML=b.text),b=Math.max(0,a.B.index-1),b=Math.min(a.j.length-1,b),b=a.j[b],a.da=b.url,a.h=b.height,a.p=b.width,a.M=b.textColor,a.e=b.anchor,a.N=b.textSize,a.D=b.backgroundPosition,this.n.show());return!0},n.getBounds=function(){for(var a,b=new google.maps.LatLngBounds(this.d,this.d),c=this.o(),d=0;a=c[d];d++)b.extend(a.getPosition());return b},n.remove=function(){this.n.remove(),this.a.length=0,delete this.a},n.T=function(){return this.a.length},n.o=b("a"),n.getCenter=b("d"),n.getMap=b("c"),n=j.prototype,n.onAdd=function(){this.b=document.createElement("DIV"),this.t&&(this.b.style.cssText=m(this,k(this,this.d)),this.b.innerHTML=this.B.text),this.getPanes().overlayMouseTarget.appendChild(this.b);var a=this;google.maps.event.addDomListener(this.b,"click",function(){var b=a.u.k;google.maps.event.trigger(b,"clusterclick",a.u),b.O&&a.c.fitBounds(a.u.getBounds())})},n.draw=function(){if(this.t){var a=k(this,this.d);this.b.style.top=a.y+"px",this.b.style.left=a.x+"px"}},n.show=function(){this.b&&(this.b.style.cssText=m(this,k(this,this.d)),this.b.style.display=""),this.t=!0},n.remove=function(){this.setMap(o)},n.onRemove=function(){this.b&&this.b.parentNode&&(l(this),this.b.parentNode.removeChild(this.b),this.b=o)},n.setCenter=a("d"),window.MarkerClusterer=c,c.prototype.addMarker=c.prototype.q,c.prototype.addMarkers=c.prototype.C,c.prototype.clearMarkers=c.prototype.R,c.prototype.fitMapToMarkers=c.prototype.S,c.prototype.getCalculator=c.prototype.H,c.prototype.getGridSize=c.prototype.w,c.prototype.getExtendedBounds=c.prototype.v,c.prototype.getMap=c.prototype.getMap,c.prototype.getMarkers=c.prototype.o,c.prototype.getMaxZoom=c.prototype.I,c.prototype.getStyles=c.prototype.z,c.prototype.getTotalClusters=c.prototype.U,c.prototype.getTotalMarkers=c.prototype.V,c.prototype.redraw=c.prototype.i,c.prototype.removeMarker=c.prototype.Y,c.prototype.removeMarkers=c.prototype.Z,c.prototype.resetViewport=c.prototype.m,c.prototype.repaint=c.prototype.L,c.prototype.setCalculator=c.prototype.$,c.prototype.setGridSize=c.prototype.aa,c.prototype.setMaxZoom=c.prototype.ba,c.prototype.onAdd=c.prototype.onAdd,c.prototype.draw=c.prototype.draw,h.prototype.getCenter=h.prototype.getCenter,h.prototype.getSize=h.prototype.T,h.prototype.getMarkers=h.prototype.o,j.prototype.onAdd=j.prototype.onAdd,j.prototype.draw=j.prototype.draw,j.prototype.onRemove=j.prototype.onRemove}(),function(a){function b(){var a=document.createElement("p"),b=!1;if(a.addEventListener)a.addEventListener("DOMAttrModified",function(){b=!0},!1);else{if(!a.attachEvent)return!1;a.attachEvent("onDOMAttrModified",function(){b=!0})}return a.setAttribute("id","target"),b}function c(b,c){if(b){var d=this.data("attr-old-value");if(c.attributeName.indexOf("style")>=0){d.style||(d.style={});var e=c.attributeName.split(".");c.attributeName=e[0],c.oldValue=d.style[e[1]],c.newValue=e[1]+":"+this.prop("style")[a.camelCase(e[1])],d.style[e[1]]=c.newValue}else c.oldValue=d[c.attributeName],c.newValue=this.attr(c.attributeName),d[c.attributeName]=c.newValue;this.data("attr-old-value",d)}}var d=window.MutationObserver||window.WebKitMutationObserver;a.fn.attrchange=function(e,f){if("object"==typeof e){var g={trackValues:!1,callback:a.noop};if("function"==typeof e?g.callback=e:a.extend(g,e),g.trackValues&&this.each(function(b,c){for(var d,e={},b=0,f=c.attributes,g=f.length;g>b;b++)d=f.item(b),e[d.nodeName]=d.value;a(this).data("attr-old-value",e)}),d){var h={subtree:!1,attributes:!0,attributeOldValue:g.trackValues},i=new d(function(b){b.forEach(function(b){var c=b.target;g.trackValues&&(b.newValue=a(c).attr(b.attributeName)),"connected"===a(c).data("attrchange-status")&&g.callback.call(c,b)})});return this.data("attrchange-method","Mutation Observer").data("attrchange-status","connected").data("attrchange-obs",i).each(function(){i.observe(this,h)})}return b()?this.data("attrchange-method","DOMAttrModified").data("attrchange-status","connected").on("DOMAttrModified",function(b){b.originalEvent&&(b=b.originalEvent),b.attributeName=b.attrName,b.oldValue=b.prevValue,"connected"===a(this).data("attrchange-status")&&g.callback.call(this,b)}):"onpropertychange"in document.body?this.data("attrchange-method","propertychange").data("attrchange-status","connected").on("propertychange",function(b){b.attributeName=window.event.propertyName,c.call(a(this),g.trackValues,b),"connected"===a(this).data("attrchange-status")&&g.callback.call(this,b)}):this}return"string"==typeof e&&a.fn.attrchange.hasOwnProperty("extensions")&&a.fn.attrchange.extensions.hasOwnProperty(e)?a.fn.attrchange.extensions[e].call(this,f):void 0}}(jQuery),$.fn.editable.defaults.mode="popup",RichMarker.prototype=new google.maps.OverlayView,window.RichMarker=RichMarker,RichMarker.prototype.getVisible=function(){return this.get("visible")},RichMarker.prototype.getVisible=RichMarker.prototype.getVisible,RichMarker.prototype.setVisible=function(a){this.set("visible",a)},RichMarker.prototype.setVisible=RichMarker.prototype.setVisible,RichMarker.prototype.visible_changed=function(){this.ready_&&(this.markerWrapper_.style.display=this.getVisible()?"":"none",this.draw())},RichMarker.prototype.visible_changed=RichMarker.prototype.visible_changed,RichMarker.prototype.setFlat=function(a){this.set("flat",!!a)},RichMarker.prototype.setFlat=RichMarker.prototype.setFlat,RichMarker.prototype.getFlat=function(){return this.get("flat")},RichMarker.prototype.getFlat=RichMarker.prototype.getFlat,RichMarker.prototype.getWidth=function(){return this.get("width")},RichMarker.prototype.getWidth=RichMarker.prototype.getWidth,RichMarker.prototype.getHeight=function(){return this.get("height")},RichMarker.prototype.getHeight=RichMarker.prototype.getHeight,RichMarker.prototype.setShadow=function(a){this.set("shadow",a),this.flat_changed()},RichMarker.prototype.setShadow=RichMarker.prototype.setShadow,RichMarker.prototype.getShadow=function(){return this.get("shadow")},RichMarker.prototype.getShadow=RichMarker.prototype.getShadow,RichMarker.prototype.flat_changed=function(){this.ready_&&(this.markerWrapper_.style.boxShadow=this.markerWrapper_.style.webkitBoxShadow=this.markerWrapper_.style.MozBoxShadow=this.getFlat()?"":this.getShadow())},RichMarker.prototype.flat_changed=RichMarker.prototype.flat_changed,RichMarker.prototype.setZIndex=function(a){this.set("zIndex",a)},RichMarker.prototype.setZIndex=RichMarker.prototype.setZIndex,RichMarker.prototype.getZIndex=function(){return this.get("zIndex")},RichMarker.prototype.getZIndex=RichMarker.prototype.getZIndex,RichMarker.prototype.zIndex_changed=function(){this.getZIndex()&&this.ready_&&(this.markerWrapper_.style.zIndex=this.getZIndex())},RichMarker.prototype.zIndex_changed=RichMarker.prototype.zIndex_changed,RichMarker.prototype.getDraggable=function(){return this.get("draggable")},RichMarker.prototype.getDraggable=RichMarker.prototype.getDraggable,RichMarker.prototype.setDraggable=function(a){this.set("draggable",!!a)},RichMarker.prototype.setDraggable=RichMarker.prototype.setDraggable,RichMarker.prototype.draggable_changed=function(){this.ready_&&(this.getDraggable()?this.addDragging_(this.markerWrapper_):this.removeDragListeners_())},RichMarker.prototype.draggable_changed=RichMarker.prototype.draggable_changed,RichMarker.prototype.getPosition=function(){return this.get("position")},RichMarker.prototype.getPosition=RichMarker.prototype.getPosition,RichMarker.prototype.setPosition=function(a){this.set("position",a)},RichMarker.prototype.setPosition=RichMarker.prototype.setPosition,RichMarker.prototype.position_changed=function(){this.draw()},RichMarker.prototype.position_changed=RichMarker.prototype.position_changed,RichMarker.prototype.getAnchor=function(){return this.get("anchor")},RichMarker.prototype.getAnchor=RichMarker.prototype.getAnchor,RichMarker.prototype.setAnchor=function(a){this.set("anchor",a)},RichMarker.prototype.setAnchor=RichMarker.prototype.setAnchor,RichMarker.prototype.anchor_changed=function(){this.draw()},RichMarker.prototype.anchor_changed=RichMarker.prototype.anchor_changed,RichMarker.prototype.htmlToDocumentFragment_=function(a){var b=document.createElement("DIV");if(b.innerHTML=a,1==b.childNodes.length)return b.removeChild(b.firstChild);for(var c=document.createDocumentFragment();b.firstChild;)c.appendChild(b.firstChild);return c},RichMarker.prototype.removeChildren_=function(a){if(a)for(var b;b=a.firstChild;)a.removeChild(b)},RichMarker.prototype.setContent=function(a){this.set("content",a)},RichMarker.prototype.setContent=RichMarker.prototype.setContent,RichMarker.prototype.getContent=function(){return this.get("content")},RichMarker.prototype.getContent=RichMarker.prototype.getContent,RichMarker.prototype.content_changed=function(){if(this.markerContent_){this.removeChildren_(this.markerContent_);var a=this.getContent();if(a){"string"==typeof a&&(a=a.replace(/^\s*([\S\s]*)\b\s*$/,"$1"),a=this.htmlToDocumentFragment_(a)),this.markerContent_.appendChild(a);for(var b,c=this,d=this.markerContent_.getElementsByTagName("IMG"),e=0;b=d[e];e++)google.maps.event.addDomListener(b,"mousedown",function(a){c.getDraggable()&&(a.preventDefault&&a.preventDefault(),a.returnValue=!1)}),google.maps.event.addDomListener(b,"load",function(){c.draw()});google.maps.event.trigger(this,"domready")}this.ready_&&this.draw()}},RichMarker.prototype.content_changed=RichMarker.prototype.content_changed,RichMarker.prototype.setCursor_=function(a){if(this.ready_){var b="";-1!==navigator.userAgent.indexOf("Gecko/")?("dragging"==a&&(b="-moz-grabbing"),"dragready"==a&&(b="-moz-grab"),"draggable"==a&&(b="pointer")):(("dragging"==a||"dragready"==a)&&(b="move"),"draggable"==a&&(b="pointer")),this.markerWrapper_.style.cursor!=b&&(this.markerWrapper_.style.cursor=b)}},RichMarker.prototype.startDrag=function(a){if(this.getDraggable()&&!this.dragging_){this.dragging_=!0;var b=this.getMap();this.mapDraggable_=b.get("draggable"),b.set("draggable",!1),this.mouseX_=a.clientX,this.mouseY_=a.clientY,this.setCursor_("dragready"),this.markerWrapper_.style.MozUserSelect="none",this.markerWrapper_.style.KhtmlUserSelect="none",this.markerWrapper_.style.WebkitUserSelect="none",this.markerWrapper_.unselectable="on",this.markerWrapper_.onselectstart=function(){return!1},this.addDraggingListeners_(),google.maps.event.trigger(this,"dragstart")}},RichMarker.prototype.stopDrag=function(a){this.getDraggable()&&this.dragging_&&(this.dragging_=!1,this.getMap().set("draggable",this.mapDraggable_),this.mouseX_=this.mouseY_=this.mapDraggable_=null,this.markerWrapper_.style.MozUserSelect="",this.markerWrapper_.style.KhtmlUserSelect="",this.markerWrapper_.style.WebkitUserSelect="",this.markerWrapper_.unselectable="off",this.markerWrapper_.onselectstart=function(){},this.removeDraggingListeners_(),this.setCursor_("draggable"),a&&google.maps.event.trigger(this,"dragend"),this.draw())},RichMarker.prototype.drag=function(a){if(!this.getDraggable()||!this.dragging_)return void this.stopDrag();var b=this.mouseX_-a.clientX,c=this.mouseY_-a.clientY;this.mouseX_=a.clientX,this.mouseY_=a.clientY;var d=parseInt(this.markerWrapper_.style.left,10)-b,e=parseInt(this.markerWrapper_.style.top,10)-c;this.markerWrapper_.style.left=d+"px",this.markerWrapper_.style.top=e+"px";var f=this.getOffset_(),g=new google.maps.Point(d-f.width,e-f.height),h=this.getProjection();this.setPosition(h.fromDivPixelToLatLng(g)),this.setCursor_("dragging"),google.maps.event.trigger(this,"drag")},RichMarker.prototype.removeDragListeners_=function(){this.draggableListener_&&(google.maps.event.removeListener(this.draggableListener_),delete this.draggableListener_),this.setCursor_("")},RichMarker.prototype.addDragging_=function(a){if(a){var b=this;this.draggableListener_=google.maps.event.addDomListener(a,"mousedown",function(a){b.startDrag(a)}),this.setCursor_("draggable")}},RichMarker.prototype.addDraggingListeners_=function(){var a=this;this.markerWrapper_.setCapture?(this.markerWrapper_.setCapture(!0),this.draggingListeners_=[google.maps.event.addDomListener(this.markerWrapper_,"mousemove",function(b){a.mouseMoved=!0,a.drag(b)},!0),google.maps.event.addDomListener(this.markerWrapper_,"mouseup",function(b){return b.stopPropagation(),a.mouseMoved?a.stopDrag(!0):(a.stopDrag(),1==b.which?google.maps.event.trigger(a,"click"):3==b.which&&google.maps.event.trigger(a,"rightclick")),a.markerWrapper_.releaseCapture(),a.mouseMoved=!1,!1},!0)]):this.draggingListeners_=[google.maps.event.addDomListener(window,"mousemove",function(b){a.mouseMoved=!0,a.drag(b)},!0),google.maps.event.addDomListener(window,"mouseup",function(b){return b.stopPropagation(),a.mouseMoved?a.stopDrag(!0):(a.stopDrag(),1==b.which?google.maps.event.trigger(a,"click"):3==b.which&&google.maps.event.trigger(a,"rightclick")),a.mouseMoved=!1,!1},!0)]},RichMarker.prototype.removeDraggingListeners_=function(){if(this.draggingListeners_){for(var a,b=0;a=this.draggingListeners_[b];b++)google.maps.event.removeListener(a);this.draggingListeners_.length=0}},RichMarker.prototype.getOffset_=function(){var a=this.getAnchor();if("object"==typeof a)return a;var b=new google.maps.Size(0,0);if(!this.markerContent_)return b;var c=this.markerContent_.offsetWidth,d=this.markerContent_.offsetHeight;switch(a){case RichMarkerPosition.TOP_LEFT:break;case RichMarkerPosition.TOP:b.width=-c/2;break;case RichMarkerPosition.TOP_RIGHT:b.width=-c;break;case RichMarkerPosition.LEFT:b.height=-d/2;break;case RichMarkerPosition.MIDDLE:b.width=-c/2,b.height=-d/2;break;case RichMarkerPosition.RIGHT:b.width=-c,b.height=-d/2;break;case RichMarkerPosition.BOTTOM_LEFT:b.height=-d;break;case RichMarkerPosition.BOTTOM:b.width=-c/2,b.height=-d;break;case RichMarkerPosition.BOTTOM_RIGHT:b.width=-c,b.height=-d}return b},RichMarker.prototype.onAdd=function(){if(this.markerWrapper_||(this.markerWrapper_=document.createElement("DIV"),this.markerWrapper_.style.position="absolute"),this.getZIndex()&&(this.markerWrapper_.style.zIndex=this.getZIndex()),this.markerWrapper_.style.display=this.getVisible()?"":"none",!this.markerContent_){this.markerContent_=document.createElement("DIV"),this.markerWrapper_.appendChild(this.markerContent_);var a=this;google.maps.event.addDomListener(this.markerContent_,"rightclick",function(){google.maps.event.trigger(a,"rightclick")}),google.maps.event.addDomListener(this.markerContent_,"mouseover",function(){google.maps.event.trigger(a,"mouseover")}),google.maps.event.addDomListener(this.markerContent_,"mouseout",function(){google.maps.event.trigger(a,"mouseout")})}this.ready_=!0,this.content_changed(),this.flat_changed(),this.draggable_changed();var b=this.getPanes();b&&b.overlayMouseTarget.appendChild(this.markerWrapper_),google.maps.event.trigger(this,"ready")},RichMarker.prototype.onAdd=RichMarker.prototype.onAdd,RichMarker.prototype.draw=function(){if(this.ready_&&!this.dragging_){var a=this.getProjection();if(a){var b=this.get("position"),c=a.fromLatLngToDivPixel(b),d=this.getOffset_();this.markerWrapper_.style.top=c.y+d.height+"px",this.markerWrapper_.style.left=c.x+d.width+"px";var e=this.markerContent_.offsetHeight,f=this.markerContent_.offsetWidth;f!=this.get("width")&&this.set("width",f),e!=this.get("height")&&this.set("height",e)}}},RichMarker.prototype.draw=RichMarker.prototype.draw,RichMarker.prototype.onRemove=function(){this.markerWrapper_&&this.markerWrapper_.parentNode&&this.markerWrapper_.parentNode.removeChild(this.markerWrapper_),this.removeDragListeners_()},RichMarker.prototype.onRemove=RichMarker.prototype.onRemove;var RichMarkerPosition={TOP_LEFT:1,TOP:2,TOP_RIGHT:3,LEFT:4,MIDDLE:5,RIGHT:6,BOTTOM_LEFT:7,BOTTOM:8,BOTTOM_RIGHT:9};window.RichMarkerPosition=RichMarkerPosition,plenty_admin.MAPS={},plenty_admin.MAPS.strokeColour="#758e1b",plenty_admin.MAPS.fillColour="#758e1b",plenty_admin.MAPS.selectedPolygon={},plenty_admin.MAPS.clu_boundaries=[],plenty_admin.MAPS.equipment_pins=[],plenty_admin.MAPS.add_field_state=0,plenty_admin.MAPS.static_maps_url_base="https://maps.googleapis.com/maps/api/staticmap?",plenty_admin.MAPS.api_key="AIzaSyDePtID2AxWnYcPJdCKTZd9b0jRIOrrj4E",plenty_admin.MAPS.add_field=function(a,b,c,d){var e=plenty_admin.MAPS,f={center:b,mapTypeId:google.maps.MapTypeId.HYBRID,zoom:c?c:12,mapTypeControl:!1,streetViewControl:!1};plenty_admin.MAPS.map=e.create_map(a,f),plenty_admin.MAPS.set_on_idle_event(plenty_admin.MAPS.map,function(){console.log("map bounds changed"),plenty_admin.MAPS.show_clu_boundaries(plenty_admin.MAPS.map)}),e.location_search(plenty_admin.MAPS.map,d)},plenty_admin.MAPS.show_clu_boundaries=function(a){var b=a.getBounds(),c=a.getZoom();if(console.log("map bounds: ",b.getNorthEast(),b.getSouthWest()),console.log("map zoom: ",c),0==plenty_admin.MAPS.add_field_state){var d={};d.maxLongitude=b.getNorthEast().F,d.minLongitude=b.getSouthWest().F,d.maxLatitude=b.getNorthEast().A,d.minLatitude=b.getSouthWest().A,plenty_admin.HELPER.showLoadingOverlay(),plenty_admin.REST.fields.getCLUBoundaryPointsForBoundingBox(d,plenty_admin.MAPS.render_CLU_boundaries,a)}},plenty_admin.MAPS.edit_field=function(a){plenty_admin.MAPS;plenty_admin.MAPS.draw_field_on_map(a,"edit-field-map-canvas",{mapTypeId:google.maps.MapTypeId.HYBRID,zoom:12},function(b,c,d){var e=d.getPath();$.extend(a,c),a.boundaries=e,console.log("fieldData",a),plenty_admin.MAPS.showEditFieldForm(a,b,d)},!1,"map")},plenty_admin.MAPS.create_map=function(a,b){return plenty_admin.MAPS.geocoder=new google.maps.Geocoder,google.maps.Polygon.prototype.getBounds=function(){for(var a,b=new google.maps.LatLngBounds,c=this.getPaths(),d=0;d<c.getLength();d++){a=c.getAt(d);for(var e=0;e<a.getLength();e++)b.extend(a.getAt(e))}return b},new google.maps.Map(document.getElementById(a),b)},plenty_admin.MAPS.set_on_idle_event=function(a,b){google.maps.event.addListener(a,"idle",b)},plenty_admin.MAPS.set_on_click_event=function(a,b){google.maps.event.addListener(a,"click",b),google.maps.event.addListener(a,"dragstart",b)},plenty_admin.MAPS.render_CLU_boundaries=function(a,b){console.log("render_CLU_boundaries: ",a,b),plenty_admin.MAPS.hide_clu_polygons();for(var c=0;c<a.length;c++){var d=a[c];plenty_admin.MAPS.draw_CLU_polygon(d,!0,null,b)}plenty_admin.HELPER.hideLoadingOverlay()},plenty_admin.MAPS.add_field_control=function(a){function b(a,b){plenty_admin.MAPS.addFieldUI=document.createElement("div"),plenty_admin.MAPS.addFieldUI.className="addFieldMapCtrl",plenty_admin.MAPS.addFieldUI.style.backgroundColor="#fff",plenty_admin.MAPS.addFieldUI.style.border="2px solid #fff",plenty_admin.MAPS.addFieldUI.style.borderRadius="3px",plenty_admin.MAPS.addFieldUI.style.boxShadow="0 2px 6px rgba(0,0,0,.3)",plenty_admin.MAPS.addFieldUI.style.cursor="pointer",plenty_admin.MAPS.addFieldUI.style.marginTop="6px",plenty_admin.MAPS.addFieldUI.style.marginRight="6px",plenty_admin.MAPS.addFieldUI.style.textAlign="center",plenty_admin.MAPS.addFieldUI.title="Add Field",a.appendChild(plenty_admin.MAPS.addFieldUI),plenty_admin.MAPS.addFieldText=document.createElement("div"),plenty_admin.MAPS.addFieldText.style.color="#0094de",plenty_admin.MAPS.addFieldText.style.fontFamily="ff-enzo-web,Helvetica,Arial,sans-serif",plenty_admin.MAPS.addFieldText.style.fontSize="16px",plenty_admin.MAPS.addFieldText.style.lineHeight="20px",plenty_admin.MAPS.addFieldText.style.paddingLeft="5px",plenty_admin.MAPS.addFieldText.style.paddingRight="5px",plenty_admin.MAPS.addFieldText.innerHTML="Add Field",plenty_admin.MAPS.addFieldUI.appendChild(plenty_admin.MAPS.addFieldText),google.maps.event.addDomListener(plenty_admin.MAPS.addFieldUI,"click",function(a){var c=$(a.target);"on"==c.data("state")?(c.data("state","off"),plenty_admin.MAPS.addFieldUI.style.backgroundColor="#fff",plenty_admin.MAPS.addFieldText.style.color="#0094de",plenty_admin.MAPS.infoWindow&&plenty_admin.MAPS.infoWindow.close(),plenty_admin.MAPS.selected_clu_polygon=null,plenty_admin.MAPS.add_field_state=1,plenty_admin.MAPS.hide_clu_polygons()):(c.data("state","on"),plenty_admin.MAPS.addFieldUI.style.backgroundColor="#0094de",plenty_admin.MAPS.addFieldText.style.color="#fff",plenty_admin.MAPS.mainMap.getZoom()<plenty_admin.UI.map.minCLUZoom&&plenty_admin.MAPS.mainMap.setZoom(plenty_admin.UI.map.minCLUZoom),plenty_admin.MAPS.add_field_state=0,plenty_admin.MAPS.show_clu_boundaries(b),plenty_admin.MAPS.set_on_idle_event(b,function(){plenty_admin.MAPS.show_clu_boundaries(b)}))})}{var c=document.createElement("div");new b(c,plenty_admin.MAPS.mainMap)}c.index=1,a.controls[google.maps.ControlPosition.TOP_RIGHT].push(c)},plenty_admin.MAPS.add_zoom_to_fields_control=function(a){function b(a){var b=document.createElement("div");b.style.backgroundColor="#fff",b.style.border="2px solid #fff",b.style.borderRadius="3px",b.style.boxShadow="0 2px 6px rgba(0,0,0,.3)",b.style.cursor="pointer",b.style.marginTop="6px",b.style.marginRight="6px",b.style.textAlign="center",b.title="All Fields",a.appendChild(b);var c=document.createElement("div");c.style.color="#0094de",c.style.fontFamily="ff-enzo-web,Helvetica,Arial,sans-serif",c.style.fontSize="16px",c.style.lineHeight="20px",c.style.paddingLeft="5px",c.style.paddingRight="5px",c.innerHTML="All Fields",b.appendChild(c),google.maps.event.addDomListener(b,"click",function(){plenty_admin.MAPS.mainMap.fitBounds(plenty_admin.UI.map.latlngbounds)})}{var c=document.createElement("div");new b(c,a)}c.index=2,a.controls[google.maps.ControlPosition.TOP_RIGHT].push(c)},plenty_admin.MAPS.add_map_legend=function(a,b){var c=document.createElement("ul");c.setAttribute("id","map_legend"),console.log("legendItems",b,Object.keys(b).length),Object.keys(b).length>0&&(a.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(c),plenty_admin.MAPS.legend=$("#map_legend"),plenty_admin.MAPS.update_map_legend(b))},plenty_admin.MAPS.update_map_legend=function(a){plenty_admin.MAPS.legend.html("");for(cropTypeKey in a)if(a.hasOwnProperty(cropTypeKey)){legendItem=a[cropTypeKey];var b=document.createElement("li");b.setAttribute("class","legend_item"),b.innerHTML="<div class='legend_swatch' style='background-color:"+legendItem.colour+"'></div> "+legendItem.label,plenty_admin.MAPS.legend.append(b)}plenty_admin.MAPS.legendItems=a},plenty_admin.MAPS.get_polygon_area=function(a){var b=24711e-8*google.maps.geometry.spherical.computeArea(a.getPath());return console.log("area",b),b.toFixed(2)},plenty_admin.MAPS.drawingManager={selectedShape:null,acresField:null,acreage:null,centerPoint:null,
that:this,MAPS:plenty_admin.MAPS,clearSelection:function(){var a=plenty_admin.MAPS.drawingManager;a.selectedShape&&(a.selectedShape.setEditable(!1),a.selectedShape=null)},setSelection:function(a){var b=plenty_admin.MAPS.drawingManager;b.clearSelection(),selectedShape=a,a.setEditable(!0),google.maps.event.addListener(a.getPath(),"set_at",function(){MAPS.selectedPolygon.acreage=plenty_admin.MAPS.get_polygon_area(a),b.acresField.val(MAPS.selectedPolygon.acreage)})},deleteSelectedShape:function(){var a=plenty_admin.MAPS.drawingManager;a.selectedShape&&a.selectedShape.setMap(null)},init:function(a){var b=plenty_admin.MAPS,c=b.drawingManager;c.drawingManager=new google.maps.drawing.DrawingManager({drawingMode:google.maps.drawing.OverlayType.POLYGON,drawingControl:!0,drawingControlOptions:{position:google.maps.ControlPosition.BOTTOM_LEFT,drawingModes:[google.maps.drawing.OverlayType.POLYGON,google.maps.drawing.OverlayType.RECTANGLE]},polygonOptions:{fillColor:plenty_admin.MAPS.fillColour,strokeColor:plenty_admin.MAPS.strokeColour,fillOpacity:.5,strokeWeight:2,clickable:!1,editable:!0,zIndex:1},rectangleOptions:{fillColor:plenty_admin.MAPS.fillColour,strokeColor:plenty_admin.MAPS.strokeColour,fillOpacity:.5,strokeWeight:2,clickable:!1,editable:!0,zIndex:1}}),c.drawingManager.setMap(a),google.maps.event.addListener(c.drawingManager,"overlaycomplete",function(d){if(c.drawingManager.setDrawingMode(null),d.type==google.maps.drawing.OverlayType.POLYGON){var e=d.overlay;e.type=d.type,google.maps.event.addListener(e,"click",function(){console.log("clicked the polygon"),that.setSelection(e),plenty_admin.MAPS.openInfoWindow(b.selectedPolygon.centerPoint,a)});var f=e.getPath(),g=google.maps.geometry.spherical.computeArea(f);b.selectedPolygon.acreage=g.toFixed(2),c.setSelection(e),b.selectedPolygon.centerPoint=plenty_admin.MAPS.get_polygon_center(f),console.log("MAPS.selectedPolygon.centerPoint: ",b.selectedPolygon.centerPoint),b.showAddFieldForm(g,d,a)}})}},plenty_admin.MAPS.get_polygon_center=function(a){var b=new google.maps.LatLngBounds;return a.forEach(function(a){b.extend(a)}),b.getCenter()},plenty_admin.MAPS.geocode=function(a,b){var c=new google.maps.Geocoder;c.geocode({address:a},function(a,c){console.log("geocode: ",a,c),c==google.maps.GeocoderStatus.OK?b&&"function"==typeof b&&b(a):console.warn("Geocoder failed due to: "+c)})},plenty_admin.MAPS.draw_CLU_polygon=function(a,b,c,d){var e=[];a.cluBoundaryPoins.forEach(function(a){e.push(new google.maps.LatLng(a.latitude,a.longitude))});var f=new google.maps.Polygon({paths:e,fillColor:"rgb(255,255,255)",strokeColor:"rgb(255,255,255)",strokeOpacity:0,strokeWeight:2,fillOpacity:0,editable:!1});return f.id=a.cluBoundary.id,google.maps.event.addListener(f,"mouseover",function(){this.setOptions({strokeOpacity:.6,fillOpacity:.35})}),plenty_admin.MAPS.selectedPolygon.clu_mouseout=google.maps.event.addListener(f,"mouseout",function(){this.setOptions({strokeOpacity:0,fillOpacity:0})}),google.maps.event.addListener(f,"click",function(){plenty_admin.MAPS.infoWindow&&plenty_admin.MAPS.infoWindow.close(),this.setOptions({strokeOpacity:.6,fillOpacity:.35}),plenty_admin.MAPS.suggest_clu_field(f,d)}),f.setMap(d),plenty_admin.MAPS.clu_boundaries.push(f),f},plenty_admin.MAPS.draw_pin=function(a,b,c){var d=a.equipmentTypeIds[0].name.toLowerCase().replace(/ /g,"-"),e=plenty_admin.UI.fontIconClasses.indexOf(d)>-1?d:"unknown",f=new RichMarker({position:a.latlng,map:c,anchor:RichMarkerPosition.BOTTOM,flat:!0,draggable:!0,content:'<div class="marker" data-id="'+a.id+'" style="background:transparent url(img/map-markers/bg.svg) no-repeat 0 0"><i class="pif pif-'+e+'"></i><div>'});return b.onMouseOver&&google.maps.event.addListener(f,"mouseover",b.onMouseOver),b.onMouseOut&&google.maps.event.addListener(f,"mouseout",b.onMouseOut),b.onClick&&google.maps.event.addListener(f,"click",b.onClick),b.onDoubleClick&&google.maps.event.addListener(f,"dblclick",b.onDoubleClick),b.onDragEnd&&google.maps.event.addListener(f,"dragend",b.onDragEnd),google.maps.event.addListener(f,"ready",function(){{var a=this;setTimeout(function(){$(a.markerContent_).find(".marker").addClass("in")},10)}}),f.id=a.id,plenty_admin.MAPS.equipment_pins.push(f),f},plenty_admin.MAPS.draw_polygon=function(a,b,c,d){var e=[];a.isCoords?e=a.boundaries:a.boundaries.forEach(function(a){e.push(new google.maps.LatLng(a.latitude,a.longitude))});var f=a.fillColor?a.fillColor:plenty_admin.MAPS.legendItems&&a.cropType?plenty_admin.MAPS.legendItems[a.cropType.replace(/ /g,"")].colour:plenty_admin.MAPS.strokeColour,g=a.strokeColor?a.strokeColor:plenty_admin.MAPS.legendItems&&a.cropType?plenty_admin.MAPS.legendItems[a.cropType.replace(/ /g,"")].colour:plenty_admin.MAPS.strokeColour,h=new google.maps.Polygon({paths:e,fillColor:f,strokeColor:g,strokeOpacity:.8,strokeWeight:2,fillOpacity:.35,editable:a.editable,title:a.fieldName,name:a.fieldName});return a.fieldId&&(h.id=a.fieldId),a.fieldName&&(h.name=a.fieldName),a.cropType&&(h.cropType=a.cropType),google.maps.event.addListener(h,"set_at",b.onEdit?b.onEdit:function(){}),google.maps.event.addListener(h,"insert_at",b.onEdit?b.onEdit:function(){}),google.maps.event.addListener(h,"mouseover",b.onMouseOver?b.onMouseOver:function(){}),google.maps.event.addListener(h,"mouseout",b.onMouseOut?b.onMouseOut:function(){}),google.maps.event.addListener(h,"click",b.onClick?b.onClick:function(){}),google.maps.event.addListener(h,"rightclick",b.onRightClick?b.onRightClick:function(){}),google.maps.event.addListener(h,"dblclick",b.onDoubleClick?b.onDoubleClick:function(){}),h.removePolygon=function(){this.setMap(null)},a.isCluster?(lastPath=null,lastCenter=null,h.getPosition=function(){var a=this.getPath();if(lastPath==a)return lastCenter;lastPath=a;var b=new google.maps.LatLngBounds;return a.forEach(function(a){b.extend(a)}),lastCenter=b.getCenter(),lastCenter}):h.setMap(c),(null===d||d)&&plenty_admin.UI.map.filtered_field_polygons.push(h),h},plenty_admin.MAPS.zoomToPolygon=function(a,b){b.fitBounds(a.getBounds())},plenty_admin.MAPS.getBoundsZoomLevel=function(a,b){function c(a){var b=Math.sin(a*Math.PI/180),c=Math.log((1+b)/(1-b))/2;return Math.max(Math.min(c,Math.PI),-Math.PI)/2}function d(a,b,c){return Math.floor(Math.log(a/b/c)/Math.LN2)}var e={height:256,width:256},f=21,g=a.getNorthEast(),h=a.getSouthWest(),i=(c(g.lat())-c(h.lat()))/Math.PI,j=g.lng()-h.lng(),k=(0>j?j+360:j)/360,l=d(b.height,e.height,i),m=d(b.width,e.width,k);return Math.min(l,m,f)},plenty_admin.MAPS.get_static_maps_url=function(a){var b=plenty_admin.MAPS.static_maps_url_base;for(param in a)a.hasOwnProperty(param)&&(b+=param+"="+a[param]+"&");return b+="key="+plenty_admin.MAPS.api_key},plenty_admin.MAPS.draw_field_on_map=function(a,b,c,d,e,f){console.log("draw_field_on_map: ",a,c);new google.maps.LatLng(a.latitude,a.longitude);if(a.boundaries){plenty_admin.MAPS[f]=plenty_admin.MAPS.create_map(b,c),a.editable=e;var g={onEdit:function(){var a=plenty_admin.MAPS.get_polygon_area(h);plenty_admin.MAPS.infoWindowContent.find("#edit_field_acres").val(a)}},h=plenty_admin.MAPS.draw_polygon(a,g,plenty_admin.MAPS[f],c.pushPoly);plenty_admin.MAPS.zoomToPolygon(h,plenty_admin.MAPS[f]),google.maps.event.trigger(plenty_admin.MAPS[f],"resize"),d&&"function"==typeof d&&d(plenty_admin.MAPS[f],a,h)}else plenty_admin.REST.fields.getAllBoundaryPointsByFieldAndBoundaryType(a.id,1,function(g){console.log("got boundaries for field: ",g),plenty_admin.MAPS[f]=plenty_admin.MAPS.create_map(b,c),a.boundaries=g,a.editable=e;var h={onEdit:function(){var a=plenty_admin.MAPS.get_polygon_area(i);plenty_admin.MAPS.infoWindowContent.find("#edit_field_acres").val(a)}},i=plenty_admin.MAPS.draw_polygon(a,h,plenty_admin.MAPS[f],c.pushPoly);plenty_admin.MAPS.zoomToPolygon(i,plenty_admin.MAPS[f]),d&&"function"==typeof d&&d(plenty_admin.MAPS.map,a,i)});return a},plenty_admin.MAPS.processPoints=function(a,b,c){a instanceof google.maps.LatLng?b.call(c,a):a instanceof google.maps.Data.Point?b.call(c,a.get()):a.getArray().forEach(function(a){processPoints(a,b,c)})},plenty_admin.MAPS.openInfoWindow=function(a,b){plenty_admin.MAPS.infoWindow.setContent(plenty_admin.MAPS.infoWindowContent),plenty_admin.MAPS.infoWindow.setPosition(a),plenty_admin.MAPS.infoWindow.open(b)},plenty_admin.MAPS.show_equipment_pin_context_menu=function(a,b){console.log("show_equipment_pin_context_menu",a,b),plenty_admin.MAPS.infoWindow&&plenty_admin.MAPS.infoWindow.close(),plenty_admin.MAPS.infoWindow=new google.maps.InfoWindow,$.get("ajax/equipment_pin_context.html",function(c){plenty_admin.MAPS.infoWindowContent=c,google.maps.event.addListener(plenty_admin.MAPS.infoWindow,"domready",function(){plenty_admin.MAPS.infoWindowContent=$(".context-menu"),plenty_admin.MAPS.infoWindowContent.find(".delete_equipment a").click(function(){return plenty_admin.MAPS.delete_fixed_equipment(a,ev),!1}).end().find(".view_equipment_details a").click(function(){return plenty_admin.UI.field.show_equipment_modal(a),!1})}),plenty_admin.MAPS.openInfoWindow(b.position,plenty_admin.MAPS.mainMap)})},plenty_admin.MAPS.show_polygon_context_menu=function(a,b,c,d){plenty_admin.MAPS.infoWindow&&plenty_admin.MAPS.infoWindow.close(),plenty_admin.MAPS.infoWindow=new google.maps.InfoWindow,$.get("ajax/"+c+".html",function(e){plenty_admin.MAPS.infoWindowContent=e,google.maps.event.addListener(plenty_admin.MAPS.infoWindow,"domready",function(){switch(plenty_admin.MAPS.infoWindowContent=$(".context-menu"),c){case"map_context_menu":plenty_admin.MAPS.infoWindowContent.find(".edit_field a").click(function(){return plenty_admin.MAPS.infoWindow&&plenty_admin.MAPS.infoWindow.close(),plenty_admin.MAPS.zoomToPolygon(d,b),plenty_admin.MAPS.showEditFieldForm(a,b,d),!1}).end().find(".insert_equipment a").click(function(){return plenty_admin.MAPS.add_fixed_equipment(a,b),!1}).end().find(".view_field a").click(function(){plenty_admin.HELPER.showLoadingOverlay();var a=[];return d.getPath().getArray().forEach(function(b,c){var d={latitude:b.lat(),longitude:b.lng(),seqNumber:c};a.push(d)}),plenty_admin.REST.fields.getFieldById(d.id,function(b){b.fillColor=d.fillColor,b.strokeColor=d.strokeColor,b.boundaries=a,b.isCoords=!1;var c=[{"class":"back",name:"Map",clickHandler:function(){return plenty_admin.UI.currentScreen.fadeOut("normal",function(){plenty_admin.UI.field.clear(),plenty_admin.UI.currentScreen=plenty_admin.UI.map.DOM,plenty_admin.UI.currentScreen.closest(".fill-area").fadeIn("normal").parent().find(".filter_controls").fadeIn("fast",function(){google.maps.event.trigger(plenty_admin.MAPS.mainMap,"resize"),plenty_admin.MAPS.mainMap.fitBounds(plenty_admin.UI.map.latlngbounds)})}),!1}},{"class":"active",name:b.name,clickHandler:null}];plenty_admin.UI.field.DOM.find(".breadcrumb-trail").remove().end().prepend(plenty_admin.UI.build_breadcrumb_trail(c)),plenty_admin.UI.field.init(b,"map")}),!1})}});var f=new google.maps.LatLng(a.rc_lat,a.rc_lng);plenty_admin.MAPS.openInfoWindow(f,plenty_admin.MAPS.mainMap)})},plenty_admin.MAPS.delete_field_equipment=function(a,b){plenty_admin.MAPS.infoWindow&&plenty_admin.MAPS.infoWindow.close(),plenty_admin.MAPS.infoWindow=new google.maps.InfoWindow,$.get("ajax/delete-field-equipment.html",function(c){plenty_admin.MAPS.infoWindowContent=c,google.maps.event.addListener(plenty_admin.MAPS.infoWindow,"domready",function(){plenty_admin.MAPS.infoWindowContent=$(".updateEquipment"),plenty_admin.MAPS.infoWindowContent.find("button.disassociate").click(function(){return plenty_admin.REST.deleteFieldEquipment["delete"](a.fieldEquipmentDto.id).then(function(a){console.log("field equipment deleted: ",a)},function(){bootbox.dialog({message:"disassociating a field failed due to a server error",className:"danger",buttons:{danger:{label:"OK",className:"btn-danger",callback:plenty_admin.HELPER.hideLoadingOverlay}}});var b=plenty_admin.MAPS.get_pin_from_array(a);b.marker.setPosition(a.latlng)}),plenty_admin.MAPS.infoWindow.close(),!1}).end().find("button.cancel").click(function(){var b=plenty_admin.MAPS.get_pin_from_array(a);return b.marker.setPosition(a.latlng),plenty_admin.MAPS.infoWindow.close(),!1}).end().find(".name").text(a.name)}),plenty_admin.MAPS.openInfoWindow(b.position,plenty_admin.MAPS.mainMap)})},plenty_admin.MAPS.update_fixed_equipment_position=function(a,b){console.log("update_fixed_equipment_position - pinData: ",a),plenty_admin.MAPS.infoWindow&&plenty_admin.MAPS.infoWindow.close(),plenty_admin.MAPS.infoWindow=new google.maps.InfoWindow,$.get("ajax/update-equipment-position.html",function(c){plenty_admin.MAPS.infoWindowContent=c,google.maps.event.addListener(plenty_admin.MAPS.infoWindow,"closeclick",function(){var b=plenty_admin.MAPS.get_pin_from_array(a);b.marker.setPosition(a.latlng)}),google.maps.event.addListener(plenty_admin.MAPS.infoWindow,"domready",function(){plenty_admin.MAPS.infoWindowContent=$(".updateEquipment"),plenty_admin.MAPS.infoWindowContent.find("button.save").click(function(){var c=plenty_admin.MAPS.get_pin_from_array(a),d=a;return d.latitude=b.position.A,d.longitude=b.position.F,delete d.latlng,console.log("equipmentDto",d),plenty_admin.REST.updateEquipment.post(d).then(function(a){console.log("equipment updated: ",a),c.marker.setMap(null),plenty_admin.MAPS.equipment_pins.splice(c.iconIndex,1),plenty_admin.UI.map.add_equipment_to_map()}),plenty_admin.MAPS.infoWindow.close(),!1}).end().find("button.cancel").click(function(){var b=plenty_admin.MAPS.get_pin_from_array(a);return b.marker.setPosition(a.latlng),plenty_admin.MAPS.infoWindow.close(),!1}).end().find(".lat").text(b.position.A).end().find(".lng").text(b.position.F).end().find(".name").text(a.name)}),plenty_admin.MAPS.openInfoWindow(b.position,plenty_admin.MAPS.mainMap)})},plenty_admin.MAPS.get_pin_from_array=function(a){var b=null;return $.grep(plenty_admin.MAPS.equipment_pins,function(c,d){a.id===$(c.markerContent_).find(".marker").data("id")&&(b=d)}),{marker:plenty_admin.MAPS.equipment_pins[b],iconIndex:b}},plenty_admin.MAPS.update_fixed_equipment_position_and_change_field=function(a,b,c){console.log("update_fixed_equipment_position_and_change_field - pinData: ",a),plenty_admin.MAPS.infoWindow&&plenty_admin.MAPS.infoWindow.close(),plenty_admin.MAPS.infoWindow=new google.maps.InfoWindow,google.maps.event.addListener(plenty_admin.MAPS.infoWindow,"closeclick",function(){var b=plenty_admin.MAPS.get_pin_from_array(a);b.marker.setPosition(a.latlng)}),$.get("ajax/change-equipment-position-and-field.html",function(d){plenty_admin.MAPS.infoWindowContent=d,google.maps.event.addListener(plenty_admin.MAPS.infoWindow,"domready",function(){plenty_admin.MAPS.infoWindowContent=$(".updateEquipment"),plenty_admin.MAPS.infoWindowContent.find("button.save").click(function(){var d=plenty_admin.MAPS.get_pin_from_array(a),e=a;e.latitude=c.position.A,e.longitude=c.position.F,delete e.latlng,console.log("equipmentDto",e),plenty_admin.DATA.eventCollector=window.eventcollector(2,1e4),plenty_admin.REST.updateEquipment.post(e).then(function(a){console.log("equipment updated: ",a),plenty_admin.DATA.eventCollector.done("event 1")});var f=a.fieldEquipmentDto;return f.fieldId=b.id,plenty_admin.REST.updateFieldEquipment.post(f).then(function(a){console.log("field equipment updated: ",a),plenty_admin.DATA.eventCollector.done("event 2")}),plenty_admin.DATA.eventCollector.on("alldone",function(){$(d.marker.markerWrapper_).remove(),plenty_admin.MAPS.equipment_pins.splice(d.iconIndex,1),plenty_admin.UI.map.add_equipment_to_map(),plenty_admin.MAPS.infoWindow.close()}),!1}).end().find("button.cancel").click(function(){var b=null;return $.grep(plenty_admin.MAPS.equipment_pins,function(c,d){a.id===c.id&&(b=d)}),plenty_admin.MAPS.equipment_pins[b].setPosition(a.latlng),plenty_admin.MAPS.infoWindow.close(),!1}).end().find(".lat").text(c.position.A).end().find(".lng").text(c.position.F).end().find(".equipment_name").text(a.name).end().find(".field_name").text(b.name)}),plenty_admin.MAPS.openInfoWindow(c.position,plenty_admin.MAPS.mainMap)})},plenty_admin.MAPS.add_fixed_equipment=function(a,b){plenty_admin.MAPS.infoWindow&&plenty_admin.MAPS.infoWindow.close(),plenty_admin.MAPS.infoWindow=new google.maps.InfoWindow,$.get("ajax/add-equipment-form.html",function(c){plenty_admin.MAPS.infoWindowContent=c,google.maps.event.addListener(plenty_admin.MAPS.infoWindow,"domready",function(){plenty_admin.MAPS.infoWindowContent=$("form.equipments");var b=plenty_admin.MAPS.infoWindowContent.find("#add_equipment_type");b.find("option").remove();var c="";for(id in plenty_admin.DATA.equipmentTypes)if(plenty_admin.DATA.equipmentTypes.hasOwnProperty(id)){var d=plenty_admin.DATA.equipmentTypes[id];c+="<option value='"+id+"'>"+d.name+"</option>"}b.append(c);var e=plenty_admin.MAPS.infoWindowContent.find("#add_equipment_brand");e.find("option").remove();var f="";for(index in plenty_admin.DATA.brandTypes)if(plenty_admin.DATA.brandTypes.hasOwnProperty(index)){var g=plenty_admin.DATA.brandTypes[index];f+="<option value='"+g.id+"'>"+g.name+"</option>"}e.append(f);var h=plenty_admin.MAPS.infoWindowContent.find("#add_equipment_orgs");h.find("option").remove();for(var i="",j=0;j<plenty_admin.DATA.userFilters.possibleFilteringEntitiesDtoList.organizations.length;j++){var k=plenty_admin.DATA.userFilters.possibleFilteringEntitiesDtoList.organizations[j];i+="<option value='"+k.id+"'>"+k.name+"</option>"}h.append(i).on("change",function(){console.log("changed org: ",$(this).val()),plenty_admin.MAPS.infoWindowContent.find(".platformServices").find(".ps_org").hide().end().find(".ps_org_"+$(this).val()).show()});var l={};plenty_admin.REST.fields.getPlatformServicesForFilter(function(a){for(var b=0;b<a.length;b++){var c=a[b];l[c.organizationId]?l[c.organizationId].push(c):l[c.organizationId]=[c]}var d="",e=0;for(id in l)if(l.hasOwnProperty(id)){var f=l[id];if(console.log("_ps",f),1==f.length)d+="<input type='text' readonly class='form-control ps_org ps_org_"+f[0].organizationId+"'"+(0===e?"":" style='display:none;'")+" data-id='"+id+"'",d+=" value='"+f[0].name+"'",d+=">";else{d+="<select class='form-control equipment_platform_service ps_org ps_org_"+id+"'"+(0===e?"":" style='display:none;'")+" required placeholder='Choose a platform service'>";for(var g=0;g<f.length;g++){var h=f[g];d+="<option value='"+h.id+"'>"+h.name+"</option>"}d+="</select>"}e+=1}plenty_admin.MAPS.infoWindowContent.find(".platformServices").append(d)}),plenty_admin.MAPS.infoWindowContent.find("#add_equipment_latitude").val(a.rc_lat).end().find("#add_equipment_longitude").val(a.rc_lng).end().find("button.add-equipment").click(function(){var b=$(this);b.button("loading");var c={};return c.equipmentName=plenty_admin.MAPS.infoWindowContent.find("input#add_equipment_name").val(),c.equipmentTypeIds=[],plenty_admin.MAPS.infoWindowContent.find("select#add_equipment_type option:selected").each(function(){c.equipmentTypeIds.push(parseInt($(this).val()))}),c.latitude=a.rc_lat,c.longitude=a.rc_lng,c.fieldId=parseInt(a.id),c.brandId=parseInt(e.val()),c.organizationId=parseInt(h.val()),c.platformServiceId=parseInt(plenty_admin.MAPS.infoWindowContent.find(".platformServices option:selected").val()),console.log("equipmentObj",c),plenty_admin.REST.insertFieldEquipment.post(c).then(function(a){console.log("added new equipment:",a),plenty_admin.MAPS.infoWindowContent.fadeOut("fast",function(){plenty_admin.MAPS.infoWindowContent.parent().find(".add_equipment_success_wrapper").fadeIn("fast"),plenty_admin.UI.map.add_equipment_to_map()})},function(){b.button("reset")}),!1}).end().parent().find("button.finish").click(function(){return plenty_admin.MAPS.infoWindow.close(),!1}).end().find("button.cancel").click(function(){return plenty_admin.MAPS.infoWindow.close(),!1}).end().find("button.newEquipment").click(function(){return plenty_admin.MAPS.infoWindowContent.parent().find(".add_equipment_success_wrapper").fadeOut("fast",function(){plenty_admin.MAPS.infoWindowContent.fadeIn("fast")}),!1})});var d=new google.maps.LatLng(a.rc_lat,a.rc_lng);plenty_admin.MAPS.openInfoWindow(d,b)})},plenty_admin.MAPS.showEditFieldForm=function(a,b,c){function d(){return c.setOptions({editable:!0}),plenty_admin.MAPS.infoWindowContent.hide().parent().find(".editing_boundary").show(),plenty_admin.MAPS.hide_polygons(plenty_admin.UI.map.filtered_field_polygons,c.id),plenty_admin.MAPS.hide_equipment(plenty_admin.MAPS.equipment_pins),plenty_admin.MAPS.edit_field_state=1,!1}function e(){plenty_admin.MAPS.infoWindowContent.show().parent().find(".editing_boundary").hide(),c.setOptions({editable:!1}),plenty_admin.MAPS.show_polygons(plenty_admin.UI.map.filtered_field_polygons,b),plenty_admin.MAPS.show_equipment(plenty_admin.MAPS.equipment_pins,b),plenty_admin.MAPS.edit_field_state=0}console.log("showEditFieldForm",a,b),plenty_admin.MAPS.infoWindow=new google.maps.InfoWindow,plenty_admin.MAPS.polygonToEdit=c;var f=(plenty_admin.MAPS,[]);c.getPath().getArray().forEach(function(a){f.push(new google.maps.LatLng(a.lat(),a.lng()))}),$.get("ajax/edit-field-form.html",function(g){plenty_admin.MAPS.infoWindowContent=g,google.maps.event.addListener(plenty_admin.MAPS.infoWindow,"domready",function(){plenty_admin.MAPS.infoWindowContent=$(".edit_field_form_wrapper");var g=plenty_admin.MAPS.infoWindowContent.find("table.cropYears");plenty_admin.REST.get_fieldCrops_order_by_year_descending(a.id,function(i){console.log("get_field_order_by_year_descending: ",i);for(var j={},k=0;k<i.length;k++)fieldCrop=i[k],j[parseInt(fieldCrop.year)]=fieldCrop;a.cropsByYear=j,plenty_admin.MAPS.infoWindowContent.find("input, textarea, checkbox, select").filter(function(){return void 0!=$(this).data("propname")}).each(function(){$(this).val(a[$(this).data("propname")])}).end().end().find(".btn.update-field").click(function(){$(this);plenty_admin.MAPS.infoWindowContent.find("input, textarea, checkbox, select").filter(function(){return void 0!=$(this).data("propname")}).each(function(){a[$(this).data("propname")]=$(this).val()}),$(this).button("loading"),a.latitude=h.A,a.longitude=h.F,a.farmId=parseInt(a.farmId),console.log("fieldObj:",a);var b=plenty_admin.MAPS.infoWindowContent.find("#edit_field_new_farm_name");return b.val().length>0?plenty_admin.REST.insertFarm.post({name:b.val()}).then(function(b){var c=b.body();if(console.log("farmBody:",c),a.farmId=c.id,plenty_admin.UI.organization.updateX(a,"field",$(this),function(){plenty_admin.UI.organization.MODAL_edit_field.modal("hide")}),"settings"===plenty_admin.context){plenty_admin.DATA.data_source.farms.push(c),plenty_admin.UI.updateBadges("farms",plenty_admin.DATA.data_source.farms.length);var d=$(plenty_admin.UI.create_item(c,"farms"));plenty_admin.UI.organization.DOM.find("table.farmsList").find(".noItemsText").remove().end().append(d),plenty_admin.UI.organization.addItemFunctionality(d)}}):plenty_admin.UI.organization.updateX(a,"field",$(this),function(){plenty_admin.UI.organization.MODAL_edit_field.modal("hide")}),!1}).end().find(".btn.cancel").click(function(){return plenty_admin.MAPS.infoWindow.close(),!1}).end().find(".btn.edit-boundary").click(function(){d(),plenty_admin.MAPS.zoomToPolygon(c,b)}).end().parent().find(".btn.save-edited-boundary").click(function(){var a=c.getPath(),b=[];a.forEach(function(a,c){var d={};d.seqNumber=c,d.latitude=a.lat(),d.longitude=a.lng(),b.push(d)});var d={fieldId:c.id,latLongPairs:b};return console.log("boundaryPointsDto",d),plenty_admin.REST.updateBoundaryPointsArray.post(d).then(function(a){console.log("updatedBoundary: ",a().data),e()},function(a){bootbox.dialog({message:"Polygon Edits were not saved! - "+a.status+" - "+a.statusText,className:"danger",buttons:{danger:{label:"OK",className:"btn-danger",callback:function(){plenty_admin.HELPER.hideLoadingOverlay(),c.setPaths(f),e()}}}})}),!1}).end().find(".btn.cancel-editing-boundary").click(function(){return c.setPaths(f),e(),!1}).end().end().find(".showNewFarm").click(function(){return $(this).hide().parent().find(".showExistingFarm").show().end().closest(".form-group").find(".newFarm").show().end().find(".existingFarm").hide(),!1}).end().find(".showExistingFarm").click(function(){return $(this).hide().parent().find(".showNewFarm").show().end().closest(".form-group").find(".existingFarm").show().end().find(".newFarm").hide(),!1}).end().find("button.addCropYear").click(function(){return $(this).hide().parent().find(".saveCropYear, .cancelCropYear").show().end().closest(".tab-pane").find("tr.new-crop-year").show(),!1}).end().find("button.cancelCropYear").click(function(){return $(this).hide().parent().find(".saveCropYear").hide().end().find(".addCropYear").show().end().closest(".tab-pane").find("tr.new-crop-year").hide(),!1}).end().find("button.saveCropYear").click(function(b){var c={fieldId:a.id,cropTypeId:parseInt(plenty_admin.MAPS.infoWindowContent.find("#edit_field_crop_type option:selected").val()),irrigationTypeId:parseInt(plenty_admin.MAPS.infoWindowContent.find("#edit_field_irrigation_type option:selected").val()),tillageTypeId:parseInt(plenty_admin.MAPS.infoWindowContent.find("#edit_field_tillage_type option:selected").val()),year:plenty_admin.MAPS.infoWindowContent.find("#edit_field_crop_year option:selected").val(),growthMethodId:plenty_admin.MAPS.infoWindowContent.find("#edit_field_growthMethod_type option:selected").val()};return plenty_admin.REST.fields.insertFieldCrop(c,function(a){console.log("field crop inserted",a),$(b.target).hide().parent().find(".cancelCropYear").hide().end().find(".addCropYear").show().end().closest(".tab-pane").find("tr.new-crop-year").hide();var c="<tr><td>"+a.year+"</td><td>"+plenty_admin.DATA.cropTypes[a.cropTypeId].name+"</td><td>"+plenty_admin.DATA.tillageTypes[a.tillageTypeId].name+"</td><td>"+plenty_admin.DATA.irrigationTypes[a.irrigationTypeId].name+"</td><td>"+plenty_admin.DATA.growthMethodTypes[a.growthMethodId].name+"</td></tr>";g.find("tbody .new-crop-year").before(c)}),!1});var l=plenty_admin.MAPS.infoWindowContent.find("#edit_field_farms");l.find("option").remove();for(var m="",k=0;k<plenty_admin.DATA.data_source.farms.length;k++){var n=plenty_admin.DATA.data_source.farms[k];m+="<option value='"+n.id+"'>"+n.name+"</option>"}l.append(m);var o=["crop","irrigation","tillage","growthMethod"];plenty_admin.UI.populate_type_lists(plenty_admin.MAPS.infoWindowContent,"edit_field",o);var p="";for(year in a.cropsByYear)if(a.cropsByYear.hasOwnProperty(year)){console.log("fieldData.cropsByYear",a.cropsByYear,year,a.cropsByYear[year]);var q=a.cropsByYear[year],r=[2015,2014,2013,2012,2011,2010,2009,2008,2007,2006,2005];p+="<tr data-id='"+q.id+"'><td class='editable' data-type='select' data-source='"+plenty_admin.UI.get_inline_editing_options(r)+"' data-name='year' data-pk='"+q.id+"/fieldCrop/' data-title='Year'>"+year+"</td><td class='editable' data-type='select' data-source='"+plenty_admin.UI.get_inline_editing_options(plenty_admin.DATA.cropTypes)+"' data-name='cropTypeId' data-pk='"+q.id+"/fieldCrop/"+q.cropTypeId+"/"+q.tillageTypeId+"/"+q.irrigationTypeId+"/"+year+"/"+a.id+"' data-title='Year'>"+plenty_admin.DATA.cropTypes[q.cropTypeId].name+"</td><td class='editable' data-type='select' data-source='"+plenty_admin.UI.get_inline_editing_options(plenty_admin.DATA.tillageTypes)+"' data-name='tillageTypeId' data-pk='"+q.id+"/fieldCrop/"+q.cropTypeId+"/"+q.tillageTypeId+"/"+q.irrigationTypeId+"/"+year+"/"+a.id+"' data-title='Tillage Type'>"+plenty_admin.DATA.tillageTypes[q.tillageTypeId].name+"</td><td class='editable' data-type='select' data-source='"+plenty_admin.UI.get_inline_editing_options(plenty_admin.DATA.irrigationTypes)+"' data-name='irrigationTypeId' data-pk='"+q.id+"/fieldCrop/"+q.cropTypeId+"/"+q.tillageTypeId+"/"+q.irrigationTypeId+"/"+year+"/"+a.id+"' data-title='Irrigation Type'>"+plenty_admin.DATA.irrigationTypes[q.irrigationTypeId].name+"</td><td class='editable' data-type='select' data-source='"+plenty_admin.UI.get_inline_editing_options(plenty_admin.DATA.growthMethodTypes)+"' data-name='growthMethodId' data-pk='"+q.id+"/fieldCrop/"+q.cropTypeId+"/"+q.tillageTypeId+"/"+q.irrigationTypeId+"/"+year+"/"+a.id+"' data-title='Growth Method'>"+plenty_admin.DATA.growthMethodTypes[q.growthMethodId].name+"</td></tr>"}$.fn.editable.defaults.mode="inline",g.find("tbody .new-crop-year").before(p).end().find(".editable").editable(plenty_admin.REST.inline_editing_options)})});var h=plenty_admin.MAPS.get_polygon_center(a.boundaries);plenty_admin.MAPS.openInfoWindow(h,b)})},plenty_admin.MAPS.suggest_clu_field=function(a,b){plenty_admin.MAPS.infoWindow=new google.maps.InfoWindow;var c=plenty_admin.MAPS,d=a.latLngs.getArray()[0].getArray();plenty_admin.MAPS.hide_clu_polygons(a),plenty_admin.MAPS.add_field_state=1,plenty_admin.MAPS.selected_clu_polygon=a,$.get("ajax/use-clu-field.html",function(e){plenty_admin.MAPS.infoWindowContent=e,google.maps.event.addListener(plenty_admin.MAPS.infoWindow,"closeclick",function(){plenty_admin.MAPS.infoWindow.close(),plenty_admin.MAPS.add_field_state=0,plenty_admin.MAPS.selected_clu_polygon=null,a.setOptions({strokeOpacity:0,fillOpacity:0}),plenty_admin.MAPS.selectedPolygon.clu_mouseout=google.maps.event.addListener(a,"mouseout",function(){this.setOptions({strokeOpacity:0,fillOpacity:0})}),"map"===plenty_admin.context?(plenty_admin.MAPS.add_field_state=1,plenty_admin.MAPS.hide_clu_polygons(),plenty_admin.MAPS.addFieldUI.style.backgroundColor="#fff",plenty_admin.MAPS.addFieldText.style.color="#0094de",plenty_admin.UI.map.DOM.find(".addFieldMapCtrl div").data("state","off")):plenty_admin.MAPS.show_clu_polygons()}),google.maps.event.addListener(plenty_admin.MAPS.infoWindow,"domready",function(){plenty_admin.MAPS.infoWindowContent=$(".use_clu_field_options"),google.maps.event.clearListeners(a,"mouseout"),plenty_admin.MAPS.infoWindowContent.find("button.yes").click(function(){plenty_admin.MAPS.add_field_state=2,$(this).button("loading");var a={boundaries:d,editable:!0,isCoords:!0},e={onMouseOver:function(){},onMouseOut:function(){},onEdit:function(){c.selectedPolygon.acreage=plenty_admin.MAPS.get_polygon_area(f);var a=plenty_admin.MAPS.infoWindowContent.find("#add_field_acres");a.val(c.selectedPolygon.acreage)},onClick:function(a){plenty_admin.MAPS.showAddFieldForm(f,a,b)}},f=plenty_admin.MAPS.draw_polygon(a,e,b);return plenty_admin.MAPS.zoomToPolygon(f,b),plenty_admin.MAPS.hide_clu_polygons(),c.selectedPolygon.acreage=plenty_admin.MAPS.get_polygon_area(f),plenty_admin.MAPS.infoWindow.close(),plenty_admin.MAPS.showAddFieldForm(f,event,b),!1}).end().find("button.no").click(function(){return plenty_admin.MAPS.infoWindow.close(),plenty_admin.MAPS.add_field_state=0,plenty_admin.MAPS.selected_clu_polygon=null,a.setOptions({strokeOpacity:0,fillOpacity:0}),plenty_admin.MAPS.selectedPolygon.clu_mouseout=google.maps.event.addListener(a,"mouseout",function(){this.setOptions({strokeOpacity:0,fillOpacity:0})}),"map"===plenty_admin.context?(plenty_admin.MAPS.add_field_state=1,plenty_admin.MAPS.hide_clu_polygons(),plenty_admin.MAPS.addFieldUI.style.backgroundColor="#fff",plenty_admin.MAPS.addFieldText.style.color="#0094de",plenty_admin.UI.map.DOM.find(".addFieldMapCtrl div").data("state","off")):plenty_admin.MAPS.show_clu_polygons(),!1})}),c.selectedPolygon.centerPoint=plenty_admin.MAPS.get_polygon_center(d),plenty_admin.MAPS.openInfoWindow(c.selectedPolygon.centerPoint,b)})},plenty_admin.MAPS.hide_clu_polygons=function(a){for(var b=0;b<plenty_admin.MAPS.clu_boundaries.length;b++){var c=plenty_admin.MAPS.clu_boundaries[b];a?c.id!==a.id&&c.setMap(null):c.setMap(null)}},plenty_admin.MAPS.hide_polygons=function(a,b){for(var c=0;c<a.length;c++){var d=a[c];b?d.id!==b&&d.setMap(null):d.setMap(null)}},plenty_admin.MAPS.show_polygons=function(a,b){for(var c=0;c<a.length;c++){var d=a[c];d.setMap(b)}},plenty_admin.MAPS.hide_equipment=function(a,b){for(var c=0;c<a.length;c++){var d=a[c];b?d.id!==b&&d.setMap(null):d.setMap(null)}},plenty_admin.MAPS.show_equipment=function(a,b){for(var c=0;c<a.length;c++){var d=a[c];d.setMap(b)}},plenty_admin.MAPS.show_clu_polygons=function(){for(var a=0;a<plenty_admin.MAPS.clu_boundaries.length;a++){var b=plenty_admin.MAPS.clu_boundaries[a];

b.setMap(plenty_admin.MAPS.map)}},plenty_admin.MAPS.showAddFieldForm=function(a,b,c){console.log("showAddFieldForm",a);a.getPaths();plenty_admin.MAPS.infoWindow=new google.maps.InfoWindow;{var d=plenty_admin.MAPS;d.drawingManager}d.selectedPolygon.polygon=a,$.get("ajax/add-field-form.html",function(a){plenty_admin.MAPS.infoWindowContent=a,google.maps.event.addListener(plenty_admin.MAPS.infoWindow,"domready",function(){plenty_admin.MAPS.infoWindowContent=$(".add_field.add_to_org_form"),acresField=plenty_admin.MAPS.infoWindowContent.find("#add_field_acres"),acresField.val(d.selectedPolygon.acreage),d.geocoder.geocode({latLng:d.selectedPolygon.centerPoint},function(a,b){if(console.log("reverse geo: ",a,b),b==google.maps.GeocoderStatus.OK)if(a[0]){var c=a[0].address_components[a[0].address_components.length-1].long_name;postcodeField=plenty_admin.MAPS.infoWindowContent.find("#add_field_postalCode"),postcodeField.val(c)}else console.warn("No reverse geo results found");else console.warn("Geocoder failed due to: "+b)}),plenty_admin.MAPS.infoWindowContent.find(".add-field").click(function(){function a(){plenty_admin.MAPS.infoWindowContent.parent().parent().find(".btn.finish").click(function(){switch(plenty_admin.MAPS.infoWindow.close(),plenty_admin.context){case"map":plenty_admin.MAPS.selectedPolygon.polygon.setMap(null),plenty_admin.MAPS.selectedPolygon.polygon=null,plenty_admin.MAPS.add_field_state=1,plenty_admin.MAPS.hide_clu_polygons(),plenty_admin.MAPS.addFieldUI.style.backgroundColor="#fff",plenty_admin.MAPS.addFieldText.style.color="#0094de",plenty_admin.UI.map.DOM.find(".addFieldMapCtrl div").data("state","off");break;case"settings":plenty_admin.UI.organization.MODAL_add_field.modal("hide")}return!1}).end().find(".btn.newField").click(function(){return plenty_admin.MAPS.infoWindow.close(),plenty_admin.MAPS.selectedPolygon.polygon.setMap(null),plenty_admin.MAPS.selectedPolygon.polygon=null,plenty_admin.MAPS.show_clu_polygons(),plenty_admin.MAPS.add_field_state=0,plenty_admin.MAPS.selected_clu_polygon.setOptions({strokeOpacity:0,fillOpacity:0}),google.maps.event.addListener(plenty_admin.MAPS.selected_clu_polygon,"mouseout",function(){this.setOptions({strokeOpacity:0,fillOpacity:0})}),plenty_admin.MAPS.selected_clu_polygon=null,!1}).end().find(".add_field_form_wrapper").fadeOut("fast",function(){plenty_admin.MAPS.infoWindowContent.parent().parent().find(".add_field_success_wrapper").fadeIn("fast")})}var b={},c=plenty_admin.MAPS.infoWindowContent.find("#add_field_new_farm_name");return plenty_admin.MAPS.infoWindowContent.find("input, textarea, checkbox, select").filter(function(){return void 0!=$(this).data("propname")}).each(function(){b[$(this).data("propname")]=$(this).val()&&void 0!=$(this).val()?$(this).val():1}),$(this).button("loading"),b.latitude=d.selectedPolygon.centerPoint.A,b.longitude=d.selectedPolygon.centerPoint.F,console.log("fieldObj:",b),console.log("newFarmField:",c,c.val().length),c.val().length>0?plenty_admin.REST.insertFarm.post({name:c.val()}).then(function(c){var d=c.body();if(console.log("farmBody:",d),b.farmId=d.id,plenty_admin.REST.fields.insertFieldWithInterestAndBoundaryPoints(b,100,a),plenty_admin.DATA.data_source.farms.push(d),"settings"===plenty_admin.context){plenty_admin.UI.updateBadges("farms",plenty_admin.DATA.data_source.farms.length);var e=$(plenty_admin.UI.create_item(d,"farms"));plenty_admin.UI.organization.DOM.find("table.farmsList").find(".noItemsText").remove().end().append(e),plenty_admin.UI.organization.addItemFunctionality(e)}else"map"===plenty_admin.context&&plenty_admin.DATA.update_filters(function(a){plenty_admin.DATA.userFilters=a.body()},null,!1)}):plenty_admin.REST.fields.insertFieldWithInterestAndBoundaryPoints(b,100,a),!1}).end().find(".cancel").click(function(){return plenty_admin.MAPS.infoWindow.close(),plenty_admin.MAPS.selectedPolygon.polygon.setMap(null),plenty_admin.MAPS.selectedPolygon.polygon=null,plenty_admin.MAPS.show_clu_polygons(),plenty_admin.MAPS.add_field_state=0,plenty_admin.MAPS.selected_clu_polygon.setOptions({strokeOpacity:0,fillOpacity:0}),google.maps.event.addListener(plenty_admin.MAPS.selected_clu_polygon,"mouseout",function(){this.setOptions({strokeOpacity:0,fillOpacity:0})}),plenty_admin.MAPS.selected_clu_polygon=null,"map"===plenty_admin.context?(plenty_admin.MAPS.add_field_state=1,plenty_admin.MAPS.hide_clu_polygons(),plenty_admin.MAPS.addFieldUI.style.backgroundColor="#fff",plenty_admin.MAPS.addFieldText.style.color="#0094de",plenty_admin.UI.map.DOM.find(".addFieldMapCtrl div").data("state","off")):plenty_admin.MAPS.show_clu_polygons(),!1}).end().find(".showNewFarm").click(function(){return $(this).hide().parent().find(".showExistingFarm").show().end().closest(".form-group").find(".newFarm").show().end().find(".existingFarm").hide(),!1}).end().find(".showExistingFarm").click(function(){return $(this).hide().parent().find(".showNewFarm").show().end().closest(".form-group").find(".existingFarm").show().end().find(".newFarm").hide(),!1});var a=plenty_admin.MAPS.infoWindowContent.find("#add_field_farms");a.find("option").remove();for(var b="",c=0;c<plenty_admin.DATA.data_source.farms.length;c++){var e=plenty_admin.DATA.data_source.farms[c];b+="<option value='"+e.id+"'>"+e.name+"</option>"}if(a.append(b),plenty_admin.DATA.data_source.farms.length<=0&&plenty_admin.MAPS.infoWindowContent.find(".showNewFarm").trigger("click"),plenty_admin.DATA.data_source.organizations)for(var f="",g=0;g<plenty_admin.DATA.data_source.organizations.length;g++){var h=plenty_admin.DATA.data_source.organizations[g];f+="<option value='"+h.id+"'>"+h.name+"</option>"}else f+="<option value='"+plenty_admin.DATA.data_source.id+"'>"+plenty_admin.DATA.data_source.name+"</option>";var i=plenty_admin.MAPS.infoWindowContent.find("#add_field_org_interest");i.append(f);for(var j=["crop","irrigation","tillage"],k=0;k<j.length;k++){if(plenty_admin.DATA[j[k]+"Types"]){var l="";for(id in plenty_admin.DATA[j[k]+"Types"])if(plenty_admin.DATA[j[k]+"Types"].hasOwnProperty(id)){var m=plenty_admin.DATA[j[k]+"Types"][id];l+="<option value='"+id+"'>"+m.name+"</option>"}}var n=plenty_admin.MAPS.infoWindowContent.find("#add_field_"+j[k]);n.append(l)}if(plenty_admin.DATA.growthMethods){var l="";for(id in plenty_admin.DATA.growthMethods)if(plenty_admin.DATA.growthMethods.hasOwnProperty(id)){var m=plenty_admin.DATA.growthMethods[id];l+="<option value='"+id+"'>"+m.name+"</option>"}}var n=plenty_admin.MAPS.infoWindowContent.find("#add_field_growthMethod");n.append(l),"map"===plenty_admin.context&&i.find("option").length>1?i.closest(".form-group").show():i.find("option:eq(0)").prop("selected",!0)}),plenty_admin.MAPS.openInfoWindow(d.selectedPolygon.centerPoint,c)})},plenty_admin.MAPS.remove_all_polygons=function(a){for(var b=0;b<a.length;b++){var c=a[b];c.removePolygon()}},plenty_admin.MAPS.location_search=function(a,b){var c=function(){function b(a,b){var c=document.getElementById(a);google.maps.event.addDomListener(c,"click",function(){f.setTypes(b)})}var c=document.getElementById("pac-input"),d=document.getElementById("type-selector"),e=document.getElementById("map_search_tools");a.controls[google.maps.ControlPosition.TOP_LEFT].push(c),a.controls[google.maps.ControlPosition.TOP_LEFT].push(d);var f=new google.maps.places.Autocomplete(c);f.bindTo("bounds",a),google.maps.event.addListener(f,"place_changed",function(){var b=f.getPlace();if(!b.geometry)return void bootbox.dialog({message:"Autocomplete's returned place contains no geometry",className:"warning",buttons:{danger:{label:"OK",className:"btn-warning",callback:plenty_admin.HELPER.hideLoadingOverlay}}});b.geometry.viewport?a.fitBounds(b.geometry.viewport):(a.setCenter(b.geometry.location),a.setZoom(17));var c="";b.address_components&&(c=[b.address_components[0]&&b.address_components[0].short_name||"",b.address_components[1]&&b.address_components[1].short_name||"",b.address_components[2]&&b.address_components[2].short_name||""].join(" "))}),b("changetype-all",[]),b("changetype-address",["address"]),b("changetype-establishment",["establishment"]),b("changetype-geocode",["geocode"]),$(e).fadeIn("fast")};0===$("#map_search_tools").length?$.get("ajax/map-search-ui.html",function(a){b.prepend(a),c()}):c()},plenty_admin.MAPS.polygon_tooltip=function(){var a,b,c,d,e,f="tt",g=3,h=3,i=300,j=10,k=20,l=95,m=0,n=document.all?!0:!1;return{show:function(h,j){null==a&&(a=document.createElement("div"),a.setAttribute("id",f),b=document.createElement("div"),b.setAttribute("id",f+"top"),c=document.createElement("div"),c.setAttribute("id",f+"cont"),d=document.createElement("div"),d.setAttribute("id",f+"bot"),a.appendChild(b),a.appendChild(c),a.appendChild(d),document.body.appendChild(a),a.style.opacity=0,a.style.filter="alpha(opacity=0)",document.onmousemove=this.pos),a.style.display="block",c.innerHTML=h,a.style.width=j?j+"px":"auto",!j&&n&&(b.style.display="none",d.style.display="none",a.style.width=a.offsetWidth,b.style.display="block",d.style.display="block"),a.offsetWidth>i&&(a.style.width=i+"px"),e=parseInt(a.offsetHeight)+g,clearInterval(a.timer),a.timer=setInterval(function(){plenty_admin.MAPS.polygon_tooltip.fade(1)},k)},pos:function(b){var c=n?event.clientY+document.documentElement.scrollTop:b.pageY,d=n?event.clientX+document.documentElement.scrollLeft:b.pageX;a.style.top=c-e+"px",a.style.left=d+h+"px"},fade:function(b){var c=m;if(c!=l&&1==b||0!=c&&-1==b){var d=j;j>l-c&&1==b?d=l-c:j>m&&-1==b&&(d=c),m=c+d*b,a.style.opacity=.01*m,a.style.filter="alpha(opacity="+m+")"}else clearInterval(a.timer),-1==b&&(a.style.display="none")},hide:function(){clearInterval(a.timer),a.timer=setInterval(function(){plenty_admin.MAPS.polygon_tooltip.fade(-1)},k)}}}(),!store.get("basicAuth");var setCreds=plenty_admin.HELPER.getParameterByName("setCreds");setCreds&&$("#setCreds").modal("show"),plenty_admin.UI.main={},plenty_admin.UI.main.DOM=$("#main-panel"),plenty_admin.UI.settings={},plenty_admin.UI.settings.organization={},plenty_admin.UI.settings.DOM=plenty_admin.UI.main.DOM.find("#settings"),plenty_admin.UI.currentScreen=plenty_admin.UI.settings.DOM,plenty_admin.UI.settings.new_organization=plenty_admin.UI.settings.DOM.find(".newOrgContainer"),plenty_admin.UI.settings.init=function(){plenty_admin.UI.settings.organizations=plenty_admin.UI.settings.DOM.find(".organizations");var a=(Object.keys(plenty_admin.DATA.organizations)[0],"#farms");plenty_admin.UI.currentScreen=plenty_admin.UI.organization.DOM,plenty_admin.UI.organization.init(plenty_admin.DATA.organizations[Object.keys(plenty_admin.DATA.organizations)[0]],a)},$(document).on("organization_data_ready",function(){plenty_admin.UI.settings.init()}),plenty_admin.UI.field={DOM:$("#field-container"),weatherTabs:{},assetTabs:{},renderedGraphs:[],dates:{start:null,end:null},hasLayout:!1,init:function(a,b){switch(console.log("plenty_admin.UI.field.init",a),plenty_admin.UI.field.fieldObj=a,b){case"settings":plenty_admin.HELPER.showLoadingOverlay(),plenty_admin.UI.field.DOM.attrchange({trackValues:!0,callback:function(a){if(a.newValue.indexOf("opacity")>-1){var b=Math.round(parseFloat(a.newValue.slice(9)));b>.999&&!plenty_admin.UI.field.hasLayout&&(plenty_admin.UI.field.fitFieldLayout("fit"),console.log("attr changed: ",a.attributeName,a.newValue))}else a.newValue.indexOf("display")>-1&&a.newValue.indexOf("none")>-1&&(console.log("attr changed: ",a.attributeName,a.newValue),plenty_admin.UI.field.fitFieldLayout("clear"))}}),plenty_admin.UI.currentScreen.fadeOut("normal",function(){plenty_admin.UI.currentScreen=plenty_admin.UI.field.DOM,plenty_admin.UI.field.populate(a),plenty_admin.UI.field.polygon=null,plenty_admin.MAPS.draw_field_on_map(a,"field_map",{mapTypeId:google.maps.MapTypeId.HYBRID,zoom:12,disableDefaultUI:!0,draggable:!1,zoomControl:!1,scrollwheel:!1,disableDoubleClickZoom:!0},function(a,b,c){plenty_admin.UI.field.polygon=c,$(window).on("resize",function(){plenty_admin.MAPS.zoomToPolygon(c,plenty_admin.MAPS.map)})},!1,"map"),plenty_admin.UI.currentScreen.fadeIn("normal")});break;case"map":plenty_admin.UI.currentScreen.closest(".fill-area").fadeOut("normal",function(){plenty_admin.UI.currentScreen=plenty_admin.UI.field.DOM,plenty_admin.UI.field.populate(a),plenty_admin.UI.field.polygon=null,plenty_admin.UI.currentScreen.addClass("fill-area-content flexbox-item-grow"),plenty_admin.UI.currentScreen.fadeIn("normal",function(){plenty_admin.MAPS.draw_field_on_map(a,"field_map",{mapTypeId:google.maps.MapTypeId.HYBRID,zoom:12,disableDefaultUI:!0,draggable:!1,zoomControl:!1,scrollwheel:!1,disableDoubleClickZoom:!0},function(a,b,c){plenty_admin.UI.field.polygon=c,$(window).on("resize",function(){plenty_admin.MAPS.zoomToPolygon(c,plenty_admin.MAPS.map)}),plenty_admin.MAPS.zoomToPolygon(c,plenty_admin.MAPS.map)},!1,"map")})}).parent().find(".filter_controls").fadeOut("fast")}},clear:function(){for(var a=0;a<plenty_admin.UI.field.renderedGraphs.length;a++){var b=plenty_admin.UI.field.renderedGraphs[a];b.destroy()}plenty_admin.UI.field.renderedGraphs=[],plenty_admin.UI.field.tempGraph=null,plenty_admin.UI.field.moistureGraph=null,plenty_admin.UI.field.precipGraph=null,plenty_admin.UI.field.gddGraph=null,plenty_admin.UI.field.DOM.find(".weatherEvents").each(function(){$(this).find(".event").remove()}),plenty_admin.UI.field.activityTimelineContainer&&plenty_admin.UI.field.activityTimelineContainer.find(".activity").remove(),plenty_admin.UI.field.activityListContainer&&plenty_admin.UI.field.activityListContainer.find(".activity").remove(),plenty_admin.UI.field.equipmentListContainer&&plenty_admin.UI.field.equipmentListContainer.find(".equipment").remove(),plenty_admin.UI.field.cropSurveysContainer&&plenty_admin.UI.field.cropSurveysContainer.find(".cropSurvey").remove(),plenty_admin.UI.field.financesGraphEl.parent().parent().parent().find(".legend").find(".legendItem").remove(),plenty_admin.UI.field.DOM.find(".topLine").find(".profit, .cost, .revenue").text(""),plenty_admin.UI.field.financesGraph&&plenty_admin.UI.field.financesGraph.destroy()},fitFieldLayout:function(a){switch(a){case"fit":$("body").height($(window).height()).css({overflow:"hidden"}),plenty_admin.UI.field.DOM.height($(window).height()-($(".navbar").height()+$("footer.footer").height())),plenty_admin.UI.field.hasLayout=!0;break;case"clear":$("body").removeAttr("style"),plenty_admin.UI.field.DOM.prop("style",""),plenty_admin.UI.field.hasLayout=!1}},populate:function(a){plenty_admin.REST.get_fieldCrops_order_by_year_descending(a.id,function(b){console.log("get_field_order_by_year_descending: ",b);for(var c={},d=0;d<b.length;d++)fieldCrop=b[d],c[parseInt(fieldCrop.year)]=fieldCrop;console.log("fieldCropsByYear",c),plenty_admin.UI.field.field_year_slider=plenty_admin.UI.field.DOM.find(".field_year_slider"),console.log("plenty_admin.UI.field.field_year_slider",plenty_admin.UI.field.field_year_slider.slider,typeof plenty_admin.UI.field.field_year_slider.slider),plenty_admin.UI.field.field_year_slider.slider({min:parseInt(b[b.length-1].year),max:parseInt(b[0].year),value:parseInt(b[0].year),formatter:function(a){return a+" - "+plenty_admin.DATA.cropTypes[c[parseInt(a)].cropTypeId].name}}).off("slide").on("slide",function(){}).off("slideStart").on("slideStart",function(a){console.log("SLIDER SLIDESTART: ",$(this),a,a.target)}).off("slideStop").on("slideStop",function(){console.log("SLIDER SLIDESTOP")}).off("change").on("change",function(b){console.log("SLIDER CHANGE",b.value.newValue);var d=c[b.value.newValue],e=plenty_admin.DATA.cropTypes[d.cropTypeId].name;plenty_admin.UI.field.clear(),plenty_admin.UI.field.update_field_year(a.id,d),plenty_admin.UI.field.DOM.find(".current_year_crop").text(b.value.newValue+" - "+plenty_admin.DATA.cropTypes[d.cropTypeId].name),plenty_admin.UI.field.polygon.setOptions({fillColor:plenty_admin.MAPS.legendItems[e].colour,strokeColor:plenty_admin.MAPS.legendItems[e].colour})}),plenty_admin.UI.field.assetTabs.DOM.off("shown.bs.tab").on("shown.bs.tab",function(a){var b=a.target.href,c=b.substring(b.indexOf("#"));console.log("changed: ",c),"#finances"===c&&(plenty_admin.UI.field.financesGraph&&plenty_admin.UI.field.financesGraph.destroy(),plenty_admin.UI.field.renderActivityFinancesGraph())}),plenty_admin.UI.field.weatherTabs.DOM.off("shown.bs.tab").on("shown.bs.tab",function(a){var b=a.target.href,c=b.substring(b.indexOf("#"));console.log("changed: ",c),plenty_admin.UI.field.updateWeatherGraph(c)}),plenty_admin.UI.field.update_field_year(a.id,c[parseInt(plenty_admin.UI.field.field_year_slider.slider("getValue"))]),plenty_admin.UI.field.DOM.find(".current_year_crop").text(plenty_admin.UI.field.field_year_slider.slider("getValue")+" - "+plenty_admin.DATA.cropTypes[c[parseInt(plenty_admin.UI.field.field_year_slider.slider("getValue"))].cropTypeId].name)})},updateWeatherGraph:function(a){var b="";switch(a){case"#temp":plenty_admin.UI.field.currentGraph=plenty_admin.UI.field.tempGraph?plenty_admin.UI.field.tempGraph:plenty_admin.UI.field.renderTempGraph(),b="tempGraph";break;case"#moisture":plenty_admin.UI.field.currentGraph=plenty_admin.UI.field.moistureGraph?plenty_admin.UI.field.moistureGraph:plenty_admin.UI.field.renderMoistureGraph(),b="moistureGraph";break;case"#precip":plenty_admin.UI.field.currentGraph=plenty_admin.UI.field.precipGraph?plenty_admin.UI.field.precipGraph:plenty_admin.UI.field.renderPrecipGraph(),b="precipGraph";break;case"#gdd":plenty_admin.UI.field.currentGraph=plenty_admin.UI.field.gddGraph?plenty_admin.UI.field.gddGraph:plenty_admin.UI.field.renderGDDGraph(),b="gddGraph"}var c=plenty_admin.UI.field.DOM.find(".keyOffset");try{c.width(plenty_admin.UI.field.currentGraph.datasets[0].points[0].x),plenty_admin.UI.field.positionToday(plenty_admin.UI.field.activitiesForCropType[0].startTime)}catch(d){console.error("something failed: ",d),bootbox.dialog({message:"Not enough activities (minimum of 2) to create weather graphs. Their start and end dates are calculated from the begining of the first, and the end of the last event.",className:"danger",buttons:{danger:{label:"OK",className:"btn-danger",callback:plenty_admin.HELPER.hideLoadingOverlay}}})}plenty_admin.UI.field.renderWeatherEvents(plenty_admin.UI.field.weatherDays.weatherEvents.precip,"precip"),plenty_admin.UI.field.renderWeatherEvents(plenty_admin.UI.field.weatherDays.weatherEvents.temp,"temp"),plenty_admin.UI.field.renderWeatherEvents(plenty_admin.UI.field.weatherDays.weatherEvents.wind,"wind"),plenty_admin.UI.field.scaleScale(plenty_admin.UI.field[b+"El"])},update_field_year:function(a,b){console.log("update_field_year",a,b),plenty_admin.HELPER.showLoadingOverlay(),plenty_admin.REST.get_field_equipments_with_fieldId(a,function(a){console.log("get_field_equipments_with_fieldId",a),plenty_admin.UI.field.renderEquipment(a)}),plenty_admin.REST.get_activities_by_field_crop_order_by_desc(b.id,function(c){if(console.log("get_activities_by_field_crop_order_by_desc",c,c.length),plenty_admin.UI.field.activitiesForCropType=c,c.length<=0)return void bootbox.dialog({message:"No activities for this field - can not render weather graphs without at least 2 activities.",className:"danger",buttons:{danger:{label:"OK",className:"btn-danger",callback:plenty_admin.HELPER.hideLoadingOverlay}}});var d=plenty_admin.HELPER.formatJavaDate(c[0].startTime);plenty_admin.UI.field.dates.start=d.obj.getUTCFullYear()+"-"+(d.obj.getUTCMonth()+1<10?"0"+(d.obj.getUTCMonth()+1):d.obj.getUTCMonth()+1)+"-"+(d.obj.getUTCDate()<10?"0"+d.obj.getUTCDate():d.obj.getUTCDate())+" "+(d.obj.getUTCHours()<10?"0"+d.obj.getUTCHours():d.obj.getUTCHours()+1)+":"+(d.obj.getUTCMinutes()<10?"0"+d.obj.getUTCMinutes():d.obj.getUTCMinutes());var e=plenty_admin.HELPER.formatJavaDate(c[c.length-1].endTime);plenty_admin.UI.field.dates.end=e.obj.getUTCFullYear()+"-"+(e.obj.getUTCMonth()+1<10?"0"+(e.obj.getUTCMonth()+1):e.obj.getUTCMonth()+1)+"-"+(e.obj.getUTCDate()<10?"0"+e.obj.getDate():e.obj.getUTCDate())+" "+(e.obj.getUTCHours()<10?"0"+e.obj.getUTCHours():e.obj.getUTCHours()+1)+":"+(e.obj.getUTCMinutes()<10?"0"+e.obj.getUTCMinutes():e.obj.getUTCMinutes()),console.log("plenty_admin.UI.field.dates: ",plenty_admin.UI.field.dates),plenty_admin.DATA.eventCollector=window.eventcollector(3,1e4),plenty_admin.REST.getActivityTypes(),plenty_admin.REST.get_weather_days_with_dateRange(a,plenty_admin.UI.field.dates.start,plenty_admin.UI.field.dates.end,function(a){console.log("get_weather_days_with_dateRange",a),plenty_admin.UI.field.weatherDays={dates:[],months:[],labels:[],allLabels:[],weatherEvents:{precip:[],temp:[],wind:[]}};for(var b=(a[a.length-1].date,c[c.length-1].endTime,0);b<a.length;b++){weatherOb=a[b];var d=plenty_admin.HELPER.formatJavaDate(weatherOb.date);plenty_admin.UI.field.weatherDays.labels.push(d.date),plenty_admin.UI.field.weatherDays.allLabels.push(d.date);for(prop in weatherOb){if(weatherOb.hasOwnProperty(prop))if("weatherEvents"===prop){plenty_admin.UI.field.weatherDays[prop]||(plenty_admin.UI.field.weatherDays[prop]=[]);for(var e=0;e<weatherOb[prop].length;e++){var f=weatherOb[prop][e];switch(f.weatherDayDate=d,f.dayIndex=b,f.type){case"HIGH_TEMP":f.iconClass="wi wi-hot",plenty_admin.UI.field.weatherDays[prop].temp.push(f);break;case"FREEZE":f.iconClass="wi wi-thermometer-exterior",plenty_admin.UI.field.weatherDays[prop].temp.push(f);break;case"SNOW":f.iconClass="wi wi-snow-wind",plenty_admin.UI.field.weatherDays[prop].precip.push(f);break;case"RAIN":f.iconClass="wi wi-rain",plenty_admin.UI.field.weatherDays[prop].precip.push(f);break;case"HIGH_WINDS":f.iconClass="wi wi-strong-wind",plenty_admin.UI.field.weatherDays[prop].wind.push(f)}}}else if("moisture"===prop){plenty_admin.UI.field.weatherDays[prop]||(plenty_admin.UI.field.weatherDays[prop]={});for(var e=0;e<weatherOb[prop].length;e++){var g=weatherOb[prop][e];plenty_admin.UI.field.weatherDays.moisture[g.depth]||(plenty_admin.UI.field.weatherDays.moisture[g.depth]={}),plenty_admin.UI.field.weatherDays.moisture[g.depth][b]=g.moisture}}else"cropSurvey"===prop?(plenty_admin.UI.field.weatherDays.cropSurvey||(plenty_admin.UI.field.weatherDays.cropSurvey=[]),weatherOb.cropSurvey&&plenty_admin.UI.field.weatherDays.cropSurvey.push(weatherOb.cropSurvey)):(plenty_admin.UI.field.weatherDays[prop]||(plenty_admin.UI.field.weatherDays[prop]=[]),plenty_admin.UI.field.weatherDays[prop].push(weatherOb[prop]));plenty_admin.UI.field.weatherDays.length=a.length}}console.log("plenty_admin.UI.field.weatherDays:",plenty_admin.UI.field.weatherDays);var h=plenty_admin.UI.field.weatherTabs.DOM.find(".nav-tabs li.active a").prop("href"),i=h.substring(h.indexOf("#")),j="";switch(i){case"#temp":plenty_admin.UI.field.currentGraph=plenty_admin.UI.field.renderTempGraph(),j="tempGraph";break;case"#moisture":plenty_admin.UI.field.currentGraph=plenty_admin.UI.field.renderMoistureGraph(),j="moistureGraph";break;case"#precip":plenty_admin.UI.field.currentGraph=plenty_admin.UI.field.renderPrecipGraph(),j="precipGraph";break;case"#gdd":plenty_admin.UI.field.currentGraph=plenty_admin.UI.field.renderGDDGraph(),j="gddGraph"}var k=plenty_admin.UI.field.DOM.find(".keyOffset");try{k.width(plenty_admin.UI.field.currentGraph.datasets[0].points[0].x)}catch(l){bootbox.dialog({message:"Not enough activities (minimum of 2) to create weather graphs. Their start and end dates are calculated from the begining of the first, and the end of the last event.",className:"danger",buttons:{danger:{label:"OK",className:"btn-danger",callback:plenty_admin.HELPER.hideLoadingOverlay}}})}plenty_admin.UI.field.scaleScale(plenty_admin.UI.field[j+"El"]),plenty_admin.UI.field.renderWeatherEvents(plenty_admin.UI.field.weatherDays.weatherEvents.precip,"precip"),plenty_admin.UI.field.renderWeatherEvents(plenty_admin.UI.field.weatherDays.weatherEvents.temp,"temp"),plenty_admin.UI.field.renderWeatherEvents(plenty_admin.UI.field.weatherDays.weatherEvents.wind,"wind"),$(window).on("resize",function(){plenty_admin.UI.field.renderWeatherEvents(plenty_admin.UI.field.weatherDays.weatherEvents.precip,"precip"),plenty_admin.UI.field.renderWeatherEvents(plenty_admin.UI.field.weatherDays.weatherEvents.temp,"temp"),plenty_admin.UI.field.renderWeatherEvents(plenty_admin.UI.field.weatherDays.weatherEvents.wind,"wind"),plenty_admin.UI.field.scaleScale(plenty_admin.UI.field[j+"El"])}),plenty_admin.DATA.eventCollector.done("event 1")}),plenty_admin.REST.get_activity_finances_for_date_range(b.id,plenty_admin.UI.field.dates.start,plenty_admin.UI.field.dates.end,function(a){console.log("get_activity_finances_for_date_range",a()),plenty_admin.UI.field.fieldCropActivityFinances=a(),plenty_admin.DATA.eventCollector.done("event 2")}),plenty_admin.DATA.eventCollector.on("alldone",function(){plenty_admin.UI.field.renderActivities(c),console.log("all data gathered: ",plenty_admin.UI.field.dayWidth),plenty_admin.UI.field.renderCropSurveys(plenty_admin.UI.field.weatherDays.cropSurvey),$(window).on("resize",function(){plenty_admin.UI.field.renderActivities(c),plenty_admin.UI.field.renderCropSurveys(plenty_admin.UI.field.weatherDays.cropSurvey)}),plenty_admin.UI.field.renderActivityFinancesGraph(),plenty_admin.HELPER.hideLoadingOverlay()})})},renderWeatherEvents:function(a,b){plenty_admin.UI.field.weatherEventsContainer=plenty_admin.UI.field.DOM.find(".tab-content .weatherEvents."+b),plenty_admin.UI.field.weatherEventsContainer.find(".event").remove();for(var c=0;c<a.length;c++){var d=a[c],e=parseInt(plenty_admin.UI.field.weatherEventsContainer.width())/plenty_admin.UI.field.weatherDays.length*d.dayIndex-8;0>e&&(e=0);var f="";switch(b){case"temp":f="℉";break;case"precip":f='"';break;case"wind":f="mph"}var g=$("<div class='event' data-toggle='tooltip' data-placement='top' title='"+(d.detail?d.detail:d.deatil)+": "+d.amount.toFixed(2)+f+"' style='left:"+e+"px'><i class='"+d.type+" "+d.iconClass+"'></i></div>");g.tooltip({container:"body"}),plenty_admin.UI.field.weatherEventsContainer.append(g)}},getActivityIconClass:function(a){console.log("getActivityIconClass",a);var b=null;switch(a){case 1:case"SoilTest":b="pif pif-soil-test";break;case 2:case"StarterFertilizer":case"LateFertilizer":b="pif pif-fertilizer";break;case 3:case"Tilling":b="pif pif-tilling";break;case 4:case"Planting":b="pif pif-planting";break;case 5:case"EarlyNitrogen":b="pif pif-early-nitrogen";break;case 6:case"LateNitrogen":b="pif pif-late-nitrogen";break;case 7:case"PestControl":b="pif pif-pest-control";break;case 8:case"Harvest":b="pif pif-harvest"}return b},renderCropSurveys:function(a){plenty_admin.UI.field.cropSurveysContainer=plenty_admin.UI.field.DOM.find(".tab-content .cropSurveys"),plenty_admin.UI.field.cropSurveysContainer.find(".cropSurvey").remove();for(var b=0;b<a.length;b++){var c=a[b];c.startOffsetDays=Math.round(plenty_admin.HELPER.daydiff(plenty_admin.UI.field.activitiesForCropType[0].startTime,c.observationTime));var d=plenty_admin.UI.field.dayWidth*c.startOffsetDays-17;0>d&&(d=0),d>plenty_admin.UI.field.cropSurveysContainer.width()&&(d=plenty_admin.UI.field.cropSurveysContainer.width()-34);var e=("UOMId-"+c.countUOMId,["cropHeight: "+c.cropHeight+"<br>","cropTypeId: "+c.cropTypeId+"<br>","growthMethodId: "+c.growthMethodId+"<br>","growthStageId: "+c.growthStageId].join("")),f=$("<div class='cropSurvey alert alert-warning' data-toggle='tooltip' data-placement='top' title='"+e+"' style='left:"+d+"px'><i class='fa fa-file-text'></i><img class='growthStageImg' src=''/></div>");f.off("click").on("click",function(){return plenty_admin.UI.crop_survey.show(c,plenty_admin.UI.field.fieldObj),!1}).tooltip({container:"body",html:!0}),plenty_admin.REST.fields.getGrowthStageFile(c.growthStageId,f,function(a,b){b.find("img.growthStageImg").prop("src","data:image/jpeg;base64,"+a),plenty_admin.UI.field.cropSurveysContainer.append(b)})}},renderActivities:function(a,b){plenty_admin.UI.field.activityTimelineContainer=plenty_admin.UI.field.DOM.find(".activitiesTimeline .activities"),plenty_admin.UI.field.activityListContainer=plenty_admin.UI.field.DOM.find(".field_asset_data .tab-content #activities-list tbody"),plenty_admin.UI.field.activityTimelineContainer.add(plenty_admin.UI.field.activityListContainer).find(".activity").remove();Math.round(plenty_admin.HELPER.daydiff(a[0].startTime,a[a.length-1].endTime));plenty_admin.UI.field.dayWidth=parseInt(plenty_admin.UI.field.activityTimelineContainer.width())/plenty_admin.UI.field.weatherDays.length;var c=plenty_admin.UI.field.dayWidth/24;if(console.log("activityDays",plenty_admin.UI.field.dayWidth,c),0===a.length)return console.warn("could not calculate weatherDay width as weatherDays is empty"),void bootbox.dialog({message:"Could not calculate weatherDay witdh - there are no weatherDays being returned.",className:"danger",buttons:{danger:{label:"OK",className:"btn-danger",callback:plenty_admin.HELPER.hideLoadingOverlay}}});for(var d=0;d<a.length;d++){var e=a[d];e.iconClass=plenty_admin.UI.field.getActivityIconClass(e.activityTypeId),e.startDate=plenty_admin.HELPER.formatJavaDate(e.startTime),e.endDate=plenty_admin.HELPER.formatJavaDate(e.endTime),e.startOffsetDays=Math.round(plenty_admin.HELPER.daydiff(a[0].startTime,e.startTime));var f=plenty_admin.UI.field.dayWidth*e.startOffsetDays,g=Math.round(c*e.durationInHours);26>g&&(g=26),0>f&&(f=0),f+g>plenty_admin.UI.field.activityTimelineContainer.width()&&(f=plenty_admin.UI.field.activityTimelineContainer.width()-g);var h=$("<div class='activity' data-toggle='tooltip' data-placement='top' title='"+plenty_admin.UI.field.getActivityTooltipTitle(e)+"' style='left:"+f+"px; width:"+g+"px'><i class='"+plenty_admin.DATA.activityTypes[e.activityTypeId].name.toLowerCase().replace(/ /g,"")+" "+e.iconClass+"'></i></div>"),i=$.grep(plenty_admin.UI.field.fieldCropActivityFinances.activityFinances,function(a){return a.activityDto.id===e.id});if(h.tooltip({html:!0,container:"body"}).data("activity",e).data("activityFinance",i[0]).click(function(){plenty_admin.UI.field.show_activity_modal($(this).data("activity"),$(this).data("activityFinance").taskFinances,$(this))}),plenty_admin.UI.field.activityTimelineContainer.append(h),!b){var j=["<tr class='activity pointer'>","<td width='5%'>","<i class='"+e.iconClass+"'></i>","</td>","<td width='25%'>",e.state,"</td>","<td width='25%'>",plenty_admin.DATA.activityTypes[e.activityTypeId].name,"</td>","<td width='20%'>",e.startDate.date,"</td>","<td width='20%'>",plenty_admin.HELPER.daysFromHours(e.durationInHours),"</td>","<td width='20%' class='text-right'>",numeral(e.cost).format("$0,0.00"),"</td>","</tr>"].join(""),k=$(j);k.data("activity",e).data("activityFinance",i[0]).click(function(){plenty_admin.UI.field.show_activity_modal($(this).data("activity"),$(this).data("activityFinance").taskFinances,$(this))}),plenty_admin.UI.field.activityListContainer.append(k)}}var l=plenty_admin.UI.field.DOM.find(".keyOffset");l.width(plenty_admin.UI.field.currentGraph.datasets[0].points[0].x),plenty_admin.UI.field.positionToday(a[0].startTime)},positionToday:function(a){var b=plenty_admin.UI.field.DOM.find(".futureDays"),c=plenty_admin.UI.field.DOM.find(".todayLabel"),d=Math.round(plenty_admin.HELPER.daydiff(a,(new Date).getTime()));console.log("pastDays",d);var e=b.parent().find(".keyOffset");if(d>0){var f=plenty_admin.UI.field.currentGraph.datasets[0].points[d].x;console.log("pastDaysWidth",f),e.animate({width:f}),c.css({right:-(c.width()/2)}),b.parent().css({height:Math.round(plenty_admin.UI.field.currentGraph.scale.endPoint),bottom:Math.round(plenty_admin.UI.field.currentGraph.scale.height-plenty_admin.UI.field.currentGraph.scale.endPoint)}).fadeIn("fast")}else b.parent().hide()},buildChartZoomer:function(){var a=plenty_admin.UI.field.DOM.find(".zoomInLayer");console.log("buildChartZoomer",a,plenty_admin.UI.field.currentGraph.scale),a.css({height:Math.round(plenty_admin.UI.field.currentGraph.scale.endPoint),bottom:Math.round(plenty_admin.UI.field.currentGraph.scale.height-plenty_admin.UI.field.currentGraph.scale.endPoint)}).on("click",function(a){console.log("chartZoomer",$(this),a);var b=$(this).find(".zoomInControl"),c=$(this).offset(),d=a.pageX-c.left-b.width()/2;

b.css({left:d}).fadeIn("fast")})},renderEquipment:function(a){plenty_admin.UI.field.equipmentListContainer=plenty_admin.UI.field.DOM.find(".field_asset_data .tab-content #equipment tbody"),console.log("equipmentListContainer",plenty_admin.UI.field.equipmentListContainer);for(var b=0;b<a.length;b++){var c=a[b];if(null!==c.fieldEquipmentDto){var d=["<tr class='equipment pointer'>","<td width='5%'>","<i class='pif pif-"+c.equipmentTypeIds[0].name.toLowerCase().replace(/ /g,"-")+"'></i>","</td>","<td width='25%'>",c.equipmentTypeIds[0].name,"</td>","<td width='30%'>",plenty_admin.DATA.brandTypes[c.brandId].name,"</td>","<td width='25%'>",c.name,"</td>","</tr>"].join(""),e=$(d);e.data("equipmentObject",c).on("click",function(){plenty_admin.UI.field.show_equipment_modal($(this).data("equipmentObject"))}),plenty_admin.UI.field.equipmentListContainer.append(e);var f=new google.maps.LatLng(c.latitude,c.longitude);c.latlng=f;var g={onMouseOver:function(){$(this.markerContent_).find(".marker").addClass("hover"),$(this.markerWrapper_).css({zIndex:10}),plenty_admin.MAPS.polygon_tooltip.show("<strong>"+c.name+"</strong>")},onMouseOut:function(){$(this.markerContent_).find(".marker").removeClass("hover"),$(this.markerWrapper_).css({zIndex:1}),plenty_admin.MAPS.polygon_tooltip.hide()},onClick:function(){plenty_admin.UI.field.show_equipment_modal(c)}};plenty_admin.MAPS.draw_pin(c,g,plenty_admin.MAPS.map)}}},getActivityTooltipTitle:function(a){var b=plenty_admin.DATA.activityTypes[a.activityTypeId].name+"<br/>"+a.startDate.fullDate+"<br/>$"+numeral(a.cost).format("$0,0.00");return console.log("activity tooltip title:",b),b},renderTempGraph:function(){{var a={labels:plenty_admin.UI.field.weatherDays.labels,datasets:[{label:"Min",fillColor:"rgba(142,220,244,0.2)",strokeColor:"rgba(142,220,244,1)",pointColor:"rgba(108,202,224,1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(142,220,244,1)",data:plenty_admin.UI.field.weatherDays.minTemp},{label:"Max",fillColor:"rgba(249,216,110,0.2)",strokeColor:"rgba(249,216,110,1)",pointColor:"rgba(239,193,63,1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(249,216,110,1)",data:plenty_admin.UI.field.weatherDays.maxTemp}]},b={multiTooltipTemplate:"<%= datasetLabel %>: <%=numeral(value).format('0,0.0')%>℉",pointHitDetectionRadius:0,scaleLabel:plenty_admin.UI.field.yAxisPadder};Chart.helpers}return plenty_admin.UI.field.tempGraph&&plenty_admin.UI.field.tempGraph.destroy(),plenty_admin.UI.field.weatherDays.labels=plenty_admin.UI.field.weatherDays.allLabels.slice(),plenty_admin.UI.field.tempGraph=new Chart(plenty_admin.UI.field.tempGraphEl.get(0).getContext("2d")).LineAlt(a,b),plenty_admin.UI.field.tempGraph.datasetId="temp",plenty_admin.UI.field.renderedGraphs.push(plenty_admin.UI.field.tempGraph),plenty_admin.UI.field.tempGraph},scaleScale:function(a){console.log("graphEl",a);{var b=a.width();a.height()}a.parent().find("svg.scale").prop("viewBox","0 0 "+b+" "+plenty_admin.UI.field.currentGraph.scale.endPoint).width(b-plenty_admin.UI.field.currentGraph.datasets[0].points[0].x).height(plenty_admin.UI.field.currentGraph.scale.endPoint).css({left:plenty_admin.UI.field.currentGraph.datasets[0].points[0].x}).fadeIn("fast")},renderMoistureGraph:function(){var a=[],b=0,c=new Rainbow;c.setSpectrum("#0076b2","#93b222","#788912"),c.setNumberRange(0,Object.keys(plenty_admin.UI.field.weatherDays.moisture).length);for(depth in plenty_admin.UI.field.weatherDays.moisture)if(plenty_admin.UI.field.weatherDays.moisture.hasOwnProperty(depth)){for(var d=plenty_admin.UI.field.weatherDays.moisture[depth],e=[],f=0;f<plenty_admin.UI.field.weatherDays.length;f++)d[f]?e.push(d[f]):0==b&&e.push(0);var g=plenty_admin.HELPER.hexToRgb("#"+c.colourAt(b)),h=depth.toString(),i={label:h+"mm",fillColor:"rgba("+g.r+","+g.g+","+g.b+",0.2)",strokeColor:"rgba("+g.r+","+g.g+","+g.b+",1)",pointColor:"rgba("+g.r+","+g.g+","+g.b+",1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba("+plenty_admin.HELPER.hexToRgb("#"+c.colourAt(b))+",1)",data:e};a.push(i),b+=1}var j={labels:plenty_admin.UI.field.weatherDays.labels,datasets:a},k={multiTooltipTemplate:"<%= datasetLabel %>: <%=numeral(value).format('0,0.00')%>cb",pointHitDetectionRadius:0,animation:!1,scaleLabel:plenty_admin.UI.field.yAxisPadder};return plenty_admin.UI.field.moistureGraph&&plenty_admin.UI.field.moistureGraph.destroy(),plenty_admin.UI.field.weatherDays.labels=plenty_admin.UI.field.weatherDays.allLabels.slice(),plenty_admin.UI.field.moistureGraph=new Chart(plenty_admin.UI.field.moistureGraphEl.get(0).getContext("2d")).LineAlt(j,k),plenty_admin.UI.field.moistureGraph.datasetId="moisture",plenty_admin.UI.field.renderedGraphs.push(plenty_admin.UI.field.moistureGraph),plenty_admin.UI.field.moistureGraph},renderPrecipGraph:function(){var a={labels:plenty_admin.UI.field.weatherDays.labels,datasets:[{label:"Precipitation",fillColor:"rgba(136,242,201,0.2)",strokeColor:"rgba(136,242,201,1)",pointColor:"rgba(97,226,174,1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(136,242,201,1)",data:plenty_admin.UI.field.weatherDays.percipTotalToToday}]},b={tooltipTemplate:"<%= label %>: <%= Math.round(value) %>",pointHitDetectionRadius:0,scaleLabel:plenty_admin.UI.field.yAxisPadder};return plenty_admin.UI.field.precipGraph&&plenty_admin.UI.field.precipGraph.destroy(),plenty_admin.UI.field.weatherDays.labels=plenty_admin.UI.field.weatherDays.allLabels.slice(),plenty_admin.UI.field.precipGraph=new Chart(plenty_admin.UI.field.precipGraphEl.get(0).getContext("2d")).LineAlt(a,b),plenty_admin.UI.field.precipGraph.datasetId="precipAmt",plenty_admin.UI.field.renderedGraphs.push(plenty_admin.UI.field.precipGraph),plenty_admin.UI.field.precipGraph},yAxisPadder:function(a){for(var b=9,c="",d=b-a.value.length,e=0;d>e;e++)c+=" ";return c+a.value},renderGDDGraph:function(){var a={labels:plenty_admin.UI.field.weatherDays.labels,datasets:[{label:"GDD",fillColor:"rgba(185,244,146,0.2)",strokeColor:"rgba(185,244,146,1)",pointColor:"rgba(150,234,96,1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(185,244,146,1)",data:plenty_admin.UI.field.weatherDays.gddTotalToToday}]},b={tooltipTemplate:"<%= label %>: <%= Math.round(value) %>",pointHitDetectionRadius:0,scaleLabel:plenty_admin.UI.field.yAxisPadder};return plenty_admin.UI.field.gddGraph&&plenty_admin.UI.field.gddGraph.destroy(),plenty_admin.UI.field.weatherDays.labels=plenty_admin.UI.field.weatherDays.allLabels.slice(),plenty_admin.UI.field.gddGraph=new Chart(plenty_admin.UI.field.gddGraphEl.get(0).getContext("2d")).LineAlt(a,b),plenty_admin.UI.field.gddGraph.datasetId="gddTotalToToday",plenty_admin.UI.field.gddGraphEl.onclick=function(a){var b=myLineChart.getPointsAtEvent(a);console.log("graph clicked: ",b)},plenty_admin.UI.field.renderedGraphs.push(plenty_admin.UI.field.gddGraph),plenty_admin.UI.field.gddGraph},renderActivityFinancesGraph:function(){var a=plenty_admin.UI.field.fieldCropActivityFinances,b=[];plenty_admin.UI.field.DOM.find(".topLine").find(".profit").text(numeral(a.totalProfit).format("$0,0.00")).end().find(".cost").text(numeral(a.totalCost).format("$0,0.00")).end().find(".revenue").text(numeral(a.totalRevenue).format("$0,0.00"));var c=new Rainbow;c.setSpectrum("#0076b2","#93b222","#788912"),c.setNumberRange(0,a.activityFinances.length>0?a.activityFinances.length:1);for(var d=0;d<a.activityFinances.length;d++){var e=a.activityFinances[d];e.colour="#"+c.colourAt(d);var f={value:e.cost,color:e.colour,highlight:plenty_admin.HELPER.colorLuminance(e.colour,.4),label:plenty_admin.DATA.activityTypes[e.activityTypeId].name};b.push(f)}var g={legendTemplate:'<ul class="<%=name.toLowerCase()%>-legend mts"><% for (var i=0; i<segments.length; i++){%><li data-segmentid="<%=i%>" data-hovercolour="<%=segments[i].fillColor%>" data-name="<%=segments[i].label.replace(/ /g, "").toLowerCase()%>" class="legendItem"><span class="swatch" style="background-color:<%=segments[i].fillColor%>"><i class="pif pif-<%=segments[i].label.toLowerCase().replace(/ /g, "-")%>"></i></span><%if(segments[i].label){%><%=segments[i].label%><%}%> <span class="pct"></span><span class="pull-right"><%= numeral(segments[i].value).format(\'$0,0.00\') %></span></li><%}%></ul>',tooltipTemplate:"<%=label%>: <%= numeral(value).format('$0,0.00') %> | <%= numeral(circumference / 6.283).format('00.00%') %>",animateRotate:!0},h=Chart.helpers;console.log("helpers",h),plenty_admin.UI.field.financesGraph&&plenty_admin.UI.field.financesGraph.destroy(),plenty_admin.UI.field.financesGraph=new Chart(plenty_admin.UI.field.financesGraphEl.get(0).getContext("2d")).Doughnut(b,g),console.log("render finances graph: ",plenty_admin.UI.field.financesGraph,b);var i=$(plenty_admin.UI.field.financesGraph.generateLegend()),j=plenty_admin.UI.field.financesGraphEl.parent().parent().parent().find(".legend");j.html("").append(i);var k=function(a){$(a).find("li").css({"background-color":"transparent"}).removeClass("active").find("span.swatch").each(function(){$(this).css({"background-color":$(this).closest("li").data("hovercolour")})}).end().find("span.pct").text("")};h.each(j.get(0).firstChild.childNodes,function(a,b){h.addEvent(a,"mouseover",function(){var c=plenty_admin.UI.field.financesGraph.segments[b],d=numeral(c.circumference/6.283).format("00.00%");c.save(),c.fillColor=c.highlightColor,c.innerRadius=60,plenty_admin.UI.field.financesGraph.showTooltip([c]),c.restore(),$(a).css({"background-color":$(this).data("hovercolour")}).addClass("active").find("span.swatch").css({"background-color":c.highlightColor}).end().find("span.pct").text(d)})}),h.addEvent(j.get(0).firstChild,"mouseout",function(){plenty_admin.UI.field.financesGraph.draw(),k(j)}),plenty_admin.UI.field.financesGraphEl.on("mousemove",function(a){var b=plenty_admin.UI.field.financesGraph.getSegmentsAtEvent(a);if(b.length>0){j.find("li").removeClass("active");var c=b[0].label.replace(/ /g,"").toLowerCase(),d=j.find("li[data-name='"+c+"']"),e=numeral(b[0].circumference/6.283).format("00.00%");k(j),d.addClass("active").css({"background-color":d.data("hovercolour")}).find("span.swatch").css({"background-color":b[0].highlightColor}).end().find("span.pct").text(e)}else k(j)}),plenty_admin.UI.field.financesGraphEl.on("mouseout",function(){k(j)}),plenty_admin.UI.field.renderedGraphs.push(plenty_admin.UI.field.financesGraph)},renderTasks:function(a){for(var b="",c=0;c<a.length;c++){var d=a[c],e=plenty_admin.HELPER.formatJavaDate(d.taskDto.startTime);console.log("taskStartDate - ",e,d.taskDto.startTime);var f=["<tr class='pointer'>","<td><span class='editable' data-type='text' data-pk='1' data-url='/post' data-title='Choose the task name'>",d.taskDto.name,"</span></td>","<td>",d.taskDto.state,"</td>","<td><span class='editable' data-type='date' data-pk='1' data-url='/post' data-title='Choose the start date'>",plenty_admin.HELPER.formatJavaDate(d.taskDto.startTime).date,"</span></td>","<td>",plenty_admin.HELPER.daysFromHours(d.taskDto.durationInHours),"</td>","<td class='text-right'>",d.taskDto.cost,"</td>","</tr>"].join("");b+=f}$.fn.editable.defaults.mode="inline",plenty_admin.UI.map.MODAL_activity.find(".activityTasksList table tbody tr").remove().end().find(".activityTasksList table tbody").append(b).find(".editable").editable(plenty_admin.REST.inline_editing_options)},renderTaskFinancesGraph:function(a){console.log("renderTaskFinancesGraph",a);var b=new Rainbow;b.setSpectrum("#0076b2","#93b222","#788912"),b.setNumberRange(0,2);for(var c=[{value:0,color:"#"+b.colourAt(0),highlight:plenty_admin.HELPER.colorLuminance("#"+b.colourAt(0),.4),label:"Equipment"},{value:0,color:"#"+b.colourAt(1),highlight:plenty_admin.HELPER.colorLuminance("#"+b.colourAt(1),.4),label:"Labor"},{value:0,color:"#"+b.colourAt(2),highlight:plenty_admin.HELPER.colorLuminance("#"+b.colourAt(2),.4),label:"Products"}],d=0;d<a.length;d++){var e=a[d];console.log("taskFinance",e),c[0].value+=e.equipmentCost.cost,c[1].value+=e.laborCost.cost,c[2].value+=e.productsCost.cost}var f={legendTemplate:'<ul class="<%=name.toLowerCase()%>-legend mts"><% for (var i=0; i<segments.length; i++){%><li data-segmentid="<%=i%>" data-hovercolour="<%=segments[i].fillColor%>" data-name="<%=segments[i].label.replace(/ /g, "").toLowerCase()%>" class="taskHeader" style="border-top:2px solid <%=segments[i].fillColor%>"><span class="swatch" style="background-color:<%=segments[i].fillColor%>"><i class="pif pif-<%=segments[i].label.toLowerCase().replace(/ /g, "-")%>"></i></span><%if(segments[i].label){%><%=segments[i].label%><%}%> <span class="pct"></span><span class="pull-right"><%= numeral(segments[i].value).format(\'$0,0.00\') %></span></li><%}%></ul>',tooltipTemplate:"<%=label%>: <%= numeral(value).format('$0,0.00') %> | <%= numeral(circumference / 6.283).format('00.00%') %>",animateRotate:!0},g=Chart.helpers;console.log("helpers",g),plenty_admin.UI.field.taskFinancesGraph=new Chart(plenty_admin.UI.field.taskFinancesGraphEl.get(0).getContext("2d")).Doughnut(c,f),console.log("render task finances graph: ",plenty_admin.UI.field.taskFinancesGraph,c);var h=$(plenty_admin.UI.field.taskFinancesGraph.generateLegend()),i=plenty_admin.UI.field.taskFinancesGraphEl.parent().parent().find(".legend");i.html("").append(h);for(var j="",k="",l="",d=0;d<a.length;d++){var e=a[d];console.log("taskFinance",e);for(var m=0;m<e.equipmentCost.taskResourceTypeCosts.length;m++){var n=e.equipmentCost.taskResourceTypeCosts[m],o=plenty_admin.HELPER.hexToRgb("#"+b.colourAt(0));j+="<li class='taskItem equipmentTaskItem' style='background-color:rgba("+o.r+", "+o.g+", "+o.b+", .2);'>"+n.resourceTypeName+"<span class='cost'>"+numeral(n.cost).format("$0,0.00")+"</span></li>";for(var p=0;p<n.taskResourceCosts.length;p++){var q=n.taskResourceCosts[p];j+="<li class='taskResourceItem equipmentTaskResourceItem' style='background-color:rgba("+o.r+", "+o.g+", "+o.b+", .2);'>"+q.resourceName+"<span class='cost'>"+numeral(q.cost).format("$0,0.00")+"</span></li>"}}for(var r=0;r<e.laborCost.taskResourceTypeCosts.length;r++){var n=e.laborCost.taskResourceTypeCosts[r],o=plenty_admin.HELPER.hexToRgb("#"+b.colourAt(1));k+="<li class='taskItem laborTaskItem' style='background-color:rgba("+o.r+", "+o.g+", "+o.b+", .2);'>"+n.resourceTypeName+"<span class='cost'>"+numeral(n.cost).format("$0,0.00")+"</span></li>";for(var p=0;p<n.taskResourceCosts.length;p++){var q=n.taskResourceCosts[p];k+="<li class='taskResourceItem laborTaskResourceItem' style='background-color:rgba("+o.r+", "+o.g+", "+o.b+", .2);'>"+q.resourceName+"<span class='cost'>"+numeral(q.cost).format("$0,0.00")+"</span></li>"}}for(var s=0;s<e.productsCost.taskResourceTypeCosts.length;s++){var n=e.productsCost.taskResourceTypeCosts[s],o=plenty_admin.HELPER.hexToRgb("#"+b.colourAt(2));l+="<li class='taskItem productTaskItem' style='background-color:rgba("+o.r+", "+o.g+", "+o.b+", .2);'>"+n.resourceTypeName+"<span class='cost'>"+numeral(n.cost).format("$0,0.00")+"</span></li>";for(var p=0;p<n.taskResourceCosts.length;p++){var q=n.taskResourceCosts[p];l+="<li class='taskResourceItem productTaskResourceItem' style='background-color:rgba("+o.r+", "+o.g+", "+o.b+", .2);'>"+q.resourceName+"<span class='cost'>"+numeral(q.cost).format("$0,0.00")+"</span></li>"}}}console.log("equipmentItems",j),console.log("laborItems",k),console.log("productItems",l),i.find("li[data-name='equipment']").after(j).end().find("li[data-name='labor']").after(k).end().find("li[data-name='products']").after(l).end().find(".equipmentTaskResourceItem").last().addClass("last").end().end().find(".laborTaskResourceItem").last().addClass("last").end().end().find(".productTaskResourceItem").last().addClass("last");var t=function(a){$(a).find("li:not(.taskItem):not(.taskResourceItem)").css({"background-color":"transparent"}).removeClass("active").find("span.swatch").each(function(){$(this).css({"background-color":$(this).closest("li").data("hovercolour")})}).end().find("span.pct").text("")};g.each(i.get(0).firstChild.childNodes,function(a,b){g.addEvent(a,"mouseover",function(){if(console.log("hover legendNode: ",this,b,$(this).prop("class")),$(this).hasClass("taskItem")||$(this).hasClass("taskResourceItem")?$(this).hasClass("equipmentTaskItem")||$(this).hasClass("equipmentTaskResourceItem")?b=0:$(this).hasClass("laborTaskItem")||$(this).hasClass("laborTaskResourceItem")?b=1:($(this).hasClass("productTaskItem")||$(this).hasClass("productTaskResourceItem"))&&(b=2):b=parseInt($(this).data("segmentid")),console.log("index: ",b),!$(this).hasClass("taskItem")&&!$(this).hasClass("taskResourceItem")){var c=plenty_admin.UI.field.taskFinancesGraph.segments[b],d=numeral(c.circumference/6.283).format("00.00%");c.save(),c.fillColor=c.highlightColor,c.innerRadius=60,plenty_admin.UI.field.taskFinancesGraph.showTooltip([c]),c.restore(),$(a).css({"background-color":$(this).data("hovercolour")}).addClass("active").find("span.swatch").css({"background-color":c.highlightColor}).end().find("span.pct").text(d)}})}),g.addEvent(i.get(0).firstChild,"mouseout",function(){$(this).hasClass("taskItem")&&($(this).hasClass("equipmentTaskItem")||$(this).hasClass("equipmentTaskResourceItem")?index=0:$(this).hasClass("laborTaskItem")||$(this).hasClass("laborTaskResourceItem")?index=1:($(this).hasClass("productTaskItem")||$(this).hasClass("productTaskResourceItem"))&&(index=2)),plenty_admin.UI.field.taskFinancesGraph.draw(),$(this).hasClass("taskItem")||$(this).hasClass("taskResourceItem")||t(i)}),plenty_admin.UI.field.taskFinancesGraphEl.on("mousemove",function(a){var b=plenty_admin.UI.field.taskFinancesGraph.getSegmentsAtEvent(a);if(b.length>0){i.find("li").removeClass("active");var c=b[0].label.replace(/ /g,"").toLowerCase(),d=i.find("li[data-name='"+c+"']"),e=numeral(b[0].circumference/6.283).format("00.00%");t(i),d.addClass("active").css({"background-color":d.data("hovercolour")}).find("span.swatch").css({"background-color":b[0].highlightColor}).end().find("span.pct").text(e)}else t(i)}),plenty_admin.UI.field.taskFinancesGraphEl.on("mouseout",function(){t(i)}),plenty_admin.UI.field.renderedGraphs.push(plenty_admin.UI.field.taskFinancesGraph)}},plenty_admin.UI.field.weatherTabs.DOM=plenty_admin.UI.field.DOM.find(".field_weather_data"),plenty_admin.UI.field.assetTabs.DOM=plenty_admin.UI.field.DOM.find(".field_asset_data"),plenty_admin.UI.field.tempGraphEl=plenty_admin.UI.field.DOM.find(".tab-content .tab-pane#temp canvas"),plenty_admin.UI.field.moistureGraphEl=plenty_admin.UI.field.DOM.find(".tab-content .tab-pane#moisture canvas"),plenty_admin.UI.field.precipGraphEl=plenty_admin.UI.field.DOM.find(".tab-content .tab-pane#precip canvas"),plenty_admin.UI.field.gddGraphEl=plenty_admin.UI.field.DOM.find(".tab-content .tab-pane#gdd canvas"),plenty_admin.UI.field.financesGraphEl=plenty_admin.UI.field.DOM.find(".tab-content .tab-pane#finances canvas"),Chart.defaults.global.responsive=!0,Chart.defaults.global.maintainAspectRatio=!1,Chart.defaults.global.scaleFontFamily="'Lucida Console', Monaco, monospace",Chart.defaults.Line.scaleShowHorizontalLines=!0,Chart.defaults.Line.scaleShowVerticalLines=!0,Chart.defaults.Line.scaleShowGridLines=!0,Chart.defaults.Line.pointHitDetectionRadius=1,plenty_admin.REST.get_fieldCrops_order_by_year_descending=function(a,b){plenty_admin.REST.getByFieldOrderByYearDescending=plenty_admin.api.one("fieldCrops/getByFieldOrderByYearDescending",a),plenty_admin.REST.getByFieldOrderByYearDescending.get().then(function(a){if(console.log("fieldCrops/getByFieldOrderByYearDescending",a.body()),Array.isArray(a.body()))var c=plenty_admin.REST.get_array_from_data(a.body());else var c=a.body();b&&"function"==typeof b&&b(c)})},plenty_admin.REST.get_activities_by_field_crop_order_by_desc=function(a,b){plenty_admin.REST.getByFieldCropOrderByDateAsc=plenty_admin.api.one("activities/getByFieldCropOrderByDateAsc",a),plenty_admin.REST.getByFieldCropOrderByDateAsc.get().then(function(a){if(console.log("activities/getByFieldCropOrderByDateAsc",a.body()),Array.isArray(a.body()))var c=plenty_admin.REST.get_array_from_data(a.body());else var c=a.body();b&&"function"==typeof b&&b(c)})},plenty_admin.REST.fields.getGrowthStageFile=function(a,b,c){plenty_admin.REST.growthStageFile=plenty_admin.api.all("growthStageFile/getImage"),plenty_admin.REST.growthStageFile.get(a).then(function(a){console.log("growthStageImageString: ",a().data),c&&"function"==typeof c&&c(a().data,b)},function(){console.log("getting growth stage image failed: "),c&&"function"==typeof c&&c("NO IMAGE AVAILABLE",b)})},plenty_admin.REST.get_activity_finances_for_date_range=function(a,b,c,d){plenty_admin.REST.getActivityFinancesForDateRange=plenty_admin.api.one("activities/getActivityFinancesForDateRange",a+"/"+b+"/"+c),plenty_admin.REST.getActivityFinancesForDateRange.get().then(function(a){if(console.log("activities/getActivityFinancesForDateRange",a.body()),Array.isArray(a.body()))var b=plenty_admin.REST.get_array_from_data(a.body());else var b=a.body();d&&"function"==typeof d&&d(b)})},plenty_admin.REST.get_weather_days_with_dateRange=function(a,b,c,d){plenty_admin.REST.getWatherDaysByFieldAndByDateRange=plenty_admin.api.one("fields/getWatherDaysByFieldAndByDateRange",a+"/"+b+"/"+c),plenty_admin.REST.getWatherDaysByFieldAndByDateRange.get().then(function(a){if(Array.isArray(a.body()))var b=plenty_admin.REST.get_array_from_data(a.body());else var b=a.body();d&&"function"==typeof d&&d(b)},function(a){console.error("plenty_admin.REST.get_weather_days_with_dateRange failed: ",a),bootbox.dialog({message:"plenty_admin.REST.get_weather_days_with_dateRange failed.",className:"danger",buttons:{danger:{label:"OK",className:"btn-danger",callback:plenty_admin.HELPER.hideLoadingOverlay}}})})},plenty_admin.REST.get_field_equipments_with_fieldId=function(a,b){plenty_admin.REST.getFieldEquipmentsWithFieldId=plenty_admin.api.one("equipment/getByField",a),plenty_admin.REST.getFieldEquipmentsWithFieldId.get().then(function(a){if(Array.isArray(a.body()))var c=plenty_admin.REST.get_array_from_data(a.body());else var c=a.body();b&&"function"==typeof b&&b(c)})},plenty_admin.DATA.load_field_observation=function(a,b){plenty_admin.REST.getObservationById=plenty_admin.api.one("observations/getObservation",a),plenty_admin.REST.getObservationById.get().then(function(a){console.log("observation: ",a),b&&"function"==typeof b&&b(a)})},plenty_admin.UI.map={},plenty_admin.UI.map.allCropTypes={},plenty_admin.UI.map.DOM=plenty_admin.UI.DOM.find("#map-container"),plenty_admin.UI.map.filterControls=$(".filter_controls"),plenty_admin.UI.map.toggleFilters=plenty_admin.UI.map.filterControls.find(".toggleFilters a"),plenty_admin.UI.map.farms_quickfilter=plenty_admin.UI.map.filterControls.find(".quickFilter_farms"),plenty_admin.UI.map.orgs_quickfilter=plenty_admin.UI.map.filterControls.find(".quickFilter_organizations"),plenty_admin.UI.map.minCLUZoom=15,plenty_admin.UI.map.applicableFilters=["organizations","farms","fields","croptypes","plans"],plenty_admin.UI.map.filtered_field_polygons=[],plenty_admin.UI.map.MODAL_equipment=$("body").find(".modal#equipment"),plenty_admin.UI.map.MODAL_activity=$("body").find(".modal#activity"),plenty_admin.UI.field.taskFinancesGraphEl=plenty_admin.UI.map.MODAL_activity.find("canvas#taskGraph"),plenty_admin.UI.map.isInit=0,plenty_admin.UI.map.init=function(){function a(){var a=new google.maps.LatLng(38.017922,-95.494064),b={center:a,mapTypeId:google.maps.MapTypeId.HYBRID,zoom:plenty_admin.UI.map.minCLUZoom,mapTypeControl:!1,streetViewControl:!1};plenty_admin.MAPS.mainMap=plenty_admin.MAPS.create_map("map-container",b),plenty_admin.MAPS.set_on_idle_event(plenty_admin.MAPS.mainMap,function(){console.log("map bounds changed");var a=plenty_admin.MAPS.mainMap.getZoom();console.log("map zoom: ",a),plenty_admin.DATA.userFilters&&0==plenty_admin.MAPS.edit_field_state&&plenty_admin.UI.map.add_equipment_to_map()}),plenty_admin.MAPS.set_on_click_event(plenty_admin.MAPS.mainMap,function(a){console.log("map clicked",a),plenty_admin.UI.filters.toggleFilters("close"),plenty_admin.UI.map.farms_quickfilter.popover("hide"),plenty_admin.UI.map.orgs_quickfilter.popover("hide")}),plenty_admin.MAPS.add_field_control(plenty_admin.MAPS.mainMap),plenty_admin.MAPS.add_zoom_to_fields_control(plenty_admin.MAPS.mainMap),plenty_admin.DATA.eventCollector=window.eventcollector(8,1e4),plenty_admin.REST.getCropTypes(),plenty_admin.REST.getTillageTypes(),plenty_admin.REST.getIrrigationTypes(),plenty_admin.REST.getEquipmentTypes(),plenty_admin.REST.getBrandTypes(),plenty_admin.REST.getGrowthMethods(),plenty_admin.DATA.eventCollector.on("alldone",function(){plenty_admin.HELPER.hideLoadingOverlay()})}console.log("plenty_admin.UI.map.init"),plenty_admin.UI.currentScreen=plenty_admin.UI.map.DOM,plenty_admin.MAPS.add_field_state=1,plenty_admin.MAPS.edit_field_state=0,"object"==typeof google&&"object"==typeof google.maps?a():google.maps.event.addDomListener(window,"load",a),plenty_admin.UI.map.toggleFilters.click(function(){return plenty_admin.UI.filters.toggleFilters(),!1}),plenty_admin.UI.map.farms_quickfilter.popover({content:function(){var a=plenty_admin.UI.filters.DOM.find(".filter-set.farms .all-filters").clone(!0,!0).addClass("farms_quickfilter_popover").show();return a},title:'<button type="button" id="close" class="close" onclick="plenty_admin.UI.map.farms_quickfilter.popover(&quot;hide&quot;);">&times;</button>',html:!0,id:"",placement:"bottom"}).parent().delegate('a, input[type="checkbox"]',"click",function(){return!1}).end().on("show.bs.popover",function(){plenty_admin.UI.map.orgs_quickfilter.popover("hide")}).on("mouseenter",function(){var a=this;$(this).popover("show"),$(".popover").on("mouseleave",function(){$(a).popover("hide")})}).on("mouseleave",function(){var a=this;setTimeout(function(){$(".popover:hover").length||$(a).popover("hide")},300)}),plenty_admin.UI.map.orgs_quickfilter.popover({content:function(){var a=plenty_admin.UI.filters.DOM.find(".filter-set.organizations .all-filters").clone(!0,!0).addClass("orgs_quickfilter_popover").show();return a},html:!0,title:'<button type="button" id="close" class="close" onclick="plenty_admin.UI.map.orgs_quickfilter.popover(&quot;hide&quot;);">&times;</button>',placement:"bottom"}).parent().delegate('a, input[type="checkbox"]',"click",function(){return!1}).end().on("show.bs.popover",function(){plenty_admin.UI.map.farms_quickfilter.popover("hide")}).on("mouseenter",function(){var a=this;$(this).popover("show"),$(".popover").on("mouseleave",function(){$(a).popover("hide")})}).on("mouseleave",function(){var a=this;setTimeout(function(){$(".popover:hover").length||$(a).popover("hide")},300)})},plenty_admin.UI.map.add_equipment_to_map=function(){if(!plenty_admin.UI.map.adding_map_equipment){plenty_admin.UI.map.adding_map_equipment=!0;var a=plenty_admin.MAPS.mainMap.getBounds(),b={};b.maxLongitude=a.getNorthEast().lng(),b.minLongitude=a.getSouthWest().lng(),b.maxLatitude=a.getNorthEast().lat(),b.minLatitude=a.getSouthWest().lat(),console.log("BOUNDARY: ",a,a.getNorthEast(),b),plenty_admin.REST.fields.getEquipmentLocationForFilter(b,function(a){plenty_admin.UI.map.adding_map_equipment=!1,console.log("Equipments",a);var b=[];if(a.length<plenty_admin.MAPS.equipment_pins.length){for(var c=[],d=0;d<plenty_admin.MAPS.equipment_pins.length;d++){var e=plenty_admin.MAPS.equipment_pins[d],f=$.grep(a,function(a){return e.id===a.id});0==f.length&&(e._index=d,c.push(e))}if(c.length>0)for(var g=c.length-1;g>=0;g--)$(c[g].markerWrapper_).remove(),plenty_admin.MAPS.equipment_pins.splice(c[g]._index,1)}plenty_admin.UI.map.isInit<1?plenty_admin.UI.map.isInit+=1:(a.forEach(function(a){var c=$.grep(plenty_admin.MAPS.equipment_pins,function(b){return b.id===a.id});if(0===c.length){var d=new google.maps.LatLng(a.latitude,a.longitude);b.push(d),plenty_admin.UI.map.latlngbounds.extend(d),a.latlng=d;var e={onMouseOver:function(){$(this.markerContent_).find(".marker").addClass("hover"),$(this.markerWrapper_).css({zIndex:10}),plenty_admin.MAPS.polygon_tooltip.show("<strong>"+a.name+"</strong><br /><p>Drag to reposition, right click to delete</p>")},onMouseOut:function(){$(this.markerContent_).find(".marker").removeClass("hover"),$(this.markerWrapper_).css({zIndex:1}),plenty_admin.MAPS.polygon_tooltip.hide()},onClick:function(){console.log("event:",this,this.args),plenty_admin.UI.map.clickedEquipment=!0;setTimeout(function(){plenty_admin.UI.map.clickedEquipment=!1},300);plenty_admin.MAPS.show_equipment_pin_context_menu(a,this),plenty_admin.MAPS.polygon_tooltip.hide()},onDragEnd:function(){for(var b=this,c=null,d=0;d<plenty_admin.UI.map.filtered_field_polygons.length;d++){var e=plenty_admin.UI.map.filtered_field_polygons[d];if(google.maps.geometry.poly.containsLocation(b.position,e)){c=e;break}}return c?c.id===a.fieldEquipmentDto.fieldId?plenty_admin.MAPS.update_fixed_equipment_position(a,b):plenty_admin.MAPS.update_fixed_equipment_position_and_change_field(a,c,b):(plenty_admin.MAPS.update_fixed_equipment_position(a,b),plenty_admin.MAPS.delete_field_equipment(a,b)),!1}};plenty_admin.MAPS.draw_pin(a,e,plenty_admin.MAPS.mainMap)}}),plenty_admin.DATA.eventCollector.done("equipment"))})}},plenty_admin.UI.field.show_activity_modal=function(a,b,c){console.log("show_activity_modal",a,b),plenty_admin.UI.map.MODAL_activity.find(".modal-title").text(plenty_admin.DATA.activityTypes[a.activityTypeId].name).end().find("button.delete").off("click").on("click",function(){plenty_admin.UI.map.MODAL_activity.find(".modal-content").addClass("blur").end().find(".confirmDelete").show()}).end().find("button.cancel").off("click").on("click",function(){plenty_admin.UI.map.MODAL_activity.find(".modal-content").removeClass("blur").end().find(".confirmDelete").hide()}).end().find(".confirmDelete button.delete").off("click").on("click",function(){plenty_admin.REST.deleteActivity["delete"](a.id).then(function(a){console.log("Activity Deleted:",a),plenty_admin.UI.map.MODAL_activity.modal("hide"),c.remove()})}).end().on("shown.bs.modal",function(){plenty_admin.UI.field.renderTaskFinancesGraph(b),plenty_admin.UI.field.renderTasks(b)}).modal("show")},plenty_admin.UI.field.show_equipment_modal=function(a){console.log("show_equipment_modal",a),plenty_admin.REST.fields.getEquipmentImage(a.id,function(a){plenty_admin.UI.map.MODAL_equipment.find(".image").html("<img src='data:image/jpeg;base64,"+a+"' width='100%'/>")});var b=a.equipmentObservationDto?a.equipmentObservationDto.type:"null";switch(plenty_admin.UI.map.MODAL_equipment.removeClass("MOVEABLE WELL SOIL_MOISTURE null").addClass(b).find(".modal-title").text(a.equipmentTypeIds[0].name).end().find(".name").text(a.name).end().find(".lat").text(a.latitude).end().find(".lng").text(a.longitude),b){case null:break;case"MOVEABLE":plenty_admin.UI.map.MODAL_equipment.find(".equipmentObservationHeaders.MOVEABLE").find(".speed b").text(a.equipmentObservationDto.speed).end().find(".fuel b").text(a.equipmentObservationDto.fuelAmount);break;case"WELL":plenty_admin.UI.map.MODAL_equipment.find(".equipmentObservationHeaders.WELL").find(".time b").text(plenty_admin.HELPER.formatJavaDate(a.equipmentObservationDto.observationTime).time).end().find(".reading b").text(a.equipmentObservationDto.meterReading);break;case"SOIL_MOISTURE":plenty_admin.UI.map.MODAL_equipment.find(".equipmentObservationHeaders.SOIL_MOISTURE").find(".time b").text(plenty_admin.HELPER.formatJavaDate(a.equipmentObservationDto.observationTime).time).end().find(".soilDepthUOM").text(a.equipmentObservationDto.depthUOM.name).end().find(".moistureUOM").text(a.equipmentObservationDto.moistureUOM.name);for(var c=0;c<a.equipmentObservationDto.readings.length;c++){var d=a.equipmentObservationDto.readings[c],e=["<tr>","<td>",d.depth,"</td>","<td>",d.moisture,"</td>","</tr>"].join("");plenty_admin.UI.map.MODAL_equipment.find(".equipmentObservationHeaders.SOIL_MOISTURE tbody").append(e)}}plenty_admin.UI.map.MODAL_equipment.find(".editable").editable(plenty_admin.REST.inline_editing_options).end().modal("show")},plenty_admin.UI.map.populate=function(a,b){
console.log("plenty_admin.UI.map.populate",a,b),plenty_admin.UI.map.latlngbounds=new google.maps.LatLngBounds,plenty_admin.REST.get_x_by_filtered("BoundaryPoints",function(c){console.log("boundaryPoints",c().data);var d=c().data;plenty_admin.MAPS.mainMap.clusterer?plenty_admin.MAPS.mainMap.clusterer.clearMarkers():plenty_admin.MAPS.remove_all_polygons(plenty_admin.UI.map.filtered_field_polygons),plenty_admin.UI.map.filtered_field_polygons=[],d.forEach(function(a){var b=$.grep(plenty_admin.UI.map.allCropTypes,function(b){return b.label===a.cropTypeName}).length>0;b||(plenty_admin.UI.map.allCropTypes[a.cropTypeName.replace(/ /g,"")]=a.cropTypeName)}),console.log("plenty_admin.UI.map.allCropTypes",plenty_admin.UI.map.allCropTypes),plenty_admin.UI.brand_palette.setNumberRange(0,Object.keys(plenty_admin.UI.map.allCropTypes).length>0?Object.keys(plenty_admin.UI.map.allCropTypes).length:100);var e={},f=0;for(id in plenty_admin.UI.map.allCropTypes)plenty_admin.UI.map.allCropTypes.hasOwnProperty(id)&&(e[id]={color:"#"+plenty_admin.UI.brand_palette.colourAt(f),colour:"#"+("none"===plenty_admin.UI.map.allCropTypes[id].toLowerCase()||"nocroptypesfound"===plenty_admin.UI.map.allCropTypes[id].toLowerCase()?"000000":plenty_admin.UI.brand_palette.colourAt(f)),label:plenty_admin.UI.map.allCropTypes[id]},f+=1);plenty_admin.MAPS.legend?plenty_admin.MAPS.update_map_legend(e):plenty_admin.MAPS.add_map_legend(plenty_admin.MAPS.mainMap,e),d.forEach(function(c){var d=[];c.boundaryPointDtos.forEach(function(a,c){var e=new google.maps.LatLng(a.latitude,a.longitude,!0);e.seqNumber=a.seqNumber,d.push(e),(void 0===b||null===b||b===!1)&&plenty_admin.UI.map.latlngbounds.extend(d[c])});var e=$.grep(a,function(a){return c.fieldId===a.id}),f="NO NAME";if(e.length>0?f=e[0].name:null,d.length>2){var g={boundaries:d,editable:!1,fieldId:c.fieldId,id:c.fieldId,fieldName:f,isCoords:!0,cropType:c.cropTypeName},h={onEdit:function(){},onMouseOver:function(){var a=this;this.setOptions({strokeOpacity:1,fillOpacity:.65}),plenty_admin.MAPS.polygon_tooltip.show(["<div class='polyToolTip polyToolTip_"+g.id+"'>","<p>Name:<br><strong>",g.fieldName,"</strong></p>","<p>","Crop:<br><strong>"+plenty_admin.HELPER.capitalizeFirstLetter(g.cropType)+"</strong>","</p>","<p>Acreage:<br><strong>",g.acreage?g.acreage:plenty_admin.MAPS.get_polygon_area(a),"</strong></p>","<p class='growthStage'>Growth Stage:<br><strong>",a.growthStage?a.growthStage.name:plenty_admin.REST.fields.getGrowthStageById(g.growthStageId?g.growthStageId:1,function(b){a.growthStage=b,$("#tt .polyToolTip_"+g.id+" .growthStage strong").text(b.name)}),"</strong></p>","<p class='mbn'>Click for options</p>"].join(""))},onMouseOut:function(){this.setOptions({strokeOpacity:.8,fillOpacity:.35}),plenty_admin.MAPS.polygon_tooltip.hide()},onMouseMove:function(){this.setOptions({strokeOpacity:.8,fillOpacity:.35})},onClick:function(a){if(plenty_admin.UI.map.clickedEquipment)return void(plenty_admin.UI.map.clickedEquipment=!1);console.log("polygon clicked");{var b=this;setTimeout(function(){if(b.isDblClick)b.isDblClick=!1;else{{a.latLng.lat(),a.latLng.lng()}$("body").addClass("loading"),plenty_admin.REST.fields.getFieldById(b.id,function(c){$("body").removeClass("loading");var d=$.extend(g,c);d.rc_lat=a.latLng.lat(),d.rc_lng=a.latLng.lng(),plenty_admin.MAPS.show_polygon_context_menu(d,plenty_admin.MAPS.mainMap,"map_context_menu",b)}),plenty_admin.MAPS.polygon_tooltip.hide()}},400)}},onDoubleClick:function(a){a.stop(),this.isDblClick=!0,console.log("polygon double clicked: ",a),plenty_admin.HELPER.showLoadingOverlay();var b=this,c=[];b.getPath().getArray().forEach(function(a,b){var d={latitude:a.lat(),longitude:a.lng(),seqNumber:b};c.push(d)});var d=null;for(prop in a)if(a.hasOwnProperty(prop)&&a[prop]instanceof MouseEvent){d=a[prop];break}return $(d&&d.target).hasClass("marker")?void console.log("marker clicked instead of poly - return!"):(plenty_admin.HELPER.showLoadingOverlay(),void plenty_admin.REST.fields.getFieldById(this.id,function(a){a.fillColor=b.fillColor,a.strokeColor=b.strokeColor,a.boundaries=c,a.isCoords=!1;var d=[{"class":"back",name:"Map",clickHandler:function(){return plenty_admin.UI.currentScreen.fadeOut("normal",function(){plenty_admin.UI.field.clear(),plenty_admin.UI.currentScreen=plenty_admin.UI.map.DOM,plenty_admin.UI.currentScreen.closest(".fill-area").fadeIn("normal").parent().find(".filter_controls").fadeIn("fast",function(){google.maps.event.trigger(plenty_admin.MAPS.mainMap,"resize"),plenty_admin.MAPS.mainMap.fitBounds(plenty_admin.UI.map.latlngbounds)})}),!1}},{"class":"active",name:a.name,clickHandler:null}];plenty_admin.UI.field.DOM.find(".breadcrumb-trail").remove().end().prepend(plenty_admin.UI.build_breadcrumb_trail(d)),plenty_admin.UI.field.init(a,"map")}))}},i=plenty_admin.MAPS.draw_polygon(g,h,plenty_admin.MAPS.mainMap);plenty_admin.UI.map.filtered_field_polygons.push(i)}}),d.length>0&&(b===!0||void 0===b||null===b)&&plenty_admin.MAPS.mainMap.fitBounds(plenty_admin.UI.map.latlngbounds),$(window).on("resize",function(){1==plenty_admin.MAPS.edit_field_state?plenty_admin.MAPS.zoomToPolygon(plenty_admin.MAPS.polygonToEdit,plenty_admin.MAPS.mainMap):plenty_admin.MAPS.mainMap.fitBounds(plenty_admin.UI.map.latlngbounds)}),plenty_admin.DATA.eventCollector.done("boundary points")})},$(document).on("map_data_ready",function(){plenty_admin.UI.map.init(),plenty_admin.DATA.load_user_filters(function(a){console.log("filters",a),plenty_admin.DATA.userFilters=a().data,plenty_admin.DATA.data_source=plenty_admin.DATA.userFilters.possibleFilteringEntitiesDtoList,plenty_admin.DATA.update_filters(null,!0)})}),plenty_admin.UI.dashboard={},plenty_admin.UI.dashboard.DOM=plenty_admin.UI.DOM.find("#dashboard-container"),plenty_admin.UI.dashboard.init=function(){console.log("plenty_admin.UI.dashboard.init"),plenty_admin.UI.currentScreen=plenty_admin.UI.dashboard.DOM,plenty_admin.HELPER.hideLoadingOverlay()},plenty_admin.UI.dashboard.populate=function(){},$(document).on("dashboard_data_ready",function(){plenty_admin.UI.dashboard.init()}),plenty_admin.UI.plans={},plenty_admin.UI.plans.DOM=plenty_admin.UI.DOM.find("#plans-container"),plenty_admin.UI.plans.filterControls=plenty_admin.UI.plans.DOM.find(".filter_controls"),plenty_admin.UI.plans.toggleFilters=plenty_admin.UI.plans.filterControls.find(".toggleFilters a"),plenty_admin.UI.plans.farms_quickfilter=plenty_admin.UI.plans.filterControls.find(".quickFilter_farms"),plenty_admin.UI.plans.orgs_quickfilter=plenty_admin.UI.plans.filterControls.find(".quickFilter_organizations"),plenty_admin.UI.plans.plansTable=plenty_admin.UI.plans.DOM.find("#plans-list"),plenty_admin.UI.plans.applicableFilters=["organizations","farms","fields","croptypes","plans"],plenty_admin.UI.plans.add_template_plan_modal=plenty_admin.UI.plans.DOM.closest("body").find(".modal.add-plan"),plenty_admin.UI.plans.dummyProfitProj={planDto:{id:111,name:"dummyPlan",description:"dummy plan because getting profit projection failed",state:"UNSCHEDULED"},fieldDto:{id:1,name:"dummyField",acres:123},fieldCropDto:{},revenue:12345,expense:65432,profit:88776,profitPerAcre:234},plenty_admin.UI.plans.init=function(){console.log("plenty_admin.UI.plans.init"),plenty_admin.UI.currentScreen=plenty_admin.UI.plans.DOM,plenty_admin.UI.plans.toggleFilters.click(function(){return plenty_admin.UI.filters.toggleFilters(),!1}),plenty_admin.UI.plans.farms_quickfilter.popover({content:function(){var a=plenty_admin.UI.filters.DOM.find(".filter-set.farms .all-filters").clone(!0,!0).addClass("farms_quickfilter_popover").show();return a},title:'<button type="button" id="close" class="close" onclick="plenty_admin.UI.plans.farms_quickfilter.popover(&quot;hide&quot;);">&times;</button>',html:!0,id:"",placement:"bottom"}).parent().delegate('a, input[type="checkbox"]',"click",function(){return!1}).end().on("show.bs.popover",function(){plenty_admin.UI.plans.orgs_quickfilter.popover("hide")}).on("mouseenter",function(){var a=this;$(this).popover("show"),$(".popover").on("mouseleave",function(){$(a).popover("hide")})}).on("mouseleave",function(){var a=this;setTimeout(function(){$(".popover:hover").length||$(a).popover("hide")},300)}),plenty_admin.UI.plans.orgs_quickfilter.popover({content:function(){var a=plenty_admin.UI.filters.DOM.find(".filter-set.organizations .all-filters").clone(!0,!0).addClass("orgs_quickfilter_popover").show();return a},html:!0,title:'<button type="button" id="close" class="close" onclick="plenty_admin.UI.plans.orgs_quickfilter.popover(&quot;hide&quot;);">&times;</button>',placement:"bottom"}).parent().delegate('a, input[type="checkbox"]',"click",function(){return!1}).end().on("show.bs.popover",function(){plenty_admin.UI.plans.farms_quickfilter.popover("hide")}).on("mouseenter",function(){var a=this;$(this).popover("show"),$(".popover").on("mouseleave",function(){$(a).popover("hide")})}).on("mouseleave",function(){var a=this;setTimeout(function(){$(".popover:hover").length||$(a).popover("hide")},300)});var a=Date.now(),b=plenty_admin.HELPER.formatJavaDate(a),c=b.obj.getUTCMonth()+1>9?b.obj.getUTCMonth()+1:"0"+(b.obj.getUTCMonth()+1),d=b.obj.getUTCDate()>9?b.obj.getUTCDate():"0"+b.obj.getUTCDate(),e=b.year+"-"+c+"-"+d,f=plenty_admin.UI.plans.add_template_plan_modal.find("input.datepicker");f.datepicker({autoclose:!0,startDate:"+0d"}),f.datepicker("setValue",e).datepicker("update"),f.on("show hide",function(a){a.stopPropagation()}),plenty_admin.UI.plans.DOM.find(".btn.add-plan-to-displayed").click(function(){var a=plenty_admin.UI.plans.DOM.find("tbody.fieldPlans"),b=function(a){for(var b=0;b<a.length;b++)0==$(this).find(".plan").length?plenty_admin.UI.plans.add_template_plan_modal.addClass("plantAndStart"):plenty_admin.UI.plans.add_template_plan_modal.removeClass("plantAndStart");plenty_admin.UI.plans.add_template_plan_modal.data("fieldSet",a).modal("show")};if(1===a.length){for(var c=0;c<a.length;c++){var d=a[c];$(d).find("tr.plan").each(function(){console.log("plan for this tbody: ",$(this));var a=parseInt($(this).data("manifested_plan_id"));console.log("manifestedPlanId",a),plenty_admin.UI.plans.add_template_plan_modal.find(".templatePlan-"+a).addClass("hide")})}0==plenty_admin.UI.plans.add_template_plan_modal.find(".templatePlan:not(.hide)").length?bootbox.dialog({message:"You have added all available plan templates.",className:"info",buttons:{danger:{label:"OK",className:"btn-primary",callback:function(){plenty_admin.HELPER.hideLoadingOverlay()}}}}):b(a)}else b(a)}),plenty_admin.UI.plans.add_template_plan_modal.find('a[data-toggle="tab"]').on("show.bs.tab",function(a){switch(console.log("tab switch: ",$(a.target).data("target")),$(a.target).data("target")){case"#plans_list":plenty_admin.UI.plans.add_template_plan_modal.find("button.next").show().end().find("button.back, button.add-plan").hide();break;case"#plans_criterea":plenty_admin.UI.plans.add_template_plan_modal.find("button.next").hide().end().find("button.back, button.add-plan").show()}}).end().find("button.next").click(function(){console.log("next"),plenty_admin.UI.plans.add_template_plan_modal.find('.nav-tabs a[data-target="#plans_criterea"]').tab("show")}).end().find("button.back").click(function(){plenty_admin.UI.plans.add_template_plan_modal.find('.nav-tabs a[data-target="#plans_list"]').tab("show")}).end().find("button.add-plan").click(function(){function a(){var a=plenty_admin.UI.plans.add_template_plan_modal.find("#plantationDate").data("datepicker").date;h=a.getUTCFullYear()+"-"+(a.getUTCMonth()+1<10?"0"+(a.getUTCMonth()+1):a.getUTCMonth()+1)+"-"+(a.getUTCDate()<10?"0"+a.getUTCDate():a.getUTCDate())}function b(){var a=plenty_admin.UI.plans.add_template_plan_modal.find("#replaceStartingDate").data("datepicker").date;i=a.getUTCFullYear()+"-"+(a.getUTCMonth()+1<10?"0"+(a.getUTCMonth()+1):a.getUTCMonth()+1)+"-"+(a.getUTCDate()<10?"0"+a.getUTCDate():a.getUTCDate())}var c=[],d=$(this);d.button("loading"),plenty_admin.UI.plans.add_template_plan_modal.find("input[type='checkbox']:checked").each(function(){c.push($(this).closest("tr"))}),console.log("selectedPlanTemplates",c),plenty_admin.UI.plans.add_plan_eventCollector=window.eventcollector(c.length,1e4),plenty_admin.UI.plans.add_plan_eventCollector.on("alldone",function(){plenty_admin.HELPER.hideLoadingOverlay()});for(var e=0;e<c.length;e++){for(var f=c[e].data("templatePlan"),g=plenty_admin.UI.plans.add_template_plan_modal.find("#autoSchedule").is(":checked"),h=null,i=null,j=plenty_admin.UI.plans.add_template_plan_modal.data("fieldSet"),k=[],l=plenty_admin.UI.plans.get_plan_start_end_range(),m=(j[m],0);m<j.length;m++){var n=0==$(j[m]).find(".plan.active").length;n?(a(),i=null):(b(),h=null),k.push({fieldCropId:$(j[m]).find(".field-row").data("fieldDto").id,replacementStartDate:i,plantationDate:h})}var o=parseInt(plenty_admin.UI.plans.add_template_plan_modal.find("#organizationList option:selected").val()),p={templatePlanId:f.id,organizationId:o,fieldCropReplaceDatePlantationDateDtos:k,autoSchedule:g,commit:!1,schedulerRequestArguments:{organizationId:o,triggeringUserId:plenty_admin.DATA.userDetails.id,dateRangeStart:l.dateRangeStart,dateRangeEnd:l.dateRangeEnd,planningTimeAllowed:"ONE_MINUTE"}};console.log("templatePlanApplicationDto",p),plenty_admin.UI.plans.add_template_plan_modal.modal("hide"),plenty_admin.HELPER.showLoadingOverlay(),plenty_admin.REST.applyTemplatePlanToFieldCrops(p,function(a){plenty_admin.UI.plans.add_template_plan_modal.data("fieldSet").each(function(){var b=({planning:a.planning,possible:a.possible,ready:a.ready},plenty_admin.UI.plans.create_plan_projection(a,"templatePlan"));b.data("planManifestationResultsDto",a).data("templatePlanApplicationDto",p),$(this).append(b)}),plenty_admin.UI.plans.add_plan_eventCollector.done("template plans added")})}}).end().find("#autoSchedule").bootstrapSwitch().end().on("show.bs.modal",function(){console.log("show add plan modal")}).on("hidden.bs.modal",function(){$(this).removeClass("addPlan plantAndStart");var a=$(this);a.find(".templatePlan").removeClass("hide alert-success").find("input[type=checkbox]").prop("checked",!1).end().end().find("button.add-plan").button("reset").end().find('a[data-toggle="tab"][data-target="#plans_criterea"]').parent().hide().end().end().find('a[data-toggle="tab"][data-target="#plans_list"]').trigger("click").end().find("button.next").prop("disabled",!0);setTimeout(function(){plenty_admin.UI.plans.add_template_plan_modal.find("button.add-plan").prop("disabled",!0)},50)})},plenty_admin.UI.plans.get_plan_start_end_range=function(){var a=Date.now()+-15552e6,b=new Date(a),c=b.getUTCFullYear()+"-"+(b.getUTCMonth()+1<10?"0"+(b.getUTCMonth()+1):b.getUTCMonth()+1)+"-"+(b.getUTCDate()<10?"0"+b.getUTCDate():b.getUTCDate()),d=Date.now()+15552e6,e=new Date(d),f=e.getUTCFullYear()+"-"+(e.getUTCMonth()+1<10?"0"+(e.getUTCMonth()+1):e.getUTCMonth()+1)+"-"+(e.getUTCDate()<10?"0"+e.getUTCDate():e.getUTCDate()),g={dateRangeEnd:f,dateRangeStart:c};return g},plenty_admin.UI.plans.get_state_icon_class=function(a){var b="thumbs-down";switch(a){case"SCHEDULED":b="calendar";break;case"IN_PROGRESS":b="hourglass-half";break;case"FINISHED":b="flag-checkered";break;case"REPLACED":b="exchange";break;case"UNSCHEDULED":b="calendar-minus-o";break;case"SCHEDULING":b="hourglass-half";break;case"CONFLICT":b="hand-stop-o"}return b},plenty_admin.UI.plans.create_plan_projection=function(a,b){switch(b){case"plan":var c={plan:a.planDto,field:a.fieldDto,fieldCrop:a.fieldCropDto,activities:a.activityListDetailedFinancesDto,profitProjection:a,manifestedPlan:{manifestedFromId:a.planDto.manifestedFromId}};break;case"templatePlan":var c={plan:a.planManifestationResults[0].profitProjectionDto.planDto,field:a.planManifestationResults[0].profitProjectionDto.fieldDto,fieldCrop:a.planManifestationResults[0].profitProjectionDto.fieldCropDto,activities:a.planManifestationResults[0].profitProjectionDto.activityListDetailedFinancesDto,profitProjection:a.planManifestationResults[0].profitProjectionDto,manifestedPlan:a.planManifestationResults[0].manifestedPlan}}var d="ready",e=!1;if(c.plan.state)switch(c.plan.state){case"SCHEDULED":e=!0,d="calendar";break;case"IN_PROGRESS":e=!0,d="hourglass-half";break;case"FINISHED":e=!0,d="flag-checkered";break;case"REPLACED":e=!1,d="exchange";break;case"UNSCHEDULED":e=!1,d="calendar-minus-o";break;case"SCHEDULING":e=!1,d="hourglass-half";break;case"CONFLICT":e=!1,d="hand-stop-o"}var f="UNSCHEDULED SCHEDULING SCHEDULED CONFLICT IN_PROGRESS FINISHED REPLACED",g=$(["<tr data-id='"+c.plan.id+"' data-manifested_plan_id='"+c.manifestedPlan.manifestedFromId+"' class='plan"+(e?" active":"")+" pointer "+b+" "+c.plan.state+"' title='View Plan Details'>","<td width='7%' class='status text-center' title='This plan is currently "+c.plan.state+"'><i class='fa fa-"+d+"'></i><br/><span class='statusText'>"+c.plan.state+"</span></i></td>","<td width='19%'>"+c.plan.name+"<i class='glyphicon glyphicon-info-sign desc mls' title='"+c.plan.description+"' data-toggle='tooltip' data-placement='top'></i></td>","<td width='12%'>"+numeral(c.profitProjection.revenue).format("$0,0.00")+"</td>","<td width='12%'>"+numeral(c.profitProjection.expense).format("$0,0.00")+"</td>","<td width='12%'>"+numeral(c.profitProjection.profit).format("$0,0.00")+"</td>","<td width='12%'>"+plenty_admin.HELPER.formatJavaDate(c.plan.startDate).USDate+"</td>","<td width='18%' class='useplan'></td>","<td width='8%' class='text-right profitPerAcre'>"+numeral(c.profitProjection.profitPerAcre).format("$0,0.00")+"</td>","</tr>"].join("")).data("drilldownData",c);if("UNSCHEDULED"==c.plan.state){var h=$("<button class='btn btn-primary btn-sm' title='Use this plan'><span class='glyphicon glyphicon-ok'></span> Use Plan</button>");h.click(function(a){a.stopPropagation();var b=$(this),c=b.closest("tr").data("drilldownData"),d=b.closest("tr").data("templatePlanApplicationDto"),e=b.closest("tr").data("planManifestationResultsDto"),g=b.closest("tbody").find(".field-row"),h=g.data("fieldDto"),i=g.data("fieldCropDto");console.log("fieldDto",h),console.log("fieldCropDto",i);try{var j=b.closest("tbody").find(".plan.active").data("drilldownData").plan.name}catch(k){var j=null}var l=c.plan.name,m=b.closest("tr").data("manifested_plan_id");if(!d){var n=plenty_admin.UI.plans.get_plan_start_end_range();fieldCropReplaceDatePlantationDateDtos=[{fieldCropId:c.fieldCrop.id,replacementStartDate:c.plan.startDate,plantationDate:null}],d={templatePlanId:m,organizationId:c.plan.organizationId,fieldCropReplaceDatePlantationDateDtos:fieldCropReplaceDatePlantationDateDtos,autoSchedule:!1,commit:!0,schedulerRequestArguments:{organizationId:c.plan.organizationId,triggeringUserId:plenty_admin.DATA.userDetails.id,dateRangeStart:n.dateRangeStart,dateRangeEnd:n.dateRangeEnd,planningTimeAllowed:"ONE_MINUTE"}}}if(j)try{var o=d.fieldCropReplaceDatePlantationDateDtos[0].replacementStartDate,p="Are you sure you want to change</p><h4>"+j+"</h4><p>for</p><h4>"+l+"</h4><p>starting on</p><h4>"+o+"?"}catch(k){console.error("current plans dfo not have a templatePlanApplicationDto");var p="Are you sure you want to change</p><h4>"+j+"</h4><p>for</p><h4>"+l+"?</h4>"}else var q=$.grep(e.planManifestationResults,function(a){return a.manifestedPlan.fieldCropId===c.fieldCrop.id}),r=q[0].manifestedPlan.plantationDate,p="Are you sure you want to make</p><h4>"+l+"</h4><p>the active plan for</p><h4>"+h.name+"</h4><p>starting on</p><h4>"+r+"?";var s=$('<div class="row"><div class="col-md-12"> <p>'+p+"</h4></div> </div>");return bootbox.dialog({title:"Confirm Change Plan",message:s,className:"info",buttons:{"default":{label:"Cancel",className:"btn-default",callback:plenty_admin.HELPER.hideLoadingOverlay},primary:{label:"OK",className:"btn-primary",callback:function(){plenty_admin.HELPER.showLoadingOverlay(),console.log("templatePlanApplicationDto",d),d.commit=!0,plenty_admin.REST.applyTemplatePlanToFieldCrops(d,function(a){var c=b.closest("tbody").find("tr.plan.active"),d=a.planManifestationResults[0].profitProjectionDto.planDto.state,e=a.planManifestationResults[0].replacedPlan?a.planManifestationResults[0].replacedPlan.state:null;if(a.planManifestationResults[0].profitProjectionDtoForReplacedPlan)var g=a.planManifestationResults[0].profitProjectionDtoForReplacedPlan,h={plan:g.planDto,field:g.fieldDto,fieldCrop:g.fieldCropDto,activities:g.activityListDetailedFinancesDto,profitProjection:g,manifestedPlan:{manifestedFromId:g.planDto.manifestedFromId}};e&&c.removeClass("active "+f).addClass(e).data("profitProjection",g).data("drilldownData",h).find("td.status").removeClass(f).addClass(e).prop("title","This plan is currently "+e).find("i.fa").prop("class","").addClass("fa fa-"+plenty_admin.UI.plans.get_state_icon_class(e)).end().find("span.statusText").text(e),b.closest("tr.plan").removeClass(f).addClass("active "+d).find("i.fa").prop("class","").addClass("fa fa-"+plenty_admin.UI.plans.get_state_icon_class(d)).end().find("span.statusText").text(d).closest("td").prop("title","This plan is currently "+d),b.remove(),plenty_admin.HELPER.hideLoadingOverlay()})}}}}),!1}),g.find("td.useplan").append(h)}return g.find("i.desc").tooltip().end().click(function(a){a.stopPropagation(),console.log("clicked a plan");var b=$(this).data("drilldownData"),c=[{"class":"back",name:"Plans",clickHandler:function(){return plenty_admin.UI.currentScreen.fadeOut("normal",function(){plenty_admin.UI.plan.clear(),plenty_admin.UI.currentScreen=plenty_admin.UI.plans.DOM,plenty_admin.UI.currentScreen.fadeIn("normal")}),!1}},{"class":"active",name:b.field.name+", "+b.plan.name,clickHandler:null}];plenty_admin.UI.plan.DOM.find(".breadcrumb-trail").remove().end().prepend(plenty_admin.UI.build_breadcrumb_trail(c)),plenty_admin.UI.plan.init(b)}),"planning"===d&&(g.checkStatus=setTimeout(function(){plenty_admin.REST.getPlan(profitProjection.planDto.id,function(a){console.log("got plan from polling: ",a)})},5e3)),g},plenty_admin.UI.plans.create_field_tbody=function(a){var b=$("<tbody class='fieldPlans fieldPlans_"+a.id+"'/>");return b},plenty_admin.UI.plans.create_field_row=function(a,b,c){return $fieldHTML=$(["<tr class='field-row field-row-"+a.id+" category pointer' data-id='"+a.id+"' title='View the plan summary for this field'>","<td width='7%' class='fieldPreview'><img src='' class='pointer pull-left field_thumb_"+a.id+"'/></th>","<td width='19%'>","<h4 class=''>"+a.name+"</h4>","<span class='fieldDetails capitalize'>"+a.acres+"ac, "+plenty_admin.DATA.cropTypes[b.cropTypeId].name+"</span>","</td>","<td width='12%' class='revenue'></td>","<td width='12%' class='expense'></td>","<td width='12%' class='profit'></td>","<td width='12%' class='startDate'></td>","<td width='18%'>","<button class='btn btn-primary btn-inverted add-field-plan' title='Add plan(s) to compare cost projections'>","<span class='glyphicon glyphicon-plus'></span>Add Plan(s)","</button>","</td>","<td width='8%' class='text-right profitPerAcre' class='profitPerAcre'></td>","</tr>"].join("")),$fieldHTML.data("fieldDto",a).data("fieldCropDto",b).data("revenue",0).data("expense",0).data("profit",0).data("profitPerAcre",0).click(function(a){a.stopPropagation(),plenty_admin.UI.filters.toggleFilters("close"),plenty_admin.UI.plans.farms_quickfilter.popover("hide"),plenty_admin.UI.plans.orgs_quickfilter.popover("hide");var b=$(this),c=b.data("fieldDto");console.log("clicked a field");var d=[],e=b.closest("tbody").find("tr.plan:not(.UNSCHEDULED)");if(e.each(function(){d.push($(this).data("drilldownData"))}),0==e.length)bootbox.dialog({message:"There are currently no active plans for this field.",className:"info",buttons:{danger:{label:"OK",className:"btn-primary",callback:function(){plenty_admin.HELPER.hideLoadingOverlay()}}}});else{var f=[{"class":"back",name:"Plans",clickHandler:function(){return plenty_admin.UI.currentScreen.fadeOut("normal",function(){plenty_admin.UI.plan.clear(),plenty_admin.UI.currentScreen=plenty_admin.UI.plans.DOM,plenty_admin.UI.currentScreen.fadeIn("normal")}),!1}},{"class":"active",name:c.name+" Plan Summary",clickHandler:null}];plenty_admin.UI.plan.DOM.find(".breadcrumb-trail").remove().end().prepend(plenty_admin.UI.build_breadcrumb_trail(f)),plenty_admin.UI.plan.init(d)}}).find("button.add-field-plan").click(function(a){console.log("add field plan"),a.stopPropagation();var b=$(this),c=1==b.closest("tbody").find(".plan.active").length;c?plenty_admin.UI.plans.add_template_plan_modal.removeClass("addPlan"):plenty_admin.UI.plans.add_template_plan_modal.addClass("addPlan"),plenty_admin.UI.plans.add_template_plan_modal.data("fieldSet",b.closest("tbody.fieldPlans")).modal("show")}),plenty_admin.REST.fields.getAllBoundaryPointsByFieldAndBoundaryType(a.id,2,function(a,b,d){function e(a,b){if(k.length>0){k.prop("src",a);var c=k.clone(!0,!0);c.popover({content:"<img src='"+a+"' style='width:110px; height:110px;'/>",title:k.closest("tr").data("fieldDto").name,html:!0,id:"",placement:"right",container:"body"}).on("mouseenter",function(){var a=this;$(this).popover("show"),$(".popover").on("mouseleave",function(){$(a).popover("hide")})}).on("mouseleave",function(){var a=this;setTimeout(function(){$(".popover:hover").length||$(a).popover("hide")},300)});var d=k.closest(".flexbox-scroll_y").find(".floating-header .field-row-"+b+" .fieldPreview");d.find("img.field_thumb_"+b).remove(),d.append(c)}else{setTimeout(function(){console.log("checking field dom element"),e(a)},300)}}var f=new google.maps.LatLngBounds;a.forEach(function(a){f.extend(new google.maps.LatLng(a.latitude,a.longitude))});var g=f.getCenter(),h=c[d].color.substring(c[d].color.indexOf("#")+1),i="color:white|weight:2|fillcolor:0x"+h;a.forEach(function(a){i+="|"+a.latitude+","+a.longitude}),staticMapParams={center:g.lat()+","+g.lng(),size:"110x110",maptype:"hybrid",zoom:plenty_admin.MAPS.getBoundsZoomLevel(f,{width:110,height:110}),path:i};var j=plenty_admin.MAPS.get_static_maps_url(staticMapParams),k=plenty_admin.UI.plans.plansTable.find(".fieldPlans.fieldPlans_"+b+" .fieldPreview img");e(j,b),k.popover({content:"<img src='"+j+"' style='width:110px; height:110px;'/>",title:k.closest("tr").data("fieldDto").name,html:!0,id:"",placement:"right",container:"body"}).on("mouseenter",function(){var a=this;$(this).popover("show"),$(".popover").on("mouseleave",function(){$(a).popover("hide")})}).on("mouseleave",function(){var a=this;setTimeout(function(){$(".popover:hover").length||$(a).popover("hide")},300)})},b.cropTypeId),$fieldHTML},plenty_admin.UI.plans.populate=function(){plenty_admin.UI.plans.plansTable.find("tbody").remove();var a={},b=null;plenty_admin.UI.plans.allCropTypes=[];for(var c=0;c<plenty_admin.DATA.fieldCrops.length;c++){var d=plenty_admin.DATA.fieldCrops[c],e=d.fieldDto;console.log("field",e);var f=plenty_admin.UI.plans.create_field_tbody(e);plenty_admin.UI.plans.plansTable.append(f)}for(var c=0;c<plenty_admin.DATA.fieldCrops.length;c++){var d=plenty_admin.DATA.fieldCrops[c],e=d.fieldDto;console.log("fieldCrop",d),console.log("field",e),a[d.cropTypeId]||(plenty_admin.UI.brand_palette.setNumberRange(0,Object.keys(a).length>0?Object.keys(a).length:100),a[d.cropTypeId]={color:"#"+plenty_admin.UI.brand_palette.colourAt(Object.keys(a).length),colour:"#"+plenty_admin.UI.brand_palette.colourAt(Object.keys(a).length),label:plenty_admin.DATA.cropTypes[d.cropTypeId].name}),console.log("legendItems: ",a),b=plenty_admin.UI.plans.create_field_row(e,d,a),plenty_admin.UI.plans.plansTable.find("tbody.fieldPlans_"+e.id).prepend(b)}for(var g=0;g<plenty_admin.DATA.plans.length;g++){var h=plenty_admin.DATA.plans[g],e=(h.planDto,h.fieldDto),d=h.fieldCropDto,i=plenty_admin.UI.plans.create_plan_projection(h,"plan");i.data("profitProjection",h);var j=plenty_admin.UI.plans.plansTable.find("tbody.fieldPlans_"+e.id);j.append(i);var k=j.find("tr.field-row");k.data("revenue",k.data("revenue")+h.revenue).data("expense",k.data("expense")+h.expense).data("profit",k.data("profit")+h.profit).data("profitPerAcre",k.data("profitPerAcre")+h.profitPerAcre)}plenty_admin.UI.plans.plansTable.find("tr.field-row").each(function(a,b){console.log("field row: ",$(this),b),$(this).find(".profit").text(numeral($(b).data("profit")).format("$0,0.00")).end().find(".expense").text(numeral($(b).data("expense")).format("$0,0.00")).end().find(".revenue").text(numeral($(b).data("revenue")).format("$0,0.00")).end().find(".profitPerAcre").text(numeral($(b).data("profitPerAcre")).format("$0,0.00"))}),plenty_admin.HELPER.initFloatingHeaders(plenty_admin.UI.plans.plansTable,".field-row","#plans-wrapper"),plenty_admin.HELPER.hideLoadingOverlay()},plenty_admin.REST.getPlansFiltered=function(a){plenty_admin.REST.plansFiltered=plenty_admin.api.one("plan/getPlanProfitProjectionsForFilter",a),plenty_admin.REST.plansFiltered.get().then(function(a){console.log("got plans filtered: ",a().data),plenty_admin.DATA.plans=a().data,plenty_admin.UI.plans.eventCollector.done("plans filtered")},function(a){console.error("getting filtered plans: ",a)})},plenty_admin.REST.getFieldCropsByYearFiltered=function(a,b){plenty_admin.REST.fieldCropsByYearFiltered=plenty_admin.api.one("filters/getFieldCropsByYearFiltered/"+b,a),plenty_admin.REST.fieldCropsByYearFiltered.get().then(function(a){console.log("got field crops by year filtered: ",a().data),plenty_admin.DATA.fieldCrops=a().data,plenty_admin.UI.plans.eventCollector.done("field crops by year filtered")},function(a){console.error("getting filtered fieldCrops by year failed: ",a)})},plenty_admin.REST.getPlan=function(a,b){plenty_admin.REST.plan=plenty_admin.api.one("plan/getPlan",a),plenty_admin.REST.plan.get().then(function(a){console.log("got plan: ",a().data),b&&"function"==typeof b&&b(a().data)},function(a){console.error("getting filtered plans: ",a)})},plenty_admin.REST.getProfitProjectionForPlan=function(a,b){plenty_admin.REST.profitProjectionForPlan=plenty_admin.api.one("plan/calculateCostForPlanDto",a.id),plenty_admin.REST.profitProjectionForPlan.get().then(function(a){console.log("got profit projection: ",a().data),b&&"function"==typeof b&&b(a().data)},function(a){console.error("getting profit projection for plan dto failed:: ",a),b(plenty_admin.UI.plans.dummyProfitProj)})},plenty_admin.REST.getTemplatePlans=function(a){plenty_admin.REST.templatePlans=plenty_admin.api.all("templatePlan/getAllTemplatePlans"),plenty_admin.REST.templatePlans.getAll().then(function(b){a&&"function"==typeof a&&a(b().data),plenty_admin.DATA.eventCollector.done("event 1")},function(a){console.error("getting templatePlans failed: ",a)})},plenty_admin.REST.applyTemplatePlanToFieldCrops=function(a,b){plenty_admin.REST.templatePlanToFieldCrops=plenty_admin.api.all("plan/applyTemplatePlanToFieldCrops"),plenty_admin.REST.templatePlanToFieldCrops.post(a).then(function(a){console.log("planManifestationResultsDto: ",a().data),b&&"function"==typeof b&&b(a().data)},function(a){console.error("applyTemplatePlanToFieldCrops failed: ",a),bootbox.dialog({message:"Could not apply plan to field! - "+a.status+" - "+a.statusText,className:"danger",buttons:{danger:{label:"OK",className:"btn-danger",callback:function(){plenty_admin.UI.plans.add_template_plan_modal.find("button.add-plan").button("reset")}}}})})},$(document).on("plans_data_ready",function(){console.log("plans_data_ready"),plenty_admin.DATA.eventCollector=window.eventcollector(3,1e4),plenty_admin.REST.getCropTypes(),plenty_admin.REST.getActivityTypes(),plenty_admin.REST.getTemplatePlans(function(a){console.log("got all template plans: ",a),plenty_admin.DATA.templatePlans=a}),plenty_admin.DATA.eventCollector.on("alldone",function(){plenty_admin.DATA.selectedTemplatePlans=[];var a=$("<tbody/>");plenty_admin.UI.plans.add_template_plan_modal.find("#templateplans-list").append(a);for(var b=0;b<plenty_admin.DATA.templatePlans.length;b++){var c=plenty_admin.DATA.templatePlans[b],d=$(['<tr class="templatePlan templatePlan-'+c.id+' pointer">','<td width="5%" class="select">','<input type="checkbox" class="selectTemplatePlan pointer"></input>',"</td>",'<td width="35%">',c.name,"</td>",'<td width="60%">',c.description,"</td>","</tr>"].join("")).data("templatePlan",c).find("input.selectTemplatePlan").click(function(){
var a=$(this).closest("tr").data("templatePlan");if($(this).is(":checked"))plenty_admin.DATA.selectedTemplatePlans.push(a),console.log("enable"),$(this).closest("tr").addClass("alert-success"),plenty_admin.UI.plans.add_template_plan_modal.find("button.add-plan, button.next").prop("disabled",!1).end().find('.nav-tabs a[data-target="#plans_criterea"]').parent().show();else{for(var b=0;b<plenty_admin.DATA.selectedTemplatePlans.length;b++){var c=plenty_admin.DATA.selectedTemplatePlans[b];if(c.id==a.id)return plenty_admin.DATA.selectedTemplatePlans.splice(b,1),0==plenty_admin.DATA.selectedTemplatePlans.length&&plenty_admin.UI.plans.add_template_plan_modal.find("button.add-plan, button.next").prop("disabled",!0).end().find('.nav-tabs a[data-target="#plans_criterea"]').parent().hide(),void $(this).closest("tr").removeClass("alert-success")}$(this).closest("tr").removeClass("alert-success")}}).end().click(function(a){"checkbox"!==a.target.type&&$(this).find("input.selectTemplatePlan").trigger("click")});a.append(d)}plenty_admin.UI.plans.init()}),plenty_admin.DATA.load_user_filters(function(a){plenty_admin.DATA.userFilters=a().data,plenty_admin.DATA.data_source=plenty_admin.DATA.userFilters.possibleFilteringEntitiesDtoList,plenty_admin.DATA.update_filters(function(){console.log("init filters"),plenty_admin.UI.plans.toggleFilters.parent().fadeIn("fast").parent().find(".filter_loader").fadeOut("fast");for(var a="",b=0;b<plenty_admin.DATA.userFilters.possibleFilteringEntitiesDtoList.organizations.length;b++){var c=plenty_admin.DATA.userFilters.possibleFilteringEntitiesDtoList.organizations[b];a+="<option value='"+c.id+"'>"+c.name+"</option>"}plenty_admin.UI.plans.add_template_plan_modal.find("select#organizationList").find("option").remove().end().append(a)},!0)})}),plenty_admin.UI.plan={DOM:$("#plan-container"),init:function(a){console.log("plan - init",a),plenty_admin.UI.currentScreen.fadeOut("normal"),plenty_admin.UI.currentScreen=plenty_admin.UI.plan.DOM,plenty_admin.UI.currentScreen.addClass("fill-area-content flexbox-item-grow"),plenty_admin.UI.plan.populate(a),plenty_admin.UI.plan.renderActivities(a),plenty_admin.UI.currentScreen.fadeIn("normal",function(){plenty_admin.UI.plan.renderActivityFinancesGraph(a)})},populate:function(a){if(console.log("plan - populate",a),Array.isArray(a)){for(var b=0,c=0,d=0,e=0,f=0,g=0,h=0,i=0;i<a.length;i++){var j=a[i];b+=j.profitProjection.profit,c+=j.profitProjection.expense,d+=j.profitProjection.revenue,e+=j.profitProjection.avgBushlesPerAcre,f+=j.profitProjection.cropPrice,g+=j.profitProjection.subsidy,h+=j.profitProjection.profitPerAcre}var k=e/a.length,l=f/a.length;profitPerAcreAvg=h/a.length,plenty_admin.UI.plan.DOM.find(".profit").text(numeral(b).format("$0,0.00")).end().find(".expense").text(numeral(c).format("$0,0.00")).end().find(".revenue").text(numeral(d).format("$0,0.00")).end().find(".plan_field_acres").text(a[0].field.acres).end().find(".plan_field_bushels_per_acre").text(k).end().find(".plan_field_price_per_bushel").text(numeral(l).format("$0,0.00")).end().find(".text-right.plan_field_subsidy_total").text(numeral(g).format("$0,0.00")).end().find(".plan_field_profit_per_acre").text(numeral(profitPerAcreAvg).format("$0,0.00"))}else plenty_admin.UI.plan.DOM.find(".profit").text(numeral(a.profitProjection.profit).format("$0,0.00")).end().find(".expense").text(numeral(a.profitProjection.expense).format("$0,0.00")).end().find(".revenue").text(numeral(a.profitProjection.revenue).format("$0,0.00")).end().find(".plan_field_acres").text(a.field.acres).end().find(".plan_field_bushels_per_acre").text(a.profitProjection.avgBushlesPerAcre).end().find(".plan_field_price_per_bushel").text(numeral(a.profitProjection.cropPrice).format("$0,0.00")).end().find(".text-right.plan_field_subsidy_total").text(numeral(a.profitProjection.subsidy).format("$0,0.00")).end().find(".plan_field_profit_per_acre").text(numeral(a.profitProjection.profitPerAcre).format("$0,0.00"))},clear:function(){console.log("plan - clear"),plenty_admin.UI.plan.financesGraph&&plenty_admin.UI.plan.financesGraph.destroy()},renderActivityFinancesGraph:function(a){if(Array.isArray(a))for(var b=[],c=0;c<a.length;c++)for(var d=0;d<a[c].activities.activityFinances.length;d++){var e=a[c].activities.activityFinances[d];b.push(e)}else var b=a.activities.activityFinances;var f=[],g=new Rainbow;g.setSpectrum("#0076b2","#93b222","#788912"),g.setNumberRange(0,b.length>0?b.length:1);for(var c=0;c<b.length;c++){var e=b[c];e.colour="#"+g.colourAt(c);var h={value:e.cost,color:e.colour,highlight:plenty_admin.HELPER.colorLuminance(e.colour,.4),label:plenty_admin.DATA.activityTypes[e.activityTypeId].name};f.push(h)}var i={legendTemplate:'<ul class="<%=name.toLowerCase()%>-legend mrs"><% for (var i=0; i<segments.length; i++){%><li data-segmentid="<%=i%>" data-hovercolour="<%=segments[i].fillColor%>" data-name="<%=segments[i].label.replace(/ /g, "").toLowerCase()%>"><span class="swatch" style="background-color:<%=segments[i].fillColor%>"><i class="pif pif-<%=segments[i].label.toLowerCase().replace(/ /g, "-")%>"></i></span><%if(segments[i].label){%><%=segments[i].label%><%}%> <span class="pct"></span><span class="pull-right"><%= numeral(segments[i].value).format(\'$0,0.00\') %></span></li><%}%></ul>',tooltipTemplate:"<%=label%>: <%= numeral(value).format('$0,0.00') %> | <%= numeral(circumference / 6.283).format('00.00%') %>",animateRotate:!0},j=Chart.helpers;plenty_admin.UI.plan.financesGraph=new Chart(plenty_admin.UI.plan.financesGraphEl.get(0).getContext("2d")).Doughnut(f,i);var k=$(plenty_admin.UI.plan.financesGraph.generateLegend()),l=plenty_admin.UI.plan.financesGraphEl.parent().parent().parent().find(".legend");l.html("").append(k);var m=function(a){$(a).find("li").css({"background-color":"transparent"}).removeClass("active").find("span.swatch").each(function(){$(this).css({"background-color":$(this).closest("li").data("hovercolour")})}).end().find("span.pct").text("")};j.each(l.get(0).firstChild.childNodes,function(a,b){j.addEvent(a,"mouseover",function(){var c=plenty_admin.UI.plan.financesGraph.segments[b],d=numeral(c.circumference/6.283).format("00.00%");c.save(),c.fillColor=c.highlightColor,c.innerRadius=60,plenty_admin.UI.plan.financesGraph.showTooltip([c]),c.restore(),$(a).css({"background-color":$(this).data("hovercolour")}).addClass("active").find("span.swatch").css({"background-color":c.highlightColor}).end().find("span.pct").text(d)})}),j.addEvent(l.get(0).firstChild,"mouseout",function(){plenty_admin.UI.plan.financesGraph.draw(),m(l)}),plenty_admin.UI.plan.financesGraphEl.on("mousemove",function(a){var b=plenty_admin.UI.plan.financesGraph.getSegmentsAtEvent(a);if(b.length>0){l.find("li").removeClass("active");var c=b[0].label.replace(/ /g,"").toLowerCase(),d=l.find("li[data-name='"+c+"']"),e=numeral(b[0].circumference/6.283).format("00.00%");m(l),d.addClass("active").css({"background-color":d.data("hovercolour")}).find("span.swatch").css({"background-color":b[0].highlightColor}).end().find("span.pct").text(e)}else m(l)}),plenty_admin.UI.plan.financesGraphEl.on("mouseout",function(){m(l)})},renderActivities:function(a){function b(a){for(var b=0;b<a.length;b++){var c=a[b].activityDto;c.iconClass=plenty_admin.UI.field.getActivityIconClass(c.activityTypeId),c.startDate=plenty_admin.HELPER.formatJavaDate(c.startTime),c.endDate=plenty_admin.HELPER.formatJavaDate(c.endTime);var d=["<tr class='activity pointer'>","<td width='5%'>","<i class='"+c.iconClass+"'></i>","</td>","<td width='20%'>",c.state,"</td>","<td width='35%'>",plenty_admin.DATA.activityTypes[c.activityTypeId].name,"</td>","<td width='13.333%'>",c.startDate.date,"</td>","<td width='13.333%'>",plenty_admin.HELPER.daysFromHours(c.durationInHours),"</td>","<td width='13.333%' class='text-right'>",numeral(c.cost).format("$0,0.00"),"</td>","</tr>"].join(""),e=$(d);e.data("activity",c).data("activityFinance",a[b]).click(function(){plenty_admin.UI.plan.show_activity_modal($(this).data("activity"),$(this).data("activityFinance").taskFinances,$(this))}),plenty_admin.UI.plan.activityListContainer.append(e)}}if(plenty_admin.UI.plan.activityListContainer.find("tr").remove(),Array.isArray(a))for(var c=0;c<a.length;c++){var d=a[c].activities.activityFinances;b(d)}else{var d=a.activities.activityFinances;b(d)}},show_activity_modal:function(a,b,c){console.log("show_activity_modal",a,b),plenty_admin.UI.plan.MODAL_activity.find(".modal-title").text(plenty_admin.DATA.activityTypes[a.activityTypeId].name).end().find("button.delete").off("click").on("click",function(){plenty_admin.UI.plan.MODAL_activity.find(".modal-content").addClass("blur").end().find(".confirmDelete").show()}).end().find("button.cancel").off("click").on("click",function(){plenty_admin.UI.plan.MODAL_activity.find(".modal-content").removeClass("blur").end().find(".confirmDelete").hide()}).end().find(".confirmDelete button.delete").off("click").on("click",function(){plenty_admin.REST.deleteActivity["delete"](a.id).then(function(a){console.log("Activity Deleted:",a),plenty_admin.UI.plan.MODAL_activity.modal("hide"),c.remove()})}).end().on("shown.bs.modal",function(){plenty_admin.UI.plan.renderTaskFinancesGraph(b),plenty_admin.UI.plan.renderTasks(b)}).on("hidden.bs.modal",function(){plenty_admin.UI.plan.taskFinancesGraph.destroy()}).modal("show")},renderTasks:function(a){for(var b="",c=0;c<a.length;c++){var d=a[c],e=plenty_admin.HELPER.formatJavaDate(d.taskDto.startTime);console.log("taskStartDate - ",e,d.taskDto.startTime);var f=["<tr class='pointer'>","<td><span class='editable' data-type='text' data-pk='1' data-url='/post' data-title='Choose the task name'>",d.taskDto.name,"</span></td>","<td>",d.taskDto.state,"</td>","<td><span class='editable' data-type='date' data-pk='1' data-url='/post' data-title='Choose the start date'>",plenty_admin.HELPER.formatJavaDate(d.taskDto.startTime).date,"</span></td>","<td>",plenty_admin.HELPER.daysFromHours(d.taskDto.durationInHours),"</td>","<td class='text-right'>",d.taskDto.cost,"</td>","</tr>"].join("");b+=f}$.fn.editable.defaults.mode="inline",plenty_admin.UI.plan.MODAL_activity.find(".activityTasksList table tbody tr").remove().end().find(".activityTasksList table tbody").append(b).find(".editable").editable(plenty_admin.REST.inline_editing_options)},renderTaskFinancesGraph:function(a){console.log("renderTaskFinancesGraph",a);var b=new Rainbow;b.setSpectrum("#0076b2","#93b222","#788912"),b.setNumberRange(0,2);for(var c=[{value:0,color:"#"+b.colourAt(0),highlight:plenty_admin.HELPER.colorLuminance("#"+b.colourAt(0),.4),label:"Equipment"},{value:0,color:"#"+b.colourAt(1),highlight:plenty_admin.HELPER.colorLuminance("#"+b.colourAt(1),.4),label:"Labor"},{value:0,color:"#"+b.colourAt(2),highlight:plenty_admin.HELPER.colorLuminance("#"+b.colourAt(2),.4),label:"Products"}],d=0;d<a.length;d++){var e=a[d];console.log("taskFinance",e),c[0].value+=e.equipmentCost.cost,c[1].value+=e.laborCost.cost,c[2].value+=e.productsCost.cost}var f={legendTemplate:'<ul class="<%=name.toLowerCase()%>-legend mts"><% for (var i=0; i<segments.length; i++){%><li data-segmentid="<%=i%>" data-hovercolour="<%=segments[i].fillColor%>" data-name="<%=segments[i].label.replace(/ /g, "").toLowerCase()%>" class="taskHeader" style="border-top:2px solid <%=segments[i].fillColor%>"><span class="swatch" style="background-color:<%=segments[i].fillColor%>"><i class="pif pif-<%=segments[i].label.toLowerCase().replace(/ /g, "-")%>"></i></span><%if(segments[i].label){%><%=segments[i].label%><%}%> <span class="pct"></span><span class="pull-right"><%= numeral(segments[i].value).format(\'$0,0.00\') %></span></li><%}%></ul>',tooltipTemplate:"<%=label%>: <%= numeral(value).format('$0,0.00') %> | <%= numeral(circumference / 6.283).format('00.00%') %>",animateRotate:!0},g=Chart.helpers;console.log("helpers",g),plenty_admin.UI.plan.taskFinancesGraph=new Chart(plenty_admin.UI.plan.taskFinancesGraphEl.get(0).getContext("2d")).Doughnut(c,f),console.log("render task finances graph: ",plenty_admin.UI.plan.taskFinancesGraph,c);var h=$(plenty_admin.UI.plan.taskFinancesGraph.generateLegend()),i=plenty_admin.UI.plan.taskFinancesGraphEl.parent().parent().find(".legend");i.html("").append(h);for(var j="",k="",l="",d=0;d<a.length;d++){var e=a[d];console.log("taskFinance",e);for(var m=0;m<e.equipmentCost.taskResourceTypeCosts.length;m++){var n=e.equipmentCost.taskResourceTypeCosts[m],o=plenty_admin.HELPER.hexToRgb("#"+b.colourAt(0));j+="<li class='taskItem equipmentTaskItem' style='background-color:rgba("+o.r+", "+o.g+", "+o.b+", .2);'>"+n.resourceTypeName+"<span class='cost'>"+numeral(n.cost).format("$0,0.00")+"</span></li>";for(var p=0;p<n.taskResourceCosts.length;p++){var q=n.taskResourceCosts[p];j+="<li class='taskResourceItem equipmentTaskResourceItem' style='background-color:rgba("+o.r+", "+o.g+", "+o.b+", .2);'>"+q.resourceName+"<span class='cost'>"+numeral(q.cost).format("$0,0.00")+"</span></li>"}}for(var r=0;r<e.laborCost.taskResourceTypeCosts.length;r++){var n=e.laborCost.taskResourceTypeCosts[r],o=plenty_admin.HELPER.hexToRgb("#"+b.colourAt(1));k+="<li class='taskItem laborTaskItem' style='background-color:rgba("+o.r+", "+o.g+", "+o.b+", .2);'>"+n.resourceTypeName+"<span class='cost'>"+numeral(n.cost).format("$0,0.00")+"</span></li>";for(var p=0;p<n.taskResourceCosts.length;p++){var q=n.taskResourceCosts[p];k+="<li class='taskResourceItem laborTaskResourceItem' style='background-color:rgba("+o.r+", "+o.g+", "+o.b+", .2);'>"+q.resourceName+"<span class='cost'>"+numeral(q.cost).format("$0,0.00")+"</span></li>"}}for(var s=0;s<e.productsCost.taskResourceTypeCosts.length;s++){var n=e.productsCost.taskResourceTypeCosts[s],o=plenty_admin.HELPER.hexToRgb("#"+b.colourAt(2));l+="<li class='taskItem productTaskItem' style='background-color:rgba("+o.r+", "+o.g+", "+o.b+", .2);'>"+n.resourceTypeName+"<span class='cost'>"+numeral(n.cost).format("$0,0.00")+"</span></li>";for(var p=0;p<n.taskResourceCosts.length;p++){var q=n.taskResourceCosts[p];l+="<li class='taskResourceItem productTaskResourceItem' style='background-color:rgba("+o.r+", "+o.g+", "+o.b+", .2);'>"+q.resourceName+"<span class='cost'>"+numeral(q.cost).format("$0,0.00")+"</span></li>"}}}console.log("equipmentItems",j),console.log("laborItems",k),console.log("productItems",l),i.find("li[data-name='equipment']").after(j).end().find("li[data-name='labor']").after(k).end().find("li[data-name='products']").after(l).end().find(".equipmentTaskResourceItem").last().addClass("last").end().end().find(".laborTaskResourceItem").last().addClass("last").end().end().find(".productTaskResourceItem").last().addClass("last");var t=function(a){$(a).find("li:not(.taskItem):not(.taskResourceItem)").css({"background-color":"transparent"}).removeClass("active").find("span.swatch").each(function(){$(this).css({"background-color":$(this).closest("li").data("hovercolour")})}).end().find("span.pct").text("")};g.each(i.get(0).firstChild.childNodes,function(a,b){g.addEvent(a,"mouseover",function(){if(console.log("hover legendNode: ",this,b,$(this).prop("class")),$(this).hasClass("taskItem")||$(this).hasClass("taskResourceItem")?$(this).hasClass("equipmentTaskItem")||$(this).hasClass("equipmentTaskResourceItem")?b=0:$(this).hasClass("laborTaskItem")||$(this).hasClass("laborTaskResourceItem")?b=1:($(this).hasClass("productTaskItem")||$(this).hasClass("productTaskResourceItem"))&&(b=2):b=parseInt($(this).data("segmentid")),console.log("index: ",b),!$(this).hasClass("taskItem")&&!$(this).hasClass("taskResourceItem")){var c=plenty_admin.UI.plan.taskFinancesGraph.segments[b],d=numeral(c.circumference/6.283).format("00.00%");c.save(),c.fillColor=c.highlightColor,c.innerRadius=60,plenty_admin.UI.plan.taskFinancesGraph.showTooltip([c]),c.restore(),$(a).css({"background-color":$(this).data("hovercolour")}).addClass("active").find("span.swatch").css({"background-color":c.highlightColor}).end().find("span.pct").text(d)}})}),g.addEvent(i.get(0).firstChild,"mouseout",function(){$(this).hasClass("taskItem")&&($(this).hasClass("equipmentTaskItem")||$(this).hasClass("equipmentTaskResourceItem")?index=0:$(this).hasClass("laborTaskItem")||$(this).hasClass("laborTaskResourceItem")?index=1:($(this).hasClass("productTaskItem")||$(this).hasClass("productTaskResourceItem"))&&(index=2)),plenty_admin.UI.plan.taskFinancesGraph.draw(),$(this).hasClass("taskItem")||$(this).hasClass("taskResourceItem")||t(i)}),plenty_admin.UI.plan.taskFinancesGraphEl.on("mousemove",function(a){var b=plenty_admin.UI.plan.taskFinancesGraph.getSegmentsAtEvent(a);if(b.length>0){i.find("li").removeClass("active");var c=b[0].label.replace(/ /g,"").toLowerCase(),d=i.find("li[data-name='"+c+"']"),e=numeral(b[0].circumference/6.283).format("00.00%");t(i),d.addClass("active").css({"background-color":d.data("hovercolour")}).find("span.swatch").css({"background-color":b[0].highlightColor}).end().find("span.pct").text(e)}else t(i)}),plenty_admin.UI.plan.taskFinancesGraphEl.on("mouseout",function(){t(i)})}},plenty_admin.UI.plan.activityListContainer=plenty_admin.UI.plan.DOM.find("table.planActivities tbody"),plenty_admin.UI.plan.financesGraphEl=plenty_admin.UI.plan.DOM.find("#plan_graph_wrapper canvas"),plenty_admin.UI.plan.MODAL_activity=$("body").find(".modal#activity"),plenty_admin.UI.plan.taskFinancesGraphEl=plenty_admin.UI.plan.MODAL_activity.find("canvas#taskGraph"),plenty_admin.UI.sideBar={},plenty_admin.UI.sideBar.DOM=$("#sidebar"),plenty_admin.UI.sideBar.organizations={},plenty_admin.UI.sideBar.organizations.DOM=plenty_admin.UI.sideBar.DOM.find("#organizations"),plenty_admin.UI.sideBar.organizations.create=function(a){var b='<div class="panel panel-default"><div role="tab" id="org_head_'+a.id+'"><h4 class="panel-title"> <a class="organization" data-orgid="'+a.id+'" data-toggle="collapse" data-parent="#organizations" href="#collapse_'+a.id+'" aria-expanded="true" aria-controls="collapse_'+a.id+'">'+a.name+'</a> </h4></div><div id="collapse_'+a.id+'" class="panel-collapse collapse" role="tabpanel" aria-labelledby="org_head_'+a.id+'" data-orgid="'+a.id+'"><div class="panel-body"><ul class="list-group"><li class="list-group-item sub farms"><span class="badge">'+(a.farms?a.farms.length:0)+'</span> <a href="#farms" class="farms" data-orgid="'+a.id+'">Farms</a></li><li class="list-group-item sub fields"><span class="badge">'+(a.fields?a.fields.length:0)+'</span> <a href="#fields" class="fields" data-orgid="'+a.id+'">Fields</a></li><li class="list-group-item sub users"><span class="badge">'+(a.users?a.users.length:0)+'</span> <a href="#users" class="users" data-orgid="'+a.id+'">Users</a> </li><li class="list-group-item sub equipment"><span class="badge">'+(a.equipments?a.equipments.length:0)+'</span> <a href="#equipments" class="equipment" data-orgid="'+a.id+'">Equipment</a> </li><li class="list-group-item sub products"><span class="badge">'+(a.products?Object.keys(a.products).length:0)+'</span> <a href="#products" class="products" data-orgid="'+a.id+'">Products</a> </li><li class="list-group-item sub plans"><span class="badge">'+(a.plans?a.plans.length:0)+'</span> <a href="#plans" class="plans" data-orgid="'+a.id+'">Plans</a></li><li class="list-group-item sub skills"><span class="badge">'+(a.skills?a.skills.length:0)+'</span> <a href="#skills" class="skills" data-orgid="'+a.id+'">Skills</a> </li><li class="list-group-item sub payments"><span class="badge">'+(a.payments?a.payments.length:0)+'</span> <a href="#payments" class="payment" data-orgid="'+a.id+'">Payment</a></li></ul></div></div></div>';return b},plenty_admin.UI.sideBar.organizations.init=function(){plenty_admin.UI.sideBar.organizations.html="",plenty_admin.UI.sideBar.organizations.DOM.html("");for(id in plenty_admin.DATA.organizations)if(plenty_admin.DATA.organizations.hasOwnProperty(id)&&"length"!==id){var a=plenty_admin.DATA.organizations[id];plenty_admin.UI.sideBar.organizations.html+=plenty_admin.UI.sideBar.organizations.create(a)}plenty_admin.UI.sideBar.organizations.DOM.append(plenty_admin.UI.sideBar.organizations.html).find("li.sub a").off("click").on("click",function(a){a.preventDefault();var b=a.currentTarget.href,c=b.substring(b.indexOf("#")),d=$(a.currentTarget).data("orgid");plenty_admin.UI.sideBar.organizations.select_sub(d,c),console.log(d,plenty_admin.UI.organization.DOM.data("orgId")),plenty_admin.UI.organization.DOM.is(":visible")?d===plenty_admin.UI.organization.DOM.data("orgId")?plenty_admin.UI.organization.switchTab(c):(plenty_admin.HELPER.showLoadingOverlay(),plenty_admin.UI.organization.init(plenty_admin.DATA.organizations[d],a.currentTarget.hash)):plenty_admin.UI.currentScreen.fadeOut("normal",function(){plenty_admin.UI.currentScreen=plenty_admin.UI.organization.DOM,d===plenty_admin.UI.organization.DOM.data("orgId")?plenty_admin.UI.organization.switchTab(c):(plenty_admin.HELPER.showLoadingOverlay(),plenty_admin.UI.organization.init(plenty_admin.DATA.organizations[d],a.currentTarget.hash)),plenty_admin.UI.organization.DOM.fadeIn("normal")}),store.set("filter::organization",d)});var b=$(['<button class="btn btn-success btn-block panel-title add-org mtm">','<span class="glyphicon glyphicon-plus"></span> New Organization',"</button>"].join(""));b.click(function(){console.log("new org clicked");var a=[{"class":"back",name:"Settings",clickHandler:function(){return plenty_admin.UI.currentScreen.fadeOut("normal",function(){plenty_admin.UI.newOrganization.clear(),plenty_admin.UI.currentScreen=plenty_admin.UI.organization.DOM,plenty_admin.UI.currentScreen.fadeIn("normal")}),!1}},{"class":"active",name:"Add Organization",clickHandler:null}];return plenty_admin.UI.newOrganization.DOM.find(".breadcrumb-trail").remove().end().prepend(plenty_admin.UI.build_breadcrumb_trail(a)),plenty_admin.UI.newOrganization.init(),plenty_admin.UI.currentScreen.fadeOut("normal",function(){plenty_admin.UI.currentScreen=plenty_admin.UI.newOrganization.DOM,plenty_admin.UI.currentScreen.fadeIn("normal")}),!1}),plenty_admin.UI.sideBar.organizations.DOM.append(b)},plenty_admin.UI.sideBar.organizations.select_sub=function(a,b){plenty_admin.UI.sideBar.organizations.DOM.find("li.active").removeClass("active").end().find("li.list-group-item.sub a[data-orgid='"+a+"'][href='"+b+"']").closest(".list-group-item").addClass("active")},$(document).on("organization_data_ready",function(a,b){plenty_admin.UI.sideBar.organizations.init(b)}),plenty_admin.UI.filters={},plenty_admin.UI.filters.state="closed",plenty_admin.UI.filters.DOM=plenty_admin.UI.DOM.find("#filters-container"),plenty_admin.REST.update_filters=plenty_admin.api.all("filters/update"),plenty_admin.UI.filters.init=function(){plenty_admin.UI.filters.hide_filters(),$(window).resize(function(){"closed"===plenty_admin.UI.filters.toggleFilters.state&&plenty_admin.UI.filters.hide_filters()}),plenty_admin.UI.filters.DOM.find("button.save-filter").click(function(){return plenty_admin.UI.filters.toggleFilters("close"),!1}),plenty_admin.UI.filters.DOM.show(),plenty_admin.UI.filters.DOM.on("mouseenter",function(){clearTimeout(this.autohide)}).on("mouseleave",function(){this.autohide=setTimeout(function(){plenty_admin.UI.filters.toggleFilters("close")},3e3)})},plenty_admin.UI.filters.add_selected_filter=function(a){var b=$('<li class="filter" data-filterid="'+a.filter.toLowerCase()+a.id+'" data-id="'+a.id+'" data-name="'+a.name+'">'+a.name+' <a href="" class="remove-filter glyphicon glyphicon-remove pull-right alert alert-danger mbn"></a></li>');b.find("a.remove-filter").click(function(){for(var a=$(this).closest("li"),b=$(this).closest(".filter-set"),c=0;c<plenty_admin.DATA.userFilters.filterDto[b.data("filter")].length;c++){var d=plenty_admin.DATA.userFilters.filterDto[b.data("filter")][c];d===parseInt(a.data("id"))&&plenty_admin.DATA.userFilters.filterDto[b.data("filter")].splice(c,1)}var e=b.find("ul.selected-filters li.filter:not(.all)");return(0==e.length||e.length===plenty_admin.DATA.userFilters.possibleFilteringEntitiesDtoList[b.data("filter").replace("Ids","s")].length)&&plenty_admin.UI.filters.select_all_filters(b,!0),a.remove(),plenty_admin.DATA.update_filters(),!1});var c=plenty_admin.UI.filters.DOM.find(".filter-set."+a.filter.toLowerCase()),d=c.find(".selected-filters li.all");d.hide(),c.find(".selected-filters").append(b)},plenty_admin.UI.filters.select_all_filters=function(a,b){var c=a.data("filter");plenty_admin.DATA.userFilters.filterDto[c]=[],b&&plenty_admin.DATA.update_filters()},plenty_admin.UI.filters.build_all_filters_entry=function(a,b){var c='<li class="filter all'+(b?" active":"")+'" data-filterid="'+a+'01"><a href="">All <input type="checkbox"'+(b?" checked":"")+' class="pull-right"></a></li>',d=$(c);return d.find("a").click(function(a){a.stopPropagation();$(a.target).find("input[type='checkbox']");return"checkbox"!==$(a.target).prop("type")&&plenty_admin.UI.filters.select_all_filters($(a.target).closest(".filter-set"),!0),!1}).find("input[type='checkbox']").click(function(a){a.stopPropagation()}).on("change",function(a){plenty_admin.UI.filters.select_all_filters($(a.target).closest(".filter-set"),!0)}),d},plenty_admin.UI.filters.build_clear_filters_entry=function(){var a=$('<li class="clear-filters"><a href="">Clear</a></li>');return a.find("a").click(function(a){a.stopPropagation(),$(this).closest(".selected-filters").find(".filter").remove();var b=$(this).closest(".filter-set");return plenty_admin.DATA.userFilters.filterDto[b.data("filter")]=[],plenty_admin.DATA.update_filters(),$(this).parent().remove(),!1}),a},plenty_admin.UI.filters.build_filter_entity=function(a,b,c){var d=$(['<li class="filter'+(c?" active":""),'" data-filterid="'+b.toLowerCase(),+a.id,'" data-id="'+a.id,'" data-name="'+a.name+'">','<a href="">',a.name,' <input type="checkbox"',c?" checked":"",' class="pull-right">',"</a>","</li>"].join(""));return d.find("a").click(function(a){if(a.stopPropagation(),console.log("clicked a filter, is it a checkbox? ",a),"checkbox"!==$(a.target).prop("type")){var b=$(a.target).find("input[type='checkbox']");return b.prop("checked",!b.prop("checked")).trigger("change"),!1}}).find("input[type='checkbox']").on("change",function(a){a.stopPropagation();var b=$(this).closest("li");if(b.hasClass("all")&&$(this).is(":checked"))return void $(this).prop("checked",!0);b.toggleClass("active");var c="";if($(this).closest(".popover").length>0?$(this).closest(".all-filters").hasClass("farms_quickfilter_popover")?c="farmIds":$(this).closest(".all-filters").hasClass("orgs_quickfilter_popover")&&(c="organizationIds"):c=b.closest(".filter-set").data("filter"),$(this).is(":checked"))console.log("CHECKED"),b.hasClass("all")?plenty_admin.DATA.userFilters.filterDto[c]=[]:(plenty_admin.DATA.userFilters.filterDto[c]=[],b.closest("ul").find("li.filter:not(.all) input[type='checkbox']:checked").each(function(){plenty_admin.DATA.userFilters.filterDto[c].push(parseInt($(this).closest("li").data("id")))}),plenty_admin.DATA.userFilters.filterDto[c]===plenty_admin.DATA.userFilters.possibleFilteringEntitiesDtoList[c.replace("Ids","s")]&&(plenty_admin.DATA.userFilters.filterDto[c]=[]));else{console.log("UN-CHECKED");var d=plenty_admin.DATA.userFilters.filterDto[c].indexOf(parseInt(b.data("id")));d>-1&&plenty_admin.DATA.userFilters.filterDto[c].splice(d,1)}plenty_admin.DATA.update_filters()}),d},plenty_admin.UI.filters.populate=function(a,b){console.log("populate: ",plenty_admin.DATA.userFilters,a);for(filter in plenty_admin.DATA.userFilters.possibleFilteringEntitiesDtoList)if(plenty_admin.DATA.userFilters.possibleFilteringEntitiesDtoList.hasOwnProperty(filter)&&plenty_admin.UI[plenty_admin.context].applicableFilters.indexOf(filter.toLowerCase())>-1){var c=filter.split(/(?=[A-Z])/).join(" "),d=filter.toLowerCase(),e=filter.substring(0,filter.length-1)+"Ids",g=plenty_admin.DATA.userFilters.possibleFilteringEntitiesDtoList[filter];a===!0&&plenty_admin.UI.filters.build_filter_set(c,d);var h=g.length===plenty_admin.DATA.userFilters.filterDto[e].length||0==plenty_admin.DATA.userFilters.filterDto[e].length;if(plenty_admin.UI.filters.DOM.find(".filter-set."+d+" .all-filters").html("").append(plenty_admin.UI.filters.build_all_filters_entry(d,h)),g.length>0)for(f=0;f<g.length;f++){var i=g[f];plenty_admin.UI.filters.DOM.find(".filter-set."+filter.toLowerCase()+" .all-filters").append(plenty_admin.UI.filters.build_filter_entity(i,filter,h?!1:plenty_admin.DATA.userFilters.filterDto[e].indexOf(i.id)>-1))}}var j=0;for(filterId in plenty_admin.DATA.userFilters.filterDto)if(plenty_admin.DATA.userFilters.filterDto.hasOwnProperty(filterId)&&plenty_admin.UI[plenty_admin.context].applicableFilters.indexOf(filterId.replace("Ids","s").toLowerCase())>-1){plenty_admin.UI.filters.DOM.find(".filter-set[data-filter='"+filterId+"'] .selected-filters li.filter, .filter-set[data-filter='"+filterId+"'] .selected-filters li.clear-filters").remove();var k=plenty_admin.DATA.userFilters.possibleFilteringEntitiesDtoList[filterId.replace("Ids","s")].length;if(plenty_admin.DATA.userFilters.filterDto[filterId].length>0&&k!=plenty_admin.DATA.userFilters.filterDto[filterId].length){var l=plenty_admin.DATA.userFilters.filterDto[filterId];j+=plenty_admin.DATA.userFilters.filterDto[filterId].length;var h=!1,m="";switch(filterId){case"organizationIds":1===plenty_admin.DATA.userFilters.filterDto[filterId].length?m=plenty_admin.DATA.userFilters.possibleFilteringEntitiesDtoList[filterId.replace("Ids","s")][0].name:k===plenty_admin.DATA.userFilters.filterDto[filterId].length||0==plenty_admin.DATA.userFilters.filterDto[filterId].length?(m="All Organizations",h=!0):m="Multiple Organizations";break;case"farmIds":1===plenty_admin.DATA.userFilters.filterDto[filterId].length?m=plenty_admin.DATA.userFilters.possibleFilteringEntitiesDtoList[filterId.replace("Ids","s")][0].name:k===plenty_admin.DATA.userFilters.filterDto[filterId].length||0==plenty_admin.DATA.userFilters.filterDto[filterId].length?(m="All Farms",h=!0):m="Multiple Farms";break;default:(plenty_admin.DATA.userFilters.possibleFilteringEntitiesDtoList[filterId.replace("Ids","s")].length===plenty_admin.DATA.userFilters.filterDto[filterId].length||0==plenty_admin.DATA.userFilters.filterDto[filterId].length||plenty_admin.DATA.userFilters.filterDto[filterId].length>plenty_admin.DATA.userFilters.possibleFilteringEntitiesDtoList[filterId.replace("Ids","s")].length)&&(h=!0)}for(var n=!1,o=0;o<l.length;o++){var p={};p.id=l[o],matchIt=$.grep(plenty_admin.DATA.userFilters.possibleFilteringEntitiesDtoList[filterId.replace("Ids","s")],function(a){return a.id==l[o]}),matchIt.length>0&&!h&&(p.name=matchIt[0].name,p.filter=filterId.replace("Ids","s"),plenty_admin.UI.filters.add_selected_filter(p),n=!0)}if(n){var q=plenty_admin.UI.filters.DOM.find(".filter-set."+filterId.replace("Ids","s").toLowerCase());q.find(".selected-filters").append(plenty_admin.UI.filters.build_clear_filters_entry())}switch(filterId){case"organizationIds":plenty_admin.UI.map.orgs_quickfilter.text(m);break;case"farmIds":plenty_admin.UI.map.farms_quickfilter.text(m)}}else switch(plenty_admin.UI.filters.DOM.find(".filter-set[data-filter='"+filterId+"'] .selected-filters li.filter").show(),filterId){case"organizationIds":plenty_admin.UI.map.orgs_quickfilter.text("All Organizations");break;case"farmIds":plenty_admin.UI.map.farms_quickfilter.text("All Farms")}}plenty_admin.UI.map.toggleFilters.find("span").text(j>0?"("+j+")":"");var r=plenty_admin.UI.map.orgs_quickfilter.parent().find(".orgs_quickfilter_popover");if(r.is(":visible")){var s=r.parent();r.remove(),plenty_admin.UI.filters.DOM.find(".filter-set.organizations .all-filters").clone(!0,!0).addClass("orgs_quickfilter_popover").show().appendTo(s)}var t=plenty_admin.UI.map.farms_quickfilter.parent().find(".farms_quickfilter_popover");if(t.is(":visible")){var s=t.parent();t.remove(),plenty_admin.UI.filters.DOM.find(".filter-set.farms .all-filters").clone(!0,!0).addClass("farms_quickfilter_popover").show().appendTo(s)}b&&"function"==typeof b&&b(),plenty_admin.UI.map.filterControls.find(".quickFilters").fadeIn("fast")},plenty_admin.UI.filters.hide_filters=function(){
plenty_admin.UI.filters.DOM.css("right",-plenty_admin.UI.filters.DOM.outerWidth())},plenty_admin.UI.filters.show_filter_selectors=function(a){$(a.target).closest(".filter-set").find("ul.selected-filters").slideUp("fast").end().find("ul.all-filters").slideDown("fast")},plenty_admin.UI.filters.hide_filter_selectors=function(a){$(a.target).closest(".filter-set").find("ul.selected-filters:not(:empty)").slideDown("fast").end().find("ul.all-filters").slideUp("fast")},plenty_admin.UI.filters.show_selected_filters=function(){plenty_admin.UI.filters.DOM.find("ul.all-filters").slideUp("fast").end().find("ul.selected-filters:not(:empty)").slideDown("fast")},plenty_admin.UI.filters.build_filter_set=function(a,b){var c=b.slice(0,b.lastIndexOf("s"))+"Ids";"croptypeIds"==c&&(c="cropTypeIds");var d=$(['<div class="filter-set mbs '+b+'" data-filter="'+c+'">','<h3 class="title filter-title mbm">','<a href="" class="show-filters pull-right">','<span class="icon pull-left"></span> ',a,'<i class="icon glyphicon glyphicon-triangle-right pull-right"></i>',"</a>",'</h3><ul class="selected-filters clear mbn">','<li class="filter all">','<span class="pull-left">All</span>',"</li>","</ul>",'<ul class="all-filters clear mbn" style="display:none;">',"</ul>","</div>"].join(""));d.data("state","closed").find(".filter-title a").click(function(a){return a.stopPropagation(),"closed"===d.data("state")?(plenty_admin.UI.filters.show_filter_selectors(a),d.data("state","open").addClass("open")):(plenty_admin.UI.filters.hide_filter_selectors(a),d.data("state","closed").removeClass("open")),!1}),plenty_admin.UI.filters.DOM.find("#filter-set-wrapper").append(d)},plenty_admin.UI.filters.toggleFilters=function(a){"open"===a?(plenty_admin.UI.filters.state="open",plenty_admin.UI.filters.DOM.stop().clearQueue().animate({right:0})):"close"===a?(plenty_admin.UI.filters.state="closed",plenty_admin.UI.filters.DOM.stop().clearQueue().animate({right:-(plenty_admin.UI.filters.DOM.width()+1)})):"closed"===plenty_admin.UI.filters.state?(plenty_admin.UI.filters.state="open",plenty_admin.UI.filters.DOM.stop().clearQueue().animate({right:0})):"open"===plenty_admin.UI.filters.state&&(plenty_admin.UI.filters.state="closed",console.log("toggleFilters - close: ",plenty_admin.UI.filters.DOM.width()),plenty_admin.UI.filters.DOM.stop().clearQueue().animate({right:-(plenty_admin.UI.filters.DOM.width()+1)}))},plenty_admin.REST.get_x_by_filtered=function(a,b){var c=a.replace(/ /g,"");plenty_admin.REST["get"+c+"Filtered"]=plenty_admin.api.one("filters/get"+c+"Filtered",plenty_admin.DATA.userFilters.filterDto.id),plenty_admin.REST["get"+c+"Filtered"].get().then(function(c){b&&"function"==typeof b&&b(c,a)})},plenty_admin.DATA.update_filters=function(a,b,c){console.log("plenty_admin.DATA.update_filters",c),plenty_admin.HELPER.showLoadingOverlay(),plenty_admin.REST.update_filters.post(plenty_admin.DATA.userFilters.filterDto).then(function(d){switch(plenty_admin.DATA.userFilters.possibleFilteringEntitiesDtoList=d.body().possibleFilteringEntitiesDtoList,plenty_admin.UI.filters.populate(b),plenty_admin.context){case"map":plenty_admin.UI.map.populate(plenty_admin.DATA.userFilters.possibleFilteringEntitiesDtoList.fields,c),plenty_admin.UI.map.add_equipment_to_map(),plenty_admin.UI.map.toggleFilters.parent().fadeIn("fast").parent().find(".filter_loader").fadeOut("fast");break;case"plans":var e=new Date,f=e.getUTCFullYear();plenty_admin.UI.plans.eventCollector=window.eventcollector(2,1e4),plenty_admin.REST.getPlansFiltered(plenty_admin.DATA.userFilters.filterDto.id),plenty_admin.REST.getFieldCropsByYearFiltered(plenty_admin.DATA.userFilters.filterDto.id,f),plenty_admin.UI.plans.eventCollector.on("alldone",function(){plenty_admin.UI.plans.populate()})}a&&"function"==typeof a&&a(d)})},plenty_admin.UI.filters.init(),plenty_admin.UI.organization={},plenty_admin.UI.organization.DOM=plenty_admin.UI.main.DOM.find("#organization-container"),plenty_admin.UI.organization.tabs={},plenty_admin.UI.organization.tabs.DOM=plenty_admin.UI.organization.DOM.find("#orgAssets"),plenty_admin.UI.organization.MODAL_add_to_organization=plenty_admin.UI.DOM.find("#add_to_organization"),plenty_admin.UI.organization.MODAL_edit_in_organization=plenty_admin.UI.DOM.find("#edit_in_organization"),plenty_admin.UI.organization.MODAL_confirm_delete=plenty_admin.UI.DOM.find("#confirm_delete"),plenty_admin.UI.organization.MODAL_edit_field=plenty_admin.UI.DOM.find("#edit_field"),plenty_admin.UI.organization.MODAL_add_field=plenty_admin.UI.DOM.find("#add_field"),plenty_admin.UI.organization.MODAL_add_field=plenty_admin.UI.DOM.find("#add_plan"),plenty_admin.UI.organization.BUTTON_delete_multiple=plenty_admin.UI.organization.DOM.find(".delete_multiple"),plenty_admin.UI.organization.filter_by_farm=plenty_admin.UI.organization.DOM.find("select.filter-by-farm");for(var entities=["Farm","User","Equipment","Product","Plan","Skill","Payment","Role","Interest","Organization"],e=0;e<entities.length;e++){var entity=entities[e];plenty_admin.REST["insert"+entity]=plenty_admin.api.all(entity.toLowerCase()+("Equipment"===entity||"Role"===entity?"":"s")+"/insert"+entity),plenty_admin.REST["delete"+entity]=plenty_admin.api.all(entity.toLowerCase()+("Equipment"===entity||"Role"===entity?"":"s")+"/delete"+entity),plenty_admin.REST["update"+entity]=plenty_admin.api.all(entity.toLowerCase()+("Equipment"===entity||"Role"===entity?"":"s")+"/update"+entity)}plenty_admin.REST.insertBoundary=plenty_admin.api.all("boundaries/insertBoundary"),plenty_admin.REST.insertBoundaryPointsArray=plenty_admin.api.all("boundaryPoints/insertBoundaryPointsArray"),plenty_admin.REST.updateBoundaryPointsArray=plenty_admin.api.all("boundaryPoints/updateBoundaryPointArray"),plenty_admin.REST.insertField=plenty_admin.api.all("fields/createFieledWithBoundaryInterestAndCropType"),plenty_admin.REST.insertFieldCrop=plenty_admin.api.all("fieldCrops/insertFieldCrop"),plenty_admin.REST.updateFieldCrop=plenty_admin.api.all("fieldCrops/updateFieldCrop"),plenty_admin.REST.deleteFieldCrop=plenty_admin.api.all("fieldCrops/deleteFieldCrop"),plenty_admin.REST.insertFieldEquipment=plenty_admin.api.all("fieldEquipment/insertWithNewEquipment"),plenty_admin.REST.updateFieldEquipment=plenty_admin.api.all("fieldEquipment/updateFieldEquipment"),plenty_admin.REST.deleteFieldEquipment=plenty_admin.api.all("fieldEquipment/deleteFieldEquipment"),plenty_admin.REST.insertActivity=plenty_admin.api.all("activities/insertActivity"),plenty_admin.REST.updateActivity=plenty_admin.api.all("activities/updateActivity"),plenty_admin.REST.deleteActivity=plenty_admin.api.all("activities/deleteActivity"),plenty_admin.REST.createTemplatePlan=plenty_admin.api.all("templatePlan/createTemplatePlan"),plenty_admin.UI.organization.init=function(a,b){plenty_admin.DATA.current_organization=a,plenty_admin.DATA.data_source=plenty_admin.DATA.current_organization,plenty_admin.UI.currentScreen=plenty_admin.UI.organization.DOM,plenty_admin.UI.organization.populate(a,b),plenty_admin.UI.organization.populate_farms_filter(),plenty_admin.DATA.eventCollector=window.eventcollector(8,1e4),plenty_admin.REST.getCropTypes(),plenty_admin.REST.getTillageTypes(),plenty_admin.REST.getIrrigationTypes(),plenty_admin.REST.getActivityTypes(),plenty_admin.REST.getSkillTypes(),plenty_admin.REST.getProductTypes(),plenty_admin.REST.getAllProducts(),plenty_admin.REST.getEquipmentEquipmentTypesForOrg(),plenty_admin.DATA.eventCollector.on("done",function(a,b,c){console.log("event %d of %d emitted",a,b),console.log("event description:",c)}),plenty_admin.DATA.eventCollector.on("alldone",function(){plenty_admin.UI.organization.DOM.fadeIn("normal",function(){plenty_admin.HELPER.hideLoadingOverlay(),plenty_admin.UI.add_template_plan.init()}),plenty_admin.UI.sideBar.organizations.DOM.find(".panel-collapse.in").removeClass("in").end().find(".panel-collapse[data-orgid='"+a.id+"']").addClass("in").find("li.sub").removeClass("active").end().find("li.sub a[href='"+b+"']").parent().addClass("active")}),plenty_admin.UI.organization.DOM.find("button.btn.add_to_organization").off("click").on("click",function(){var a=["Add","to","insert"],b=plenty_admin.UI.organization.tabs.DOM.find("li.active a[role='tab']").prop("href"),c=b.substring(b.indexOf("#")+1);"fields"===c?plenty_admin.UI.organization.show_add_field_modal():"plans"===c?plenty_admin.UI.add_template_plan.show():plenty_admin.UI.organization.show_item_modal("add_to_organization",a)}).end().find("button.delete_multiple").off("click").on("click",function(){var a=plenty_admin.UI.organization.tabs.DOM.find(".tab-pane.active tr td input[type='checkbox']:checked");console.log("selected_items:",a),bootbox.confirm({message:"Are you sure you want to delete multiple fields?",className:"danger",callback:function(){a.each(function(){var a=$(this).closest("tr").data("id");plenty_admin.UI.organization.deleteX(a,plenty_admin.HELPER.get_singular_selected_hash())})}})}).end().find("select.filter-by-farm").off("change").on("change",function(a){var b=$(this).val();switch(b){case"all":plenty_admin.UI.organization.DOM.find("table.fieldsList").find("tbody tr").show();break;default:plenty_admin.UI.organization.DOM.find("table.fieldsList").find("tbody tr").hide().end().find("tbody tr[data-farmid='"+$(a.target).val()+"']").show()}})},plenty_admin.UI.organization.show_add_field_modal=function(){var a=plenty_admin.DATA.current_organization.addressLine1+(plenty_admin.DATA.current_organization.addressLine2?", "+plenty_admin.DATA.current_organization.addressLine2:"")+", "+plenty_admin.DATA.current_organization.city+", "+plenty_admin.DATA.current_organization.state+", "+plenty_admin.DATA.current_organization.zip;console.log("current_org_address",a),plenty_admin.UI.organization.MODAL_add_field.off("shown.bs.modal").on("shown.bs.modal",function(){plenty_admin.MAPS.geocode(a,function(a){console.log("results: ",a,a[0].geometry.location);var b=new google.maps.LatLng(38.017922,-95.494064);plenty_admin.MAPS.add_field("add-field-map-canvas",b,plenty_admin.UI.map.minCLUZoom,plenty_admin.UI.organization.MODAL_add_field.find(".modal-body"))})}).off("show.bs.modal").on("show.bs.modal",function(){$(this).find(".modal-content").css("height",.9*$(window).height())}).modal("show")},plenty_admin.UI.organization.show_edit_field_modal=function(a){plenty_admin.UI.organization.MODAL_edit_field.off("shown.bs.modal").on("shown.bs.modal",function(){plenty_admin.MAPS.edit_field(a)}).off("show.bs.modal").on("show.bs.modal",function(){$(this).find(".modal-content").css("height",.9*$(window).height())}).modal("show")},plenty_admin.UI.organization.show_item_modal=function(a,b,c,d){console.log("plenty_admin.UI.organization.show_item_modal",a,b,c);var e=(plenty_admin.UI.organization.tabs.DOM.find("li.active a[role='tab']").prop("href"),plenty_admin.UI.organization.tabs.DOM.find("li.active").data("hash")),f=plenty_admin.HELPER.get_singular_selected_hash(e),g=plenty_admin.DATA.current_organization[e];switch(b[2]){case"update":case"delete":var h=$.grep(g,function(a){return"fieldsAndCropTypes"===e?a.field.id===c:a.id===c})[0],i=b[0]+" "+h.name+" "+b[1]+" "+plenty_admin.DATA.current_organization.name;console.log("currentItem",h);break;case"add":var i="Add a "+e}plenty_admin.UI.organization["MODAL_"+a].removeClass("farms users equipments products plans skills payments").addClass(e).on("hidden.bs.modal",function(){$(this).find("button."+b[0].toLowerCase()).button("reset")}).find(".modal-title").text(i).end().find("button."+b[0].toLowerCase()).off("click").on("click",function(){switch($(this).button("loading"),b[2]){case"update":var e=$(this).closest(".modal").find(".modal-body form:visible"),g=plenty_admin.UI.organization.build_item(e,h);plenty_admin.UI.organization[b[2]+"X"](g,f,d);break;case"delete":plenty_admin.UI.organization.deleteX(c,f,d,function(){console.log("item deleted"),plenty_admin.UI.organization["MODAL_"+a].modal("hide")});break;default:var e=$(this).closest(".modal").find(".modal-body form:visible"),g=plenty_admin.UI.organization.build_item(e,"update"==b[2]?h:null);plenty_admin.UI.organization[b[2]+"X"](g,f,d)}}).button("reset");var j=plenty_admin.UI.organization["MODAL_"+a].find("form.add_to_org_form."+e);switch(b[2]){case"update":plenty_admin.UI.organization.populate_form_from_item(j,c,e);break;default:j.find("input, textarea, select").each(function(){$(this).is("select")?$(this).find("option:eq(0)").prop("selected",!0):$(this).val("")})}plenty_admin.UI.organization["MODAL_"+a].modal("show")},plenty_admin.UI.organization.deleteX=function(a,b,c,d){switch(console.log("plenty_admin.UI.organization.deleteX",a,b,c,d),b){case"user":plenty_admin.REST.get_roles_with_userid(a,function(e){console.log("user roles: ",e,plenty_admin.DATA.current_organization.id);var f=$.grep(e,function(a){return a.organizationId===plenty_admin.DATA.current_organization.id});console.log("RoleForUserInOrg",f);for(var g=0;g<f.length;g++){var h=f[g];plenty_admin.REST.deleteRole["delete"](h.id).then(function(e){console.log(b+" Deleted: ",e),d&&"function"==typeof d&&d(),$(c).closest("tr").remove();var f=$.grep(plenty_admin.DATA.current_organization.users,function(b){return b.id!==a});plenty_admin.DATA.data_source.users=f})}});break;case"field":plenty_admin.REST.get_interests_by_field(a,function(e){console.log("got all interests for field",e);var f=$.grep(e,function(a){return a.organizationId===plenty_admin.DATA.data_source.id})[0];plenty_admin.REST.deleteInterest["delete"](f.id).then(function(e){console.log(b+" Deleted: ",e),d&&"function"==typeof d&&d(),$(c).closest("tr").remove();var f=$.grep(plenty_admin.DATA.data_source.fieldsAndCropTypes,function(b){return b.field.id!==a});plenty_admin.DATA.data_source.fields=f})});break;default:plenty_admin.REST["delete"+plenty_admin.HELPER.capitalizeFirstLetter(b)]["delete"](a).then(function(){console.log(b+" Deleted")})}},plenty_admin.UI.organization.insertX=function(a,b){plenty_admin.REST["insert"+plenty_admin.HELPER.capitalizeFirstLetter(b)].post(a).then(function(a){console.log(b+" Inserted: ",a);var c=a.body();switch(plenty_admin.UI.organization.MODAL_add_to_organization.modal("hide"),b){case"user":var d={organizationId:plenty_admin.DATA.current_organization.id,userId:c.id,roleTypeId:1};plenty_admin.REST.insertRole.post(d).then(function(a){var c=a.body();plenty_admin.REST.get_user_with_id(c.userId,function(a){plenty_admin.DATA.current_organization.users.push(a);var c=$(plenty_admin.UI.create_item(a,b));plenty_admin.UI.organization.DOM.find("table.usersList").find(".noItemsText").remove().end().append(c),plenty_admin.UI.organization.addItemFunctionality(c)})})}})},plenty_admin.UI.organization.updateX=function(a,b,c,d){plenty_admin.REST["update"+plenty_admin.HELPER.capitalizeFirstLetter(b)].put(a).then(function(a){console.log(b+" Updated: ",a,a.body()),plenty_admin.UI.update_entries_in_table(c,a.body()),plenty_admin.UI.organization.MODAL_edit_in_organization.modal("hide"),d&&"function"==typeof d&&d(a.body())})},plenty_admin.UI.update_entries_in_table=function(a,b){var c=$(a).closest("tr");for(p in b)b.hasOwnProperty(p)&&c.find("td."+p+" span").text(b[p])},plenty_admin.UI.organization.tabs.DOM.off("shown.bs.tab").on("shown.bs.tab",function(a){var b=a.target.href,c=b.substring(b.indexOf("#")),d=plenty_admin.UI.organization.DOM.data("orgId");plenty_admin.UI.sideBar.organizations.select_sub(d,c);var e=plenty_admin.UI.organization.tabs.DOM.find(".tab-pane.active tr td input[type='checkbox']:checked").length;switch(e>0?plenty_admin.UI.organization.BUTTON_delete_multiple.fadeIn("fast"):plenty_admin.UI.organization.BUTTON_delete_multiple.fadeOut("fast"),c){case"#farms":plenty_admin.UI.organization.tabs.DOM.find(".add_delete_controls").fadeOut("fast").end().find(".alert.farm-info").fadeIn("fast").end().find(".filter-by-farm-group").hide();break;case"#fields":plenty_admin.UI.organization.tabs.DOM.find(".filter-by-farm-group").show().end().find(".add_delete_controls").fadeIn("fast").end().find(".alert.farm-info").fadeOut("fast");break;default:plenty_admin.UI.organization.tabs.DOM.find(".filter-by-farm-group").fadeOut("fast").end().find(".add_delete_controls").fadeIn("fast").end().find(".alert.farm-info").fadeOut("fast")}}),plenty_admin.UI.organization.items=function(a,b){if(a.length<=0)var c="<h3 class='noItemsText'>No items in this set yet!</h3>";else if(a instanceof Object&&!Array.isArray(a))var c="<h3 class='noItemsText'>No properties in this object yet!</h3>";else{for(var d="fieldsAndCropTypes"==b?a[0].field:a[0],e=plenty_admin.UI.create_header_row(d,b),c="<tbody>",f=0;f<a.length;f++){var g=a[f];c+=plenty_admin.UI.create_item(g,b)}c+="</tbody>"}var h=$(c),i={headerHTML:e,bodyHTML:plenty_admin.UI.organization.addItemFunctionality(h)};return i},plenty_admin.UI.organization.showFieldPage=function(a){console.log("showFieldPage: ",a);var b=[{"class":"back toSettings",name:"Settings",clickHandler:function(){return plenty_admin.UI.currentScreen.fadeOut("normal",function(){plenty_admin.UI.currentScreen=plenty_admin.UI.settings.DOM,plenty_admin.UI.currentScreen.fadeIn("normal")}),!1}},{"class":"back toOrganization",name:plenty_admin.DATA.current_organization.name,clickHandler:function(){return plenty_admin.UI.currentScreen.fadeOut("normal",function(){plenty_admin.UI.currentScreen=plenty_admin.UI.organization.DOM,plenty_admin.UI.currentScreen.fadeIn("normal")}),!1}},{"class":"active",name:a.name,clickHandler:null}];plenty_admin.UI.field.DOM.find(".breadcrumb-trail").remove().end().prepend(plenty_admin.UI.build_breadcrumb_trail(b)),plenty_admin.UI.field.init(a,"settings")},plenty_admin.UI.organization.addItemFunctionality=function(a){return a.find("td input[type='checkbox']").off("click").on("click",function(a){var b=$(a.target).closest("tbody").find("tr td input[type='checkbox']:checked").length;b>0?plenty_admin.UI.organization.BUTTON_delete_multiple.fadeIn("fast"):plenty_admin.UI.organization.BUTTON_delete_multiple.fadeOut("fast")}).end().find("td button.btn.editItem").off("click").on("click",function(a){var b=$(this).closest("tr"),c=["Update","in","update"],d=b.data("id");switch(b.data("hash")){case"fieldsAndCropTypes":var e=$.grep(plenty_admin.DATA.data_source.fieldsAndCropTypes,function(a){return a.field.id===d})[0].field;plenty_admin.UI.organization.show_edit_field_modal(e,a.target);break;default:plenty_admin.UI.organization.show_item_modal("edit_in_organization",c,d,a.target)}}).end().find("td button.btn.deleteItem").off("click").on("click",function(a){var b=$(this).closest("tr").data("id"),c=["Remove","from","delete"];plenty_admin.UI.organization.show_item_modal("confirm_delete",c,b,a.target)}).end().find("td.map_thumbnail a").click(function(a){var b=$(a.target).closest("tr").data("id"),c=$.grep(plenty_admin.DATA.current_organization.fieldsAndCropTypes,function(a){return a.field.id===b})[0].field;return plenty_admin.UI.organization.showFieldPage(c),!1}),a},plenty_admin.UI.create_header_row=function(a,b){var c="<thead><tr>";c+='<th class="select" style="width:60px;">Select</th>',"fieldsAndCropTypes"===b&&(c+='<th class="select" style="width:100px;">Preview</th>'),a.hasOwnProperty("name")&&(c+="<th>Name</th>"),a.hasOwnProperty("firstName")&&(c+="<th>First Name</th>"),a.hasOwnProperty("lastName")&&(c+="<th>Last Name</th>");for(p in a)if(a.hasOwnProperty(p)&&"id"!==p&&"name"!==p&&"firstName"!==p&&"lastName"!==p&&"created"!==p&&"lastModified"!==p&&"enabled"!==p&&"farmId"!==p){var d="";switch(p){case"lastModified":d="Last Modified";break;case"mobileNumber":d="Mobile #";break;case"postalCode":d="ZIP";break;case"weatherForecastCity":d="City";break;case"weatherForecastState":d="State";break;case"latitude":d="Lat";break;case"longitude":d="Lon";break;default:d=p}Array.isArray(a[p])&&(d="# "+d),c+='<th class="text-capitalize">'+d+"</th>"}return c+='<th class="text-right prn">Controls</th>',c+="</tr></thead>"},plenty_admin.UI.create_item=function(a,b){if("fieldsAndCropTypes"===b){var c=a.id?a:a.field;plenty_admin.REST.fields.getAllBoundaryPointsByFieldAndBoundaryType(c.id,2,function(a){function b(a){if(h.length>0)h.prop("src",a);else{setTimeout(function(){console.log("checking field dom element"),b(a)},300)}}var d=new google.maps.LatLngBounds;a.forEach(function(a){d.extend(new google.maps.LatLng(a.latitude,a.longitude))});var e=d.getCenter(),f="color:0x758e1b|weight:2";a.forEach(function(a){f+="|"+a.latitude+","+a.longitude}),staticMapParams={center:e.lat()+","+e.lng(),size:"80x80",maptype:"hybrid",zoom:plenty_admin.MAPS.getBoundsZoomLevel(d,{width:80,height:80}),path:f};var g=plenty_admin.MAPS.get_static_maps_url(staticMapParams),h=plenty_admin.UI.organization.DOM.find("table.fieldsList").find("tbody tr[data-id='"+c.id+"'] td.map_thumbnail img");b(g)})}else var c=a;var d='<tr class="reveal-on-hover-wrap '+b+'" data-id="'+c.id+'" data-hash="'+b+'" '+("fieldsAndCropTypes"===b?"data-farmid='"+c.farmId+"'":"")+">";d+='<td><input type="checkbox" aria-label="..."></td>',"fieldsAndCropTypes"===b&&(d+='<td class="map_thumbnail" style="width:80px;"><a href=""><img src="" width="80" height="80"/></a></td>'),c.hasOwnProperty("name")&&(d+='<td class="name"><span class="editable" data-type="text" data-name="name" data-pk="x/'+b+"/"+c.id+'" data-title="'+p+'">'+c.name+"</span></td>"),c.hasOwnProperty("firstName")&&(d+='<td class="firstName"><span class="editable" data-type="text" data-name="firstName" data-pk="x/'+b+"/"+c.id+'" data-title="'+p+'">'+c.firstName+"</span></td>"),c.hasOwnProperty("lastName")&&(d+='<td class="lastName"><span class="editable" data-type="text" data-name="lastName" data-pk="x/'+b+"/"+c.id+'" data-title="'+p+'">'+c.lastName+"</span></td>");for(p in c)if(c.hasOwnProperty(p)&&"id"!==p&&"name"!==p&&"firstName"!==p&&"lastName"!==p&&"created"!==p&&"lastModified"!==p&&"enabled"!==p&&"farmId"!==p){var e="";switch(p){case"roleId":e=plenty_admin.REST.roleTypes[c[p]];break;case"latitude":case"longitude":e="<span class='truncate truncate-80'>"+c[p]+"</span>";break;case"password":e='<button type="button" class="btn btn-sm btn-primary sendPassword reveal-on-hover-element"><span class="fa fa-lock"></span> <span class="hidden-xs">Send Password</span></button>';break;default:e=c[p]}d+='<td class="'+p+'"><span class="pull-left'+("created"!==p&&"lastModified"!==p&&"password"!==p?' editable"':'"')+("created"!==p&&"lastModified"!==p?'  data-type="'+plenty_admin.HELPER.returnFieldType(p)+'" data-name="'+p+'" data-pk="x/'+b+"/"+a.id+'" data-title="'+p+'"':"")+("select"===plenty_admin.HELPER.returnFieldType(p)?plenty_admin.HELPER.returnInlineEditSelectOptions(p):"")+">"+e+"</span></td>"}return d+='<td class="pln prn"><div class="btn-group pull-right mbn reveal-on-hover-element" role="group" aria-label="..."><button type="button" class="btn btn-sm btn-primary editItem"><span class="glyphicon glyphicon-edit"></span> <span class="hidden-xs">Edit</span></button>'+("farms"!==b?'<button type="button" class="btn btn-sm btn-danger deleteItem"><span class="fa fa-trash-o"></span><span class="hidden-xs">Remove</span></button>':"")+"</div></td></tr>"},plenty_admin.UI.organization.populate=function(a,b){console.log("plenty_admin.UI.organization.populate: ",a,b),plenty_admin.UI.organization.DOM.data("orgId",a.id);for(i in a)if(a.hasOwnProperty(i))switch(console.log("list org properties: ",i,a[i],typeof a[i]),typeof a[i]){case"string":case"number":var c="";switch(i){case"organizationTypeId":c=plenty_admin.DATA.organizationTypes[a[i]].name;break;default:c=a[i]}plenty_admin.UI.organization.DOM.find(".org-"+i).text(c).data("pk",a.id+"/organizations").editable(plenty_admin.REST.inline_editing_options);break;case"object":if("fieldsAndCropTypes"===i)var d=plenty_admin.UI.organization.DOM.find("table.fieldsListHeader"),e=plenty_admin.UI.organization.DOM.find("table.fieldsList");else var d=plenty_admin.UI.organization.DOM.find("table."+i+"ListHeader"),e=plenty_admin.UI.organization.DOM.find("table."+i+"List");var f=plenty_admin.UI.organization.items(a[i],i);e.html("").append(f.bodyHTML).find(".editable").editable(plenty_admin.REST.inline_editing_options),d.html("").append(f.headerHTML)}b&&plenty_admin.UI.organization.switchTab(b),plenty_admin.HELPER.hideLoadingOverlay()},plenty_admin.UI.organization.build_item=function(a,b){console.log("form: ",a,b);var c={};return c.id=b?b.id:null,c.created=b?b.created:null,c.lastModified=b?b.lastModified:null,a.find("input, textarea, select").each(function(){switch($(this).prop("type")){case"checkbox":c[$(this).data("propname")]=$(this).is(":checked");break;default:c[$(this).data("propname")]=$(this).val()}}),console.log("add_new_data",c),c},plenty_admin.UI.organization.populate_farms_filter=function(){plenty_admin.UI.organization.filter_by_farm.find("option").remove();for(var a="<option value='all'>All Farms</option>",b=0;b<plenty_admin.DATA.current_organization.farms.length;b++){var c=plenty_admin.DATA.current_organization.farms[b];a+="<option value='"+c.id+"'>"+c.name+"</option>"}plenty_admin.UI.organization.filter_by_farm.append(a)},plenty_admin.UI.organization.populate_form_from_item=function(a,b,c){console.log("populate_form_from_item: ",a,b,c);var d=$.grep(plenty_admin.DATA.current_organization[c],function(a){return a.id===b})[0];console.log("itemData",d),a.find("input, textarea, select").each(function(){switch($(this).prop("type")){case"checkbox":console.log("found a checkbox: ",$(this),d[$(this).data("propname")]),$(this).prop("checked",d[$(this).data("propname")]);break;default:$(this).val(d[$(this).data("propname")])}})},plenty_admin.UI.organization.switchTab=function(a){plenty_admin.UI.organization.tabs.DOM.find(".nav-tabs a[role='tab'][href='"+a+"']").tab("show")},plenty_admin.UI.crop_survey={},plenty_admin.UI.crop_survey.modal=$("body").find(".modal#crop-survey"),plenty_admin.UI.crop_survey.show=function(a,b){console.log("plenty_admin.UI.crop_survey.show",a),"object"==typeof a?plenty_admin.UI.crop_survey.populate(a,b):"number"==typeof a&&plenty_admin.DATA.load_field_observation(a,function(a){plenty_admin.UI.crop_survey.populate(a,b)})},plenty_admin.UI.crop_survey.populate=function(a,b){plenty_admin.UI.crop_survey.modal.find(".mainTabs a[data-toggle='tab']").on("shown.bs.tab",function(a){console.log("e.target",a.target);var c=plenty_admin.UI.crop_survey.modal.find(".tab-content.mainTabs .tab-pane.active:visible .map:visible:last");plenty_admin.UI.crop_survey.showMap(c,b)}).end().on("shown.bs.modal",function(){var a=plenty_admin.UI.crop_survey.modal.find(".tab-content.mainTabs .tab-pane.active:visible .map:visible:last");plenty_admin.UI.crop_survey.showMap(a,b)}).modal("show")},plenty_admin.UI.crop_survey.showMap=function(a,b){var c=a.prop("id");console.log("mapId",c),plenty_admin.MAPS.draw_field_on_map(b,c,{mapTypeId:google.maps.MapTypeId.HYBRID,zoom:12,disableDefaultUI:!0,draggable:!1,zoomControl:!1,scrollwheel:!1,disableDoubleClickZoom:!0,pushPoly:!1},function(a,b,d){console.log("Polygon: ",d),console.log("Map element: ",$("#"+c)),$("#"+c).data("polygon",d).data("mapId",c),$(window).on("resize",function(){plenty_admin.MAPS.zoomToPolygon(d,plenty_admin.MAPS[c])})},!1,null,c)},plenty_admin.UI.newOrganization={init:function(){plenty_admin.UI.newOrganization.DOM.data("ready")||(plenty_admin.UI.newOrganization.DOM.find("button.newOrg").off("click").on("click",function(){var a=$(this).closest(".panel").find("form"),b={};return b.name=a.find("#new_org_name").val(),b.organizationTypeId=parseInt(a.find("#new_org_type").val()),b.addressLine1=a.find("#new_org_address_1").val(),b.addressLine2=a.find("#new_org_address_2").val(),b.city=a.find("#new_org_city").val(),b.state=a.find("#new_org_state").val(),b.zip=a.find("#new_org_zip").val(),console.log("organizationDto: ",b),a.fadeOut("fast",function(){plenty_admin.UI.newOrganization.DOM.find(".alert-info").fadeIn("fast")}),plenty_admin.REST.insertOrganization.post(b).then(function(b){console.log("organization inserted: ",b().data);var c={organizationId:b().data.id,userId:plenty_admin.DATA.userDetails.id,roleTypeId:1};plenty_admin.REST.insertRole.post(c).then(function(){plenty_admin.UI.newOrganization.DOM.find(".alert-info").fadeOut("fast",function(){plenty_admin.UI.newOrganization.DOM.find(".alert-success").fadeIn("fast");setTimeout(function(){plenty_admin.UI.newOrganization.DOM.find(".alert-success").fadeOut("fast",function(){a.fadeIn("fast")})},5e3)}),plenty_admin.UI.sideBar.organizations.DOM.find(".add-org").before(plenty_admin.UI.sideBar.organizations.create(b().data))})},function(){plenty_admin.UI.settings.new_organization.find(".alert-info").fadeOut("fast",function(){plenty_admin.UI.settings.new_organization.find(".alert-danger").fadeIn("fast");setTimeout(function(){plenty_admin.UI.settings.new_organization.find(".alert-danger").fadeOut("fast",function(){a.fadeIn("fast")})},5e3)})}),!1}).end().find("a.moreDetailsToggle").off("click").on("click",function(){return $(this).find("span").toggle().end().parent().find(".more-details").slideToggle(),!1}),plenty_admin.UI.newOrganization.DOM.data("ready",!0))},clear:function(){}},plenty_admin.UI.newOrganization.DOM=plenty_admin.UI.main.DOM.find("#new-organization-container"),plenty_admin.UI.add_template_plan={modal:$("body").find(".modal#add-template-plan"),init:function(){if(!plenty_admin.UI.add_template_plan.modal.data("ready")){console.log("plenty_admin.UI.add_template_plan - INIT");var a="";for(id in plenty_admin.DATA.organizations)if(plenty_admin.DATA.organizations.hasOwnProperty(id)&&"length"!==id){var b=plenty_admin.DATA.organizations[id];a+="<option value='"+id+"'>"+b.name+"</option>"}var c=plenty_admin.UI.add_template_plan.modal.find("select#add_plan_owningOrgId");c.find("option").remove().end().append(a);var d=plenty_admin.UI.add_template_plan.modal.find("select#add_task_product_types");d.find("option").remove().end().append("<option value='' disabled selected style='display:none;'>Choose product type</option>");for(id in plenty_admin.DATA.productTypes)if(plenty_admin.DATA.productTypes.hasOwnProperty(id)&&"length"!==id){var e=plenty_admin.DATA.productTypes[id],f=$("<option value='"+id+"'>"+e.name+"</option>");f.data("dto",e),d.append(f),plenty_admin.REST.getProductsByType(e.id,function(a,b){console.log("products - ",a),b.data("items",a)},f)}var g="";for(id in plenty_admin.DATA.activityTypes)if(plenty_admin.DATA.activityTypes.hasOwnProperty(id)&&"length"!==id){var h=plenty_admin.DATA.activityTypes[id];g+="<option value='"+id+"'>"+h.name+"</option>"}var i=plenty_admin.UI.add_template_plan.modal.find("select#add_activity_type");i.find("option").remove().end().append(g),plenty_admin.UI.add_template_plan.modal.on("show.bs.modal",function(){$(this).find(".modal-content").css("height",.9*$(window).height());var a=plenty_admin.UI.add_template_plan.modal.find("select#add_task_equipment_types");a.find("option").remove().end().append("<option value='' disabled selected style='display:none;'>Choose equipment type</option>");for(id in plenty_admin.DATA.equipmentTypes)if(plenty_admin.DATA.equipmentTypes.hasOwnProperty(id)&&"length"!==id){var b=plenty_admin.DATA.equipmentTypes[id],c=$("<option value='"+id+"'>"+b.name+"</option>");c.data("dto",b),a.append(c),plenty_admin.REST.getEquipmentByOrgAndType(plenty_admin.DATA.current_organization.id,b.id,function(a,b){console.log("equipments - ",a),b.data("items",a)},c)}var d=plenty_admin.UI.add_template_plan.modal.find("select#add_task_labour_types");d.find("option").remove().end().append("<option value='' disabled selected style='display:none;'>Choose labour type</option>");for(id in plenty_admin.DATA.labourTypes)if(plenty_admin.DATA.labourTypes.hasOwnProperty(id)&&"length"!==id){var e=plenty_admin.DATA.labourTypes[id],f=$("<option value='"+id+"'>"+e.name+"</option>");f.data("dto",e),d.append(f),plenty_admin.REST.getSkillsAndRatesByUserAndSkillAndOrg(e.id,function(a,b){console.log("skills - ",a),b.data("items",a)},f)}}).on("hidden.bs.modal",function(){plenty_admin.UI.add_template_plan.clear()}).find(".task-types-tabs a").click(function(a){a.preventDefault(),console.log("tab clicked",$(this)),$(this).tab("show")}).on("shown.bs.tab",function(a){
var b=$(a.target).prop("href"),c=b.substring(b.indexOf("#")+1);console.log("hash",c),plenty_admin.UI.add_template_plan.modal.find(".tab-content.task-types .tab-pane").removeClass("active").end().find(".tab-content.task-types .tab-pane#"+c).addClass("active")}).end().find("select.specific_items").on("change",function(){var a=$(this),b=null;a.prop("id").indexOf("product")>-1?b="product":a.prop("id").indexOf("equipment")>-1&&(b="equipment"),$(this).find("option:selected").val()&&"equipment"===b?$(this).closest(".tab-pane").find(".component_qty").val(1).prop("disabled",!0):$(this).closest(".tab-pane").find(".component_qty").prop("disabled",!1)}).end().find("select.component_type").on("change",function(){var a=$(this),b=a.find("option:selected"),c=b.data("dto"),d=b.data("items"),e=a.parent().find("select.specific_items");c.unitName&&a.closest(".tab-pane").find(".uom").text(c.unitName).show();var f=null;a.prop("id").indexOf("product")>-1?f="product":a.prop("id").indexOf("equipment")>-1?f="equipment":a.prop("id").indexOf("labour")>-1&&(f="labour");var g="<option value='' selected'>Choose specific "+b.text()+"</option>";for(id in d)if(d.hasOwnProperty(id)){var h=d[id];g+="<option value='"+("equipment"===f?h.equipmentId:h.id)+"'>"+("equipment"===f?h.equipmentName:h.name)+"</option>"}return e.find("option").remove().end().append(g).show(),!1}).end().find("button.task_add_component").on("click",function(){var a=$(this),b=a.closest(".tab-pane"),c=plenty_admin.HELPER.validateForm(b);if(c){var d=b.data("type"),e=b.find("table.task-items tbody"),f={id:parseInt(b.find(".component_type option:selected").val()),qty:parseInt(b.find(".component_qty").val())};b.find("select.specific_items option:selected").length>0&&(f.specificId=parseInt(b.find("select.specific_items option:selected").val())),b.find(".component_type option:selected").prop("disabled",!0),b.find(".component_type option:eq(0)").show().prop("selected",!0);var g=plenty_admin.UI.add_template_plan.build_task_component(f,d);e.append(g)}return!1}).end().find("button.save_activity").on("click",function(){var a=$(this),b=plenty_admin.UI.add_template_plan.addActivityForm,c=plenty_admin.HELPER.validateForm(b);if(c){var d={templatePlanId:null,activityTypeId:parseInt(b.find("#add_activity_type option:selected").val()),daysFromPlanting:parseInt(b.find("#add_activity_days_from_planting").val())};console.log("activityDto",d),plenty_admin.UI.add_template_plan.build_activity_element(d),a.closest(".activities_management").find(".alert.help-block:eq(0)").hide().end().find("form").slideUp("fast",function(){a.closest(".activities_management").find(".activity_list").slideDown("fast").end().find("button.add_activity").slideDown("fast"),plenty_admin.UI.add_template_plan.addTaskAndTaskComponents.slideDown("fast"),plenty_admin.UI.add_template_plan.addTaskBtn.slideUp("fast").prop("disabled",!1),plenty_admin.UI.add_template_plan.taskListHolder.slideUp("fast"),plenty_admin.UI.add_template_plan.modal.find(".noActivityForTasks").slideUp("fast")}),plenty_admin.UI.add_template_plan.activityListHolder.find("li.list-group-item.activity").length>1&&plenty_admin.UI.add_template_plan.activityListHolder.sortable({pullPlaceholder:!1,placeholder:'<li class="list-group-item placeholder"><a>MOVE HERE</a></li>',onDrop:function(a,b,c){var d=$("<li/>").css({height:0});a.before(d),d.animate({height:a.height()}),a.animate(d.position(),function(){d.detach(),c(a,b)})},onDragStart:function(a,b,c){var d=a.offset(),e=b.rootGroup.pointer;adjustment={left:e.left-d.left,top:e.top-d.top},c(a,b)},onDrag:function(a,b){a.css({left:b.left-adjustment.left,top:b.top-adjustment.top})}})}return!1}).end().find("button.add_activity").on("click",function(){var a=$(this);a.hide().parent().find(".activity_list").slideUp("fast",function(){a.parent().find(".add_activity_form").slideDown("fast")})}).end().find("button.add_task").on("click",function(){var a=$(this);a.slideUp("fast"),plenty_admin.UI.add_template_plan.taskListHolder.slideUp("fast",function(){plenty_admin.UI.add_template_plan.addTaskAndTaskComponents.slideDown("fast")})}).end().find("button.save_task").on("click",function(){var a=($(this),plenty_admin.UI.add_template_plan.addTaskForm),b=plenty_admin.UI.add_template_plan.addTaskAndTaskComponents,c=b.find("table.equipment-items tbody tr.task-element"),d=b.find("table.labour-items tbody tr.task-element"),e=b.find("table.product-items tbody tr.task-element"),f=c.length+d.length+e.length,g=plenty_admin.HELPER.validateForm(a);if(g&&f>=1){for(var h=[],i=[],j=0;j<c.length;j++){var k=$(c[j]).data("task_component");k.specificId?i.push(k.specificId):h.push(k.id)}console.log("equipmentIds:",h),console.log("anySpecificEquipmentIds:",i);for(var l=[],j=0;j<d.length;j++)l.push($(d[j]).data("task_component").id);console.log("labourIds:",l);for(var m=[],n=[],j=0;j<e.length;j++){var k=$(e[j]).data("task_component"),o={productTypeId:k.id,amount:k.qty};k.specificId?n.push(k.specificId):m.push(o)}console.log("productAmountPairs:",m),console.log("anySpecificProductIds:",n);var p={name:a.find("#add_task_name").val(),templateActivityId:null,daysFromActivityStart:parseInt(a.find("#add_task_days_from_start").val()),labourIds:l,equipmentIds:h,productAmountPairs:m,anySpecificEquipmentIds:i,anySpecificProductIds:n,anySpecificLabourIds:[]};console.log("templateTaskDto",p),plenty_admin.UI.add_template_plan.build_task_element(p),b.slideUp("fast",function(){plenty_admin.UI.add_template_plan.taskListHolder.slideDown("fast"),plenty_admin.UI.add_template_plan.addTaskBtn.slideDown("fast"),plenty_admin.UI.add_template_plan.clear_add_task_form()})}return!1}).end().find("button.cancel_activity").on("click",function(a){a.preventDefault();var b=$(this);b.closest(".activities_management").find("form").slideUp("fast",function(){b.closest(".activities_management").find(".activity_list").slideDown("fast").end().find("button.add_activity").slideDown("fast")})}).end().find("button.cancel_task").on("click",function(a){a.preventDefault();$(this);plenty_admin.UI.add_template_plan.addTaskAndTaskComponents.slideUp("fast",function(){plenty_admin.UI.add_template_plan.taskListHolder.slideDown("fast"),plenty_admin.UI.add_template_plan.addTaskBtn.slideDown("fast")})}).end().find("button.add").on("click",function(){var a=plenty_admin.UI.add_template_plan.modal.find("form.add_plan_form"),b=plenty_admin.HELPER.validateForm(a),c=$(this);if(plenty_admin.UI.add_template_plan.modal.find(".activity .alert.help-block").slideUp("fast"),b){var d=plenty_admin.UI.add_template_plan.modal.find(".activity");if(console.log("activities",d,d.length),d.length<=0)plenty_admin.UI.add_template_plan.activityListHolder.parent().find(".alert.help-block:eq(0)").slideDown("fast");else{plenty_admin.UI.add_template_plan.activityListHolder.parent().find(".alert.help-text:eq(0)").hide();for(var e=[],f=0;f<d.length;f++){var g=$(d[f]),h=[],i=plenty_admin.UI.add_template_plan.taskListHolder.find("ul.task_list.activity_tasks_"+g.data("index")+" .task");if(i.length<=0)return g.find(".help-block.alert").slideDown("fast"),console.log("Activity Has No Tasks ;("),!1;for(var j=0;j<i.length;j++){var k=$(i[j]);h.push(k.data("taskDto"))}g.data("activityDto").indexInPlan=g.index();var l={templateActivityDto:g.data("activityDto"),templateTaskDtos:h};e.push(l)}c.button("disable");var m={owningOrgId:plenty_admin.DATA.current_organization.id,planName:a.find("#add_plan_name").val(),planDescription:a.find("#add_plan_desc").val(),activitiesAndTasks:e};console.log("TemplatePlanCreationDto",m),plenty_admin.REST.plans.createTemplatePlan(m,function(a){console.log("add this templatePlan to the list: ",a);var b=plenty_admin.UI.organization.addItemFunctionality($(plenty_admin.UI.create_item(a,"plans")));plenty_admin.UI.organization.DOM.find("table.plansList").find(".noItemsText").remove().end().append(b),plenty_admin.UI.add_template_plan.hide()})}}return!1}).end(),plenty_admin.UI.add_template_plan.modal.data("ready",!0)}},show:function(){plenty_admin.UI.add_template_plan.modal.modal("show")},hide:function(){plenty_admin.UI.add_template_plan.modal.modal("hide")},clear:function(){plenty_admin.UI.add_template_plan.activityListHolder.find("li.activity").remove().end().hide().parent().find("form.add_activity_form").show().end().find("button.add_activity").hide(),plenty_admin.UI.add_template_plan.taskListHolder.find("li.task").remove().end().hide().parent().find("form.add_task_form, button.add_task").hide().end().find("p.noActivityForTasks").show(),plenty_admin.UI.add_template_plan.modal.find("input, textarea").each(function(){$(this).val($(this).data("default")?"number"==$(this).prop("type")?parseInt($(this).data("default")):$(this).data("default"):"")}).end().find("select").each(function(){$(this).find("option:eq(0)").prop("selected",!0),$(this).find("option:gt(0)").each(function(){$(this).prop("disabled",!1)})}).end().find(".uom").hide().end().find("button.add").button("reset"),plenty_admin.UI.add_template_plan.modal.find("tr.task-element").remove(),plenty_admin.UI.add_template_plan.addTaskAndTaskComponents.hide()},build_task_component:function(a,b){var c=$(['<tr class="reveal-on-hover-wrap task-element">','<td width="55%">'+plenty_admin.DATA[b+"Types"][a.id].name+"</td>",'<td width="20%">'+a.qty+"</td>",'<td width="25%"><button class="btn btn-sm btn-danger delete reveal-on-hover-element btn-block"><span class="fa fa-trash-o"></span> Delete</button></td>',"</tr>"].join("")).data("task_component",a).find("button.delete").click(function(){return $(this).closest("tr").remove(),!1}).end();return c},build_task_element:function(a){console.log("build_task_element",a);for(var b=$(['<li class="list-group-item overflowFix reveal-on-hover-wrap task">','<div class="col-md-12 mbs">','<h4 class="pull-left">'+a.name+"</h4>",'<p class="pull-right mbn reveal-on-hover-element mts" role="group" aria-label="...">','<button class="btn btn-sm btn-danger reveal-on-hover-element delete-task"><span class="fa fa-trash-o"></span> <span class="hidden-xs">Delete</span></button>','<button type="button" class="btn btn-sm btn-primary edit-task mls"><span class="glyphicon glyphicon-edit"></span> <span class="hidden-xs">Edit</span></button>',"</p>","</div>",'<div class="col-md-4 equipment prn">',"<p><b>Equipment</b></p>","</div>",'<div class="col-md-4 labour prn">',"<p><b>Labour</b></p>","</div>",'<div class="col-md-4 product">',"<p><b>Product</b></p>","</div>","</li>"].join("")).data("taskDto",a),c=0;c<a.equipmentIds.length;c++){var d=a.equipmentIds[c];$equipment_task_item=$('<p class="task-component">'+plenty_admin.DATA.equipmentTypes[d].name+' <a href="" class="remove pull-right ptn pbn pln prn"><i class="fa fa-trash-o"></i></a></p>'),$equipment_task_item.data("id",d).data("type","equipmentIds").find("a.remove").click(function(){var a=$(this),b=a.parent(),c=a.closest(".task").data("taskDto")[b.data("type")];console.log("idList",c);for(var d=-1,e=0;e<c.length;e++){parseInt(b.data("id"))===c[e]&&(d=e);break}return console.log("index",d),d>=-1&&c.splice(d,1),$(this).closest("p").remove(),!1}),b.find(".equipment").append($equipment_task_item)}for(var c=0;c<a.anySpecificEquipmentIds.length;c++){var d=a.anySpecificEquipmentIds[c];$equipment_task_item=$("<p>"+plenty_admin.DATA.current_organization.equipmentEquipmentTypes[d].equipmentName+' <a href="" class="remove pull-right ptn pbn pln prn"><i class="fa fa-trash-o"></i></a></p>'),$equipment_task_item.data("id",d).data("type","anySpecificEquipmentIds").find("a.remove").click(function(){return $(this).closest("p").remove(),!1}),b.find(".equipment").append($equipment_task_item)}for(var c=0;c<a.labourIds.length;c++){var e=a.labourIds[c];$labour_task_item=$("<p>"+plenty_admin.DATA.labourTypes[e].name+' <a href="" class="remove pull-right ptn pbn pln prn"><i class="fa fa-trash-o"></i></a></p>'),$labour_task_item.data("id",e).data("type","labourIds").find("a.remove").click(function(){var a=$(this),b=a.parent(),c=a.closest(".task").data("taskDto")[b.data("type")];console.log("idList",c);for(var d=-1,e=0;e<c.length;e++){parseInt(b.data("id"))===c[e]&&(d=e);break}return console.log("index",d),d>=-1&&c.splice(d,1),$(this).closest("p").remove(),!1}),b.find(".labour").append($labour_task_item)}for(var c=0;c<a.productAmountPairs.length;c++){var f=a.productAmountPairs[c];$product_task_item=$("<p>"+plenty_admin.DATA.productTypes[f.productTypeId].name+' <a href="" class="remove pull-right ptn pbn pln prn"><i class="fa fa-trash-o"></i></a></p>'),$product_task_item.data("id",f).data("type","productAmountPairs").find("a.remove").click(function(){var a=$(this),b=a.parent(),c=a.closest(".task").data("taskDto")[b.data("type")];console.log("idList",c);for(var d=-1,e=0;e<c.length;e++){parseInt(b.data("id").productTypeId)===c[e]&&(d=e);break}return console.log("index",d),d>=-1&&c.splice(d,1),$(this).closest("p").remove(),!1}),b.find(".product").append($product_task_item)}for(var c=0;c<a.anySpecificProductIds.length;c++){var f=a.anySpecificProductIds[c];$product_task_item=$("<p>"+plenty_admin.DATA.allProducts[f].name+' <a href="" class="remove pull-right ptn pbn pln prn"><i class="fa fa-trash-o"></i></a></p>'),$product_task_item.data("id",f).data("type","anySpecificProductIds").find("a.remove").click(function(){for(var a=$(this),b=a.parent(),c=a.closest(".task").data("taskDto")[b.data("type")],d=null,e=0;e<c.length;e++)parseInt(b.data("id"))===c[e]&&(d=e);return d&&c.splice(d,1),a.closest("p").remove(),!1}),b.find(".product").append($product_task_item)}b.find("button.delete-task").click(function(){b.remove();var a=plenty_admin.UI.add_template_plan.taskListHolder.find("ul.task_list li.task");return 0===a.length&&plenty_admin.UI.add_template_plan.taskListHolder.hide(),!1}).end().find("button.edit-task").click(function(){return plenty_admin.UI.add_template_plan.edit_task(),!1}).end();var g=plenty_admin.UI.add_template_plan.activityListHolder.find(".activity.active").data("index");plenty_admin.UI.add_template_plan.taskListHolder.find("ul.task_list").hide(),plenty_admin.UI.add_template_plan.taskListHolder.find("ul.task_list.activity_tasks_"+g).append(b).show()},clear_add_task_form:function(){plenty_admin.UI.add_template_plan.addTaskAndTaskComponents.find("input").each(function(){$(this).val($(this).data("default")?"number"==$(this).prop("type")?parseInt($(this).data("default")):$(this).data("default"):"")}).end().find("table.task-items tbody tr").remove().end().parent().find("select :nth-child(0)").prop("selected",!0).end().find("select option:gt(0)").prop("disabled",!1).end().find("select.specific_items, .uom").hide()},edit_activity:function(){plenty_admin.UI.add_template_plan.addActivityBtn.hide(),plenty_admin.UI.add_template_plan.activityListHolder.slideUp("fast",function(){plenty_admin.UI.add_template_plan.addActivityForm.slideDown("fast")})},edit_task:function(){plenty_admin.UI.add_template_plan.addTaskBtn.slideUp("fast"),plenty_admin.UI.add_template_plan.taskListHolder.slideUp("fast"),plenty_admin.UI.add_template_plan.addTaskAndTaskComponents.slideDown("fast")},build_activity_element:function(a){console.log("build_activity_element",a);var b=$(['<li class="list-group-item reveal-on-hover-wrap active activity">','<div class="help-block alert alert-danger error mtn mbs" style="display:none;"',"<h3>This activity has no tasks associated with it.</h3>","<p>Either add tasks to it or remove this activity.</p>","</div>",'<p class="pull-right mbn reveal-on-hover-element" role="group" aria-label="...">','<button class="btn btn-danger btn-sm delete-activity"><span class="fa fa-trash-o"></span> <span class="hidden-xs">Delete</span></button>','<button type="button" class="btn btn-sm btn-primary edit-activity"><span class="glyphicon glyphicon-edit"></span> <span class="hidden-xs">Edit</span></button>',"</p>",'<a href="">',plenty_admin.DATA.activityTypes[a.activityTypeId].name,"</a>","</li>"].join("")).data("activityDto",a).data("templateTaskDtos",[]).data("tasks",[]).find("a").click(function(){var a=$(this).closest("li").data("index"),b=plenty_admin.UI.add_template_plan.taskListHolder.find("ul.task_list"),c=plenty_admin.UI.add_template_plan.taskListHolder.find("ul.task_list.activity_tasks_"+a),d=c.find(".task");return b.hide(),c.show(),d.length>0?(plenty_admin.UI.add_template_plan.addTaskAndTaskComponents.slideUp("fast"),plenty_admin.UI.add_template_plan.addTaskBtn.slideDown("fast"),plenty_admin.UI.add_template_plan.taskListHolder.slideDown("fast")):(plenty_admin.UI.add_template_plan.addTaskBtn.slideUp("fast"),plenty_admin.UI.add_template_plan.taskListHolder.slideUp("fast"),plenty_admin.UI.add_template_plan.addTaskAndTaskComponents.slideDown("fast")),plenty_admin.UI.add_template_plan.activityListHolder.find("li.list-group-item.active").removeClass("active"),$(this).parent().addClass("active"),!1}).end().find("button.delete-activity").click(function(){$(this).closest("li").remove(),$(this).closest(".activities_management").find("li.activity").length<=0&&(plenty_admin.UI.add_template_plan.modal.find(".noActivityForTasks").slideDown("fast"),plenty_admin.UI.add_template_plan.addTaskAndTaskComponents.slideUp("fast"))}).end().find("button.edit-activity").click(function(){plenty_admin.UI.add_template_plan.edit_activity()}).end();plenty_admin.UI.add_template_plan.activityListHolder.find("li.list-group-item.active").removeClass("active").end().append(b),b.data("index",b.index());var c=$('<ul class="task_list list-group activity_tasks_'+b.data("index")+'" style="display:none;"></ul>');plenty_admin.UI.add_template_plan.taskListHolder.append(c)}},plenty_admin.UI.add_template_plan.activityListHolder=plenty_admin.UI.add_template_plan.modal.find(".activities_management .activity_list"),plenty_admin.UI.add_template_plan.addActivityForm=plenty_admin.UI.add_template_plan.modal.find("form.add_activity_form"),plenty_admin.UI.add_template_plan.addActivityBtn=plenty_admin.UI.add_template_plan.modal.find("button.add_activity"),plenty_admin.UI.add_template_plan.taskListHolder=plenty_admin.UI.add_template_plan.modal.find(".tasks_management .task_lists"),plenty_admin.UI.add_template_plan.addTaskForm=plenty_admin.UI.add_template_plan.modal.find("form.add_task_form"),plenty_admin.UI.add_template_plan.addTaskAndTaskComponents=plenty_admin.UI.add_template_plan.modal.find(".add_task_and_task_components"),plenty_admin.UI.add_template_plan.addTaskBtn=plenty_admin.UI.add_template_plan.modal.find("button.add_task");